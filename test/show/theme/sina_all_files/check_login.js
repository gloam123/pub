var loginBox=document.getElementById("loginBox");if(loginBox){(function(){if(typeof window.$WeiboJsApi=="undefined"){window.$WeiboJsApi={}}$WeiboJsApi._ajax=function(a){a=a[0]||{};this.url=a.url||"";this.param=a.param||null;this.callback=a.callback||function(){};this.timeout=a.timeout||15000;this.ontimeout=a.ontimeout||function(){};this.timeoutflag=true;if(typeof window._$WeiboJsApi_callback=="undefined"){window._$WeiboJsApi_callback={}}this._setJSONRequest()};$WeiboJsApi._ajax.prototype={_setJSONRequest:function(){var d=document.getElementsByTagName("head")[0];var b=document.createElement("script");var a=this._setRandomFun();var f=this;var e="";for(var c in this.param){if(e==""){e=c+"="+this.param[c]}else{e+="&"+c+"="+this.param[c]}}b.type="text/javascript";b.charset="utf-8";if(d){d.appendChild(b)}else{document.body.appendChild(b)}window._$WeiboJsApi_callback[a.id]=function(g){f.callback(g);f.timeoutflag=false;setTimeout(function(){delete window._$WeiboJsApi_callback[a.id];b.parentNode.removeChild(b)},100)};b.src=this.url+"&callback="+a.name+"&"+e;setTimeout(function(){if(f.timeoutflag){f.ontimeout();setTimeout(function(){delete window._$WeiboJsApi_callback[a.id];b.parentNode.removeChild(b)},100)}},f.timeout)},_setRandomFun:function(){var a="";do{a="$WeiboJsApi"+Math.floor(Math.random()*10000)}while(window._$WeiboJsApi_callback[a]);return{id:a,name:"window._$WeiboJsApi_callback."+a}}};window.$WeiboJsApi.ajax=function(){return new $WeiboJsApi._ajax(arguments)};window.$WeiboJsApi.getWeiboInfo=function(a){return new $WeiboJsApi.ajax({url:"http://127.0.0.1:9527/query?appid=com.sina.weibo",callback:a})};window.$WeiboJsApi.getAppInfo=function(a,b){return new $WeiboJsApi.ajax({url:"http://127.0.0.1:9527/query?appid="+a,callback:b})};window.$WeiboJsApi.startWeibo=function(a){return new $WeiboJsApi.ajax({url:"http://127.0.0.1:9527/si?cmp=com.sina.weibo_com.sina.weibo.SplashActivity&act=android.intent.action.VIEW",callback:a})};window.$WeiboJsApi.startApp=function(a,c,b){return new $WeiboJsApi.ajax({url:"http://127.0.0.1:9527/si?act=android.intent.action.VIEW&cmp="+a+"_"+c,callback:b})};window.$WeiboJsApi.startScheme=function(a,b){return new $WeiboJsApi.ajax({url:"http://127.0.0.1:9527/si?act=android.intent.action.VIEW&data="+a,callback:b})};window.$WeiboJsApi.getUserInfo=function(a){return new $WeiboJsApi.ajax({url:"http://127.0.0.1:9527/login?",callback:a.onsuccess,ontimeout:a.ontimeout,timeout:a.timeout})}})();(function(m,l){function o(v){var u=[],t=/%20/g;var s;for(var r in v){s=v[r].toString();u.push(m.encodeURIComponent(r).replace(t,"+")+"="+m.encodeURIComponent(s).replace(t,"+"))}return u.join("&")}var d=Object.prototype.toString;function c(r){return d.call(r)==="[object Function]"}function q(r){return d.call(r)==="[object Number]"}function i(r){var s=(new Date()).getTime()+Math.floor(Math.random()*100000);return r?r+""+s:s}var j=l.getElementsByTagName("head")[0]||l.documentElement;var n=j.getElementsByTagName("base")[0];var h=/^(?:loaded|complete|undefined)/;var p=function(r,s){r.onload=r.onreadystatechange=function(){if(h.test(r.readyState)){r.onload=r.onreadystatechange=null;j.removeChild(r);r=null}}};function f(r,t){var s=l.createElement("script");s.src=r;if(t){s.charset=t}s.async=true;p(s);if(n){j.insertBefore(s,n)}else{j.appendChild(s)}return s}var k=function(v){var r=v.jsonp||"callback";var w=i("jsonpcallback");var s=r+"="+w;var t=window.setTimeout(function(){if(c(v.ontimeout)){v.ontimeout()}},5000);window[w]=function(x){window.clearTimeout(t);if(c(v.onsuccess)){v.onsuccess(x)}};var u=v.url.indexOf("?")>0?"&":"?";if(v.data){f(v.url+u+o(v.data)+"&"+s,v.charset)}else{f(v.url+u+s,v.charset)}};var b={setCookie:function(s,w,t,z,v,r){var x=[];x.push(s+"="+escape(w));if(t){var y=new Date();var u=y.getTime()+t*3600000;y.setTime(u);x.push("expires="+y.toGMTString())}if(z){x.push("path="+z)}if(v){x.push("domain="+v)}if(r){x.push(r)}l.cookie=x.join(";")},getCookie:function(r){r=r.replace(/([\.\[\]\$])/g,"\\$1");var t=new RegExp(r+"=([^;]*)?;","i");var u=l.cookie+";";var s=u.match(t);if(s){return s[1]||""}else{return""}},deleteCookie:function(r){l.cookie=r+"=;expires=Fri, 31 Dec 1999 23:59:59 GMT;"}};var g=function(r){return l.getElementById(r)},a={},e=false;a.loginBox=g("loginBox");k({url:"http://passport.sina.cn/sso/islogin",data:{entry:"wapsso"},charset:"utf-8",onsuccess:function(r){if(r.retcode===20000000){a.loginBox.href=r.data.return_url;var v='<img src="'+r.data.portrait_url+'">';a.loginBox.innerHTML=v}else{if(r.retcode===50011039){var t=b.getCookie("needapp");if(t===""){e=true}else{var u=(new Date()).getTime()/1000;var s=(u-t)/(60*60);if(s>24){e=true}}if(e){$WeiboJsApi.getUserInfo({onsuccess:function(x){var w={entry:"wapsso",id:x.uid,login_state:x.login_state,from:x.from};k({url:"http://passport.sina.cn/sso/checkapp",data:w,charset:"utf-8",onsuccess:function(y){if(y.retcode===20000000&&x.login_state===1){a.loginBox.href=y.data.return_url;var z='<img src="'+x.portrait_url+'">';a.loginBox.innerHTML=z}else{a.loginBox.href=y.data.return_url}}})},ontimeout:function(){if(a.loginBox.href!=location.href&&a.loginBox.href!=location.href+"#"){a.loginBox.href="http://my.sina.cn/?pos=108&vt=4"}},timeout:2000})}else{if(a.loginBox.href!=location.href&&a.loginBox.href!=location.href+"#"){a.loginBox.href="http://my.sina.cn/?pos=108&vt=4"}}}}}})})(window,document)};