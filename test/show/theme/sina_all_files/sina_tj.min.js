
function Sina_tj(options){this._init();this._preview();};Sina_tj.prototype._init=function(){this.saxApi='http://sax.sina.cn/wap/impress?';this.previewApi='http://sax.sina.cn/wap/preview?';window.oSax=$('.j_sax');window.oSax_arr=[];if(!window.saxConfig){saxConfig={};};if(saxConfig.topData){var topData=saxConfig.topData;}
else{var topData=''};for(var i=0;i<oSax.length;i++){if(oSax[i].dataset.id){oSax_arr.push(oSax[i].dataset.id);}}};Sina_tj.prototype._preview=function(){var url=this.previewApi;if(!!url==false){return false;};if(url.indexOf('?')==-1){url=url+'?';};var _this=this;var pdata=this.pdata=isPreview();if(typeof pdata=='string'){_this._sax();}
else{for(var i=0;i<oSax_arr.length;i++){if(pdata.ids==oSax_arr[i]){window.pIndex=i;break;}}
if(!pdata.ids||!pdata.deid){alert('参数错误');_this._sax();}
else{$.ajax({url:url+'adunit_id='+pdata.ids+'&deid='+pdata.deid+'&ip='+pdata.ip+'&date='+pdata.date+'&rotate_count='+parseInt(Math.random()*1000)+'&page_url='+encodeURIComponent(window.location.href)+'&version=vt4&timestamp='+new Date().getTime(),data:{},type:'jsonp',callback:'wap_callback',timeout:5000,success:function(rs){if(!rs.ad){alert('没有预览数据');}
else{window.previewData=rs.ad[0];}
_this._sax();},error:function(rs){},complete:function(){}});};};};Sina_tj.prototype._sax=function(){var _this=this;var url=this.saxApi;if(!!url==false){return false;};if(url.indexOf('?')==-1){url=url+'?';};var ids=oSax_arr.join(',');if(ids==''){return;};$.ajax({url:url+'adunit_id='+oSax_arr.join(',')+'&rotate_count='+parseInt(Math.random()*1000)+'&version=vt4&page_url='+encodeURIComponent(window.location.href)+'&timestamp='+new Date().getTime(),data:{},type:'jsonp',callback:'wap_callback',timeout:5000,success:function(rs){if(!rs.ad){return;}
var oImgSwipe=$('.j_imgSlide');var data=rs.ad;if(window.pIndex||window.pIndex==0&&_this.pdata.ids){data[pIndex]=window.previewData;}
var lmt=1;var oAdv=[];var oSax_type=[];arr_pv=[];for(var i=0;i<oSax_arr.length;i++){oSax_type[i]=data[i].type;if(data[i]['content'][0]){for(var j=0;j<data[i]['content'][0]['pv'].length;j++){if(data[i]['content'][0]['pv'][j]){arr_pv.push(data[i]['content'][0]['pv'][j]);}}}
oAdv[i]=[];switch(data[i].type){case"jdt":if(data[i]['content'][0]){if(data[i]['content'][0]['link'][0]&&data[i]['content'][0]['src'][0]){if(oSax[i].className.indexOf('sina_tj_jdt')!=-1){push_jdt(data[i],oAdv[i]);oSax[i].dataset.loaded=1;var maxNum=document.querySelector('.maxNum');maxNum.innerHTML=maxNum.innerHTML-0+1;if(oImgSwipe.length>0){if(oImgSwipe.find('.top_slide_wrap').child().eq(oSax.eq(i).data('pos')-1).length>0){oSax.eq(i).insertBefore(oImgSwipe.find('.top_slide_wrap').child().eq(oSax.eq(i).data('pos')-1));}
else{console.log(oSax.eq(i).data('pos'))
oImgSwipe.child()[0].appendChild(oSax.eq(i)[0]);}}
oSax.eq(i).addClass('swipe_pic');}
if(oSax[i].className.indexOf('sina_tj_atlas')!=-1){push_atlas(data[i],oAdv[i]);oSax.eq(i).parents('.j_atlas').removeClass('hide');}}}
break;case"qp":if(oSax[i].className.indexOf('sina_tj_qp')!=-1){if(data[i]['content'][0]){if(data[i]['content'][0]['link'][0]&&data[i]['content'][0]['src'][0]){var qpdata={title:data[i]['content'][0]['src'][0],imgl:data[i]['content'][0]['src'][1],clickUrl:data[i]['content'][0]['link'][0],monitorUrl:'',display:'up'}
lmt=0;}}}
break;case"lmt":if(lmt&&oSax[i].className.indexOf('sina_tj_lmt')!=-1){if(data[i]['content'][0]){if(data[i]['content'][0]['link'][0]&&data[i]['content'][0]['src'][0]){var lmtdata={title:data[i]['content'][0]['src'][0],imgl:data[i]['content'][0]['src'][1],clickUrl:data[i]['content'][0]['link'][0],monitorUrl:'',display:'down'}}}}
break;case"wzl":if(data[i]['content'][0]){if(data[i]['content'][0]['link'][0]&&data[i]['content'][0]['src'][0]){if(oSax[i].className.indexOf('sina_home_txt')!=-1||oSax[i].className.indexOf('sina_tj_feed')!=-1||oSax[i].className.indexOf('sina_tj_card_article')!=-1||oSax[i].className.indexOf('sina_tj_article_top')!=-1){push_home_txt(data[i],oAdv[i]);}
if(oSax[i].className.indexOf('sina_tj_home_tips')!=-1||oSax[i].className.indexOf('sina_tj_article_list')!=-1){push_wzl_tips(data[i],oAdv[i]);}
if(oSax[i].className.indexOf('sina_tj_article_rec')!=-1){push_article_rec(data[i],oAdv[i]);}
if(oSax[i].className.indexOf('sina_tj_card_app')!=-1){push_card_app(data[i],oAdv[i]);$('.sina_tj_card_app').parent().data('newsid',data[i]['content'][0]['src'][0].split('#')[1]||'');}}}
break;case"hf":if(data[i]['content'][0]){if(data[i]['content'][0]['link'][0]&&data[i]['content'][0]['src'][0]){if(oSax[i].className.indexOf('sina_tj_baner')!=-1||oSax[i].className.indexOf('sina_tj_top')!=-1){checkImg(data[i]['content'][0]['src'][0],oSax.eq(i));push_hf(data[i],oAdv[i]);}}
else if(oSax[i].className.indexOf('sina_tj_top')!=-1&&topData){push_hf(topData,oAdv[i]);}}
else if(oSax[i].className.indexOf('sina_tj_top')!=-1&&topData){push_hf(topData,oAdv[i]);}
break;}}
for(var i=0;i<oSax_arr.length;i++){if(oSax_type[i]=='qp'&&lmt==0){generalize(qpdata,oSax.eq(i));continue;}
if(oSax_type[i]=='lmt'&&lmt==1){generalize(lmtdata,oSax.eq(i));continue;}
if(oAdv[i].join('')==''){oSax.eq(i).remove();}
else{oSax.eq(i).append(oAdv[i].join(''));}}
for(var i=0;i<oSax.length;i++){if(oSax[i].dataset.id&&oSax[i]){oSax_arr.push(oSax[i].dataset.id);}}
var str='<div>';for(var j=0;j<arr_pv.length;j++){str+='<img src="'+arr_pv[j]+'" alt="pv_monitor" style="display:none;" />';}
str+='</div>';$('body').append(str);},error:function(rs){},complete:function(){slideInit();atlasHeight();}});};function isPreview(){var location=decodeURIComponent(window.location.href);if(location.indexOf('preview')!=-1){var arr_location=location.split('#');var data={}
var arr_json=arr_location[1].split('=');var arr_ids=arr_json[1].split('|');data.ids=arr_ids[0];data.date=arr_ids[1];data.ip=arr_ids[2];data.deid=arr_ids[3];return data;}
else{return'';};};function checkImg(src,obj){var oImg=new Image();oImg.onerror=function(){obj.remove();console.log('一张图片加载失败了！')}
oImg.src=src;};setTimeout(function(){var oSina_tj=new Sina_tj();window.addEventListener('resize',function(){atlasHeight();});},300);function slideInit(){var slide=document.querySelector('.j_imgSlide'),slideConfig={startIndex:0,auto:true,circular:true,interval:3000,speed:300,maxHeight:207,callback:function(ele,index,direction){var innerWrap=ele.parentNode,items=innerWrap.children,len=items.length,wrap=innerWrap.parentNode,num=wrap.querySelector('.curNum'),item=this.direction==1?items[index>1?index-1:len-1]:items[index<len-1?index+1:0],img=item.querySelector('img'),oImg;num.innerHTML=index+1;if(img.getAttribute('data-src')){oImg=new Image();oImg.src=img.getAttribute('data-src');oImg.onload=function(){img.src=img.getAttribute('data-src');img.removeAttribute('data-src');removeClass(item,'toload');}}}}
var slide=new Swiper(slide,null,slideConfig);}
function generalize(data,obj){var mainPage=obj;if(mainPage&&data){var adConfig=data;var delay=adConfig.delay?adConfig.delay:5,hideDelay=delay*1000,adImg=window.devicePixelRatio>=2?adConfig.imgh||adConfig.imgl:adConfig.imgl,adw=320,adh=180,adTimer;var expires=new Date(),key='ad_'+adConfig.id,dayTime=24*60*60*1000,flag=true,currDate=''+expires.getFullYear()+(expires.getMonth()+1)+expires.getDate(),match=new RegExp("(^| )"+key+"=([^;]*)(;|$)").exec(document.cookie);if(match&&match[2]===currDate){flag=false;}
expires.setTime((Math.floor(expires.getTime()/dayTime)+1)*dayTime);document.cookie=key+"="+currDate+"; expires="+expires.toGMTString();function loadMonitorImg(url){if(url){var img=new Image();img.src=url;img.alt='pv_monitor';img.style.display='none';mainPage.append(img);}}
function loadMonitor(){if(adConfig.monitorUrl){if(typeof(adConfig.monitorUrl)=='string'){loadMonitorImg(adConfig.monitorUrl);}else{var i,leng=adConfig.monitorUrl.length;for(i=0;i<leng;i++){loadMonitorImg(adConfig.monitorUrl[i]);}}}
if(adConfig.cookieMapping){if(typeof(adConfig.cookieMapping)=='string'){loadMonitorImg(adConfig.cookieMapping);}else{var j,len=adConfig.cookieMapping.length;for(j=0;j<len;j++){loadMonitorImg(adConfig.cookieMapping[j]);}}}}
function loadAd(url,cb){var img=new Image();img.src=url;img.onload=function(){var w=img.width,h=img.height;cb(w,h);}}
function hideAd(that,type){if(adTimer){clearTimeout(adTimer);adTimer=null;}
if(type=='hide'){that.css('opacity','0');setTimeout(function(){try{that.remove();}catch(e){}},1000);}else if(type=='toggle'){if(that.css('height')=='0px'){that.css('height',adh+'px');that.parent().find('.j_adCloseBtn').css({'-webkit-transform':'rotate(-45deg)','top':'15px'});}else{that.css('height','0px');that.parent().find('.j_adCloseBtn').css({'-webkit-transform':'rotate(135deg)','top':'10px'});}}
return false;}
function initAdDown(){loadAd(adImg,function(w,h){var adTitle='<a href="'+adConfig.clickUrl+'" target="_blank"><p style="position:relative;border-bottom:1px solid #D9DADC;background:#eef8ff;color:#0e84d7;font-size:17px;line-height:36px;padding:0 8px;">'+adConfig.title+'</p></a>';mainPage.append(adTitle);if(flag){var adImgHtml='<a id="j_adImgDown" href="'+adConfig.clickUrl+'" target="_blank" style="position:fixed;z-index:9999;bottom:0;left:0;width:100%;height:'+adh+'px;background:'+(adConfig.bgColor||'#eef8ff')+';text-align:center;opacity:1;-webkit-transition:opacity 0.5s ease-in;-moz-transition:opacity 0.5s ease-in;"><div style="display:inline-block;background:url('+adImg+') no-repeat center center;background-size:100% auto;position:relative;width:'+adw+'px;height:'+adh+'px"><span class="j_adClose" style="position:absolute; right:0; top:0;display:inline-block;background:url(http://site.proc.sina.cn/explore_v2/ls/ad/close.png) no-repeat;background-size:40px auto;width:40px;height:40px; line-height:40px; text-indent:999em; overflow:hidden">关闭</span></div></a>';mainPage.append(adImgHtml);var adImgObj=$('#j_adImgDown');adClose=adImgObj.find('.j_adClose');bindEvent(adClose[0],'click',function(){hideAd(adImgObj,'hide');return false;})
adTimer=setTimeout(function(){hideAd(adImgObj,'hide');},hideDelay);}});}
function initAdUp(){loadAd(adImg,function(w,h){var adImgHtml='<a style="display:block;background:rgb(250, 250, 250);" href="'+adConfig.clickUrl+'" target="_blank"><div id="j_adImgUp" style="background:url('+adImg+') no-repeat center top;height:0px;-webkit-transition:height 0.5s ease-in; overflow:hidden;"></div><div style="position:relative;border-bottom:1px solid #D9DADC;background:'+(adConfig.bgColor||'#eef8ff')+';color:#0e84d7;font-size:17px;line-height:36px;padding:0 8px;">'+adConfig.title+'<div class="j_adClose" style="display:inline-block;width:25px;height:26px;position:absolute; right:0px; top:0; padding:10px 0 0 15px; z-index:111"><span class="j_adCloseBtn" style="display:inline-block;width:8px;height:8px;border-top:#ffcc00 solid 3px;border-right:#ffcc00 solid 3px;-webkit-transform:rotate('+(flag?'-45':'135')+'deg);-moz-transform:rotate('+(flag?'-45':'135')+'deg);position:absolute;left:15px;top:'+(flag?'15':'10')+'px;"></span></div></div></a>';mainPage.append(adImgHtml);var adImgObj=$('#j_adImgUp'),adClose=adImgObj.parent().find('.j_adClose');if(flag){setTimeout(function(){adImgObj.css('height',adh+'px');},10)
adTimer=setTimeout(function(){hideAd(adImgObj,'toggle');return false;},hideDelay);}
bindEvent(adClose[0],'click',function(){hideAd(adImgObj,'toggle');return false;})});}}
function adload(){if(mainPage&&adConfig){adConfig.display=adConfig.display||'';setTimeout(function(){if(adConfig.display=='down'){initAdDown();}else if(adConfig.display=='up'){initAdUp();}},100);setTimeout(loadMonitor,1000);}}
function getCookie(objName){var arrStr=document.cookie.split("; ");for(var i=0;i<arrStr.length;i++){var temp=arrStr[i].split("=");if(temp[0]==objName)return unescape(temp[1]);}}
function setCookie(name,value,expires,path,domain,secure){var oDate=new Date();oDate.setDate(oDate.getDate()+expires);document.cookie=name+"="+escape(value)+
((expires)?"; expires="+oDate:"")+
((path)?"; path="+path:"")+
((domain)?"; domain="+domain:"")+
((secure)?"; secure":"");}
setTimeout(adload,100);}
function push_home_txt(data,arr){arr.push('<div class="sina_home_t"><a href="'+data['content'][0]['link'][0]+'" title="'+data['content'][0]['src'][0]+'">'+data['content'][0]['src'][0]+'</a></div>');};function push_wzl(data,arr){arr.push('<a class="sina_tj" href="'+data['content'][0]['link'][0]+'" title="'+data['content'][0]['src'][0]+'">'+data['content'][0]['src'][0]+'</a>');};function push_wzl_tips(data,arr){arr.push('<div class="sina_tj_tips">');arr.push('<a href="'+data['content'][0]['link'][0]+'" title="'+data['content'][0]['src'][0]+'">'+data['content'][0]['src'][0]+'</a>');arr.push('<em>推广</em>');arr.push('</div>');};function push_article_rec(data,arr){arr.push('<a href="'+data['content'][0]['link'][0]+'" title="'+data['content'][0]['src'][0]+'">'+data['content'][0]['src'][0]+'</a>');};function push_card_app(data,arr){arr.push('<dl><dt>');arr.push('<img src="http://u1.sinaimg.cn/upload/2014/0108/09/99691b6f.png" alt="">');arr.push('</dt><dd>');arr.push('<h3>'+data['content'][0]['src'][0].split('#')[0]+'</h3>');arr.push('<p>更多相关报道 上新浪新闻APP</p>');arr.push('</dd></dl>');};function push_hf(data,arr){arr.push('<a href="'+data['content'][0]['link'][0]+'">');arr.push('<img src="'+data['content'][0]['src'][0]+'" alt="" /></a>');};function push_jdt(data,arr){arr.push('<a href="'+data['content'][0]['link'][0]+'">');arr.push('<img src="'+data['content'][0]['src'][0]+'" data-src="'+data['content'][0]['src'][0]+'" alt="" />');if(data['content'][0]['src'][1]){arr.push('<span class="top_slide_info"><i class="top_slide_t">'+data['content'][0]['src'][1]+'</i></span>');};arr.push('</a>');};function push_atlas(data,arr){arr.push('<a href="'+data['content'][0]['link'][0]+'">');arr.push('<img class="news_pic_img" src="'+data['content'][0]['src'][0]+'" alt="" />');if(data['content'][0]['src'][1]){arr.push('<p class="news_pic_info">'+data['content'][0]['src'][1]+'</p>');}
arr.push('</a>');}
function atlasHeight(){var picWidth=Math.ceil((getWidth()-24-4)/2),picHeight=Math.floor(picWidth*3/4)-5,initPicDom=document.querySelectorAll('.sina_tj_atlas a');for(var i=0;i<initPicDom.length;i++){initPicDom[i].style['height']=picHeight+'px';}}
function getWidth(){return window.innerWidth||document.documentElement.clientWidth||document.body.clientWidth||0;};function Sina(arg){this.elements=[];this.domString='';switch(typeof arg){case'function':addReady(arg);break;case'string':if(arg.indexOf('<')!=-1){this.domString=arg;}
else{this.elements=getEle(arg);};break;case'object':if(!arg){return;}
if(arg.length){for(var i=0;i<arg.length;i++){this.elements[i]=arg[i];}}
else{this.elements.push(arg);};break;}
for(var i=0;i<this.elements.length;i++){this[i]=this.elements[i];}
this.length=this.elements.length;};Sina.prototype.css=function(name,value)
{if(arguments.length==2){for(var i=0;i<this.elements.length;i++){this.elements[i].style[name]=value;}}
else{if(typeof name=='string'){var obj=this.elements[0];return getStyle(obj,name);}
else{for(var i=0;i<this.elements.length;i++){for(var j in name){this.elements[i].style[j]=name[j];}}};};return this;};Sina.prototype.data=function(name,value){if(arguments.length==2){for(var i=0;i<this.elements.length;i++){this.elements[i].dataset[name]=value;}}
else{return this.elements[0].dataset[name];};return this;};Sina.prototype.attr=function(name,value){if(arguments.length==2){for(var i=0;i<this.elements.length;i++){this.elements[i].setAttribute(name,value);}}
else{if(typeof name=='string'){var obj=this.elements[0];return obj[name]||obj.getAttribute(name);}
else{for(var i=0;i<this.elements.length;i++){for(var j in name){this.elements[i].setAttribute(j,name[j]);}}};};return this;};Sina.prototype.html=function(str){if(arguments.length==1){for(var i=0;i<this.elements.length;i++)
{this.elements[i].innerHTML=str;}}
else{var obj=this.elements[0];return obj.innerHTML;};return this;};Sina.prototype.append=function(arg)
{var oTmp=document.createElement('div');if(arg instanceof Sina){var obj=arg;oTmp.innerHTML=obj[0];}
else{var obj=$(arg);oTmp.innerHTML=obj.domString;};while(oTmp.childNodes.length>0){this.elements[0].appendChild(oTmp.childNodes[0]);}
return this;};Sina.prototype.insertBefore=function(arg){if(arg instanceof Sina){var arg=arg;if(!arg[0]){return;}}
else{var arg=$(arg);};var obj=arg.parent();for(var i=0;i<this.elements.length;i++){obj[0].insertBefore(this.elements[i],arg[0]);}
return this;};Sina.prototype.parent=function(){return $(this.elements[0].parentNode);};Sina.prototype.parents=function(className){var parent=$(this).parent();if(parent[0].className.indexOf(className.substring(1))!=-1){return parent;}
else{return parent.parents(className);}};Sina.prototype.child=function(){return $(this.elements[0].children);};Sina.prototype.remove=function(){for(var i=0;i<this.elements.length;i++){var oParent=this.elements[i].parentNode;oParent.removeChild(this.elements[i]);}
return this;};Sina.prototype.eq=function(n){return $(this.elements[n]);};Sina.prototype.index=function(){var obj=this.elements[this.elements.length-1];var brother=obj.parentNode.children;for(var i=0;i<brother.length;i++){if(brother[i]==obj){return i;};}};Sina.prototype.find=function(str){var result=getEle(str,this.elements);return $(result);};Sina.prototype.each=function(fn){for(var i=0;i<this.elements.length;i++){fn.call(this.elements[i],i,this.elements[i]);}};Sina.prototype.addClass=function(sClass){var re=new RegExp('\\b'+sClass+'\\b');for(var i=0;i<this.elements.length;i++){if(!re.test(this.elements[i].className)){if(this.elements[i].className){this.elements[i].className+=' '+sClass;}
else{this.elements[i].className=sClass;};};}};Sina.prototype.removeClass=function(sClass){var re=new RegExp('\\b'+sClass+'\\b','g');for(var i=0;i<this.elements.length;i++){this.elements[i].className=this.elements[i].className.replace(re,'').replace(/\s+/g,' ');}};$.fn=Sina.fn=Sina.prototype;$.fn.extend=function(json){for(var i in json){Sina.prototype[i]=json[i];}};function $(arg){return new Sina(arg);}
$.ajax=function(json){json.data=json.data||{};json.type=(json.type||'get').toLowerCase();json.timeout=json.timeout||0;json.callback=json.callback||'jsoncallback';if(json.type=='jsonp'){var fnName='jsonp_'+Math.random();fnName=fnName.replace('.','');window[fnName]=function(result){json.success&&json.success(result);json.complete&&json.complete();oHead.removeChild(oS);window[fnName]=null;clearTimeout(timer);};json.data[json.callback]=fnName;var arr=[];for(var i in json.data){arr.push(i+'='+encodeURIComponent(json.data[i]));}
var sData='&'+arr.join('&');var oS=document.createElement('script');oS.src=json.url+sData;var oHead=document.getElementsByTagName('head')[0];oHead.appendChild(oS);if(json.timeout){var timer=setTimeout(function(){json.error&&json.error();json.complete&&json.complete();oHead.removeChild(oS);window[fnName]=null;},json.timeout);}}
else{if(window.XMLHttpRequest){var oAjax=new XMLHttpRequest();}
else{var oAjax=new ActiveXObject('Microsoft.XMLHTTP');};json.data.t=Math.random();var arr=[];for(var i in json.data){arr.push(i+'='+encodeURIComponent(json.data[i]));}
var sData=arr.join('&');if(json.type=='get'){oAjax.open('get',json.url+'?'+sData,true);oAjax.send();}
else{oAjax.open('post',json.url,true);oAjax.setRequestHeader('Content-Type','application/x-www-form-urlencoded');oAjax.send(sData);};oAjax.onreadystatechange=function(){if(oAjax.readyState==4){if(oAjax.status>=200&&oAjax.status<300||oAjax.status==304){json.success&&json.success(oAjax.responseText);}
else{json.error&&json.error();};json.complete&&json.complete();clearTimeout(timer);};};if(json.timeout){var timer=setTimeout(function(){json.error&&json.error();json.complete&&json.complete();oAjax.onreadystatechange=null;},json.timeout);};};};function getStyle(obj,name){if(obj.currentStyle){return obj.currentStyle[name];}
else{return getComputedStyle(obj,false)[name];};};function isChild(oParent,obj){while(obj){if(obj==oParent)return true;obj=obj.parentNode;}
return false;};function hasClass(obj,sClass){var re=new RegExp('\\b'+sClass+'\\b');if(re.test(obj.className)){return true;}
else{return false;};};function _getStr(aParent,str){var aChild=[];for(var i=0;i<aParent.length;i++){var arr=aParent[i].querySelectorAll(str);for(var j=0;j<arr.length;j++){aChild.push(arr[j]);}}
return aChild;};function getEle(str,aParent){var arr=str.replace(/^\s+|\s+$/g,'').split(/\s+/g);aParent=aParent||[document];var aChild=[];for(var i=0;i<arr.length;i++){aChild=_getStr(aParent,arr[i]);aParent=aChild;}
return aChild;}