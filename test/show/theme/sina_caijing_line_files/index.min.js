$(function(){function f(j){if(isNaN(j)){return j}var m="",l=0,k="";if(j<0){m="-";j=Math.abs(j)}l=j;if(j>100000000){l=Math.round(j/100000000*100)/100;k="亿"}else{if(j>10000){l=Math.round(j/10000*100)/100;k="万"}else{l=Math.round(j*100)/100}}if(l.toString().indexOf(".")==-1){l=l+".00"}else{if((l.toString().split(".")[1]).toString().length==1){l=l+"0"}}return(m+l+k)}function g(k){var m="",j=k.toString(),l=j.length-3;for(;l>=0;l-=3){m=j.substr(l,3)+","+m;j=j.slice(0,j.length-3)}if(j.length>0){m=j+","+m}m=m.slice(0,m.length-1);return m}var e={init:function(){this.drawDetailCircle()},drawDetailCircle:function(){var j=$("#mBuy");if(!j||j.length===0){return}var s=$("#mBuy").text(),r=$("#mSell").text(),p=$("#sBuy").text(),n=$("#sSell").text(),q=parseFloat($("#nmBuy").text()),o=parseFloat($("#nmSell").text()),m=parseFloat($("#nsBuy").text()),l=parseFloat($("#nsSell").text()),k=q+o+m+l;q=q/k;o=o/k;m=m/k;l=l/k;new DrawCircle("detailCanvas",{color:["#f35535","#0ac837","#82e700","#ff9c00"],data:[q,o,m,l],node:"dCanvasNote",note:[s,r,p,n]})}};var a={init:function(){var l=$("#stockGrade");if(!l||l.length===0){return}var k=document.getElementsByTagName("script")[0],j=document.createElement("script");j.src="http://finance.sina.com.cn/realstock/company/"+$(".j_serialNum").text()+"/other_jsvar.js";j.onload=function(){if(isNaN(gradeLevel)||gradeLevel<=0||gradeLevel>5){$("#stockGradeYes").addClass("hide");$("#stockGradeNo").removeClass("hide");return}var n=gradeLevel-1,m=$("#stockGrade").find("span");m.eq(n).html(m.eq(n).html()+'<em class="stock_suggest">推荐</em>');m.eq(n).addClass("active");$("#stockGradeNo").addClass("hide");$("#stockGradeYes").removeClass("hide")};k.parentNode.insertBefore(j,k)}};var i={isRefreshing:false,init:function(){var j=this;$(".j_refresh").on("click tap",function(k){j._userRefresh(k)});setInterval(function(){j._userRefresh()},20*1000)},_userRefresh:function(l){l&&l.preventDefault();l&&l.stopPropagation();var j=this;var k="/aj/sh/info?code="+$(".j_serialNum").text();$.ajax({url:k,async:true,type:"GET",dataType:"json",timeout:10000,success:function(m){j.handleData(m)},error:function(m){}})},handleData:function(l){if(!l){return}var n=0,o="",q=((typeof l)!="object")?JSON.parse(l):l,k=null;q=q.data;if(q.hq){$(".j_stockCurValue").html(q.hq["zuixin"]).removeClass("num_red num_green num_black num_grey").addClass(q.hq["col"]);$(".j_valRange").html(q.hq["zhangdiee"]).removeClass("num_red num_green num_black num_grey").addClass(q.hq["col"]);$(".j_valExtent").html(q.hq["zhangdiefu"]).removeClass("num_red num_green num_black num_grey").addClass(q.hq["col"])}if(q.ah){if(q.ah["zuixin"]){$(".j_newstock_price").html(q.ah["zuixin"]).removeClass("num_red num_green num_black num_grey").addClass(q.ah["color"])}if(q.ah["zhangdiefu"]){$(".j_newstock_valRan").html(q.ah["zhangdiefu"]).removeClass("num_red num_green num_black num_grey").addClass(q.ah["color"])}if(q.ah["yijia"]){$(".j_newstock_money").html(q.ah["yijia"])}if(q.ah["shengyu"]){$(".j_newstock_info").html(q.ah["shengyu"])}}var s=$(".j_stockfifth").find("ul");if(q.five){o="";k=null;for(var m=1;m<=5;m++){k=q.five["mai4"][""+m];o+="<li><span>卖";switch(m){case 1:o+="①";break;case 2:o+="②";break;case 3:o+="③";break;case 4:o+="④";break;case 5:o+="⑤";break}o+='</span><span class="'+k.col+'">'+k.jia+"</span><span>"+k.liang+"</span></li>"}s.eq(0).html(o);o="";k=null;for(var m=1;m<=5;m++){k=q.five["mai3"][""+m];o+="<li><span>买";switch(m){case 1:o+="①";break;case 2:o+="②";break;case 3:o+="③";break;case 4:o+="④";break;case 5:o+="⑤";break}o+='</span><span class="'+k.col+'">'+k.jia+"</span><span>"+k.liang+"</span></li>"}s.eq(1).html(o)}if(q.trade_detail){var p=q.trade_detail.length;o="<tr><th>交易时间</th><th>成交价</th><th>量（手）</th><th>性质</th></tr>";for(var m=0;m<p;m++){k=q.trade_detail[m];o+="<tr><td>"+k.shijian+"</td><td>"+k.chengjiaojia+"</td><td>"+k.chengjiaoliang+'</td><td class="'+k.color+'">'+k.xingzhi+"</td></tr>"}$(".j_trade_detail").empty();$(".j_trade_detail").html(o)}if(q.fund_flow){k=q.fund_flow;$("#fundFlow").html('<li><em class="c_1">　</em>主力买入<span id="mBuy">'+k.zhulimairubi+'</span><span id="nmBuy">'+k.zhulimairu+'</span></li><li><em class="c_2">　</em>主力卖出<span id="mSell">'+k.zhulimaichubi+'</span><span id="nmSell">'+k.zhulimaichu+'</span></li><li><em class="c_3">　</em>散户卖出<span id="sBuy">'+k.sanhumaichubi+'</span><span id="nsBuy">'+k.sanhumaichu+'</span></li><li><em class="c_4">　</em>散户买入<span id="sSell">'+k.sanhumairubi+'</span><span id="nsSell">'+k.sanhumairu+"</span></li>");var j=document.getElementById("detailCanvas"),r=j.getContext("2d");r.clearRect(0,0,j.width,j.height);$("#dCanvasNote").html("");e.drawDetailCircle()}}};var c={init:function(){var j=this;$(".j_selfBtn").on("click tap",function(k){j._selfSelect(k)})},_selfSelect:function(j){j&&j.stopPropagation();j&&j.preventDefault();var k="";var l=$(".j_serialNum").text();var m=$(".j_selfBtn");var o=m.find("ul.user_combin");var p=m.find("b").hasClass("on")?"addstock":"delstock";var q="&type=sh";if(o&&o.length>0){if(m.find("b").hasClass("on")){if("none"===o.css("display")){o.show()}else{if($(j.target).is("li")||$(j.target).is("span")){var n=null;if($(j.target).is("span")){n=$(j.target).parent("li")}var r="";r=n.attr("data-group")||"";m.attr("data-group",r);k="/aj/mystock/"+p+"?code="+l+q+"&pid="+r;this._work(k);o.hide()}else{o.hide()}}}else{r=m.find("b").data("pid");k="/aj/mystock/"+p+"?code="+l+q+"&pid="+r;m.attr("data-group");this._work(k)}}else{k="/aj/mystock/"+p+"?code="+l+q;this._work(k)}},_work:function(j){$.ajax({url:j,async:true,type:"GET",dataType:"json",success:function(n){if(!n){return}n=n.data;var m=$(".j_selfBtn"),k=$("#hintLabel")||null,l=((typeof n)!="object")?JSON.parse(n):n;if(l.url){location.href=l.url;return}if(k&&(k.length>0)){if(m.find("b").hasClass("on")){k.html("添加成功").show();m.find("b").removeClass("on").addClass("off")}else{if(m.find("b").hasClass("off")){k.html("删除成功").show();m.find("b").removeClass("off").addClass("on")}}setTimeout(function(){k.hide()},600)}},error:function(l){var k=$("#hintLabel")||null;if(k&&(k.length>0)){k.html(($(".j_selfBtn").find("b").hasClass("on"))?"添加失败":"删除失败").show();setTimeout(function(){k.hide()},600)}}})}};var h={init:function(){var q=$(".j_tab1"),m=q.find("li");var o=$(".j_stock_infocontents"),u=$(".j_stock_infocontents").find("div.tab1Infos");m.on("click tap",function(){if($(this).parent().find("li").size()<=1){return}if($(this).find("a").hasClass("active")){return}var w=$(this),v=m.index(this);m.find("a").removeClass("active");w.find("a").addClass("active");u.hide();u.eq(v).show()});var p=$(".j_tab2"),j=p.find("li");var k=$(".j_tab2Content"),l=k.find("div.tab2Infos");j.on("click tap",function(){if($(this).parent().find("li").size()<=1){return}if($(this).hasClass("active")){return}var w=$(this),v=j.index(this);j.removeClass("active");w.addClass("active");l.hide();l.eq(v).show()});var n=$(".j_tab3"),s=n.find("li");var t=$(".j_stock_infocontents2"),r=t.find("div.tab3Infos");s.on("click tap",function(){if($(this).parent().find("li").size()<=1){return}if($(this).find("a").hasClass("active")){return}var w=$(this),v=s.index(this);s.find("a").removeClass("active");w.find("a").addClass("active");r.hide();r.eq(v).show()})}};var b={searchTimer:null,hkDefaultVal:null,init:function(){var j=this;$(".j_searchCross").hide();$(".j_searchInput").on("focus",function(){j._clearSearchDefault()});$(".j_searchInput").on("blur",function(){j._recoverSearchDefault()});$("#searchInput").on("focus",function(){j._setSearchContent()});$("#searchInput").on("blur",function(){j._defaultSearchContent()});$("#searchBtn").on("click tap",function(){j._onSearch()});$(".j_searchInput").on("input",function(){$(".j_searchCross").show()});$(".j_searchCross").on("click tap",function(){j._clearSearchContent()})},_clearSearchDefault:function(){var k=$(".j_searchInput").attr("default");var j=$.trim($(".j_searchInput").val());if(k===j){$(".j_searchInput").val("")}$(".j_searchInput").addClass("focus")},_recoverSearchDefault:function(){var j=$.trim($(".j_searchInput").val());if(""===j){$(".j_searchInput").val($(".j_searchInput").attr("default"));$(".j_searchInput").removeClass("focus")}},_setSearchContent:function(){var j=this;if(!this.hkDefaultVal){var k=$("#searchInput");this.hkDefaultVal=k?$.trim(k.val()):""}this.searchTimer=setInterval(function(){j._checkSearchContent()},200)},_checkSearchContent:function(){var j=$("#searchInput"),l=$("#searchCross"),k=j?$.trim(j.val()):"";if(k===this.hkDefaultVal){j.val("");k=""}if(l){if(k===""){if(l.css("display")!="none"){l.css("display","none")}}else{if(l.css("display")!="block"){l.css("display","block")}}}},_defaultSearchContent:function(){if(this.searchTimer){clearInterval(this.searchTimer);this.searchTimer=null}var j=$("#searchInput"),k=j?$.trim(j.val()):"";(k==="")&&(j.val(this.hkDefaultVal))},_onSearch:function(){var j=$("#searchInput"),k=j?$.trim(j.val()):"";(!this.hkDefaultVal)&&(this.hkDefaultVal=k);if((k==="")||(k===this.hkDefaultVal)){return}location.href="search.php?keyword="+k+"&type=us"},_clearSearchContent:function(){var j=$(".j_searchInput"),k=$(".j_searchCross");k&&k.css("display","none");if(j){j.val("");j.focus()}}};var d={_canvasAndMenuInit:function(){window.aStockCanvas.init("stockKLine",$(".j_serialNum").text());var m=null,p=$("#klTabs"),l=p.find("li"),j=p.find("em"),q=l.not(".open_more"),n=p.find("li.open_more"),o=$("#klTabsMore"),k=o.find("p");q.on("click tap",function(){m=$(this);if(m.find("a").hasClass("active")){return}l.find("a").removeClass("active");k.find("a").removeClass("active");$(".j_open_moremark").removeClass("up").addClass("down");m.find("a").addClass("active");k.removeClass("active");o.hide()});n.on("click tap",function(){if("none"===o.css("display")){$(".j_open_moremark").removeClass("down").addClass("up");o.show()}else{$(".j_open_moremark").removeClass("up").addClass("down");o.hide()}});k.on("click tap",function(){m=$(this);if(m.hasClass("active")){return}q.find("a").removeClass("active");n.find("a").addClass("active");k.removeClass("active");m.addClass("active")})},_windowInit:function(){window.addEventListener("onorientationchange" in window?"orientationchange":"resize",function(){switch(window.orientation){case 0:case 180:location.hash="";break;case -90:case 90:location.hash="#H5Picture";break}},false)},init:function(){this._windowInit();c.init();h.init();b.init();e.init();a.init();this._canvasAndMenuInit();if(typeof(symbol_status)==="string"&&symbol_status==""){i.init()}}};setTimeout(function(){d.init()},300);window.addEventListener("pageshow",function(){setTimeout(function(){var j=$("#searchCross");if(j){if(j.css("display")!="none"){j.css("display","none")}}$(document).trigger("resize")},300)},false)});$(function(){var c=$(".extension");var b='<div class="extension sina_appexten"><span class="item_index"></span>';var a=window.location.href;var f=a.lastIndexOf("code=")+5;var d=a.substr(f);var e="http://stocks.sina.cn/aj/sh/promoted?code="+d;$.ajax({async:false,url:e,type:"GET",success:function(h){if(h.status==1){if(h.data.stp.msg&&h.data.inewstock.msg){b+='<h1 class="exUp"><a href="'+h.data.stp.url+'">'+h.data.stp.msg+"</a></h1>";b+='<h1 class="exDown"><a href="'+h.data.inewstock.url+'">'+h.data.inewstock.msg+"</a></h1>"}else{if(h.data.stp.msg&&!h.data.inewstock.msg){b+='<h1><a href="'+h.data.stp.url+'">'+h.data.stp.msg+"</a></h1>"}else{if(!h.data.stp.msg&&h.data.inewstock.msg){b+='<h1><a href="'+h.data.inewstock.url+'">'+h.data.inewstock.msg+"</a></h1>"}else{return}}}b+="</div>";var g=$(b);g.insertBefore(c)}}})});if(__if_dongmi){$("#secretary_board_vote").before('<h3 class="main-title-vote-2014">2014年金牌董秘评选</h3>');(function(){var g=false,l,e,k=location.search.substring(1).split("&"),a,d;for(var f=0,j=k.length;f<j;f++){if(k[f].split("=")[0]=="code"){e=k[f].split("=")[1]}}if(e){var h='<div class="content-box clearfix"><div class="vote clearfix"><div class="item good" data-vote="1"><span class="icon"></span><p></p><div class="tips">您已参与过投票！</div></div><div class="item bad" data-vote="2"><span class="icon"></span><p></p><div class="tips">您已参与过投票！</div></div></div><div class="name">加载中...</div></div>';function b(i){if(i<10000){return i}else{return(i/10000).toFixed(2)+"万"}}$("#secretary_board_vote").html(h);$.ajax({type:"GET",url:"/aj/sh/dongmiinfo?code="+e,dataType:"json",success:function(n){var m=n.data,i="";l=m.status;i=m.stock_name+"："+m.name;$("#secretary_board_vote .content-box .name").html(i);$("#secretary_board_vote .good p").html(b(m.up));$("#secretary_board_vote .bad p").html(b(m.down));if(l==2){m.vote==1?$("#secretary_board_vote .bad").addClass("on"):$("#secretary_board_vote .good").addClass("on")}}});function c(i){return/^\d+$/.test(i)}$("#secretary_board_vote .vote .item").on("click",function(){if(l==1){location.href=__login_url}else{if(l==2){var i=$(this);i.find(".tips").addClass("on");setTimeout(function(){i.find(".tips").removeClass("on")},1000)}else{if(!g){var i=$(this),m=$(this).attr("data-vote");$.ajax({type:"POST",data:{code:e,vote:m},url:"/aj/sh/dongmivote",dataType:"json",success:function(o){i.siblings(".item").addClass("on");var n=i.find("p").text();if(c(n)){n=b(parseInt(n)+1);i.find("p").html(n)}l=2;g=true}})}}}})}})()};
