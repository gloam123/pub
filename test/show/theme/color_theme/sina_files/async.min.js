
(function(){var READMEMNAME='cn.udv.s.readMem',CURPAGENAME='cn.udv.s.guessPage',READMEMLEN=10,LISTNUM=8,PAGENUM=5,MINNUM=LISTNUM,currentPage=0,likeUrlArr=[],rawInterestData,interestData,swipeGuess=null,pageshowFlag=false,datatype='guess',uid=typeof uid=='undefined'?'':uid,hash=typeof hash=='undefined'?'':hash,app={localStorage:(function(){var win=window,localStorageName='localStorage',isLocalStorageNameSupported=function(){try{return((localStorageName in win)&&win[localStorageName]);}catch(err){return false;}},lStorage={set:function(){},get:function(){return'';}};if(isLocalStorageNameSupported()&&win['JSON']){lStorage={set:function(key,val){val=JSON.stringify(val);try{localStorage.setItem(key,val);}catch(e){}},get:function(key){var val=localStorage.getItem(key);return JSON.parse(val);}};}
return lStorage;})(),filterRepeated:function(data){var readMem=app.localStorage.get(READMEMNAME)||[],dataStr=readMem.join('|');var newData=[];var repeatedData=[];var filtUrlAndTit=function(arr){var j,url='',title='',item=null,len=arr.length;for(j=0;j<len;j++){item=arr[j];item._url=trim(item.surl||'')||item.url;item._title=trim(item.stitle||'')||item.title.replace('- 手机新浪网','');if(!item||(item&&(!item._url||!item._title))){continue;}
url=item._url;title=item._title;if(dataStr.indexOf(url)==-1){newData.push(item);dataStr+='|'+url;}else{repeatedData.push(item);}}};filtUrlAndTit(data);if(newData.length<LISTNUM){newData=newData.concat(repeatedData.slice(0,LISTNUM-newData.length));}
return newData;}}
currentPage=parseInt(app.localStorage.get(CURPAGENAME))||0;function rebuildInterestData(data){var arraySlice=function(data,listNum,pageNum){var len=data.length,index=0,to,i,pages=[];pageNum=pageNum||Infinity;listNum=listNum||len;for(i=0;i<pageNum;i++){to=index+listNum;if(to>len){break;}
pages.push(data.slice(index,to));index+=listNum;}
return pages;};var pages=arraySlice(data,LISTNUM,PAGENUM);return pages;}
function getLikeData(){var i,j,page=[],html=[],length=0,pageNum=0,item=null,len=interestData.length,url,urlArg='',lnkPro=datatype==='guess'?'title':'timeout';for(i=0;i<len;i++){page=interestData[i];length=page.length;if(length==LISTNUM){html.push('<div class="news_items_module"><ul class="news_items morelistbox">');for(j=0;j<length;j++){item=page[j];url=item._url;if(url.indexOf('?')===-1){url+='?';}else{url+='&';}
html.push('<li><a href="'+url+urlArg+'">'+item._title+'</a></li>');likeUrlArr.push(item.url);}
html.push('</ul></div>');pageNum++;}}
interestData.length=pageNum;if(currentPage>=pageNum){currentPage=0;}
return html.join('');}
function interestInit(){var listWrap=document.getElementById('j_interest_tpl');if(listWrap.length==0){return;}
var innerWrap=listWrap.children[0],btnWrap=document.getElementById('j_update_interest'),loading=document.getElementById('j_like_loading'),activeClz='on',html=getLikeData(),total=interestData.length,btns=(function(){if(total>1){var i,clz='',pageHtml='',htmlArr=[];for(i=0;i<total;i++){clz=(i==currentPage)?('class="'+activeClz+'"'):'';htmlArr.push('<li '+clz+'><i></i></li>');}
pageHtml=htmlArr.join('');btnWrap.innerHTML=pageHtml;}
var list=btnWrap.children;return{list:list}})();if(total>1){btnWrap.style['display']='block';}else{btnWrap.style['display']='none';}
innerWrap.removeChild(loading);innerWrap.innerHTML=html;var news=innerWrap.querySelectorAll('a');var pageSendArr=[];function getPage(i){return Math.floor((i+LISTNUM)/LISTNUM)-1;}
innerWrap.addEventListener("click",function(e){if(e.target.nodeName.toLocaleLowerCase()=="a"){var item=e.target,readMem=app.localStorage.get(READMEMNAME)||[],href=item.href.replace('&pos=108&cre=ckhome','');readMem.push(href);app.localStorage.set(READMEMNAME,readMem.slice(-READMEMLEN));var i=Array.prototype.indexOf.call(news,e.target),page=getPage(i),urls=[];if(pageSendArr.indexOf(page)===-1){pageSendArr.push(page);for(var j=page*LISTNUM,len=(page+1)*LISTNUM;j<len;j++){if(i==j)continue;urls.push(encodeURIComponent(likeUrlArr[j]));}}else{urls.push(encodeURIComponent(likeUrlArr[i]));}}},false);var likeSwiper=new Swiper(listWrap,null,{circular:true,auto:false,callback:function(ele,index,direction){currentPage=index;var items=btns.list;for(var i=0;i<items.length;i++){if(i==index){addClass(items[i],'on');}else{removeClass(items[i],'on');}}
app.localStorage.set(CURPAGENAME,currentPage);if(window.suda){var likeInfo={'type':'liketab','name':'tabchange','title':'猜你喜欢','index':currentPage+1};window.suds_count&&window.suds_count(likeInfo);}}});}
function updateInterestData(){var filtedInterestData=app.filterRepeated(rawInterestData.data);interestData=rebuildInterestData(filtedInterestData);interestInit();}
function loadInterest(){var arg='&length='+(LISTNUM*(PAGENUM+2))+'&_='+new Date().getTime(),url='http://cre.dp.sina.cn/api/v3/get?cateid=sina_all&fields=surl,stitle,url,title,type&dedup=8&pageid=http://sina.cn&lid=all&cre=sinaw&mod=g&statics=1&merge=3'+arg+'&callback=likeDataHandle';createScript(url);}
function loadToplist(){var arg='&top_show_num='+(LISTNUM*(PAGENUM+2))+'&_='+new Date().getTime(),url='http://cre.dp.sina.cn/api/v3/get?cateid=sina_all&fields=surl,stitle,url,title,type&dedup=8&pageid=http://sina.cn&lid=all&cre=sinaw&mod=g&statics=1&merge=3'+arg+'&callback=topListHandle';createScript(url);}
function loadLeju(){var timestamp=(new Date()).valueOf();var url='http://api.m.leju.com/?site=api&ctl=api&act=sl&timestamp='+timestamp;createScript(url);}
function getSearchValue(key){var localSearch=location.search.substr(1),itemArr=localSearch.split("&"),value="";for(var i=0,len=itemArr.length;i<len;i++){var listArr=itemArr[i].split("=");if(listArr[0]==key){value=listArr[1];}}
return value}
function loadLocalStation(){var timestamp=new Date().getTime(),queryTime=getSearchValue("time"),queryDf=getSearchValue("df");if(queryTime)queryTime="&time="+queryTime;if(queryDf)queryDf="&df="+queryDf;var ua=navigator.userAgent.toLowerCase(),value=ua.indexOf('ucbrowser')+1?"uc":ua.indexOf('baidu')+1?"bd":ua.indexOf('qqbrowser')+1?"qq":"no";var pf=/iphone|ipad|ipod/.test(ua)?"ios":ua.indexOf('android')+1?"android":"no";var url='http://s.api.sina.cn/ls/allasync?callback=weatherData&ua='+value+'&pf='+pf+'&timestamp='+timestamp+queryTime+queryDf;createScript(url);var url2='http://interface.sina.cn/dfz/outside/wap/news/new_langshou_router.d.json?callback=localStationData&timestamp='+timestamp+queryTime+queryDf;createScript(url2);}
function loadWeibo(){var url='http://api.weibo.cn/hot/sinamobile?wm=ig_2002&callback=weiboDataHandle';createScript(url);}
window.likeDataHandle=function(data){datatype='guess';if(data&&data.data&&data.data.length>0){pageshowFlag=true;rawInterestData=data;updateInterestData();}else{loadToplist();}}
window.topListHandle=function(data){datatype='top';data=data.result;pageshowFlag=true;rawInterestData=data;updateInterestData();}
window.weatherData=function(data){if(data.retData.weather.icon){var weatherImg=document.createElement("img"),weatherIcon=document.getElementById("weather_icon");weatherImg.src=data.retData.weather.icon;weatherImg.width=22;weatherIcon.appendChild(weatherImg);}
if(data.retData.app_recommend&&(data.retData.app_recommend.length===4||data.retData.app_recommend.length===8)){var appData=data.retData.app_recommend,i=0,len=appData.length,str='';for(;i<len;i++){if(appData[i].title&&appData[i].url&&appData[i].pic){str+='<li><a href="'+appData[i].url+'"><img src="'+appData[i].pic+'" alt="'+appData[i].title+'"/><i class="download_btn"></i><p class="app_title">'+appData[i].title+'</p></a></li>';}}
document.getElementById("app_down_cont").innerHTML=str;}else{var el=document.getElementById('app_recommend');el.parentElement.removeChild(el);}
if(data.retData.finance){var str="",elWrap=document.querySelector("#card_finance .j_newsModule .news_items_module_wrap"),el=elWrap.children[0],addDom=document.createElement("div");if(data.retData.finance.stocks.length!=0){var stocks=data.retData.finance.stocks;addDom.className="news_finance_card";addDom.setAttribute("data-sudaclick","tab_31_stock")
str+='<div class="news_finance_card_info fl">'+'<p class="'+stocks[0]["class"]+'">'+'<strong>'+stocks[0]["title"]+'</strong>'+'<span>'+stocks[0]["range"]+'%</span>'+'<span>'+stocks[0]["value"]+'</span></p>'+'</div><div class="news_finance_card_info fr">'+'<p class="'+stocks[1]["class"]+'">'+'<strong>'+stocks[1]["title"]+'</strong>'+'<span>'+stocks[1]["range"]+'%</span>'+'<span>'+stocks[1]["value"]+'</span>'+'</p></div>';}else if(data.retData.finance.tags.length!=0){var tags=data.retData.finance.tags;addDom.className="news_hot_card";for(var i=0,len=tags.length;i<len;i++){str+='<a href="'+tags[i]["url"]+'" title="'+tags[i]["title"]+'">'+tags[i]["title"]+'</a>';}}
addDom.innerHTML=str;el.insertBefore(addDom,el.children[0]);}}
window.localStationData=function(data){var wrap=document.getElementById('j_localStationWrap'),tabs=wrap.querySelector('.j_navTab'),innerWrap=wrap.querySelector('.j_newsModule').children[0];if(data.retData&&data.retData.yaowen&&data.retData.yaowen.list&&data.retData.yaowen.list.top){var todayNews=document.querySelector("#card_yaowen"),yaowenData=data.retData.yaowen.list.top,yaowenStr="",yaowenUl=todayNews.querySelector(".j_newsModule .news_items");for(var i=0,len=yaowenData.length;i<len;i++){yaowenStr+='<li><a href="'+yaowenData[i][0].link+'" title="'+yaowenData[i][0].title+'">'+yaowenData[i][0].title+'</a></li>';}
if(yaowenUl)yaowenUl.innerHTML+=yaowenStr;}
if(data&&data.retData&&data.retData.tab){var _data=data.retData.tab,_tabs=[],_items=[],on=false;removeClass(wrap,'hide');for(var i in _data){if(!on){_tabs.push('<li class="news_tab_nav on">'+_data[i].title.title+'</li>');on=true;}else{_tabs.push('<li class="news_tab_nav">'+_data[i].title.title+'</li>');}
_items.push('<div class="news_items_module"><ul class="news_items">');for(var j=0,news=_data[i].list.top;j<news.length;j++){_items.push('<li><a href="'+news[j][0].link+'" title="'+news[j][0].title+'">'+news[j][0].title+'</a></li>');}
_items.push('</ul><div class="news_more_tips"><a href="'+_data[i].more.url+'" title="'+_data[i].more.title+'"><span>进入'+_data[i].more.title+'<em class="news_more_r iconf_icon_enter"></em></span></a></div></div>');}
tabs.innerHTML=_tabs.join('');innerWrap.innerHTML=_items.join('');tabInit(tabs.children,innerWrap.children);tabNav();}}
window.LejuDataCallback=function(data){var wrap=document.getElementById('j_lejuWrap'),tabs=wrap.querySelector('.j_navTab'),innerWrap=wrap.querySelector('.j_newsModule').children[0];if(data&&data.retCode&&data.retData.tab){var _data=data.retData.tab,_tabs=[],_items=[],on=false;removeClass(wrap,'hide');for(var i in _data){if((!_data[i].pics||(_data[i].pics&&_data[i].pics.length!=0))&&(!_data[i].links||(_data[i].links&&_data[i].links.length!=0))&&(!_data[i].list||(_data[i].list&&_data[i].list.length!=0))){if(!on){_tabs.push('<li class="news_tab_nav on">'+_data[i].title.title+'</li>');on=true;}else{_tabs.push('<li class="news_tab_nav">'+_data[i].title.title+'</li>');}
_items.push('<div class="news_items_module"><ul class="news_pic_items m_b">');for(var j=0,pics=_data[i].pics;j<2;j++){_items.push('<li><a href="'+pics[j].link+'" title="'+pics[j].title+'"><img src="'+pics[j].src+'" alt="'+pics[j].title+'" class="news_pic_img" /><p class="news_pic_info">'+pics[j].title+'</p></a></li>');}
_items.push('</ul><div class="news_hot_card leju">');var links=_data[i].links,linksMaxLength=links.length>3?3:links.length;for(var j=0;j<linksMaxLength;j++){if(links[j].link&&links[j].title)_items.push('<a href="'+links[j].link+'" title="'+links[j].title+'">'+links[j].title+'</a>');}
_items.push('</div><ul class="news_items">');for(var j=0,news=_data[i].list;j<news.length;j++){_items.push('<li><a href="'+news[j].link+'" title="'+news[j].title+'">'+news[j].title+'</a></li>');}
_items.push('</ul><div class="news_more_tips"><a href="'+_data[i].more.url+'" title="'+_data[i].more.title+'"><span>'+_data[i].more.title+'<em class="news_more_r iconf_icon_enter"></em></span></a></div></div>');}}
tabs.innerHTML=_tabs.join('');innerWrap.innerHTML=_items.join('');tabInit(tabs.children,innerWrap.children);tabNav();}}
window.weiboDataHandle=function(data){var wrap=document.getElementById('j_weiboWrap'),tabs=wrap.querySelector('.j_navTab'),innerWrap=wrap.querySelector('.j_newsModule').children[0],weibo=document.getElementById('j_weiboList');if(data&&data.status&&data.data.length>4){var _data=data.data,_items=[];_items.push('<div class="wb_top_module_card"><a href="'+_data[0].url+'" title="'+_data[0].title+'"><aside class="wb_top_info h170 wb_num_1"><p><span>TOP 1</span>'+_data[0].title+'</p></aside></a></div>');_items.push('<div class="wb_top_module_card"><a href="'+_data[1].url+'" title="'+_data[1].title+'"><aside class="wb_top_info h80 m_b wb_num_2"><p><span>TOP 2</span>'+_data[1].title+'</p></aside></a>');_items.push('<a href="'+_data[2].url+'" title="'+_data[2].title+'"><aside class="wb_top_info h80 m_t wb_num_3"><p><span>TOP 3</span>'+_data[2].title+'</p></aside></a></div>');_items.push('<div class="wb_top_module_card"><a href="'+_data[3].url+'" title="'+_data[3].title+'"><aside class="wb_top_info h80 m_b"><p><span>TOP 4</span>'+_data[3].title+'</p></aside></a>');_items.push('<a href="'+_data[4].url+'" title="'+_data[4].title+'"><aside class="wb_top_info h80 m_t"><p><span>TOP 5</span>'+_data[4].title+'</p></aside></a></div>');weibo.innerHTML=_items.join('');tabInit(tabs.children,weibo.parentNode.parentNode.children);tabNav();}}
loadInterest();loadLeju();loadWeibo();loadLocalStation();})();