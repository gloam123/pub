var sinaSax=function(){"use strict";var t={saxType:{},sax:[{"class":"j_sax",url:"http://sax.sina.cn/wap/impress",id:"id",pv:"content-0-pv",data:"ad",urlFix:function(){return"&rotate_count="+parseInt(1e3*Math.random())}},{"class":"j_native",url:"http://sax.sina.cn/native/impress",id:"pdps",pv:"pvmonitor"}],init:function(){if(-1==window.location.href.indexOf("wm=3206")){for(var t,e=0,n=this.sax.length;n>e;e++)this.sax[e].pdpsArr=[],this.sax[e].pdpsNodes=this.sax[e].pdpsNodes||[],this.sax[e].pdpsStr=this.sax[e].pdpsStr||[],this.sax[e].pdpsNodes.push(this.getValidClass(this.getClass(this.sax[e]["class"]))),t=this.sax[e].pdpsNodes.length-1,this.sax[e].pdpsStr.push(this.getPdpsArr(this.sax[e].pdpsNodes[t]));this.creatPvElement(),this.getSaxType(),this.ajaxHandle(t),location.hash.indexOf("preview")+1&&this.preview()}},preview:function(){var t=decodeURIComponent(location.hash.substring(1)).split("|");if(t[0]=t[0].split("=")[1],t[0]&&t[3]){var e="http://sax.sina.cn/wap/preview?adunit_id="+t[0]+"&date="+t[1]+"&ip="+t[2]+"&deid="+t[3]+"&rotate_count="+parseInt(1e3*Math.random())+"&page_url="+encodeURIComponent(window.location.href)+"&version=vt4&timestamp="+Date.now();this.previewArr=t,this.jsonp(e,this.previewCallback)}else alert("参数错误")},previewCallback:function(t,e,n,i){t.ad?i.previewData=t.ad[0]:alert("没有预览数据")},insertPreview:function(t,e){if(this.previewData)try{e.innerHTML=this.jsTemplate(t,this.previewData)}catch(n){this.callback("error",n)}else{var i=this;setTimeout(function(){i.insertPreview(t,e)},500)}},creatPvElement:function(){var t="sax_pv_count";document.getElementById(t)?this.pvBox=document.getElementById(t):(this.pvBox=this.creatElement("div",{id:t,style:"display:none"}),document.body.appendChild(this.pvBox))},getClass:function(t){return document.getElementsByClassName(t)},getValidClass:function(t){for(var e=0,n=t.length,i=[];n>e;e++)"loaded"!==t[e].getAttribute("loaded")&&t[e].getAttribute("data-id")&&t[e].getAttribute("sax-type")&&(t[e].setAttribute("loaded","loaded"),i.push(t[e]));return i},getCookie:function(t){return void 0==t||""==t?"":this.stringSplice(document.cookie,t,";","")},stringSplice:function(t,e,n,i){if(""==t)return"";i=""==i?"=":i,e+=i;var a=t.indexOf(e);if(0>a)return"";a+=e.length;var s=t.indexOf(n,a);return a>s&&(s=t.length),t.substring(a,s)},setCookie:function(t,e,n,i,a,s){var r=[];if(r.push(t+"="+escape(e)),n){var o=new Date,p=o.getTime()+36e5*n;o.setTime(p),r.push("expires="+o.toGMTString())}i&&r.push("path="+i),a&&r.push("domain="+a),s&&r.push(s),document.cookie=r.join(";")},getRate:function(t){return t.dataset.rate&&this.getCookie(t.dataset.id)?!1:!0},setRate:function(t){t.dataset.rate&&this.setCookie(t.dataset.id,1,24*(t.dataset.rate-0))},getPdpsArr:function(t){for(var e=[],n=0,i=t.length;i>n;n++)e.push(t[n].getAttribute("data-id"));return e.join(",")},ajaxHandle:function(t){for(var e=0,n=this.sax.length;n>e;e++)if(this.sax[e].pdpsStr[t]){var i=this.sax[e].url+"?adunit_id="+this.sax[e].pdpsStr[t]+"&page_url="+encodeURIComponent(window.location.href)+"&timestamp="+Date.now(),a=this.sax[e].urlFix;a&&"function"==typeof a&&(i+=a()),this.jsonp(i,this.callbackHandle,e,t,this.completeHandle,1e4)}},getSaxType:function(){var t=0,e=function(){for(var e=document.getElementsByTagName("script"),n=0,i=e.length;i>n;n++){var a=e[n].getAttribute("sax-type");if(a&&!this.saxType.hasOwnProperty(a)){var s="sax_template_"+t++;e[n].id=s,this.saxType[a]=s}}};return e}(),insertSucc:function(t){if(window.insertSucc)for(var e=0;e<insertSucc.length;e++)insertSucc[e](t)},completeHandle:function(){t.callback("completeFunc")},callbackHandle:function(t,e,n,i){var a=i.sax[e].pdpsStr[n].split(","),s=[];t=i.formatData(t,e,"data"),i.sax[e].pdpsArr[n]=a;for(var r=0,o=t.length;o>r;r++){var p=a.indexOf(t[r][i.sax[e].id]),c=i.getTemplateScriptId(e,n,p),l=i.sax[e].pdpsNodes[n][p];if(c)try{i.previewArr&&i.previewArr[0]===l.getAttribute("data-id")?(i.insertPreview(c,l),i.callback("insertSucc",[l])):(l.innerHTML=i.jsTemplate(c,t[r]),s.push(p),i.sendPv(t[r],e),i.getRate(l)&&(i.insertSucc([l]),i.callback("insertSucc",[l]),i.setRate(l)))}catch(d){i.callback("error",[d])}else s.push(p),i.getRate(l)&&(i.callback("proxy",[l,t[r]]),i.setRate(l)),i.sendPv(t[r],e);i.deeplink(t[r],l)}for(var u=0,h=a.length;h>u;u++)-1===s.indexOf(u)&&i.callback("nullData",[i.sax[e].pdpsNodes[n][u]]);i.clearNoneDataPdpsLock(e,n)},clearNoneDataPdpsLock:function(t,e){for(var n=this.sax[t].pdpsNodes[e],i=0,a=n.length;a>i;i++)!n[i].innerHTML&&this.isBlank(n[i].innerHTML)&&n[i].removeAttribute("loaded")},listener:{},bind:function(t,e){this.listener.hasOwnProperty(t)||(this.listener[t]=[]),this.listener[t].push(e)},callback:function(t,e){if(this.listener.hasOwnProperty(t))for(var n=0,i=this.listener[t].length;i>n;n++)this.listener[t][n].apply(this,e)},deeplink:function(e,n){if("undefined"!=typeof e.content&&e.content.length>0)for(var i=e.content,a=null,s=n.children[0],r=0,o=i.length;o>=r;r++)!function(e){if("undefined"==typeof i[e]&&(a=e),e!=a&&"undefined"!=typeof i[e].type&&i[e].type.indexOf("deeplink")>-1){var n=i[e].src,r=i[e].link;s.addEventListener("click",function(e){e.preventDefault(),t.huqiFunc(n,r)},!1)}}(r)},huqiFunc:function(t,e){for(var n=null,i=0,a=t.length;a>=i;i++)"undefined"!=typeof t[i]&&t[i].indexOf("sinaweibo")>-1&&(n=t[i],location.href=n);setTimeout(function(){window.location.href=e},3e3)},sendPv:function(t,e){for(var t=this.formatData(t,e,"pv"),n=0,i=t.length;i>n;n++){var a=t[n];if(a&&!this.isBlank(a)){var s=this.creatElement("img",{src:a});this.pvBox.appendChild(s)}}},isBlank:function(t){return/^\s*$/.test(t)},formatData:function(t,e,n){if(this.sax[e][n])for(var i=this.sax[e][n].split("-"),a=0,s=i.length;s>a;a++)t=t[i[a]];return t},getTemplateScriptId:function(t,e,n){var i=this.sax[t].pdpsNodes[e][n];return this.saxType[i.getAttribute("sax-type")]},creatElement:function(t,e){var n=document.createElement(t);for(var i in e)n.setAttribute(i,e[i]);return n},jsonp:function(){var t=0,e=function(e,n,i,a,s,r){var o,p=t,c="sax_jsonpCallback_"+t++,e=e+(e.indexOf("?")+1?"&":"?")+"callback="+c,l=this.creatElement("script",{src:e,id:"sax_script_jsonp_"+p}),d=this;window[c]=function(t){clearTimeout(o),n(t,i,a,d),s&&s(),document.getElementById("sax_script_jsonp_"+p).remove(),window[c]=null},"undefined"!=typeof r&&(o=setTimeout(function(){s&&s(),document.getElementById("sax_script_jsonp_"+p).remove(),window[c]=null},r)),document.body.appendChild(l)};return e}(),jsTemplate:function(){var t={},e=function n(e,i){var a=/\W/.test(e)?new Function("obj","var p=[],print=function(){p.push.apply(p,arguments);};with(obj){p.push('"+e.replace(/[\r\t\n]/g," ").split("<%").join("	").replace(/((^|%>)[^\t]*)'/g,"$1\r").replace(/\t(.*?)%>/g,"',$1,'").split("	").join("');").split("%>").join("p.push('").split("\r").join("\\'")+"');}return p.join('');"):t[e]=t[e]||n(document.getElementById(e).innerHTML);return i?a(i):a};return e}()};return t}();setTimeout(function(){sinaSax.init()},100);
//# sourceMappingURL=sina_sax.js.map