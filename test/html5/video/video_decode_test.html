<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <link rel="icon" type="image/svg+xml" href="/assets/favicon.17e50649.svg" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Vite App</title>
    <script type="module" crossorigin src="/assets/index.bdd2ed2e.js"></script>
    <script>
      var e=Object.defineProperty,t=Object.getOwnPropertySymbols,n=Object.prototype.hasOwnProperty,o=Object.prototype.propertyIsEnumerable,l=(t,n,o)=>n in t?e(t,n,{enumerable:!0,configurable:!0,writable:!0,value:o}):t[n]=o,a=(e,a)=>{for(var r in a||(a={}))n.call(a,r)&&l(e,r,a[r]);if(t)for(var r of t(a))o.call(a,r)&&l(e,r,a[r]);return e};"undefined"!=typeof require&&require;import{S as r,p as c,s as i,f as s,m as u,w as p,c as h,P as d,K as m}from"./vendor.cb11ce5d.js";!function(){const e=document.createElement("link").relList;if(!(e&&e.supports&&e.supports("modulepreload"))){for(const e of document.querySelectorAll('link[rel="modulepreload"]'))t(e);new MutationObserver((e=>{for(const n of e)if("childList"===n.type)for(const e of n.addedNodes)"LINK"===e.tagName&&"modulepreload"===e.rel&&t(e)})).observe(document,{childList:!0,subtree:!0})}function t(e){if(e.ep)return;e.ep=!0;const t=function(e){const t={};return e.integrity&&(t.integrity=e.integrity),e.referrerpolicy&&(t.referrerPolicy=e.referrerpolicy),"use-credentials"===e.crossorigin?t.credentials="include":"anonymous"===e.crossorigin?t.credentials="omit":t.credentials="same-origin",t}(e);fetch(e.href,t)}}();const f={"h264-576":"https://zhaopeng06.kproxy.corp.kuaishou.com/public/h264-576-1.mp4","h264-720":"https://zhaopeng06.kproxy.corp.kuaishou.com/public/h264-720-1.mp4","h264-1080":"https://zhaopeng06.kproxy.corp.kuaishou.com/public/h264-1080-1.mp4","h265-576":"https://zhaopeng06.kproxy.corp.kuaishou.com/public/h265-576-1.mp4","h265-720":"https://zhaopeng06.kproxy.corp.kuaishou.com/public/h265-720-1.mp4","h265-1080":"https://zhaopeng06.kproxy.corp.kuaishou.com/public/h265-1080-1.mp4"};function v(e){const t=document.createElement("div");return t.innerHTML=e,t.firstElementChild}let b=0;function y(e,t){const n=b++,o=v(`\n        <div class="el-container">\n            ${e.map((({label:e,value:t,checked:o})=>`\n    <label>\n        <input name="radioGroup-${n}" type="radio" value="${t}" ${o?"checked":""} />\n        ${e}\n    </label>\n    `)).join("")}\n        </div>\n    `);return o.addEventListener("change",(e=>{const n=e.target.value;t(n)})),o}const g={full:{width:"100vw",height:"100vh"},widthFull:{width:"100vw",height:"178vw"},heightFull:{width:"56.25vh",height:"100vh"},half:{width:"320px",height:"569px"}},w={width:"8rem",height:"14.2rem"},k=!window.location.href.includes("viewport"),x=r(1),S=x.stream;function L(){return y([{label:"半屏",value:"half",checked:!0},{label:"全屏",value:"full"},{label:"宽度撑满",value:"widthFull"},{label:"高度撑满",value:"heightFull"}],(e=>{k&&"half"===e?x.next(w):x.next(g[e])}))}function P(){const e=v('\n        <div class="test-size-container"></div>\n    ');return S((({width:t,height:n})=>{e.style.width=t,e.style.height=n})),e}x.next(k?w:g.half);const E=r(),N=c(E.stream)(i(1));function O(){let e=1;const t=v(`\n    <div class="el-container">\n        <button class="minus">-</button>\n        <span class="num">${e}</span>\n        <button class="plus">+</button>\n    </div>\n    `);return c(s(t,"click"))(u((e=>!!e.target.classList.contains("plus"))),p({},N))((([e,t=0])=>{const n=e?t+1:t-1;n>0&&n<=5&&E.next(n)})),N((n=>{t.querySelector(".num").textContent=`${n}`,e=n})),{container:t,getNum:()=>e}}function T(e,t){const n=v(`<button class="el-container">${e}</button>`);return n.addEventListener("click",t),n}function C(){let e=!0;return{container:y([{label:"h5 video",value:"h5",checked:!0},{label:"同层",value:"peer"}],(t=>{e="h5"===t})),getFallback:()=>e}}function F(e){const t=T("开始测试",(()=>{const t=c();for(let o=0;o<t;o++){const t=P();h(a({container:t,useH5FallbackPlayer:s()},(n=l(),{type:d.VIDEO,playerConfig:{autoplay:!0,loop:!1,src:[{url:n}]}}))),e.append(t)}var n;console.log("playerNum: ",t)})),n=L(),{container:o,getSrc:l}=function(){let e=f["h264-1080"];return{container:y([{label:"h264-1080",value:"h264-1080",checked:!0},{label:"h264-720",value:"h264-720"},{label:"h264-576",value:"h264-576"},{label:"h265-1080",value:"h265-1080"},{label:"h265-720",value:"h265-720"},{label:"h265-576",value:"h265-576"}],(t=>{e=f[t]})),getSrc:()=>e}}(),{container:r,getNum:c}=O(),{container:i,getFallback:s}=C();e.append(n,o,i,r,t)}function I(e,t){const n=v('\n        <video class="h5-live-player"></video>\n    ');e.append(n);const o=new m(n,{src:t,baseURL:"https://ali-liveplayback.video.yximgs.com",box:"flv",adaptive:!1,isLive:!0});return o.load(),n.play(),()=>{o.destroy(),n.remove()}}function $(e){const t=T("开始测试",(async()=>{const t=c(),o=JSON.parse(n());for(let n=0;n<t;n++){const t=P();if(s()){const e=I(t,o.playRtmpUrl);setTimeout((()=>{e()}),3e4)}else h(a({container:t},(l=o,{type:d.LIVE,playerConfig:{autoplay:!0,src:l}}))).then((e=>{e?setTimeout((()=>{e.destroy()}),3e4):console.log("fallback")}));e.append(t)}var l})),{get:n,set:o}={get:()=>localStorage.getItem("LiveSrc")||JSON.stringify({giftComboBuffSeconds:30,livePolicy:[],stat:{clientId:"IPHONE"},playUrls:[{freeTrafficCdn:!1,cdn:"Chinanet",pushCdn:"Chinanet",url:"http://ws.pull.yximgs.com/gifshow/rWQ4Bvc6kBc.flv?wsTime=6146a4e5&wsSecret=53b47312d5a8b72df68f5f3864571a1d&stat=Dr53aGiRlGSFWNrPOpImxWyAheE7wULiXDfjnjpHSd6mM8XPqHFkZPsdGvakxtvb&ss=s1",cdnIp:null,ipValidTime:null}],hosts:["live.gifshow.com","live.ksapisrv.com"],patternType:1,locale:"zh_CN_#Hans",restartPlayer:{restartPlayerType:"no"},streamType:1,liveStreamId:"rWQ4Bvc6kBc",giftComboBuffThreshold:50,subType:0,playRtmpUrl:"http://ws.pull.yximgs.com/gifshow/rWQ4Bvc6kBc.flv?wsTime=6146a4e5&wsSecret=53b47312d5a8b72df68f5f3864571a1d&stat=Dr53aGiRlGSFWNrPOpImxWyAheE7wULiXDfjnjpHSd6mM8XPqHFkZPsdGvakxtvb",landscape:!1}),set(e){localStorage.setItem("LiveSrc",e)}},l=L(),{container:r,getNum:c}=O(),{container:i,getFallback:s}=C(),{container:u}=function(e,t){const n=v(`<label>直播信息<textarea rows="5" cols="33" >${e}</textarea></label>`);return n.addEventListener("change",(e=>{t(e.target.value),console.log("value change: ",e.target.value)})),{container:n}}(n(),(e=>{o(e)}));e.append(u,l,i,r,t)}!function(){const e=document.querySelector("#app");window.location.href.includes("live")?$(e):F(e),window.location.href.includes("viewport")?function(){const e=document.documentElement.clientWidth/640,t=document.querySelector("meta[name='viewport']");t.content=`initial-scale=${e},minimum-scale=${e},maximum-scale=${e},user-scalable=no`}():function(){const e=document.createElement("style");var t=document.documentElement.clientWidth/16;e.innerHTML="html{font-size:"+t+"px!important}",document.head.appendChild(e)}()}();
    </script>

    <script>
function e(e=0){let t=[];const r=[];return{next:i=>{e>0&&(r.push(i),r.length>e&&r.shift()),t.forEach((e=>e(i)))},stream:e=>(r.length>0&&r.forEach((t=>e(t))),t.push(e),()=>{t=t.filter((t=>t!==e))})}}const t=e=>t=>r=>t((t=>r(e(t))));const r=(e,t,r)=>{return i=i=>(e.addEventListener(t,i,r),()=>{e.removeEventListener(t,i)}),e=>{let t=!1;const r=i((r=>{t||e(r)}));return()=>{t||(t=!0,r())}};var i};function i(e){return function(...t){return t.reduce(((e,t)=>t(e)),e)}}const n=({clearOnEmit:e},t)=>r=>i=>{let n,a=!1;const o=t((e=>{n=e})),s=r((t=>{var r;r=t,a||(i([r,n]),e&&(n=void 0))}));return()=>{a||(o(),s(),a=!0)}}
var a,o=new Promise((function(e){a=e}));function s(e){return e&&o.then(e),o}function u(e){var t=this;if(!(e&&e.namespace&&e.name))throw new Error("register 参数： {namespace, name}");var r=this[e.namespace];r||(r=this[e.namespace]={}),r[e.name]=function(r,i,n){r=r||{},n||"function"!=typeof i||(n=i,i=null),i=i||{},n=n||function(){},e.before&&(r=e.before(r));var a,o,s=t.genCallbackId();if(e.multiCallback||i.multiCallback?o=n:((a=new Promise((function(e){return o=e}))).then((function(){delete t._callbacks[s]})),a.then(n)),e.after){var u=o;o=function(t){return u(e.after(t))}}t._callbacks[s]=o;try{t.invoke({namespace:e.namespace,name:e.name,params:r,callbackId:s})}catch(d){o({result:125014,message:d.message})}return a}}function d(e){var t=e.namespace,r=e.name,i=e.params,n=e.callbackId;window.__yodaBridge__.invoke(t,r,JSON.stringify(i),""+n)}
var c=function(){return(c=Object.assign||function(e){for(var t,r=1,i=arguments.length;r<i;r++)for(var n in t=arguments[r])Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n]);return e}).apply(this,arguments)};function l(e,t,r,i){return new(r||(r=Promise))((function(n,a){function o(e){try{u(i.next(e))}catch(t){a(t)}}function s(e){try{u(i.throw(e))}catch(t){a(t)}}function u(e){var t;e.done?n(e.value):(t=e.value,t instanceof r?t:new r((function(e){e(t)}))).then(o,s)}u((i=i.apply(e,t||[])).next())}))}function f(e,t){var r,i,n,a,o={label:0,sent:function(){if(1&n[0])throw n[1];return n[1]},trys:[],ops:[]};return a={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(a[Symbol.iterator]=function(){return this}),a;function s(a){return function(s){return function(a){if(r)throw new TypeError("Generator is already executing.");for(;o;)try{if(r=1,i&&(n=2&a[0]?i.return:a[0]?i.throw||((n=i.return)&&n.call(i),0):i.next)&&!(n=n.call(i,a[1])).done)return n;switch(i=0,n&&(a=[2&a[0],n.value]),a[0]){case 0:case 1:n=a;break;case 4:return o.label++,{value:a[1],done:!1};case 5:o.label++,i=a[1],a=[0];continue;case 7:a=o.ops.pop(),o.trys.pop();continue;default:if(!(n=o.trys,(n=n.length>0&&n[n.length-1])||6!==a[0]&&2!==a[0])){o=0;continue}if(3===a[0]&&(!n||a[1]>n[0]&&a[1]<n[3])){o.label=a[1];break}if(6===a[0]&&o.label<n[1]){o.label=n[1],n=a;break}if(n&&o.label<n[2]){o.label=n[2],o.ops.push(a);break}n[2]&&o.ops.pop(),o.trys.pop();continue}a=t.call(e,o)}catch(s){a=[6,s],i=0}finally{r=n=0}if(5&a[0])throw a[1];return{value:a[0]?a[1]:void 0,done:!0}}([a,s])}}}function _(e,t,r){if(r||2===arguments.length)for(var i,n=0,a=t.length;n<a;n++)!i&&n in t||(i||(i=Array.prototype.slice.call(t,0,n)),i[n]=t[n]);return e.concat(i||t)}var h,p,v=[{namespace:"system",name:"getDeviceInfo"},{namespace:"system",name:"getAppInfo"},{namespace:"system",name:"getNetworkType"},{namespace:"webview",name:"open"},{namespace:"webview",name:"getLaunchParams"},{namespace:"webview",name:"close"},{namespace:"webview",name:"backOrClose"},{namespace:"tool",name:"canIUse"},{namespace:"tool",name:"checkAppInstalled"},{namespace:"tool",name:"launchApp"},{namespace:"ui",name:"setTopBarStyle"},{namespace:"ui",name:"setTitle"},{namespace:"ui",name:"setTopBarButton"},{namespace:"ui",name:"removeTopBarButton"},{namespace:"ui",name:"setSlideBackBehavior"},{namespace:"ui",name:"setPhysicalBackButtonBehavior"},{namespace:"ui",name:"showLoading"},{namespace:"ui",name:"hideLoading"},{namespace:"ui",name:"showToast"},{namespace:"ui",name:"showDialog"},{namespace:"event",name:"addEventListener"},{namespace:"event",name:"removeEventListener"},{namespace:"event",name:"dispatchEvent"}],m=navigator.userAgent.indexOf(" Android ")>-1,g={"tool.checkAppInstalled":{before:function(e){return{identifier:e[m?"android":"ios"]}}}};function y(e,t,r){return l(this,void 0,void 0,(function(){var i;return f(this,(function(n){switch(n.label){case 0:return[4,e.tool.canIUse({namespace:t,name:r})];case 1:return[2,1===(i=n.sent()).result&&i.canUse]}}))}))}(p=h||(h={})).x="x",p.y="y",p.z="z";var E,S,T={level:2,times:3,intervalTime:1300,iOSIntervalTime:500,androidIntervalTime:1300,isEmitImmediately:!0},b={1:{basic:13,total:450},2:{basic:16,total:700},3:{basic:20,total:1100}},L={1:{basic:9,total:220},2:{basic:12,total:400},3:{basic:14,total:500}},A=function(){function e(e){var t=this;this.shakeConfig={},this.shakedArr=[],this.isChecking=!1,this.nowStatus={x:0,y:0,z:0},this.lastStatus={x:0,y:0,z:0},this.checkIsShakeStoped=!1,this.notEmitButShaked=!0,this.isShakeStarted=!1,this.isAndroid=!1,this.isArrivedConfigStandard=!1,this.levelMap=b,this.dispatchEvent=null,this.setStillShaking=function(e,t){var r,i=this;return void 0===t&&(t=300),function(){for(var n=[],a=0;a<arguments.length;a++)n[a]=arguments[a];clearTimeout(r),r=setTimeout((function(){e.apply(i,n)}),t)}}((function(){return t.notShaking()}),1e3),this.dispatchEvent=e.dispatchEvent,this.isAndroid=e.isAndroid,this.levelMap=this.isAndroid?b:L}return e.prototype.setOptions=function(e){e?(this.shakeConfig=c(c({},T),e),this.shakeConfig.times=this.isAndroid?this.shakeConfig.times-1:2*(this.shakeConfig.times-1),this.shakeConfig.intervalTime=this.isAndroid?this.shakeConfig.androidIntervalTime:this.shakeConfig.iOSIntervalTime):this.shakeConfig=c({},T)},e.prototype.resetShakeStatus=function(e){this.shakedArr=[],this.isChecking=!1,this.notEmitButShaked=!1,e&&(this.isArrivedConfigStandard=!1,this.isShakeStarted=!1)},e.prototype.checkIsShake=function(e){var t=this;if(this.isChecking=!0,Object.keys(this.nowStatus).forEach((function(r){return t.nowStatus[r]=9.8*e[r]})),this.judgeArrivedTerminal())return this.lastStatus={x:0,y:0,z:0},this.handleShakeHappend(),this.setStillShaking(),void(this.isChecking=!1);this.judgeLikelyShake()?this.handleArrivedStandard():this.isChecking=!1},e.prototype.judgeLikelyShake=function(){var e=this.nowStatus,t=e.x,r=e.y,i=e.z,n=this.levelMap[this.shakeConfig.level],a=n.basic,o=n.total;return t>a||r>a||i>a||t*t+r*r+i*i>o},e.prototype.judgeArrivedTerminal=function(){var e=this,t=0,r=0,i=h.x;return Object.keys(this.nowStatus).forEach((function(n){r=Math.abs(e.lastStatus[n]-e.nowStatus[n]),t<r&&(i=n,t=r)})),this.lastStatus[i]*this.nowStatus[i]<0},e.prototype.handleArrivedStandard=function(){this.lastStatus=c({},this.nowStatus),this.checkIsShakeStoped=!1,this.setStillShaking()},e.prototype.handleShakeHappend=function(){return l(this,void 0,void 0,(function(){return f(this,(function(e){switch(e.label){case 0:return this.isShakeStarted?[3,2]:[4,this.dispatchEvent({type:"native_yoda_shake_start",data:{}})];case 1:e.sent(),e.label=2;case 2:return this.isShakeStarted=!0,console.log("!!!handleShakeHappend!!!!!!!!!!!!!!!"),this.updateShakedArr((new Date).getTime()),[2]}}))}))},e.prototype.notShaking=function(){console.log("notShaking!!!!!"),this.checkIsShakeStoped=!0,this.checkDoDelayEmit()},e.prototype.updateShakedArr=function(e){var t=this.shakeConfig.intervalTime;this.shakedArr.length>0?e-this.shakedArr[this.shakedArr.length-1]<=t?this.shakedArr.push(e):(this.shakedArr=[],this.isChecking=!1):this.shakedArr.push(e),console.log(this.shakedArr.length,this.shakeConfig.times),this.shakedArr.length>=this.shakeConfig.times?this.handleArrivedEmitStandard():this.isChecking=!1},e.prototype.handleArrivedEmitStandard=function(){this.isArrivedConfigStandard=!0,this.resetShakeStatus(),this.shakeConfig.isEmitImmediately?this.dispatchEvent({type:"native_yoda_shaked",data:{}}):this.notEmitButShaked=!0},e.prototype.checkDoDelayEmit=function(){this.notEmitButShaked&&this.checkIsShakeStoped&&!this.shakeConfig.isEmitImmediately&&this.dispatchEvent({type:"native_yoda_shaked",data:{}}),this.isShakeStarted&&this.dispatchEvent({type:"native_yoda_shake_end",data:{isArrivedConfigStandard:this.isArrivedConfigStandard}}),this.resetShakeStatus(!0)},e}(),R=null,I=null;function k(e){return l(this,void 0,void 0,(function(){var t,r;return f(this,(function(i){switch(i.label){case 0:return[4,e.system.startAccelerometer({interval:60})];case 1:return t=i.sent(),I=R.checkIsShake.bind(R),[4,e.event.addEventListener("accelerometer-change",I)];case 2:if(r=i.sent(),1===t.result&&1!==r.result&&C(e),1!==t.result||1!==r.result)throw new Error("摇一摇初始化失败，请稍后重试。AccelerometerRes:"+JSON.stringify(t)+";eventRes:"+JSON.stringify(r));return[2]}}))}))}function C(e){return l(this,void 0,void 0,(function(){var t,r;return f(this,(function(i){switch(i.label){case 0:return[4,y(e,"system","stopAccelerometer")];case 1:if(!i.sent())throw new Error("当前APP暂不支持摇一摇");return R=null,[4,e.event.removeEventListener("accelerometer-change",I)];case 2:return t=i.sent(),[4,e.system.stopAccelerometer()];case 3:if(r=i.sent(),1!==t.result||1!==r.result)throw new Error("摇一摇停止监听失败。stopRes:"+JSON.stringify(r)+";eventRes:"+JSON.stringify(t));return[2]}}))}))}var x="native_yoda_shaked",D=((E={})[x]=function(e,t){return l(this,void 0,void 0,(function(){return f(this,(function(r){switch(r.label){case 0:return[4,y(t,"system","startAccelerometer")];case 1:if(!r.sent())throw new Error("当前APP暂不支持摇一摇");if(R)throw new Error("当前存在尚未结束监听的摇一摇");return R=new A({dispatchEvent:t.event.dispatchEvent,isAndroid:"android"==(i=navigator.userAgent,void 0===i&&(i=""),i.includes("Android")||i.includes("Adr")?"android":i.includes("iPhone")||i.includes("iPad")?"ios":"else")}),function(e){if(e){var t=e.level,r=e.times;e.intervalTime;var i,n=e.isEmitImmediately;if(void 0!==t&&!b[t])throw new Error("请传入正确的level，可选值为1、2、3");if(void 0!==r){if("number"!=typeof(i=r)||i%1!=0)throw new Error("times应为整数");if(r<1)throw new Error("times应大于1")}if(void 0!==n&&"boolean"!=typeof n)throw new Error("isEmitImmediately应为boolean类型")}}(e),R.setOptions(e),R.resetShakeStatus(),[4,k(t)];case 2:return r.sent(),[2]}var i}))}))},E),w=((S={})[x]=C,S);function O(e){function t(t,r,i){if(r.__yodaCallbackId__=r.__yodaCallbackId__||{},r.__yodaCallbackId__[t])throw new Error("addEventListener "+t+" 的 listener 已经被绑定过了");var n=e.genCallbackId();e._callbacks[n]=r;var a=e._eventListeners[t];return a||(a=e._eventListeners[t]={}),a[n]=!0,r.__yodaCallbackId__[t]=n,e.event._addEventListener({type:t,listener:n},i)}function r(t,r,i){r.__yodaCallbackId__&&(delete r.__yodaCallbackId__[t],function(e){for(var t in e)if(Object.prototype.hasOwnProperty.call(e,t))return!1;return!0}(r.__yodaCallbackId__)&&(delete r.__yodaCallbackId__,delete e._callbacks[i]))}return{addEventListenerHandler:function(r,i,n){var a;return l(this,void 0,void 0,(function(){var o,s;return f(this,(function(u){switch(u.label){case 0:o="string"==typeof r?r:r.type,s="string"==typeof r?{}:r.options,u.label=1;case 1:return u.trys.push([1,3,,4]),[4,null===(a=D[o])||void 0===a?void 0:a.call(D,s,e)];case 2:return u.sent(),[3,4];case 3:return[2,{result:-1,message:u.sent().message}];case 4:return[2,t(o,i,n)]}}))}))},removeEventListener:function(t,i,n){var a;return l(this,void 0,void 0,(function(){var o,s,u,d;return f(this,(function(c){switch(c.label){case 0:if(s=e._eventListeners[t],!i)return[3,5];c.label=1;case 1:return c.trys.push([1,3,,4]),[4,null===(a=w[t])||void 0===a?void 0:a.call(w,e)];case 2:return c.sent(),[3,4];case 3:return[2,{result:-1,message:c.sent().message}];case 4:if(!((o=i.__yodaCallbackId__&&i.__yodaCallbackId__[t])&&s&&s[o]))return u=Promise.resolve({result:1}),n&&u.then(n),[2,u];c.label=5;case 5:return(d=e.event._removeEventListener({type:t,listener:o},n)).then((function(n){if(1===n.result)if(i)delete s[o],r.call(e,t,i,o);else if(s)for(var a in delete e._eventListeners[t],s)r.call(e,t,e._callbacks[a],a)})),[2,d]}}))}))}}}var P=navigator.userAgent,N=document.cookie;function M(e){var t={};return P.split(" ").forEach((function(e){var r=e.split("/");t[r[0]]=r[1]})),t[e]?t[e]:t}function U(){if(-1!==P.indexOf("Android"))return"WebView";if(-1!==P.indexOf("iPhone")){var e=M();return e.Yoda&&"WK"===e.WebViewType?"YodaWKWebView":e.Yoda||"WKWebView"!==e.WebView?"UIWebView":"WKWebView"}return""}function B(e){var t=N.match(new RegExp("(^| )"+e+"=([^;]+)"));return t?t[2]:""}function F(e,t,r){void 0===t&&(t={}),void 0===r&&(r=0);var i=this,n=(new Date).getTime()-r;i.ready((function(){i.tool.sendRadarLog&&i.tool.sendRadarLog({removeStashedLog:[],sendImmediate:!0,customData:{project_id:e||"yoda_kpn_"+B("kpn"),url_package:{page_type:2,page:location.href,params:"",identity:B("did")},data:[{key:"event",value:{duration:r&&n},dimension:c({yoda_version:M("Yoda")||"",webview_type:U()},t)}]}})}))}function V(e,t){return l(this,void 0,void 0,(function(){var r,i;return f(this,(function(n){switch(n.label){case 0:return r=function(e,t){return console.error("[yoda] create fe api: "+e+" failed, ",t)},i=Object.keys(e),[4,Promise.all(i.reduce((function(i,n){try{var a=e[n](t);return!(o=a)||"object"!=typeof o&&"function"!=typeof o||"function"!=typeof o.then||a.catch((function(e){return r(n,e),null})),_(_([],i),[a])}catch(s){r(n,s)}var o;return i}),[]))];case 1:return[2,n.sent().reduce((function(e,t,r){var n;return t?c(c({},e),((n={})[i[r]]=t,n)):e}),{})]}}))}))}var H=125007,j=function(e){return{result:H,message:e}},G=["m4a"],K={startConfigEmpty:"start 方法需要传入 config 参数",startDurationEmpty:"duration 应该为大于等于 0 的整数",startDurationLimit:"duration 不能超过最大值 600000（10分钟）",startFormat:"format 只支持: "+G.join(";")};function W(e){var t=!1,r={start:[],stop:[],error:[]},i=new Map,n=function(i){return function(n){return t||(t=!0,e.event.addEventListener("native_audio_recorder_start",a("start")),e.event.addEventListener("native_audio_recorder_stop",a("stop")),e.event.addEventListener("native_audio_recorder_error",a("error"))),r[i].push(n),function(){return r[i]=r[i].filter((function(e){return e!==n}))}}},a=function(e){return function(t){i.has(t.taskId)&&("stop"!==e&&"error"!==e||i.delete(t.taskId),r[e].forEach((function(e){return t?e(t):e()})))}};return{onStart:n("start"),onStop:n("stop"),onError:n("error"),addListenId:function(e){return i.set(e,!0)},rmListenId:function(e){return i.delete(e)}}}var q="readFile 方法需要传入 config 参数",z="filePath 参数不能为空",Y="encoding 参数不能为空";var X={recorderManager:function(e){return l(void 0,void 0,void 0,(function(){var t,r,i,n,a,o;return f(this,(function(s){return function(e){return!!(e.event&&e.system&&e.system.startAudioRecorder&&e.system.stopAudioRecorder)}(e)?(t=W(e),r=t.onStart,i=t.onStop,n=t.onError,a=t.addListenId,o=t.rmListenId,[2,{start:function(t){return l(void 0,void 0,void 0,(function(){var r,i,n;return f(this,(function(s){switch(s.label){case 0:return(r=function(e){return e?!Number.isInteger(e.duration)||e.duration<=0?j(K.startDurationEmpty):e.duration>6e5?j(K.startDurationLimit):e.format&&G.includes(e.format)?null:j(K.startFormat):j(K.startConfigEmpty)}(t))?[2,r]:(i=""+Date.now(),a(i),[4,e.system.startAudioRecorder(c(c({},t),{taskId:i}))]);case 1:return(n=s.sent())&&1===n.result||o(i),[2,n]}}))}))},stop:function(){return e.system.stopAudioRecorder()},onStart:r,onStop:i,onError:n}]):[2,null]}))}))},fileManager:function(e){return l(void 0,void 0,void 0,(function(){return f(this,(function(t){return function(e){return!!e.system&&!!e.system.readFile}(e)?[2,{readFile:function(t){var r=function(e){return e?e.filePath?e.encoding?null:j(Y):j(z):j(q)}(t);return r||e.system.readFile(t)}}]:[2,null]}))}))}},Q={kwai:"Kwai",kwaiAd:"KwaiAd",kwaiAdThird:"KwaiAdThird",kwaiMerchant:"KwaiMerchant",kwaiLive:"KwaiLive",Kwai:"Kwai",KwaiAd:"KwaiAd",KwaiAdThird:"KwaiAdThird",KwaiMerchant:"KwaiMerchant",KwaiLive:"KwaiLive"};function J(e){return l(this,void 0,void 0,(function(){var t;return f(this,(function(r){switch(r.label){case 0:return[4,V(X,e)];case 1:return t=r.sent(),e.feApi=t,[2]}}))}))}function $(){var e=this,t=this,r=function(){var r=Date.now();t.register({namespace:"tool",name:"getApiList"}),t.tool.getApiList({},(function(i){var n=i.result,a=i.apiList;return l(e,void 0,void 0,(function(){var e,i,o;return f(this,(function(s){switch(s.label){case 0:for(1!==n&&(a=v),e=a.length;e--;)i=a[e],(o=g[i.namespace+"."+i.name])&&(i=c(c({},i),o)),1===n&&(this._apisMap={result:n,apiList:a}),t.register(c({},i));return function(e){var t=e.event,r=O(e);t&&t.addEventListener&&(t._addEventListener=t.addEventListener,t.addEventListener=r.addEventListenerHandler),t&&t.removeEventListener&&(t._removeEventListener=t.removeEventListener,t.removeEventListener=r.removeEventListener)}(t),[4,J(t)];case 1:return s.sent(),F.call(t,"2fa790a375",{name:"yoda_auto_register",category:"yoda_js_sdk",result_type:n,extra_info:JSON.stringify({res:this._apisMap,apiLength:a.length})},r),t._readyResolve(),[2]}}))}))}))};window.__yodaBridge__?r():window.__yodaBridgeReady__=r}function Z(e){var t=e.id,r=e.params,i=this._callbacks[t];i&&i(r)}var ee={beforeInvoke:function(e,t){var r=e.namespace,i=e.name,n=e.params,a=e.callbackId;if("tool"===r&&0!==Object.keys(this._apisMap).length){if("getApiList"===i)return void window.__yodaBridgeCallback__(a,this._apisMap);if("canIUse"===i){var o=this._apisMap.apiList,s=n.namespace,u=n.name,d=Q[s]||s,c=o.some((function(e){var t=e.namespace,r=e.name;return t===d&&r===u}));return void window.__yodaBridgeCallback__(a,{result:1,canUse:c})}}t()}},te=window&&window.navigator&&window.navigator.userAgent.toLowerCase()||"",re=/(iPhone|iPad|iPod|iOS)/i.test(te),ie={requestLocationPermission:"requestLocationPermissionWithPermissionCheck",getLocation:"getLocationWithPermissionCheck",syncLocation:"syncLocationWithPermissionCheck"};var ne={beforeInvoke:function(e,t){var r=this,i=e.namespace,n=e.name,a=e.params,o=e.callbackId;if(!function(e,t){return"kwai"===e.toLocaleLowerCase()&&!!ie[t]}(i,n))return t();if(!function(e,t){var r=ie[t];return e.kwai&&!!e.kwai[r]||e.Kwai&&e.Kwai[r]}(r,n))return re&&"requestLocationPermission"===n&&(e.name="requestLocationAuthorization"),t();if(e.name=ie[n],e.params=c(c({},a),{forced_permission_request:a.forced_permission_request||2}),e.params.callback){var s=window[e.params.callback];window[e.params.callback]=function(e){var t=!1;if("string"==typeof e)try{e=JSON.parse(e)}catch(r){console.warn(r),t=!0}s(t?e:c(c({},e),{withPermissionCheck:!0}))}}else{var u=r._callbacks[o];r._callbacks[o]=function(e){e.withPermissionCheck=!0,u(e)}}t()}},ae=Number.MAX_SAFE_INTEGER||9007199254740991,oe=new(function(){function e(){this.isInYoda=!!window.__yodaBridge__,this._instanceId=this.genInstanceId(),this._callbackId=1,this._callbacks={},this._eventListeners={},this._apisMap={},this._readyPromise=o,this._readyResolve=a,this.ready=s,this._plugins=[],this.version="0.5.0-beta.3",this.overflow=!1,this.plugin=function(e,t){e._plugins=[];var r=function(r){var i=t[r],n=r[0].toUpperCase()+r.slice(1),a="before"+n,o="after"+n;e[r]=function(t){var r=e._plugins,n=r.length,s=-1;!function u(){for(var d=function(){var i=r[s][a];if("function"==typeof i){var n=!1;return i.call(e,t,(function(){n||(n=!0,u())})),{value:void 0}}};++s<n;){var c=d();if("object"==typeof c)return c.value}i.call(e,t);for(var l=0;l<n;l++){var f=r[l][o];"function"==typeof f&&f.call(e,t)}}()}};for(var i in t)r(i);return function(t){"function"==typeof t&&(t=new t(e)),e._plugins.push(t)}}(this,{register:u,invoke:d,callbackHandler:Z,init:$})}return e.prototype.genCallbackId=function(){var e=this.genNextId();return e>=ae?(this.overflow=!0,this._callbackId=1,this._instanceId=this.genInstanceId(),this.genCallbackId()):""+e},e.prototype.genNextId=function(){for(var e=this._instanceId+this._callbackId++;this.overflow&&this._callbacks[e];)e=this._instanceId+this._callbackId++;return e},e.prototype.genInstanceId=function(){var e=""+ae,t=Number(e.slice(0,3))-100,r=Math.floor(Math.random()*t),i=""+Date.now(),n=i.slice(i.length-9),a=new Array(e.length-12).fill(0).join("");return Number(""+r+n+a)},e}());function se(e){var t={exports:{}};return e(t,t.exports),t.exports}window.__yodaBridgeCallback__=function(e,t){oe.callbackHandler({id:e,params:t})},[ee,ne].forEach((function(e){return oe.plugin(e)})),setTimeout((function(){return oe.init()}));var ue=se((function(e){function t(){return e.exports=t=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var i in r)Object.prototype.hasOwnProperty.call(r,i)&&(e[i]=r[i])}return e},t.apply(this,arguments)}e.exports=t}));function de(e){return new Promise((function(t){setTimeout(t,e)}))}function ce(){return new Promise((function(e){requestAnimationFrame(e)}))}function le(e){return new Promise((function(t){var r=new Image;r.onload=t,r.src=e}))}var fe=null;parent===self?(fe=oe,window.__yoda__=oe):fe=function e(t){return t!==t.parent?e(t.parent):t}(self).__yoda__||oe;var _e=fe,he=window&&window.navigator&&window.navigator.userAgent.toLowerCase()||"",pe=he.split(" ").reduce((function(e,t){var r=t.split("/");return e[r[0]]=r[1],e}),{}),ve=_e.isInYoda,me=he.match(/ tbs\//i)||he.match(/xweb/i),ge=he.match(/android/i),ye=he.match(/iphone/i)||he.match(/ipad/i);he.match(/UIWebView/i);var Ee,Se,Te,be=function(){try{return!!KwSdk}catch(e){}return!1}(),Le=function(){try{return KwSdk.supports("ksplayer_v1")}catch(e){}return!1}(),Ae=ye&&ve&&"wk"===pe.webviewtype,Re=ge&&Le,Ie=!1,ke=0,Ce=new Promise((function(e){Ee=function(t){var r=t.enable,i=t.version;t.enableFullScreen,e(r),Ie=r,ke=i}})),xe=function(){if(ge)return be?"KsWebView":"WebView";if(ye){if(ve&&"wk"===pe.webviewtype)return"YodaWKWebView";if(ve&&"wk"===pe.webviewtype)return"WKWebView"}return"UIWebView"},De=pe.yoda,we=!!pe.kwai,Oe=pe.kwai,Pe=!!pe.ksnebula,Ne=pe.ksnebula,Me=function(e,t){void 0===e&&(e=""),void 0===t&&(t="");for(var r=e.split("."),i=t.split("."),n=Math.max(r.length,i.length),a=0,o=0;o<n;o++){var s=r.length>o?r[o]:"0",u=isNaN(Number(s))?s.charCodeAt(0):Number(s),d=i.length>o?i[o]:"0",c=isNaN(Number(d))?d.charCodeAt(0):Number(d);if(u<c){a=-1;break}if(u>c){a=1;break}}return a},Ue=(Se="did",(Te=document.cookie.match(new RegExp("(^| )"+Se+"=([^;]+)")))?Te[2]:""),Be=1,Fe=Math.floor(1e6*Math.random()),Ve=Date.now()+"-"+Fe;var He=function(){function e(){var e=this;this.taskQueue=[],this.pending=!1,this.addTask=function(t){return new Promise((function(r){e.taskQueue.push({task:t,done:r}),e.next()}))}}var t=e.prototype;return t.next=function(){if(!this.pending&&0!==this.taskQueue.length){var e=this.taskQueue.shift();this.execTask(e)}},t.execTask=function(e){var t,r=this,i=e.task,n=e.done,a=i(),o=Promise.resolve();o=!(t=a)||"object"!=typeof t&&"function"!=typeof t||"function"!=typeof t.then?Promise.resolve(a):a,this.pending=!0,o.then((function(e){n(e)})).catch().then((function(){r.pending=!1,r.next()}))},e}();function je(e){var t=null;return{create:function(){return t||((t=e.apply(void 0,arguments)).catch().then((function(){return t=null})),t)},clear:function(){return t=null}}}var Ge=function(){function e(e){var t=this;this.isCanceled=!1,this.cancelCbList=[function(){return t.isCanceled=!0}],e&&e((function(e){return t.cancelCbList.push(e)}))}return e.prototype.cancel=function(){this.isCanceled||(this.cancelCbList.forEach((function(e){return e()})),this.cancelCbList=[])},e}();function Ke(e){void 0===e&&(e=0);var t=[],r=[];return{next:function(i){e>0&&(r.push(i),r.length>e&&r.shift()),t.forEach((function(e){return e(i)}))},stream:function(e){return r.length>0&&r.forEach((function(t){return e(t)})),t.push(e),function(){t=t.filter((function(t){return t!==e}))}}}}function We(){for(var e=arguments.length,t=new Array(e),r=0;r<e;r++)t[r]=arguments[r];return function(e){var r=new Array(t.length).fill(null),i=new Array(t.length).fill(!1),n=[],a=!1;return t.forEach((function(o,s){n.push(o((function(n){a||(function(e,t){r[t]=e,i[t]=!0}(n,s),function(){if(!i.includes(!1)){var n=[].concat(r);r=new Array(t.length).fill(null),i=new Array(t.length).fill(!1),e(n)}}())})))})),function(){a||(a=!0,n.forEach((function(e){return e()})),n=[],r=[],i=[])}}}var qe=function(e){return function(t){return function(r){return t((function(t){return r(e(t))}))}}},ze=function(e){return function(t){return function(r){return t((function(t){e(t)&&r(t)}))}}};function Ye(e){return void 0===e&&(e=1e3),function(t){var r=0,i=setInterval((function(){return t(r++)}),e);return function(){i&&(clearInterval(i),i=null)}}}var Xe=function(e){return function(t){return function(r){var i=e,n=!1,a=t((function(e){return o(e)})),o=function(e){if(!n)return i<=0?s():(i--,r(e),i<=0?s():void 0)},s=function(){n=!0,a()};return s}}};function Qe(e){return function(t){var r=!1,i=e((function(e){r||t(e)}));return function(){r||(r=!0,i())}}}var Je=function(e,t,r){return Qe((function(i){return e.addEventListener(t,i,r),function(){e.removeEventListener(t,i)}}))};function $e(e){return function(){for(var t=arguments.length,r=new Array(t),i=0;i<t;i++)r[i]=arguments[i];return r.reduce((function(e,t){return t(e)}),e)}}function Ze(){for(var e=arguments.length,t=new Array(e),r=0;r<e;r++)t[r]=arguments[r];return function(e){var r=!1,i=t.map((function(t){return t((function(t){return i=t,void(r||e(i));var i}))}));return function(){r||(r=!0,i.forEach((function(e){return e()})),i=[])}}}var et,tt,rt=function(e,t){return function(r){return function(i){var n=!1,a=0,o=r((function(r){n||(t=e(t,r,a++),i(t))}));return function(){n||(o(),n=!0)}}}},it=function(e){return function(t){return function(r){var i=!1,n=t((function(e){i||r(e)})),a=e((function(){o()})),o=function(){i||(a(),n(),i=!0)};return o}}},nt=function(e){return function(t){return function(r){return t((function(t){e(t),r(t)}))}}},at=function(e){return void 0===e&&(e=0),function(t){var r=0,i=null;return function(n){r++,i||(i=Ke(e),t((function(e){i&&i.next(e)})));var a=i.stream(n);return function(){r--,a(),r<=0&&(r=0,i=null)}}}},ot=function(e,t){var r=e.clearOnEmit;return function(e){return function(i){var n=!1,a=void 0,o=t((function(e){a=e})),s=e((function(e){var t;t=e,n||(i([t,a]),r&&(a=void 0))}));return function(){n||(o(),s(),n=!0)}}}},st=function(){};(tt=et||(et={}))[tt.none=0]="none",tt[tt.error=1]="error",tt[tt.warn=2]="warn",tt[tt.log=3]="log";var ut=function(e){return function(t){return"none"===e?st:t>=et[e]?console[e].bind(console):st}};function dt(){var e=Ke(),t=function(t){return function(r){for(var i=arguments.length,n=new Array(i>1?i-1:0),a=1;a<i;a++)n[a-1]=arguments[a];e.next({logType:t,msg:r,optionalParams:n})}};return{stream:e.stream,error:t("error"),warn:t("warn"),log:t("log")}}var ct=function(e){return function(t){return t((function(t){var r=t.logType,i=t.msg,n=t.optionalParams,a=void 0===n?[]:n;"none"!==r&&e[r].apply(e,[i].concat(a))}))}},lt=se((function(e){var t=function(e){var t,r=Object.prototype,i=r.hasOwnProperty,n="function"==typeof Symbol?Symbol:{},a=n.iterator||"@@iterator",o=n.asyncIterator||"@@asyncIterator",s=n.toStringTag||"@@toStringTag";function u(e,t,r){return Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}),e[t]}try{u({},"")}catch(D){u=function(e,t,r){return e[t]=r}}function d(e,t,r,i){var n=t&&t.prototype instanceof v?t:v,a=Object.create(n.prototype),o=new k(i||[]);return a._invoke=function(e,t,r){var i=l;return function(n,a){if(i===_)throw new Error("Generator is already running");if(i===h){if("throw"===n)throw a;return x()}for(r.method=n,r.arg=a;;){var o=r.delegate;if(o){var s=A(o,r);if(s){if(s===p)continue;return s}}if("next"===r.method)r.sent=r._sent=r.arg;else if("throw"===r.method){if(i===l)throw i=h,r.arg;r.dispatchException(r.arg)}else"return"===r.method&&r.abrupt("return",r.arg);i=_;var u=c(e,t,r);if("normal"===u.type){if(i=r.done?h:f,u.arg===p)continue;return{value:u.arg,done:r.done}}"throw"===u.type&&(i=h,r.method="throw",r.arg=u.arg)}}}(e,r,o),a}function c(e,t,r){try{return{type:"normal",arg:e.call(t,r)}}catch(D){return{type:"throw",arg:D}}}e.wrap=d;var l="suspendedStart",f="suspendedYield",_="executing",h="completed",p={};function v(){}function m(){}function g(){}var y={};y[a]=function(){return this};var E=Object.getPrototypeOf,S=E&&E(E(C([])));S&&S!==r&&i.call(S,a)&&(y=S);var T=g.prototype=v.prototype=Object.create(y);function b(e){["next","throw","return"].forEach((function(t){u(e,t,(function(e){return this._invoke(t,e)}))}))}function L(e,t){function r(n,a,o,s){var u=c(e[n],e,a);if("throw"!==u.type){var d=u.arg,l=d.value;return l&&"object"==typeof l&&i.call(l,"__await")?t.resolve(l.__await).then((function(e){r("next",e,o,s)}),(function(e){r("throw",e,o,s)})):t.resolve(l).then((function(e){d.value=e,o(d)}),(function(e){return r("throw",e,o,s)}))}s(u.arg)}var n;this._invoke=function(e,i){function a(){return new t((function(t,n){r(e,i,t,n)}))}return n=n?n.then(a,a):a()}}function A(e,r){var i=e.iterator[r.method];if(i===t){if(r.delegate=null,"throw"===r.method){if(e.iterator.return&&(r.method="return",r.arg=t,A(e,r),"throw"===r.method))return p;r.method="throw",r.arg=new TypeError("The iterator does not provide a 'throw' method")}return p}var n=c(i,e.iterator,r.arg);if("throw"===n.type)return r.method="throw",r.arg=n.arg,r.delegate=null,p;var a=n.arg;return a?a.done?(r[e.resultName]=a.value,r.next=e.nextLoc,"return"!==r.method&&(r.method="next",r.arg=t),r.delegate=null,p):a:(r.method="throw",r.arg=new TypeError("iterator result is not an object"),r.delegate=null,p)}function R(e){var t={tryLoc:e[0]};1 in e&&(t.catchLoc=e[1]),2 in e&&(t.finallyLoc=e[2],t.afterLoc=e[3]),this.tryEntries.push(t)}function I(e){var t=e.completion||{};t.type="normal",delete t.arg,e.completion=t}function k(e){this.tryEntries=[{tryLoc:"root"}],e.forEach(R,this),this.reset(!0)}function C(e){if(e){var r=e[a];if(r)return r.call(e);if("function"==typeof e.next)return e;if(!isNaN(e.length)){var n=-1,o=function r(){for(;++n<e.length;)if(i.call(e,n))return r.value=e[n],r.done=!1,r;return r.value=t,r.done=!0,r};return o.next=o}}return{next:x}}function x(){return{value:t,done:!0}}return m.prototype=T.constructor=g,g.constructor=m,m.displayName=u(g,s,"GeneratorFunction"),e.isGeneratorFunction=function(e){var t="function"==typeof e&&e.constructor;return!!t&&(t===m||"GeneratorFunction"===(t.displayName||t.name))},e.mark=function(e){return Object.setPrototypeOf?Object.setPrototypeOf(e,g):(e.__proto__=g,u(e,s,"GeneratorFunction")),e.prototype=Object.create(T),e},e.awrap=function(e){return{__await:e}},b(L.prototype),L.prototype[o]=function(){return this},e.AsyncIterator=L,e.async=function(t,r,i,n,a){void 0===a&&(a=Promise);var o=new L(d(t,r,i,n),a);return e.isGeneratorFunction(r)?o:o.next().then((function(e){return e.done?e.value:o.next()}))},b(T),u(T,s,"Generator"),T[a]=function(){return this},T.toString=function(){return"[object Generator]"},e.keys=function(e){var t=[];for(var r in e)t.push(r);return t.reverse(),function r(){for(;t.length;){var i=t.pop();if(i in e)return r.value=i,r.done=!1,r}return r.done=!0,r}},e.values=C,k.prototype={constructor:k,reset:function(e){if(this.prev=0,this.next=0,this.sent=this._sent=t,this.done=!1,this.delegate=null,this.method="next",this.arg=t,this.tryEntries.forEach(I),!e)for(var r in this)"t"===r.charAt(0)&&i.call(this,r)&&!isNaN(+r.slice(1))&&(this[r]=t)},stop:function(){this.done=!0;var e=this.tryEntries[0].completion;if("throw"===e.type)throw e.arg;return this.rval},dispatchException:function(e){if(this.done)throw e;var r=this;function n(i,n){return s.type="throw",s.arg=e,r.next=i,n&&(r.method="next",r.arg=t),!!n}for(var a=this.tryEntries.length-1;a>=0;--a){var o=this.tryEntries[a],s=o.completion;if("root"===o.tryLoc)return n("end");if(o.tryLoc<=this.prev){var u=i.call(o,"catchLoc"),d=i.call(o,"finallyLoc");if(u&&d){if(this.prev<o.catchLoc)return n(o.catchLoc,!0);if(this.prev<o.finallyLoc)return n(o.finallyLoc)}else if(u){if(this.prev<o.catchLoc)return n(o.catchLoc,!0)}else{if(!d)throw new Error("try statement without catch or finally");if(this.prev<o.finallyLoc)return n(o.finallyLoc)}}}},abrupt:function(e,t){for(var r=this.tryEntries.length-1;r>=0;--r){var n=this.tryEntries[r];if(n.tryLoc<=this.prev&&i.call(n,"finallyLoc")&&this.prev<n.finallyLoc){var a=n;break}}a&&("break"===e||"continue"===e)&&a.tryLoc<=t&&t<=a.finallyLoc&&(a=null);var o=a?a.completion:{};return o.type=e,o.arg=t,a?(this.method="next",this.next=a.finallyLoc,p):this.complete(o)},complete:function(e,t){if("throw"===e.type)throw e.arg;return"break"===e.type||"continue"===e.type?this.next=e.arg:"return"===e.type?(this.rval=this.arg=e.arg,this.method="return",this.next="end"):"normal"===e.type&&t&&(this.next=t),p},finish:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var r=this.tryEntries[t];if(r.finallyLoc===e)return this.complete(r.completion,r.afterLoc),I(r),p}},catch:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var r=this.tryEntries[t];if(r.tryLoc===e){var i=r.completion;if("throw"===i.type){var n=i.arg;I(r)}return n}}throw new Error("illegal catch attempt")},delegateYield:function(e,r,i){return this.delegate={iterator:C(e),resultName:r,nextLoc:i},"next"===this.method&&(this.arg=t),p}},e}(e.exports);try{regeneratorRuntime=t}catch(r){Function("r","regeneratorRuntime = r")(t)}}));function ft(e,t,r,i,n,a,o){try{var s=e[a](o),u=s.value}catch(d){return void r(d)}s.done?t(u):Promise.resolve(u).then(i,n)}var _t=function(e){return function(){var t=this,r=arguments;return new Promise((function(i,n){var a=e.apply(t,r);function o(e){ft(a,i,n,o,s,"next",e)}function s(e){ft(a,i,n,o,s,"throw",e)}o(void 0)}))}};var ht,pt,vt,mt,gt=function(e,t){e.prototype=Object.create(t.prototype),e.prototype.constructor=e,e.__proto__=t},yt=function(e){return $e(Ze(Je(e,"firstframe"),$e(Je(e,"firstframe"))(qe((function(){return Je(e,"playing")})),(function(e){return function(t){var r=!1,i=[],n=e((function(e){if(!r&&e){var n=e((function(e){r||t(e)}));i.push(n)}}));return i.push(n),function(){r||(i.forEach((function(e){return e()})),i=[],r=!0)}}}))))(ze((function(){return!e.paused})))};(pt=ht||(ht={})).idle="idle",pt.playing="playing",pt.paused="paused",pt.released="released",pt.ended="ended",pt.error="error",pt.destroyed="destroyed",(mt=vt||(vt={})).Player="player",mt.Plugin="plugin",mt.Track="track",mt.All="all";var Et=function(){function e(e,t,r,i,n){this.el=e,this.event$=t,this.id=r,this.config=i,this.logger=n}var t=e.prototype;return t.trigger=function(e,t){"timeupdate"!==e&&this.logger.log("trigger: "+e,this.id,t),this.event$.next({namespace:vt.Player,type:e,data:t})},t.triggerTrackInfo=function(e,t){this.event$.next({namespace:vt.Track,type:e,data:t})},t.updateConfig=function(e){this.config=ue({},this.config,e)},e}(),St=function(e){function t(){return e.apply(this,arguments)||this}return gt(t,e),t}(Et),Tt=function(e){function t(){for(var t,r=arguments.length,i=new Array(r),n=0;n<r;n++)i[n]=arguments[n];return(t=e.call.apply(e,[this].concat(i))||this).name="android-live-player",t.disposeEvent=null,t.videoEl=null,t.loadStart$=Ke(),t.loaded=!1,t}gt(t,e);var r=t.prototype;return r.load=function(){var e=_t(lt.mark((function e(t){var r,i,n;return lt.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!this.loaded){e.next=2;break}return e.abrupt("return",this.getInstance());case 2:return t=t||{},r=ue({},this.config,t),this.trigger("before-load",!!r.autoplay),i=!this.videoEl,n=i?document.createElement("video"):this.videoEl,this.videoEl=n,this.initElWithConfig(n,r),i&&this.loadStart$.next(),i?(this.listenElEvent(n),this.el.appendChild(n)):n.load(),this.loaded=!0,this.trigger("after-load",null),e.abrupt("return",this.getInstance());case 14:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}(),r.dispose=function(){var e=_t(lt.mark((function e(){return lt.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this.trigger("before-dispose",null),this.loaded=!1,this.disposeEvent&&this.disposeEvent(),this.videoEl&&(this.releasePlayer(this.videoEl),this.videoEl.remove(),this.videoEl=null),this.trigger("after-dispose",null),e.abrupt("return","");case 6:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}(),r.getInstance=function(){var e,t,r,i,n,a=this;return{pause:(n=_t(lt.mark((function e(){return lt.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(a.videoEl){e.next=2;break}return e.abrupt("return");case 2:return e.abrupt("return",a.videoEl.pause());case 3:case"end":return e.stop()}}),e)}))),function(){return n.apply(this,arguments)}),play:(i=_t(lt.mark((function e(){return lt.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(a.videoEl){e.next=2;break}return e.abrupt("return",a.load({autoplay:!0}));case 2:return e.abrupt("return",a.videoEl.play());case 3:case"end":return e.stop()}}),e)}))),function(){return i.apply(this,arguments)}),fullScreen:(r=_t(lt.mark((function e(){return lt.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(a.videoEl){e.next=2;break}return e.abrupt("return");case 2:if(a.videoEl.requestFullscreen){e.next=4;break}return e.abrupt("return",a.logger.warn("requestFullscreen is not a function"));case 4:return e.abrupt("return",a.videoEl.requestFullscreen());case 5:case"end":return e.stop()}}),e)}))),function(){return r.apply(this,arguments)}),setMuted:(t=_t(lt.mark((function e(t){return lt.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(a.videoEl){e.next=2;break}return e.abrupt("return");case 2:return e.abrupt("return",a.videoEl.muted=t);case 3:case"end":return e.stop()}}),e)}))),function(e){return t.apply(this,arguments)}),updateSource:(e=_t(lt.mark((function e(t){return lt.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(a.videoEl){e.next=2;break}return e.abrupt("return");case 2:if(a.config=ue({},a.config,t),!a.videoEl.updatelivesrc){e.next=6;break}return a.logger.warn("updatelivesrc",a.config.src),e.abrupt("return",a.videoEl.updatelivesrc(JSON.stringify(a.config.src)));case 6:return e.abrupt("return",!1);case 7:case"end":return e.stop()}}),e)}))),function(t){return e.apply(this,arguments)})}},r.initElWithConfig=function(e,t){var r=t.src,i=void 0===r?{}:r,n=t.autoplay,a=t.muted,o=t.objectFit,s=t.forceUseMinResolution,u=void 0!==s&&s,d=t.activityTag;e.removeAttribute("width"),e.removeAttribute("height"),e.style.width="100%",e.style.height="100%",e.disableRemotePlayback=!0,e.setAttribute("poster","data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAQAAAC1HAwCAAAAC0lEQVR42mNkYAAAAAYAAjCB0C8AAAAASUVORK5CYII=");var c=document.createElement("source");return c.src="1",e.appendChild(c),e.setAttribute("useksplayer","live-video"),e.setAttribute("livesrc",JSON.stringify(ue({},i,{yodaConfig:{forceUseMinResolution:u,pageUrl:window.location.href,activityTag:d}}))),n&&e.setAttribute("autoplay",""),a&&(e.setAttribute("muted",""),e.muted=a),e.setAttribute("playsinline",""),e.setAttribute("webkit-playsinline",""),o&&(e.style.objectFit=o),e},r.listenElEvent=function(e){var t=this,r=[Je(e,"firstframe")((function(){return t.triggerTrackInfo("firstframe",null)})),Je(e,"play")((function(){return t.trigger("play",null)})),Je(e,"pause")((function(){return t.trigger("pause",null)})),yt(e)((function(){return t.trigger("playing",null)})),Je(e,"waiting")((function(){return t.trigger("waiting",null)})),Je(e,"fullscreenchange")((function(){return t.trigger("fullscreenchange",{isFull:!!document.fullscreenElement})})),Je(e,"timeupdate")((function(){return t.trigger("timeupdate",{to:e.currentTime})})),$e(Je(e,"error"))(ze((function(){return!!e.error})),qe((function(){return e.error})))((function(e){t.disposeEvent&&(t.logger.warn("dispose inner listener"),t.disposeEvent(),t.disposeEvent=null),t.trigger("error",{type:"noMoreSource",originalError:{message:(null==e?void 0:e.message)||"",code:null==e?void 0:e.code}})}))];this.disposeEvent=function(){r.forEach((function(e){return e()})),r=[]}},r.releasePlayer=function(e){e.src="",e.releaseplayer&&(this.logger.warn("call releaseplayer",this.id),this.videoEl.releaseplayer())},t}(St),bt=function(e){return function(t){return function(r){return r(e),t((function(e){return r(e)}))}}},Lt=function(e,t,r){var i=$e(t)(it(Ze(e,r)),Xe(1));return $e(e)(qe((function(){return i})),(function(e){return function(t){var r=!1,i=[],n=e((function(e){if(!r&&e){var n=e((function(e){r||t(e)}));i.push(n)}}));return i.push(n),function(){r||(i.forEach((function(e){return e()})),i=[],r=!0)}}}))},At=function(e){return $e(Ze(Je(e,"playing"),Je(e,"loadeddata"),Je(e,"durationchange"),$e(Je(e,"timeupdate"))(ze((function(){return 0!==e.currentTime}))),Je(e,"canplay")))(Xe(1))},Rt=function(e,t,r){var i=$e(Ye(300))(qe((function(){return r.currentTime})),bt(r.currentTime),(function(e){return function(t){var r=null,i=!1,n=!1,a=e((function(e){var n=r;r=e,i?t([n,e]):i=!0}));return function(){n||(n=!0,r=null,i=!1,a())}}}),ze((function(e){return e[0]!==e[1]})),it(Ze(e,t)));return $e(e)(qe((function(){return i})),(function(e){return function(t){var r=!1,i=[],n=e((function(e){if(!r&&e){var n=e((function(e){r||t(e)}));i.push(n)}}));return i.push(n),function(){r||(i.forEach((function(e){return e()})),i=[],r=!0)}}}),qe((function(e){return e[1]})))},It=function(e){function t(){for(var t,r=arguments.length,i=new Array(r),n=0;n<r;n++)i[n]=arguments[n];return(t=e.call.apply(e,[this].concat(i))||this).name="h5-live-player",t.disposeEvent=null,t.videoEl=null,t.loadStart$=Ke(),t.loaded=!1,t}gt(t,e);var r=t.prototype;return r.load=function(){var e=_t(lt.mark((function e(t){var r,i,n;return lt.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=t||{},r=ue({},this.config,t),this.trigger("before-load",!!r.autoplay),i=!this.videoEl,n=i?document.createElement("video"):this.videoEl,this.videoEl=n,this.initElWithConfig(n,r),i&&this.loadStart$.next(),i?(this.listenElEvent(n),this.el.appendChild(n)):n.load(),this.loaded=!0,this.trigger("after-load",null),this.logger.warn("[live player] IS_ANDROID: "+ge+", IS_X5: "+me+", autoplay: "+r.autoplay),ge&&me&&r.autoplay&&(this.logger.warn("manual play by x5"),n.play()),e.abrupt("return",this.getInstance());case 14:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}(),r.dispose=function(){var e=_t(lt.mark((function e(){return lt.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this.trigger("before-dispose",null),this.loaded=!1,this.disposeEvent&&this.disposeEvent(),this.videoEl&&(this.videoEl.src="",this.videoEl.remove(),this.videoEl=null),this.trigger("after-dispose",null),e.abrupt("return","");case 6:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}(),r.getInstance=function(){var e,t,r,i,n,a=this;return{pause:(n=_t(lt.mark((function e(){return lt.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(a.videoEl){e.next=2;break}return e.abrupt("return");case 2:return e.abrupt("return",a.videoEl.pause());case 3:case"end":return e.stop()}}),e)}))),function(){return n.apply(this,arguments)}),play:(i=_t(lt.mark((function e(){return lt.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(a.videoEl){e.next=2;break}return e.abrupt("return",a.load({autoplay:!0}));case 2:return e.abrupt("return",a.videoEl.play());case 3:case"end":return e.stop()}}),e)}))),function(){return i.apply(this,arguments)}),fullScreen:(r=_t(lt.mark((function e(){return lt.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(a.videoEl){e.next=2;break}return e.abrupt("return");case 2:if(a.videoEl.requestFullscreen){e.next=4;break}return e.abrupt("return",a.logger.warn("requestFullscreen is not a function"));case 4:return e.abrupt("return",a.videoEl.requestFullscreen());case 5:case"end":return e.stop()}}),e)}))),function(){return r.apply(this,arguments)}),setMuted:(t=_t(lt.mark((function e(t){return lt.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(a.videoEl){e.next=2;break}return e.abrupt("return");case 2:a.videoEl.muted=t,t?a.videoEl.setAttribute("muted",""):a.videoEl.removeAttribute("muted");case 4:case"end":return e.stop()}}),e)}))),function(e){return t.apply(this,arguments)}),updateSource:(e=_t(lt.mark((function e(t){return lt.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(a.videoEl){e.next=2;break}return e.abrupt("return",!1);case 2:return a.config=ue({},a.config,t),a.videoEl.src=a.config.fallbackSrc,e.abrupt("return",!0);case 5:case"end":return e.stop()}}),e)}))),function(t){return e.apply(this,arguments)})}},r.initElWithConfig=function(e,t){var r=t.autoplay,i=t.muted,n=t.objectFit,a=t.fallbackSrc;return e.removeAttribute("width"),e.removeAttribute("height"),e.style.width="100%",e.style.height="100%",e.style.transform="translateZ(0)",e.disableRemotePlayback=!0,e.setAttribute("poster","data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAQAAAC1HAwCAAAAC0lEQVR42mNkYAAAAAYAAjCB0C8AAAAASUVORK5CYII="),e.src=a||"",r&&e.setAttribute("autoplay",""),i&&(e.setAttribute("muted",""),e.muted=i),e.setAttribute("playsinline",""),e.setAttribute("webkit-playsinline",""),n&&(e.style.objectFit=n),ge&&me&&e.setAttribute("x5-video-player-type","h5-page"),e},r.listenElEvent=function(e){var t=this,r=Je(e,"play"),i=Je(e,"pause"),n=Je(e,"playing"),a=Je(e,"waiting"),o=Ze(Je(e,"timeupdate"),Rt(r,i,e)),s=Ze($e(Je(e,"error"))(ze((function(){return!!e.error})),qe((function(){return e.error})))),u=$e(Ze(a,$e(Ze(r,o))(qe((function(){return $e(Ye(1e3))(ot({clearOnEmit:!0},o),ze((function(e){return e[0],void 0===e[1]})),it(Ze(r,i,a,o)),Xe(1))})),(function(e){return function(t){var r=!1,i=[],n=e((function(e){if(!r&&e){var n=e((function(e){r||t(e)}));i.push(n)}}));return i.push(n),function(){r||(i.forEach((function(e){return e()})),i=[],r=!0)}}}))))(ze((function(){return!e.paused})),at()),d=$e(Lt(Ze(r,u),Ze(o,n),i))(at()),c=[r((function(){return t.trigger("play",null)})),At(e)((function(){t.triggerTrackInfo("firstframe",null)})),i((function(){return t.trigger("pause",null)})),d((function(){return t.trigger("playing",null)})),u((function(){return t.trigger("waiting",null)})),o((function(){return t.trigger("timeupdate",{to:e.currentTime})})),s((function(e){t.disposeEvent&&(t.disposeEvent(),t.disposeEvent=null),t.trigger("error",{type:"noMoreSource",originalError:e})}))];this.disposeEvent=function(){c.forEach((function(e){return e()})),c=[]}},t}(St);var kt=function(e,t){if(null==e)return{};var r,i,n={},a=Object.keys(e);for(i=0;i<a.length;i++)r=a[i],t.indexOf(r)>=0||(n[r]=e[r]);return n};function Ct(e,t){for(var r=0;r<t.length;r++){var i=t[r];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}var xt,Dt,wt,Ot,Pt=function(e,t,r){return t&&Ct(e.prototype,t),r&&Ct(e,r),e};(Dt=xt||(xt={}))[Dt.WillIdle=0]="WillIdle",Dt[Dt.Idle=1]="Idle",Dt[Dt.WillLoad=2]="WillLoad",Dt[Dt.Loaded=3]="Loaded",(Ot=wt||(wt={}))[Ot.StartLoad=0]="StartLoad",Ot[Ot.PageShowReload=1]="PageShowReload",Ot[Ot.FinishLoad=2]="FinishLoad",Ot[Ot.StartRelease=3]="StartRelease",Ot[Ot.FinishRelease=4]="FinishRelease";var Nt,Mt,Ut,Bt,Ft=function(){function e(){this.state=xt.Idle,this.lifecycleChange$=Ke()}var t=e.prototype;return t.trigger=function(e,t){if(void 0===t&&(t=null),this.isValidEvent(e)){switch(e){case wt.StartLoad:case wt.PageShowReload:this.state=xt.WillLoad;break;case wt.FinishLoad:this.state=xt.Loaded;break;case wt.StartRelease:this.state=xt.WillIdle;break;case wt.FinishRelease:this.state=xt.Idle}this.lifecycleChange$.next({lifeCycle:this.state,data:t})}},t.isValidEvent=function(e){switch(e){case wt.StartLoad:return this.state!==xt.WillIdle;case wt.FinishLoad:return this.state===xt.WillLoad;case wt.StartRelease:case wt.PageShowReload:return[xt.Loaded,xt.WillLoad].includes(this.state);case wt.FinishRelease:return this.state===xt.WillIdle}},t.on=function(e,t){return $e(this.lifecycleChange$.stream)(ze((function(t){return t.lifeCycle===e})),Xe(1))(t)},e}();(Mt=Nt||(Nt={})).VIDEO="NORMAL",Mt.LIVE="LIVE",(Bt=Ut||(Ut={})).MP4="mp4",Bt.M3U8="m3u8",Bt.FLV="flv";var Vt,Ht,jt=Ke(),Gt=Ke();(Ht=Vt||(Vt={}))[Ht.success=1]="success";var Kt=["pageReady","play","playing","pause","timeUpdate","waiting","fullScreenChange","error","domLost","firstFrame","seek","loadedmetadata","ended","abLoopEnded","speedChange"],Wt=Ke(),qt=[-5001,-5002,-5102,-5103,-5104,-5105,-5109,-5110,-5121,-5122,-5123,-5124,-5131,-5132,-5133,-5134,-5135],zt="data-setup",Yt="yoda-video-context",Xt=15,Qt=100,Jt=2e4,$t=dt(),Zt=function(){Promise.resolve({});(_e.tool&&_e.tool.getCurrentPageConfig?_e.tool.getCurrentPageConfig({pageUrl:window.location.href}):_e.tool&&_e.tool.getSwitchList?_e.tool.getSwitchList():Promise.resolve(Re?{enablePeerRender:!0}:{})).then((function(e){var t=e&&e.enablePeerRender||!1,r=e&&e.enableFullScreen||!1,i=Number(e&&e.peerRenderVersion||0);Ee({enable:t,version:i,enableFullScreen:r})}))};_e.isInYoda?_e.ready((function(){jt.stream((function(e){$t.warn("[web] send action: ",e),_e.media.video(e,(function(t){$t.warn("[web] get response: ",t,e),e.resolve(ue({},t,{nodeId:e.params.nodeId}))}))})),Gt.stream((function(e){$t.log("[web] send action: ",e),_e.media.video(e,(function(){}))})),Kt.forEach((function(e){_e.event.addEventListener("peer_render_video_"+e,(function(t){"timeUpdate"!==e&&$t.warn("[web] get native event, eventType: "+e,t),Wt.next({type:e,data:t})}))})),Zt()})):Zt();var er,tr=$e(Wt.stream)(ze((function(e){return"pageReady"===e.type})),qe((function(){return!0}))),rr=Ze($e(function(){for(var e=arguments.length,t=new Array(e),r=0;r<e;r++)t[r]=arguments[r];return function(e){var r=!1,i=function(){r=!0,n.forEach((function(e){return e()})),n=[]},n=t.map((function(t){return t((function(t){return n=t,void(r||(i(),e(n)));var n}))}));return function(){i()}}}(tr,$e(Ye(Jt))(qe((function(){return!1})),Xe(1))))(it(tr)),tr),ir=!0,nr=new Promise((function(e){return er=e}));function ar(){ir=!0,nr=new Promise((function(e){return er=e}))}function or(){return nr}Je(window,"pagehide")((function(){ar()}));var sr=$e(Je(window,"pageshow"))(ze((function(e){return e.persisted})),at());$e(sr)(bt(null),qe((function(){return Promise.resolve().then((function(){var e="peer_render_video_pageReady",t=function t(){_e.event.removeEventListener(e,t)};_e.event&&_e.event.addEventListener&&_e.event.addEventListener(e,t)})),$e(rr)(it(sr))})),(function(e){return function(t){var r=!1,i=[],n=e((function(e){if(!r&&e){var n=e((function(e){r||t(e)}));i.push(n)}}));return i.push(n),function(){r||(i.forEach((function(e){return e()})),i=[],r=!0)}}}))((function(e){ir||ar(),er(e),ir=!1}));var ur=function(e){return function(t){return new Promise((function(r){jt.next({action:e,params:t,resolve:r})}))}},dr=ur("insert"),cr=ur("updateSource"),lr=ur("destroy"),fr=ur("pause"),_r=ur("play"),hr=ur("seek"),pr=ur("fullScreen"),vr=ur("resize"),mr=ur("speed"),gr=ur("muted"),yr=ur("abLoop"),Er=ur("screenshot"),Sr=ur("simulate"),Tr=ur("refindNode"),br=ur("step"),Lr=ur("mixAudio"),Ar=ur("exitFullScreen"),Rr=[],Ir=function(e){kr(e),Rr.push(e)},kr=function(e){Rr=Rr.filter((function(t){return t!==e}))},Cr=function(){Rr.length>0&&Gt.next({action:"checkNodeState",params:{nodeIdList:Rr}})};_e.ready((function(){_e.kwai&&_e.kwai.on&&(_e.kwai.on({type:"native_foreground",handler:Cr}),_e.kwai.on({type:"native_reentry",handler:Cr}))}));var xr,Dr;function wr(e){if(!e)return{x:0,y:0,width:0,height:0};var t=e.getBoundingClientRect();return{x:t.x,y:t.y,width:e.offsetWidth,height:e.offsetHeight}}function Or(e,t,r,i){return Pr.apply(this,arguments)}function Pr(){return(Pr=_t(lt.mark((function e(t,r,i,n){var a,o;return lt.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(void 0===n&&(n=0),!r.isCanceled){e.next=3;break}return e.abrupt("return",[xr.Cancel,n]);case 3:return e.next=5,t(r);case 5:if(a=e.sent,o=n+1,!r.isCanceled){e.next=9;break}return e.abrupt("return",[xr.Cancel,o]);case 9:if(!a){e.next=11;break}return e.abrupt("return",[xr.Success,o]);case 11:if(!(n+1<i)){e.next=13;break}return e.abrupt("return",Or(t,r,i,o));case 13:return e.abrupt("return",[xr.Failed,o]);case 14:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function Nr(e){var t=e.id,r=e.el,i=e.isVideo,n=e.registerListener,a=e.onClearState,o=e.insertParams,s=e.onPageshowReload,u=e.onError,d=e.onPlay,c=e.onSuccess,l=e.onFixLost,f=e.logger,_=0,h=Math.floor(Xt/3),p=new Ft,v=new He,m=null,g="video-"+Ve+"-"+t,y=function(){return g+"-"+_},E=function(){return ke>0?g:y()},S=function(){return{nodeId:E(),domId:y()}},T=new Ge,b=null,L=!1,A=!1;function R(){b&&(f.log("reset dom",y()),b.remove(),b=null),r.textContent=""}function I(){return k.apply(this,arguments)}function k(){return(k=_t(lt.mark((function e(){return lt.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return R(),e.next=3,ce();case 3:return _++,b=C(r),e.next=7,ce();case 7:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function C(e){var t=document.createElement("div");t.style.height="100%",t.style.width="100%",t.style.overflow="scroll",t.style.webkitOverflowScrolling="touch",t.id=y();var r=document.createElement("div");return r.style.height="101%",t.appendChild(r),e.appendChild(t),t}function x(){return D.apply(this,arguments)}function D(){return(D=_t(lt.mark((function e(){return lt.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(p.isValidEvent(wt.PageShowReload)){e.next=3;break}return f.warn("prevent reloadByPageShow: ",p.state),e.abrupt("return");case 3:return f.warn("reload by page show"),se(),he(),e.abrupt("return",fe());case 7:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function w(){m&&(m(),m=null),a&&a(),me(),L=!1}function O(){var e=[];e.push($e(Je(window,"pageshow"))(ze((function(e){return e.persisted})))(_t(lt.mark((function e(){return lt.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,x();case 2:s();case 3:case"end":return e.stop()}}),e)})))));var t=Je(window,"orientationchange")((function(){return ge.resize()}));e.push(t);var r=$e(Wt.stream)(ze((function(e){return e.data.nodeId===E()})));return $e(r)(ze((function(e){return"domLost"===e.type})))((function(e){return u({type:"domLost",originalError:{message:"dom lost!"}})})),n&&e.push(n(r)),function(){e.forEach((function(e){return e()})),e=[]}}function P(e,t,r){return N.apply(this,arguments)}function N(){return(N=_t(lt.mark((function e(t,r,i){var n,a,s,d,c;return lt.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!t.isCanceled){e.next=2;break}return e.abrupt("return",[!1,0]);case 2:if(f.warn("[base ios player] execLoad preCreateDom: ",A),A){e.next=8;break}return e.next=6,I();case 6:e.next=9;break;case 8:A=!1;case 9:return f.warn("start wait page ready"),e.next=12,or();case 12:if(n=e.sent,!t.isCanceled){e.next=16;break}return f.warn("execLoad return by cancel"),e.abrupt("return",[!1,0]);case 16:if(n){e.next=19;break}return f.error("time out"),e.abrupt("return",[!1,0]);case 19:return a=ue({},o(),S(),{position:wr(b)}),i&&(a.playInfo.autoplay=i),a.logInfo.insertStartTime=r,e.next=24,Or(_t(lt.mark((function e(){var t;return lt.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,dr(a);case 2:if(t=e.sent,t.result!==Vt.success){e.next=6;break}return e.abrupt("return",!0);case 6:return e.next=8,de(Qt);case 8:return e.abrupt("return",!1);case 9:case"end":return e.stop()}}),e)}))),t,h);case 24:if(s=e.sent,d=s[0],c=s[1],!t.isCanceled){e.next=29;break}return e.abrupt("return",[!1,c]);case 29:if(d===xr.Success){e.next=33;break}return u({type:"insertGroupFailed",tryTime:c,originalError:{message:"insertGroupFailed"}}),f.error("can not insert: "+y()),e.abrupt("return",[!1,c]);case 33:return L=!0,e.abrupt("return",[!0,c]);case 35:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function M(e){return U.apply(this,arguments)}function U(){return(U=_t(lt.mark((function e(t){var r;return lt.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(void 0===t&&(t=!1),p.isValidEvent(wt.StartRelease)){e.next=3;break}return e.abrupt("return","");case 3:if(r="",!i||!t){e.next=8;break}return e.next=7,ge.screenshot();case 7:r=e.sent.img;case 8:if(p.trigger(wt.StartRelease,r),!r){e.next=16;break}return e.next=12,le(r);case 12:return e.next=14,ce();case 14:return e.next=16,ce();case 16:return e.prev=16,e.next=19,Promise.race([lr(ue({},S())),de(2e3)]);case 19:e.next=24;break;case 21:e.prev=21,e.t0=e.catch(16),f.error(e.t0);case 24:return R(),p.trigger(wt.FinishRelease),w(),e.abrupt("return",r);case 28:case"end":return e.stop()}}),e,null,[[16,21]])})))).apply(this,arguments)}function B(){return p.state===xt.Loaded&&!!b}var F,V,H,j,G,K,W,q,z,Y,X,Q,J,$,Z,ee,te,re,ie,ne,ae,oe=je((function(e){return v.addTask(_t(lt.mark((function t(){var r,i,n,a,s;return lt.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(r=0,!(i=T).isCanceled){t.next=4;break}return t.abrupt("return",!1);case 4:return m&&m(),m=O(),p.trigger(wt.StartLoad),(e||o().playInfo.autoplay)&&d(),n=Date.now(),t.next=11,Or(function(){var t=_t(lt.mark((function t(i){var a,o,s;return lt.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,P(i,n,e);case 2:return a=t.sent,o=a[0],s=a[1],r+=s,t.abrupt("return",o);case 7:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}(),i,3);case 11:if(a=t.sent,(s=a[0])!==xr.Cancel){t.next=15;break}return t.abrupt("return");case 15:if(s!==xr.Failed){t.next=21;break}return u({type:"canNotInsert",originalError:{message:"canNotInsert"},tryTime:r}),t.next=19,M();case 19:t.next=23;break;case 21:c({tryTime:r,duration:Date.now()-n}),Ir(E());case 23:return p.trigger(wt.FinishLoad),t.abrupt("return",!0);case 25:case"end":return t.stop()}}),t)}))))})),se=oe.clear,fe=oe.create,_e=je((function(e){return T.cancel(),T=new Ge,se(),kr(E()),v.addTask((function(){return M(e)}))})),he=_e.clear,pe=_e.create,ve=(F=je(_t(lt.mark((function e(){var t,r,i,n,a,o;return lt.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t=Date.now(),f.warn("in refind"),B()){e.next=5;break}return f.warn("refind skip by canExecNativeApi "),e.abrupt("return",!1);case 5:if(!(r=T).isCanceled){e.next=9;break}return f.warn("refind skip by cancelToken "),e.abrupt("return",!1);case 9:return i=ue({},S(),{position:wr(b)}),e.next=12,Tr(i);case 12:if(e.sent.result!==Vt.success){e.next=16;break}return e.abrupt("return",!0);case 16:return e.next=18,I();case 18:if(!r.isCanceled){e.next=21;break}return f.warn("refind return by cancel"),e.abrupt("return",!1);case 21:return e.next=23,Or(_t(lt.mark((function e(){return lt.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,Tr(ue({},i,S()));case 2:if(e.sent.result!==Vt.success){e.next=6;break}return e.abrupt("return",!0);case 6:return e.next=8,de(Qt);case 8:return e.abrupt("return",!1);case 9:case"end":return e.stop()}}),e)}))),r,h);case 23:return n=e.sent,a=n[0],o=n[1],l({tryTime:o,duration:Date.now()-t,result:a===xr.Success}),e.abrupt("return",a===xr.Success);case 28:case"end":return e.stop()}}),e)})))),V=F.create,H=F.clear,j=je(_t(lt.mark((function e(){var t,r,i;return lt.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(B()){e.next=2;break}return e.abrupt("return");case 2:return t=wr(b),r=t.width,i=t.height,e.abrupt("return",vr(ue({width:r,height:i},S())));case 4:case"end":return e.stop()}}),e)})))),G=j.create,K=j.clear,W=je(_t(lt.mark((function e(){return lt.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(B()){e.next=2;break}return e.abrupt("return");case 2:return e.abrupt("return",fr(ue({},S())));case 3:case"end":return e.stop()}}),e)})))),q=W.create,z=W.clear,Y=je(function(){var e=_t(lt.mark((function e(t){return lt.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(void 0===t&&(t=!1),B()){e.next=3;break}return e.abrupt("return");case 3:return e.abrupt("return",gr(ue({muted:t},S())));case 4:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()),X=Y.create,Q=Y.clear,J=je(_t(lt.mark((function e(){var t,r,n,a;return lt.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t={img:""},B()&&i){e.next=3;break}return e.abrupt("return",t);case 3:return e.next=5,Er(ue({},S()));case 5:if(r=e.sent,n=r.img,a=r.format,n&&a){e.next=10;break}return e.abrupt("return",t);case 10:return e.abrupt("return",{img:"data:image/"+a+";base64,"+n});case 11:case"end":return e.stop()}}),e)})))),$=J.create,Z=J.clear,ee=je(function(){var e=_t(lt.mark((function e(t){return lt.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(B()){e.next=2;break}return e.abrupt("return");case 2:return e.abrupt("return",Sr({nodeId:E(),type:t,domId:y()}));case 3:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()),te=ee.create,re=ee.clear,ie=je(function(){var e=_t(lt.mark((function e(t){return lt.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(B()){e.next=2;break}return e.abrupt("return");case 2:return e.abrupt("return",Lr(ue({},S(),{mixed:t})));case 3:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()),ne=ie.create,ae=ie.clear,{clear:function(){K(),z(),Q(),Z(),re(),H(),ae()},resize:G,pause:q,setMuted:X,screenshot:$,simulate:te,fixLost:V,updateMixAudio:ne}),me=ve.clear,ge=kt(ve,["clear"]);return v.addTask(_t(lt.mark((function e(){return lt.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,I();case 2:A=!0;case 3:case"end":return e.stop()}}),e)})))),{api:ge,lifecycleState:p,get loaded(){return L},get videoId(){return E()},get domId(){return y()},get commonId(){return S()},load:fe,dispose:pe,canExecNativeApi:B}}(Dr=xr||(xr={}))[Dr.Cancel=0]="Cancel",Dr[Dr.Success=1]="Success",Dr[Dr.Failed=2]="Failed";var Mr=function(e){function t(){for(var t,r=arguments.length,i=new Array(r),n=0;n<r;n++)i[n]=arguments[n];return(t=e.call.apply(e,[this].concat(i))||this).name="ios-live-player",t.basePlayer=Nr({logger:t.logger,id:t.id,el:t.el,registerListener:function(e){var r=[],i=e((function(e){var r=e.type,i=e.data;switch(r){case"pause":case"playing":case"waiting":t.trigger(r,null);break;case"fullScreenChange":t.trigger("fullscreenchange",{isFull:i.isFull});break;case"timeUpdate":t.trigger("timeupdate",{to:i.to});break;case"error":t.trigger(r,{type:"noMoreSource",originalError:i});break;case"firstFrame":t.triggerTrackInfo("firstframe",null);break;case"play":t.triggerTrackInfo("iosNativePlay",null)}}));return r.push(i),r.push(t.basePlayer.lifecycleState.on(xt.WillLoad,(function(){return t.trigger("before-load",!!t.insertConfig.playInfo.autoplay)})),t.basePlayer.lifecycleState.on(xt.Loaded,(function(){return t.trigger("after-load",null)})),t.basePlayer.lifecycleState.on(xt.WillIdle,(function(){return t.trigger("before-dispose",null)})),t.basePlayer.lifecycleState.on(xt.Idle,(function(){return t.trigger("after-dispose",null)}))),function(){r.forEach((function(e){return e()})),r=[]}},onClearState:function(){t.api.clear()},insertParams:function(){return t.insertConfig},onPageshowReload:function(){return t.trigger("pageshow-reload",null)},onError:function(e){"canNotInsert"!==e.type&&"domLost"!==e.type||t.trigger("error",e),"insertGroupFailed"===e.type&&t.triggerTrackInfo("insertgroupfailed",{tryTime:e.tryTime})},onPlay:function(){return t.trigger("play",null)},onSuccess:function(e){return t.triggerTrackInfo("insertsuccess",e)},onFixLost:function(e){var r=e.result,i=kt(e,["result"]);return t.triggerTrackInfo(r?"fixSuccess":"fixFailed",i)}}),t.api=t.createApi(),t}gt(t,e);var r=t.prototype;return r.load=function(){var e=_t(lt.mark((function e(){return lt.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!this.checkConfigAndThrowError()){e.next=3;break}return e.next=3,this.basePlayer.load();case 3:return e.abrupt("return",this.getInstance());case 4:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}(),r.dispose=function(e){return this.basePlayer.dispose(e)},r.getInstance=function(){var e=this.basePlayer.api,t=this.api;t.clear;var r=kt(t,["clear"]);return ue({},e,r)},r.createApi=function(){var e=this,t=je(_t(lt.mark((function t(){return lt.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(e.basePlayer.lifecycleState.state!==xt.WillLoad){t.next=3;break}return e.logger.log("[ios live] start return"),t.abrupt("return");case 3:if(e.loaded){t.next=7;break}if(e.checkConfigAndThrowError()){t.next=6;break}return t.abrupt("return");case 6:return t.abrupt("return",e.basePlayer.load(!0));case 7:return e.trigger("play",null),t.abrupt("return",_r(ue({},e.basePlayer.commonId)));case 9:case"end":return t.stop()}}),t)})))),r=t.create,i=t.clear,n=je(function(){var t=_t(lt.mark((function t(r){return lt.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(e.loaded){t.next=2;break}return t.abrupt("return",!1);case 2:return e.config=ue({},e.config,r),t.abrupt("return",cr(ue({},e.basePlayer.commonId,e.insertConfig.playInfo)).then((function(e){return 1===e.result})));case 4:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}()),a=n.create,o=n.clear;return{play:r,updateSource:a,clear:function(){i(),o()}}},r.checkConfig=function(){return!(!this.insertConfig.playInfo.src||!this.insertConfig.playInfo.src.liveStreamId)},r.checkConfigAndThrowError=function(){var e=this.checkConfig();return e||this.trigger("error",{type:"params",originalError:{message:"can not init player by the params"}}),e},Pt(t,[{key:"loaded",get:function(){return this.basePlayer.loaded}},{key:"commonId",get:function(){return this.basePlayer.commonId}},{key:"insertConfig",get:function(){var e=this.config,t=e.autoplay,r=e.src,i=e.objectFit,n=e.triggerTimeUpdate,a=e.muted,o=e.forceUseMinResolution,s=void 0!==o&&o,u=e.activityTag,d=e.logParams,c=void 0===d?{}:d,l=e.disableNativeControl,f=void 0!==l&&l,_=e.request,h=e.enableMixAudio,p=void 0!==h&&h,v=e.disableNativeControlMixAudio,m=void 0!==v&&v;return ue({},this.basePlayer.commonId,{type:Nt.LIVE,playInfo:{autoplay:t,src:r,objectFit:i,triggerTimeUpdate:n,muted:a,forceUseMinResolution:s,disableNativeControl:f,enableMixAudio:p,disableNativeControlMixAudio:m},request:_,logInfo:{activityTag:u,logParams:c}})}}]),t}(St);function Ur(e){var t=e.el,r=e.event$,i=e.config,n=e.uid,a=e.useH5FallbackPlayer,o=e.onInit,s=e.logger,u=function(e){var t=ue({},e);return t.src||(t.src={}),t.objectFit||(t.objectFit="cover"),t}(i),d=null;if(Ie&&(Ae&&(d=Mr),Re&&(d=Tt)),a&&(d=It),d){var c=new d(t,r,n,u,s);return u.autoplay&&o.then((function(){c.load()})),c}return null}var Br=function(e){function t(){return e.apply(this,arguments)||this}return gt(t,e),t}(Et),Fr=function(e){function t(){for(var t,r=arguments.length,i=new Array(r),n=0;n<r;n++)i[n]=arguments[n];return(t=e.call.apply(e,[this].concat(i))||this).name="android-video-player",t.disposeEvent=null,t.videoEl=null,t.loadStart$=Ke(),t.sourceError$=Ke(),t.noMoreSource$=Ke(),t.played=!1,t.currentCancelToken=new Ge,t.taskQueue=new He,t.loaded=!1,t.loadApi=je((function(e,r){return t.taskQueue.addTask(_t(lt.mark((function i(){var n,a,o,s,u;return lt.wrap((function(i){for(;;)switch(i.prev=i.next){case 0:if(!e.isCanceled){i.next=2;break}return i.abrupt("return",null);case 2:if(!t.loaded){i.next=4;break}return i.abrupt("return",t.getInstance());case 4:return r=r||{},n=ue({},t.config,r),t.trigger("before-load",!!n.autoplay),(a=t.el.querySelector("video"))&&t.videoEl!==a&&(a.remove(),t.videoEl=null),o=!t.videoEl,s=o?document.createElement("video"):t.videoEl,t.videoEl=s,t.loadStart$.next(),o?t.listenElEvent(s):t.logger.error("not create"),i.next=16,t.initElWithConfig(s,n);case 16:if(u=i.sent,!e.isCanceled){i.next=19;break}return i.abrupt("return",null);case 19:if(u){i.next=24;break}return t.trigger("error",{type:"noMoreSource",originalError:{message:"can not play by the src"}}),t.disposeEvent&&(t.disposeEvent(),t.disposeEvent=null),t.dispose(!0),i.abrupt("return",null);case 24:return o?t.el.appendChild(s):s.load(),t.loaded=!0,t.trigger("after-load",null),t.trigger("loadedmetadata",{duration:s.duration}),t.played=!0,i.abrupt("return",t.getInstance());case 30:case"end":return i.stop()}}),i)}))))})),t}gt(t,e);var r=t.prototype;return r.load=function(){var e=_t(lt.mark((function e(t){return lt.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",this.loadApi.create(this.currentCancelToken,t));case 1:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}(),r.dispose=function(){var e=_t(lt.mark((function e(t){var r=this;return lt.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return void 0===t&&(t=!1),t||this.trigger("before-dispose",null),this.currentCancelToken.cancel(),this.currentCancelToken=new Ge,this.loadApi.clear(),e.abrupt("return",this.taskQueue.addTask(_t(lt.mark((function e(){return lt.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r.loaded=!1,r.played=!1,r.disposeEvent&&r.disposeEvent(),r.videoEl&&(r.releasePlayer(r.videoEl),r.videoEl.remove(),r.videoEl=null),t||r.trigger("after-dispose",null),e.abrupt("return","");case 6:case"end":return e.stop()}}),e)})))));case 7:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}(),r.getInstance=function(){var e,t,r,i,n,a,o,s,u=this;return{pause:(s=_t(lt.mark((function e(){return lt.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(u.videoEl){e.next=2;break}return e.abrupt("return");case 2:return e.abrupt("return",u.videoEl.pause());case 3:case"end":return e.stop()}}),e)}))),function(){return s.apply(this,arguments)}),play:(o=_t(lt.mark((function e(){return lt.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(u.videoEl){e.next=3;break}return e.next=3,u.load();case 3:if(u.videoEl){e.next=5;break}return e.abrupt("return");case 5:return e.abrupt("return",u.videoEl.play());case 6:case"end":return e.stop()}}),e)}))),function(){return o.apply(this,arguments)}),seek:(a=_t(lt.mark((function e(t){return lt.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(u.videoEl){e.next=2;break}return e.abrupt("return");case 2:u.videoEl.currentTime=t;case 3:case"end":return e.stop()}}),e)}))),function(e){return a.apply(this,arguments)}),fullScreen:(n=_t(lt.mark((function e(){return lt.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(u.videoEl){e.next=2;break}return e.abrupt("return");case 2:if(u.videoEl.requestFullscreen){e.next=4;break}return e.abrupt("return",u.logger.warn("requestFullscreen is not a function"));case 4:return e.abrupt("return",u.videoEl.requestFullscreen());case 5:case"end":return e.stop()}}),e)}))),function(){return n.apply(this,arguments)}),exitFullScreen:(i=_t(lt.mark((function e(){return lt.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(u.videoEl){e.next=2;break}return e.abrupt("return");case 2:if(document.exitFullscreen){e.next=4;break}return e.abrupt("return",u.logger.warn("exitFullscreen is not a function"));case 4:return e.abrupt("return",document.exitFullscreen());case 5:case"end":return e.stop()}}),e)}))),function(){return i.apply(this,arguments)}),setSpeed:(r=_t(lt.mark((function e(t){return lt.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(u.videoEl){e.next=2;break}return e.abrupt("return");case 2:return e.abrupt("return",u.videoEl.playbackRate=t);case 3:case"end":return e.stop()}}),e)}))),function(e){return r.apply(this,arguments)}),setMuted:(t=_t(lt.mark((function e(t){return lt.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(u.videoEl){e.next=2;break}return e.abrupt("return");case 2:return e.abrupt("return",u.videoEl.muted=t);case 3:case"end":return e.stop()}}),e)}))),function(e){return t.apply(this,arguments)}),abLoop:(e=_t(lt.mark((function e(t,r,i){return lt.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(u.videoEl){e.next=2;break}return e.abrupt("return");case 2:u.videoEl.abplay&&u.videoEl.abplay(t,r,i);case 3:case"end":return e.stop()}}),e)}))),function(t,r,i){return e.apply(this,arguments)})}},r.initElWithConfig=function(){var e=_t(lt.mark((function e(t,r){var i,n,a,o,s,u,d,c,l,f,_,h,p,v,m,g;return lt.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(i=r.src,n=void 0===i?[]:i,a=r.autoplay,o=r.muted,s=r.loop,u=r.objectFit,d=r.speed,c=r.isTransparent,l=r.range,f=r.enableAccurateSeek,_=r.videoType,h=r.startTime,p=r.activityTag,v=r.enableHardwarePolicy,m=r.photoId,g=void 0===m?"":m,0!==n.length){e.next=3;break}return e.abrupt("return",!1);case 3:return t.removeAttribute("width"),t.removeAttribute("height"),t.style.width="100%",t.style.height="100%",t.disableRemotePlayback=!0,t.setAttribute("poster","data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAQAAAC1HAwCAAAAC0lEQVR42mNkYAAAAAYAAjCB0C8AAAAASUVORK5CYII="),t.setAttribute("useksplayer",c?"transparent-video":"video"),o&&(t.setAttribute("muted",""),t.muted=!0),a&&t.setAttribute("autoplay",""),s&&t.setAttribute("loop",""),f&&t.setAttribute("accurateseek",""),_&&t.setAttribute("videotype",_),h&&t.setAttribute("starttime",""+h),l&&(t.setAttribute("starttime",String(l.from)),t.setAttribute("endtime",String(l.to)),t.setAttribute("loopcount",String(l.count))),t.setAttribute("playsinline",""),t.setAttribute("webkit-playsinline",""),u&&(t.style.objectFit=u),t.setAttribute("videoextras",JSON.stringify({enableHardwarePolicy:v,pageUrl:window.location.href,activityTag:p,photoId:g})),e.next=23,this.switchVideoCdn(t,n);case 23:if(e.sent){e.next=26;break}return e.abrupt("return",!1);case 26:return d&&(t.playbackRate=d),h&&(t.currentTime=h),e.abrupt("return",!0);case 29:case"end":return e.stop()}}),e,this)})));return function(t,r){return e.apply(this,arguments)}}(),r.listenElEvent=function(e){var t=this,r=[Je(e,"firstframe")((function(){return t.triggerTrackInfo("firstframe",null)})),Je(e,"play")((function(){return t.trigger("play",null)})),Je(e,"pause")((function(){return t.trigger("pause",null)})),yt(e)((function(){return t.trigger("playing",null)})),Je(e,"ended")((function(){return t.trigger("ended",null)})),Je(e,"waiting")((function(){return t.trigger("waiting",null)})),Je(e,"abended")((function(){return t.trigger("abloopended",null)})),Je(e,"seeking")((function(){return t.trigger("seeking",null)})),Je(e,"seeked")((function(){return t.trigger("seeked",{to:e.currentTime})})),Je(e,"fullscreenchange")((function(){return t.trigger("fullscreenchange",{isFull:!!document.fullscreenElement})})),Je(e,"timeupdate")((function(){return t.trigger("timeupdate",{to:e.currentTime})})),$e(Je(e,"error"))(ze((function(){return!!e.error&&t.played})),qe((function(){return e.error})))((function(e){t.disposeEvent&&(t.logger.warn("dispose inner listener"),t.disposeEvent(),t.disposeEvent=null),t.trigger("error",{type:e.MEDIA_ERR_NETWORK===e.code?"noMoreSource":"internal",originalError:{message:(null==e?void 0:e.message)||"",code:null==e?void 0:e.code}})}))];this.disposeEvent=function(){r.forEach((function(e){return e()})),r=[]}},r.switchVideoCdn=function(e,t){var r=this;return new Promise((function(i){var n=0,a=function(){e.error&&(r.triggerTrackInfo("cdnswitched",{url:e.src}),n+1<t.length?(n++,u()):(s(),r.noMoreSource$.next(),i(!1)))},o=function(){e.duration&&(i(!0),s())},s=function(){e.removeEventListener("error",a),e.removeEventListener("durationchange",o)},u=function(){e.src=t[n].url};e.addEventListener("error",a),e.addEventListener("durationchange",o),u()}))},r.releasePlayer=function(e){e.src="",e.releaseplayer&&(this.logger.warn("call releaseplayer",this.id),this.videoEl.releaseplayer())},t}(Br),Vr=function(e){function t(){for(var t,r=arguments.length,i=new Array(r),n=0;n<r;n++)i[n]=arguments[n];return(t=e.call.apply(e,[this].concat(i))||this).name="ios-video-player",t.basePlayer=Nr({logger:t.logger,id:t.id,el:t.el,isVideo:!0,registerListener:function(e){var r=[],i=e((function(e){var r=e.type,i=e.data;switch(r){case"pause":case"playing":case"waiting":t.trigger(r,null);break;case"ended":t.insertConfig.playInfo.loop||t.trigger(r,null);break;case"abLoopEnded":t.trigger("abloopended",null);break;case"seek":t.trigger("seeked",{to:i.to});break;case"loadedmetadata":t.trigger(r,{duration:i.duration});break;case"fullScreenChange":t.trigger("fullscreenchange",{isFull:i.isFull});break;case"timeUpdate":t.trigger("timeupdate",{to:i.to});break;case"error":t.trigger(r,{type:qt.includes(i.code)?"internal":"noMoreSource",originalError:i});break;case"firstFrame":t.triggerTrackInfo("firstframe",null);break;case"play":t.triggerTrackInfo("iosNativePlay",null);break;case"speedChange":t.trigger(r,i)}}));return r.push(i),r.push(t.basePlayer.lifecycleState.on(xt.WillLoad,(function(){t.trigger("before-load",!!t.insertConfig.playInfo.autoplay)})),t.basePlayer.lifecycleState.on(xt.Loaded,(function(){return t.trigger("after-load",null)})),t.basePlayer.lifecycleState.on(xt.WillIdle,(function(e){var r=e.data;return t.trigger("before-dispose",r)})),t.basePlayer.lifecycleState.on(xt.Idle,(function(){return t.trigger("after-dispose",null)}))),function(){r.forEach((function(e){return e()})),r=[]}},onClearState:function(){t.api.clear()},insertParams:function(){return t.insertConfig},onPageshowReload:function(){return t.trigger("pageshow-reload",null)},onError:function(e){"canNotInsert"!==e.type&&"domLost"!==e.type||t.trigger("error",e),"insertGroupFailed"===e.type&&t.triggerTrackInfo("insertgroupfailed",{tryTime:e.tryTime})},onPlay:function(){return t.trigger("play",null)},onSuccess:function(e){return t.triggerTrackInfo("insertsuccess",e)},onFixLost:function(e){var r=e.result,i=kt(e,["result"]);return t.triggerTrackInfo(r?"fixSuccess":"fixFailed",i)}}),t.api=t.createApi(),t}gt(t,e);var r=t.prototype;return r.load=function(){var e=_t(lt.mark((function e(){return lt.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!this.checkConfigAndThrowError()){e.next=3;break}return e.next=3,this.basePlayer.load();case 3:return e.abrupt("return",this.getInstance());case 4:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}(),r.dispose=function(e){return this.basePlayer.dispose(e)},r.getInstance=function(){var e=this.basePlayer.api,t=this.api;t.clear;var r=kt(t,["clear"]);return ue({},e,r)},r.createApi=function(){var e=this,t=this.basePlayer.canExecNativeApi,r=je(_t(lt.mark((function t(){return lt.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(e.basePlayer.lifecycleState.state!==xt.WillLoad){t.next=3;break}return e.logger.log("[ios video] start return"),t.abrupt("return");case 3:if(e.loaded){t.next=7;break}if(e.checkConfigAndThrowError()){t.next=6;break}return t.abrupt("return");case 6:return t.abrupt("return",e.basePlayer.load(!0));case 7:return e.trigger("play",null),t.abrupt("return",_r(ue({},e.basePlayer.commonId)));case 9:case"end":return t.stop()}}),t)})))),i=r.create,n=r.clear,a=je(function(){var r=_t(lt.mark((function r(i){return lt.wrap((function(r){for(;;)switch(r.prev=r.next){case 0:if(t()){r.next=2;break}return r.abrupt("return");case 2:return e.trigger("seeking",null),r.abrupt("return",hr(ue({},e.basePlayer.commonId,{seekTime:i})));case 4:case"end":return r.stop()}}),r)})));return function(e){return r.apply(this,arguments)}}()),o=a.create,s=a.clear,u=je(function(){var r=_t(lt.mark((function r(i){return lt.wrap((function(r){for(;;)switch(r.prev=r.next){case 0:if(t()){r.next=2;break}return r.abrupt("return");case 2:return r.abrupt("return",mr(ue({},e.basePlayer.commonId,{speed:i})));case 3:case"end":return r.stop()}}),r)})));return function(e){return r.apply(this,arguments)}}()),d=u.create,c=u.clear,l=je(function(){var r=_t(lt.mark((function r(i,n,a){return lt.wrap((function(r){for(;;)switch(r.prev=r.next){case 0:if(t()){r.next=2;break}return r.abrupt("return");case 2:return r.abrupt("return",yr(ue({},e.basePlayer.commonId,{from:i,to:n,count:a})));case 3:case"end":return r.stop()}}),r)})));return function(e,t,i){return r.apply(this,arguments)}}()),f=l.create,_=l.clear,h=je(_t(lt.mark((function r(){return lt.wrap((function(r){for(;;)switch(r.prev=r.next){case 0:if(t()){r.next=2;break}return r.abrupt("return");case 2:return r.abrupt("return",br(ue({},e.basePlayer.commonId)));case 3:case"end":return r.stop()}}),r)})))),p=h.create,v=h.clear,m=je(function(){var r=_t(lt.mark((function r(i){return lt.wrap((function(r){for(;;)switch(r.prev=r.next){case 0:if(void 0===i&&(i="left"),t()){r.next=3;break}return r.abrupt("return");case 3:return r.abrupt("return",pr(ue({},e.basePlayer.commonId,{direction:i})));case 4:case"end":return r.stop()}}),r)})));return function(e){return r.apply(this,arguments)}}()),g=m.create,y=m.clear,E=je(_t(lt.mark((function r(){return lt.wrap((function(r){for(;;)switch(r.prev=r.next){case 0:if(t()){r.next=2;break}return r.abrupt("return");case 2:return r.abrupt("return",Ar(ue({},e.basePlayer.commonId)));case 3:case"end":return r.stop()}}),r)})))),S=E.create,T=E.clear;return{play:i,seek:o,setSpeed:d,abLoop:f,step:p,fullScreen:g,exitFullScreen:S,clear:function(){n(),s(),c(),_(),v(),y(),T()}}},r.checkConfig=function(){return 0!==this.insertConfig.playInfo.src.length},r.checkConfigAndThrowError=function(){var e=this.checkConfig();return e||this.trigger("error",{type:"params",originalError:{message:"can not init player by the params"}}),e},Pt(t,[{key:"loaded",get:function(){return this.basePlayer.loaded}},{key:"commonId",get:function(){return this.basePlayer.commonId}},{key:"insertConfig",get:function(){var e=this.config,t=e.autoplay,r=e.loop,i=e.muted,n=e.src,a=e.objectFit,o=e.isTransparent,s=e.triggerTimeUpdate,u=e.speed,d=e.range,c=e.startTime,l=e.videoType,f=e.enableAccurateSeek,_=e.activityTag,h=e.photoId,p=void 0===h?"":h,v=e.logParams,m=void 0===v?{}:v,g=e.request,y=e.disableNativeControl,E=void 0!==y&&y,S=e.previewFirstFrame,T=e.enableMixAudio,b=void 0!==T&&T,L=e.disableNativeControlMixAudio,A=void 0!==L&&L,R=e.controlConfig,I=void 0===R?{title:"",enableAdjustBrightnessAndVolume:!0,enablePlaybackRate:!0,enableSeekView:!0,enablePanSeek:!0}:R,k=I.title,C=void 0===k?"":k,x=I.enableAdjustBrightnessAndVolume,D=void 0===x||x,w=I.enablePlaybackRate,O=void 0===w||w,P=I.enableSeekView,N=void 0===P||P,M=I.enablePanSeek,U=void 0===M||M,B=ue({},this.basePlayer.commonId,{type:Nt.VIDEO,playInfo:{autoplay:t,loop:r,muted:i,src:n,objectFit:a,isTransparent:o,triggerTimeUpdate:s,speed:u,videoType:l,enableAccurateSeek:f,activityTag:_,disableNativeControl:E,previewFirstFrame:!t&&S,enableMixAudio:b,disableNativeControlMixAudio:A,controlConfig:{title:C,enableAdjustBrightnessAndVolume:D,enablePlaybackRate:O,enableSeekView:N,enablePanSeek:U}},logInfo:{activityTag:_,photoId:p,logParams:m},request:g});return d&&(B.playInfo.range=d),c&&(B.playInfo.startTime=c),B}}]),t}(Br),Hr=function(e){function t(){for(var t,r=arguments.length,i=new Array(r),n=0;n<r;n++)i[n]=arguments[n];return(t=e.call.apply(e,[this].concat(i))||this).name="h5-video-player",t.disposeEvent=null,t.videoEl=null,t.loaded=!1,t}gt(t,e);var r=t.prototype;return r.load=function(){var e=_t(lt.mark((function e(t){var r,i,n;return lt.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=t||{},r=ue({},this.config,t),this.trigger("before-load",!!r.autoplay),i=!this.videoEl,n=i?document.createElement("video"):this.videoEl,this.videoEl=n,this.initElWithConfig(n,r),i?(this.listenElEvent(n),this.el.appendChild(n)):n.load(),this.loaded=!0,this.trigger("after-load",null),ge&&me&&r.autoplay&&(this.logger.warn("manual play by x5"),n.play()),e.abrupt("return",this.getInstance());case 12:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}(),r.dispose=function(){var e=_t(lt.mark((function e(){return lt.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this.trigger("before-dispose",null),this.loaded=!1,this.disposeEvent&&this.disposeEvent(),this.videoEl&&(this.videoEl.src="",this.videoEl.remove(),this.videoEl=null),this.trigger("after-dispose",null),e.abrupt("return","");case 6:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}(),r.getInstance=function(){var e,t,r,i,n,a,o,s,u,d=this;return{pause:(u=_t(lt.mark((function e(){return lt.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(d.videoEl){e.next=2;break}return e.abrupt("return");case 2:return e.abrupt("return",d.videoEl.pause());case 3:case"end":return e.stop()}}),e)}))),function(){return u.apply(this,arguments)}),play:(s=_t(lt.mark((function e(){return lt.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(d.videoEl){e.next=3;break}return e.next=3,d.load();case 3:return e.abrupt("return",d.videoEl.play());case 4:case"end":return e.stop()}}),e)}))),function(){return s.apply(this,arguments)}),seek:(o=_t(lt.mark((function e(t){return lt.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(d.videoEl){e.next=2;break}return e.abrupt("return");case 2:d.videoEl.currentTime=t,ve||d.videoEl.paused||d.videoEl.play();case 4:case"end":return e.stop()}}),e)}))),function(e){return o.apply(this,arguments)}),fullScreen:(a=_t(lt.mark((function e(){return lt.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(d.videoEl){e.next=2;break}return e.abrupt("return");case 2:if(d.videoEl.requestFullscreen){e.next=4;break}return e.abrupt("return",d.logger.warn("requestFullscreen is not a function"));case 4:return e.abrupt("return",d.videoEl.requestFullscreen());case 5:case"end":return e.stop()}}),e)}))),function(){return a.apply(this,arguments)}),exitFullScreen:(n=_t(lt.mark((function e(){return lt.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(d.videoEl){e.next=2;break}return e.abrupt("return");case 2:if(document.exitFullscreen){e.next=4;break}return e.abrupt("return",d.logger.warn("exitFullscreen is not a function"));case 4:return e.abrupt("return",document.exitFullscreen());case 5:case"end":return e.stop()}}),e)}))),function(){return n.apply(this,arguments)}),setSpeed:(i=_t(lt.mark((function e(t){return lt.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(d.videoEl){e.next=2;break}return e.abrupt("return");case 2:return e.abrupt("return",d.videoEl.playbackRate=t);case 3:case"end":return e.stop()}}),e)}))),function(e){return i.apply(this,arguments)}),setMuted:(r=_t(lt.mark((function e(t){return lt.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(d.videoEl){e.next=2;break}return e.abrupt("return");case 2:d.videoEl.muted=t,t?d.videoEl.setAttribute("muted",""):d.videoEl.removeAttribute("muted");case 4:case"end":return e.stop()}}),e)}))),function(e){return r.apply(this,arguments)}),abLoop:(t=_t(lt.mark((function e(t,r,i){return lt.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(d.videoEl){e.next=2;break}return e.abrupt("return");case 2:d.videoEl.abplay&&d.videoEl.abplay(t,r,i);case 3:case"end":return e.stop()}}),e)}))),function(e,r,i){return t.apply(this,arguments)}),updateSource:(e=_t(lt.mark((function e(t){var r;return lt.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(d.videoEl){e.next=2;break}return e.abrupt("return",!1);case 2:return d.config=ue({},d.config,t),r=d.videoEl.querySelectorAll("source"),d.config.src.forEach((function(e,t){var i=e.url;r[t]&&(r[t].src=i)})),e.abrupt("return",!0);case 6:case"end":return e.stop()}}),e)}))),function(t){return e.apply(this,arguments)})}},r.initElWithConfig=function(e,t){var r=t.src,i=void 0===r?[]:r,n=t.autoplay,a=t.muted,o=t.loop,s=t.objectFit,u=t.speed,d=t.range;return e.removeAttribute("width"),e.removeAttribute("height"),e.style.width="100%",e.style.height="100%",e.style.transform="translateZ(0)",e.disableRemotePlayback=!0,e.setAttribute("poster","data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAQAAAC1HAwCAAAAC0lEQVR42mNkYAAAAAYAAjCB0C8AAAAASUVORK5CYII="),i.forEach((function(t){var r=t.url,i=document.createElement("source");i.src=r,e.appendChild(i)})),u&&(e.playbackRate=u),n&&(e.autoplay=!0,e.setAttribute("autoplay","")),a&&(e.muted=!0,e.setAttribute("muted","")),o&&e.setAttribute("loop",""),d&&(e.setAttribute("abplaystart",String(d.from)),e.setAttribute("abplayend",String(d.to)),e.setAttribute("abplayloop",String(d.count))),e.setAttribute("playsinline",""),e.setAttribute("webkit-playsinline",""),s&&(e.style.objectFit=s),ge&&me&&e.setAttribute("x5-video-player-type","h5-page"),e},r.listenElEvent=function(e){var t=this,r=Je(e,"play"),i=Je(e,"pause"),n=Je(e,"playing"),a=Je(e,"ended"),o=Je(e,"waiting"),s=Je(e,"seeking"),u=Je(e,"seeked"),d=Je(e,"timeupdate"),c=Je(e,"durationchange"),l=Ze(d,Rt(r,i,e)),f=Ze($e(Je(e,"error"))(ze((function(){return!!e.error})),qe((function(){return e.error}))),$e(Je(e.lastElementChild,"error"))(qe((function(){return{code:0,MEDIA_ERR_NETWORK:0,message:"noMoreSource"}})))),_=$e(Ze(o,$e(Ze(r,l))(qe((function(){return $e(Ye(1e3))(ot({clearOnEmit:!0},l),ze((function(e){return e[0],void 0===e[1]})),it(Ze(r,i,o,l,a)),Xe(1))})),(function(e){return function(t){var r=!1,i=[],n=e((function(e){if(!r&&e){var n=e((function(e){r||t(e)}));i.push(n)}}));return i.push(n),function(){r||(i.forEach((function(e){return e()})),i=[],r=!0)}}}))))(ze((function(){return!e.paused})),at()),h=$e(Lt(Ze(r,_),Ze(l,n),Ze(a,i)))(ze((function(){return!e.paused})),at()),p=[r((function(){return t.trigger("play",null)})),At(e)((function(){t.triggerTrackInfo("firstframe",null)})),i((function(){return t.trigger("pause",null)})),h((function(){return t.trigger("playing",null)})),a((function(){return t.trigger("ended",null)})),_((function(){return t.trigger("waiting",null)})),s((function(){return t.trigger("seeking",null)})),u((function(){return t.trigger("seeked",{to:e.currentTime})})),c((function(){t.trigger("loadedmetadata",{duration:e.duration})})),l((function(){return t.trigger("timeupdate",{to:e.currentTime})})),f((function(e){t.disposeEvent&&(t.disposeEvent(),t.disposeEvent=null),t.trigger("error",{type:e.code===e.MEDIA_ERR_NETWORK?"noMoreSource":"internal",originalError:{message:(null==e?void 0:e.message)||"",code:null==e?void 0:e.code}})}))];this.disposeEvent=function(){p.forEach((function(e){return e()})),p=[]}},t}(Br);function jr(e){var t=e.el,r=e.event$,i=e.config,n=e.uid,a=e.useH5FallbackPlayer,o=e.onInit,s=e.logger,u=function(e){var t=ue({},e);return t.src||(t.src=[]),t.objectFit||(t.objectFit="cover"),t}(i),d=null;if(Ie&&(Ae&&(d=Vr),Re&&(d=Fr)),a&&(d=Hr),d){var c=new d(t,r,n,u,s);return(u.autoplay||u.previewFirstFrame)&&o.then((function(){c.load()})),c}return null}function Gr(e){switch(e.type){case Nt.VIDEO:return jr(e);case Nt.LIVE:return Ur(e);default:return e.logger.error("media type: "+e.type+" not exist"),null}}var Kr={},Wr=function(e){return function(e){return Object.prototype.hasOwnProperty.call(Kr,e)}(e)?Kr[e]:null};function qr(e,t){var r=t.context,i=t.event$,n=t.player,a=t.pluginWrapper,o=t.getState,s=[];return e.forEach((function(e){var t=e.name,u=e.args,d=Wr(t);if(d){var c=new d(r,i,n,a,o,u||{});c.isValid()&&(c.init(),s.push(c))}else r.logger.warn("can not find plugin by name: "+t)})),s}function zr(e){e.forEach((function(e){e.dispose()}))}var Yr=function(){function e(e,t,r,i,n,a){this.context=e,this.event$=t,this.player=r,this.root=i,this.getState=n,this.pluginConfig=a}var t=e.prototype;return t.trigger=function(e,t){this.event$.next({namespace:vt.Plugin,type:e,data:t})},t.triggerContext=function(e,t){this.event$.next({namespace:vt.Player,type:e,data:t})},t.isValid=function(){return!0},t.init=function(){},t.dispose=function(){},e}();function Xr(e){var t=e.getAttribute(zt);if(!t)return null;try{return JSON.parse(t)}catch(r){return null}}var Qr=function(){if(window&&document&&document===window.document){if("complete"!==document.readyState)return Jr(10);Array.from(document.querySelectorAll("."+Yt)).forEach((function(e){e.context||Xr(e)&&Ui({container:e})}))}},Jr=function(e){setTimeout(Qr,e)};function $r(e,t){var r;if("undefined"==typeof Symbol||null==e[Symbol.iterator]){if(Array.isArray(e)||(r=function(e,t){if(!e)return;if("string"==typeof e)return Zr(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);"Object"===r&&e.constructor&&(r=e.constructor.name);if("Map"===r||"Set"===r)return Array.from(e);if("Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return Zr(e,t)}(e))||t&&e&&"number"==typeof e.length){r&&(e=r);var i=0;return function(){return i>=e.length?{done:!0}:{done:!1,value:e[i++]}}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}return(r=e[Symbol.iterator]()).next.bind(r)}function Zr(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,i=new Array(t);r<t;r++)i[r]=e[r];return i}function ei(e,t){var r="yoda_video_player_callback_"+t+"_"+function(e){void 0===e&&(e=!0);var t=(new Date).getTime();return"undefined"!=typeof performance&&"function"==typeof performance.now&&(t+=performance.now()),(e?"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx":"xxxxxxxx_xxxx_4xxx_yxxx_xxxxxxxxxxxx").replace(/[xy]/g,(function(e){var r=(t+16*Math.random())%16|0;return t=Math.floor(t/16),("x"===e?r:3&r|8).toString(16)}))}(!1);return window[r]=function(){e()},r}var ti,ri,ii=function(e,t){_e.Kwai.on({type:e,handler:ei(t,"Kwai_on"),callback:ei((function(){}),"Kwai_on")})};(ri=ti||(ti={})).background="native_background",ri.foreground="native_foreground",ri.leave="native_leave",ri.willLeave="native_will_leave",ri.reentry="native_reentry";var ni=dt();function ai(){return"visible"===document.visibilityState}var oi=Ke(),si=Ke(),ui=$e(function(){var e=Ke();function t(t){t((function(t){return e.next(t)}))}function r(){t(si.stream)}ve?_e.ready((function(){_e.Kwai&&_e.Kwai.on?ge?(ni.warn("[visibility] IS_ANDROID"),t($e(oi.stream)(qe((function(e){return[ti.foreground,ti.reentry].includes(e)}))))):ye?we&&Me(Oe,"8.3.40")<0||Pe&&Me(Ne,"3.3.40")<0?(ni.warn("[visibility] IS_IOS use visibility + leave + reentry + foreground + background"),t($e(Ze($e(oi.stream)(qe((function(e){return[ti.foreground,ti.reentry].includes(e)?1:-1}))),$e(si.stream)(qe((function(e){return e?1:-1})))))(rt((function(e,t){return e+t}),0),qe((function(e){return e>=0}))))):(ni.warn("[visibility] IS_IOS use leave and reentry"),t($e(oi.stream)(ze((function(e){return[ti.reentry,ti.willLeave,ti.leave].includes(e)})),qe((function(e){return e===ti.reentry}))))):(ni.warn("[visibility] not IS_ANDROID or IS_IOS"),r()):(ni.warn("[visibility] Yoda.Kwai.on not exist"),r())})):(ni.warn("[visibility] not in yoda"),r());var i=!1;return $e(e.stream)(Xe(1))((function(){i=!0})),new Promise((function(e){var t=ye||ge&&(Me(Oe,"9.0.30")>=0||Me(Ne,"9.0.30"))>=0;_e.isInYoda&&t?_e.ready((function(){_e.webview&&_e.webview.getWebviewStatus?_e.webview.getWebviewStatus({},(function(t){var r=t.result,i=t.isOnTop,n=t.appStatus;ni.warn("getWebviewStatus result: "+r+", isOnTop: "+i+", appStatus: "+n),e(1===r?"background"===n||!i:!ai())})):e(!ai())})):(ni.warn("[background] can not use getWebviewStatus\n                isInYoda: "+_e.isInYoda+"\n                appVersion: "+Oe+"\n            "),e(!ai()))})).then((function(t){i||e.next(!t)})),e.stream}())(bt(null),(function(e){return function(t){var r=null,i=!1,n=!1,a=e((function(e){var n=r;r=e,i?t([n,e]):i=!0}));return function(){n||(n=!0,r=null,i=!1,a())}}}),ze((function(e){return e[0]!==e[1]})),qe((function(e){return e[0],e[1]})),at(1));ui((function(e){ni.warn("[visibility] used visible change: "+e)})),_e.isInYoda&&_e.ready((function(){_e.Kwai&&_e.Kwai.on&&(ii(ti.leave,(function(){oi.next(ti.leave)})),ii(ti.reentry,(function(){oi.next(ti.reentry)})),ii(ti.background,(function(){oi.next(ti.background)})),ii(ti.foreground,(function(){oi.next(ti.foreground)})),ii(ti.willLeave,(function(){oi.next(ti.willLeave)})))})),document.addEventListener("visibilitychange",(function(){si.next(ai())}));var di=Ke(),ci={},li=function(){return _e.tool&&_e.tool.sendRadarLog};di.stream((function(e){var t=e.value,r=e.needStashed,i=e.contextId,n=e.projectTag,a=e.logger,o=kt(e,["value","needStashed","contextId","projectTag","logger"]);ci[i]||(ci[i]={}),r&&void 0===ci[i][o.name]&&(ci[i][o.name]="");var s={enablePeerRender:!!Ie};ge&&(s.enableAndroidPlayer=!!Re),ye&&(s.enableIosPlayer=!!Ae),s.contextVersion="0.5.4",s.projectTag=n,o.extra_info=ue({},o.extra_info,s);var u={key:"event",value:ue({},t,{front_timestamp:Date.now()}),dimension:ue({},o,{extra_info:JSON.stringify(o.extra_info),webview_type:xe(),yoda_version:De,pageId:Ve})};if(a.log("[tracker] ",JSON.stringify(u)),li()){var d="";r&&ci[i]&&ci[i][o.name]&&(d=ci[i][o.name],ci[i][o.name]=""),r&&d&&a.log("[tracker] removeLogId: "+d+", contextId: "+i+" name: "+o.name),_e.tool.sendRadarLog({removeStashedLog:d?[d]:[],sendImmediate:!r,customData:{project_id:"a677c86858",data:[u],url_package:{page_type:2,page:window.location.href,params:"",identity:Ue}}},(function(e){var t=e.result,n=e.logId;r&&1===t&&n&&(a.log("[tracker] getLogId: "+n+" contextId: "+i+" name: "+o.name),ci[i][o.name]=n)}))}}));var fi,_i,hi=function(e,t,r,i,n){return function(a){if(!li())return i.error("can not send log by bridge or webLogger");di.next(ue({},a,{logger:i,category:r,extra_info:ue({},n(),a.extra_info?a.extra_info:{}),contextId:e,projectTag:t}))}},pi=function(e){return function(t){return Qe((function(r){return e.listen(t,r)}))}},vi=function(e){return function(t){return Qe((function(r){return e.listen(vt.Track,t,r)}))}},mi=qe((function(){return Date.now()})),gi=function(e,t){return $e(t)(mi,ot({},$e(e)(mi)),qe((function(e){return e[0]-e[1]})),Xe(1))},yi=function(e,t){var r,i=Ze((r=[!1],function(e){return r.forEach((function(t){return e(t)})),function(){}}),$e(e)(qe((function(){return!0}))));return $e(We(i,t))(Xe(1),ze((function(e){return!e[0]})))},Ei=function(e){return $e(e)(Xe(1))},Si=function(e){return $e(e)((t=100,function(e){return function(r){var i=null,n=!0,a=e((function(e){n&&(n=!1,i=setTimeout((function(){n=!0,i=null}),t),r(e))}));return function(){a(),null!==i&&clearTimeout(i)}}}));var t},Ti=function(e,t){return $e(Ze($e(e)(qe((function(){return{type:"play",time:Date.now()}}))),$e(t)(qe((function(){return{type:"playing",time:Date.now()}})))))(rt((function(e,t){return"play"===e.type&&"play"===t.type?e:"play"===e.type&&"playing"===t.type?ue({},t,{time:t.time-e.time,shouldPop:!0}):"playing"!==e.type&&null!==e.type||"play"!==t.type?ue({},e,{shouldPop:!1}):t}),{type:null,time:0}),ze((function(e){return!!e.shouldPop})))};(_i=fi||(fi={}))[_i.start=0]="start",_i[_i.pause=1]="pause",_i[_i.emit=2]="emit";var bi,Li,Ai,Ri,Ii=function(e,t,r){var i=_e.isInYoda;i&&(r=Ze(r,$e(oi.stream)(ze((function(e){return e===ti.leave})))));var n,a=$e(Ze($e(e)(qe((function(){return fi.start}))),$e(t)(qe((function(){return fi.pause}))),$e(r)(qe((function(){return fi.emit})))))(rt((function(e,t){return e.paused||t!==fi.pause&&t!==fi.emit?e.paused&&t===fi.start?{paused:!1,startPlayTime:Date.now(),duration:e.duration}:e:{paused:!0,startPlayTime:0,duration:e.duration+Date.now()-e.startPlayTime}}),{startPlayTime:0,paused:!0,duration:0}));return i?a:$e(a)((n=1,function(e){return function(t){var r=!1,i=[],a=e((function(e){i.push(e),i.length>n&&i.shift()}));return function(){if(!r){r=!0,a();for(var e,n=$r(i);!(e=n()).done;){var o=e.value;t(o)}i=[]}}}}),it(r))},ki=function(){var e=!!(performance&&performance.timing&&performance.timing.toJSON),t=performance&&performance.getEntriesByType&&performance.getEntriesByType("navigation").length>0?performance.getEntriesByType("navigation")[0].toJSON():e?performance.timing.toJSON():{};return{readyState:document.readyState,timing:t}};function Ci(e,t,r){var i=pi(e),n=vi(e);e.config&&e.config.playerConfig&&e.config.playerConfig.src&&e.config.playerConfig.src.liveStreamId;var a=hi(e.id,e.config.projectTag||"",bi.Live,r,(function(){return function(e,t){var r={};if(r.contextId=e.id,r.useH5FallbackPlayer=e.config.useH5FallbackPlayer||!1,r.type=e.config.type,"ios-live-player"===t.name){var i=t.commonId,n=i.domId,a=i.nodeId;r.domId=n,r.nodeId=a}var o=t.config,s=o.src,u=kt(o,["src"]),d="";return s&&(d=s.liveStreamId),r.playerConfig=ue({},u,{liveStreamId:d}),r}(e,t)})),o=i("before-load"),s=i("play"),u=i("error"),d=i("waiting"),c=i("playing"),l=i("pause"),f=Ze(i("destroy"),Je(window,"onpagehide"in window?"pagehide":"beforeunload")),_=n("firstframe"),h=n("iosNativePlay"),p=n("insertgroupfailed"),v=n("insertsuccess"),m=n("fixSuccess"),g=n("fixFailed"),y=Ze(u,f,l),E=Ze(c,u),S=Ze(o,s,h),T=[m((function(e){var t=e.data;a({name:Ai.IosRefindSuccess,value:t})})),g((function(e){var t=e.data;a({name:Ai.IosRefindFailed,value:t})})),gi(S,_)((function(e){a({name:Ai.StartCost,value:{duration:e}})})),$e(u)(ze((function(e){return"domLost"!==e.data.type&&"canNotInsert"!==e.data.type})))((function(e){a({name:Ai.Error,result_type:""+(e.data.type||0),extra_info:ue({},e.data)})})),yi(Ze(s,u),Ze(Je(window,"beforeunload"),f))((function(){a({name:Ai.PlayCancel})})),Ei(_)((function(){a({name:Ai.PlaySuccess})})),Si(d)((function(){a({name:Ai.Waiting})})),$e(u)(ze((function(e){return"domLost"===e.data.type})))((function(){a({name:Ai.IosDomLost})})),p((function(e){var t=e.data.tryTime;a({name:Ai.IosInsertGroupFailed,extra_info:{tryTime:t},value:{tryTime:t}})})),$e(u)(ze((function(e){return"canNotInsert"===e.data.type})))((function(e){var t=e.data;a({name:Ai.IosInitFailed,extra_info:ue({},ki(),{tryTime:t.tryTime}),value:{tryTime:t.tryTime}})})),v((function(e){var t=e.data,r=t.tryTime,i=t.duration;a({name:Ai.IosInitSuccess,extra_info:{tryTime:r,duration:i},value:{tryTime:r,duration:i}})})),Ti(s,c)((function(e){var t=e.time;a({name:Ai.PlayDelay,extra_info:{duration:t},value:{duration:t}})})),$e(s)(Xe(1))((function(){a({name:Ai.FirstPlay})})),Ii(c,y,f)((function(e){var t=e.duration;a({name:Ai.PlayedDuration,value:{duration:t}})})),Ii(d,E,f)((function(e){var t=e.duration;a({name:Ai.WaitingDuration,value:{duration:t}})}))];return function(){T.forEach((function(e){return e()}))}}function xi(e,t,r){var i=pi(e),n=vi(e),a=hi(e.id,e.config.projectTag||"",bi.Video,r,(function(){return function(e,t){var r={};if(r.contextId=e.id,r.useH5FallbackPlayer=e.config.useH5FallbackPlayer||!1,r.type=e.config.type,r.playerConfig=t.config,"ios-video-player"===t.name){var i=t.commonId,n=i.domId,a=i.nodeId;r.domId=n,r.nodeId=a}return r}(e,t)})),o=i("before-load"),s=i("play"),u=i("error"),d=i("waiting"),c=i("playing"),l=i("pause"),f=i("ended"),_=Ze(i("destroy"),Je(window,"onpagehide"in window?"pagehide":"beforeunload")),h=n("firstframe"),p=n("iosNativePlay"),v=n("insertgroupfailed"),m=n("insertsuccess"),g=n("cdnswitched"),y=n("fixSuccess"),E=n("fixFailed"),S=Ze(u,_,l,f),T=Ze(c,u,f),b=Ze(o,s,p),L=[y((function(e){var t=e.data;a({name:Ai.IosRefindSuccess,value:t})})),E((function(e){var t=e.data;a({name:Ai.IosRefindFailed,value:t})})),gi(b,h)((function(e){a({name:Ai.StartCost,value:{duration:e}})})),$e(u)(ze((function(e){return"domLost"!==e.data.type&&"canNotInsert"!==e.data.type})))((function(e){a({name:Ai.Error,result_type:""+(e.data.type||0),extra_info:ue({},e.data)})})),yi(Ze(s,u),_)((function(){a({name:Ai.PlayCancel})})),Ei(h)((function(){a({name:Ai.PlaySuccess})})),Si(d)((function(){a({name:Ai.Waiting})})),$e(f)(Xe(1))((function(){a({name:Ai.Ended})})),$e(u)(ze((function(e){return"domLost"===e.data.type})))((function(){a({name:Ai.IosDomLost})})),g((function(e){var t=e.data.url;a({name:Ai.CDNSwitched,extra_info:{url:t}})})),v((function(e){var t=e.data.tryTime;a({name:Ai.IosInsertGroupFailed,extra_info:{tryTime:t},value:{tryTime:t}})})),$e(u)(ze((function(e){return"canNotInsert"===e.data.type})))((function(e){var t=e.data;a({name:Ai.IosInitFailed,extra_info:ue({},ki(),{tryTime:t.tryTime}),value:{tryTime:t.tryTime}})})),m((function(e){var t=e.data,r=t.tryTime,i=t.duration;a({name:Ai.IosInitSuccess,extra_info:{tryTime:r,duration:i},value:{tryTime:r,duration:i}})})),Ti(s,c)((function(e){var t=e.time;a({name:Ai.PlayDelay,value:{duration:t}})})),$e(s)(Xe(1))((function(){a({name:Ai.FirstPlay})})),Ii(c,S,_)((function(e){var t=e.duration;a({name:Ai.PlayedDuration,value:{duration:t}})})),Ii(d,T,_)((function(e){var t=e.duration;a({name:Ai.WaitingDuration,value:{duration:t}})}))];return function(){L.forEach((function(e){return e()}))}}(Li=bi||(bi={})).Video="yoda_player_web",Li.Live="yoda_live_web",(Ri=Ai||(Ai={})).StartCost="player_start_costTime",Ri.Error="player_play_error",Ri.PlayCancel="player_play_cancel",Ri.PlaySuccess="player_play_success",Ri.Waiting="player_play_stalled",Ri.Ended="player_play_ended",Ri.IosDomLost="player_dom_lost",Ri.CDNSwitched="player_play_cdn_switched",Ri.IosInsertGroupFailed="player_insert_group_failed",Ri.IosInitFailed="player_init_failed",Ri.IosInitSuccess="player_init_success",Ri.IosRefindSuccess="player_refind_success",Ri.IosRefindFailed="player_refind_failed",Ri.FirstPlay="player_first_play",Ri.PlayDelay="player_play_delay",Ri.PlayedDuration="player_played_duration",Ri.WaitingDuration="player_waiting_duration";var Di=function(e){var t=ht.idle,r=[e.listen("playing",(function(){t=ht.playing})),e.listen("pause",(function(){t=ht.paused})),e.listen("after-dispose",(function(){t=ht.released})),e.listen("ended",(function(){t=ht.ended})),e.listen("error",(function(){t=ht.error})),e.listen("destroy",(function(){t=ht.destroyed}))];return{dispose:function(){r.forEach((function(e){return e()}))},getState:function(){return t}}},wi=!1,Oi=function(){return wi},Pi=dt(),Ni=Ke(),Mi=$e(Ni.stream)(at());function Ui(e){var t,r=e.container,i=(t=e.logLevel||et.none,{error:ut("error")(t),warn:ut("warn")(t),log:ut("log")(t)}),n="string"==typeof r?document.querySelector(r):r;if(!n)return i.error("el should not be empty"),Promise.resolve(null);if(n.loading)return i.warn("context loading"),n.loading;if(n.context)return i.warn("context already created"),Promise.resolve(n.context);i.warn("context version: 0.5.4"),i.warn("create video context with config: ",e);var a=null,o=new Promise((function(e){return a=e}));return n.loading=o,function(){var t=_t(lt.mark((function t(){var r,a,s,u,d,c,l,f,_,h,p,v,m,g,y,E,S,T,b,L,A,R,I,k,C;return lt.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return T=function(e,t,r){var i,n,a;void 0===r?(n=vt.Player,i=e,a=t):(n=e,i=t,a=r);var o=$e(h.stream)(ze((function(e){var t=e.type,r=e.namespace;return(n===r||"all"===n)&&(i===t||"all"===i)})),qe((function(e){return ue({},e,{id:_})})))((function(e){return a(e)}));return p.push(o),function(){o(),p=p.filter((function(e){return e!==o}))}},e=ue({},Xr(n)||{},e),a=(r=e).type,s=void 0===a?Nt.VIDEO:a,u=r.playerConfig,d=r.plugins,c=void 0===d?[]:d,l=r.useH5FallbackPlayer,f=void 0!==l&&l,_=Be++,h=Ke(),p=[],n.classList.add(Yt),v=ct(i),m=[Pi.stream,ni.stream,$t.stream].map(v),i.warn("start wait checkEnv"),t.next=12,Ce;case 12:if(g=t.sent,i.warn("finish wait checkEnv"),!g){t.next=23;break}return y=Date.now(),i.warn("wait page complete"),t.next=19,new Promise((function(e){"complete"===document.readyState?e():document.addEventListener("readystatechange",(function(){"complete"===document.readyState&&e()}))}));case 19:E=Date.now()-y,i.warn("page complete ",E),t.next=24;break;case 23:i.error("env not support ",ye?"enableIosPlayer: "+Ae:"",ge?"enableAndroidPlayer: "+Re:"");case 24:if(!e.cancelToken||!e.cancelToken.isCanceled){t.next=26;break}return t.abrupt("return",null);case 26:if(S=Gr({uid:_,type:s,el:n,event$:h,config:u,useH5FallbackPlayer:f,onInit:o,logger:i})){t.next=30;break}return i.warn("env not support"),t.abrupt("return",null);case 30:return i.warn("context get player success: ",S.name),b=function(){p.forEach((function(e){return e()})),p=[]},L={el:n,config:ue({},e,{type:s,plugins:c,playerConfig:S.config,container:n}),id:_,plugins:[],release:function(e){return i.log("context release",_),S.dispose(e)},destroy:function(){return zr(A.plugins),S.trigger("destroy",null),I(),b(),Array.from(n.childNodes).forEach((function(e){return e.remove()})),n.context&&(n.context=void 0),C.forEach((function(e){return e&&e()})),m.forEach((function(e){return e&&e()})),S.dispose()},listen:T,logger:i},A=ue({},L,S.getInstance()),R=Di(A),I=R.dispose,k=R.getState,c.length>0&&(A.plugins=qr(c,{context:A,event$:h,pluginWrapper:n,player:S,getState:k})),A.updateConfig=function(e){return S.updateConfig(e)},C=[s===Nt.VIDEO?xi(A,S,i):null,s===Nt.LIVE?Ci(A,S,i):null],t.abrupt("return",A);case 39:case"end":return t.stop()}}),t)})));return function(){return t.apply(this,arguments)}}()().then((function(e){n.loading=void 0,e&&(n.context=e),a&&a(e)})),o}_e.isInYoda&&_e.ready((function(){_e.event.addEventListener("audio-pause",(function(){Pi.warn("[audio] get audio-pause"),wi=!0,Ni.next(!0)})),_e.event.addEventListener("audio-resume",(function(){Pi.warn("[audio] get audio-resume"),wi=!1,Ni.next(!1)}))})),_e.ready((function(){return Qr()}));var Bi=new(function(){function e(e){void 0===e&&(e=1),this.maxActiveNum=e,this.id=1,this.activeIns=[]}var t=e.prototype;return t.addIns=function(){var e=_t(lt.mark((function e(t){var r;return lt.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!(this.activeIns.length>=this.maxActiveNum)){e.next=3;break}return e.next=3,this.removeFirst();case 3:return r=this.id++,this.activeIns.push(ue({},t,{id:r})),e.abrupt("return",r);case 6:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}(),t.removeIns=function(){var e=_t(lt.mark((function e(t){var r;return lt.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(r=this.activeIns.find((function(e){return e.id===t}))){e.next=3;break}return e.abrupt("return");case 3:if(!r){e.next=8;break}if(this.activeIns=this.activeIns.filter((function(e){return e.id!==t})),!r.destroy){e.next=8;break}return e.next=8,r.destroy();case 8:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}(),t.removeFirst=function(){if(-1!==this.maxActiveNum){var e=this.activeIns.shift();if(e)return this.destroyVideo(e)}},t.destroyVideo=function(){var e=_t(lt.mark((function e(t){return lt.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!t.destroy){e.next=3;break}return e.next=3,t.destroy();case 3:t.store=null;case 4:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),e}())(1);[{name:"instance",plugin:function(e){function t(){for(var t,r=arguments.length,i=new Array(r),n=0;n<r;n++)i[n]=arguments[n];return(t=e.call.apply(e,[this].concat(i))||this).videoId=-1,t.disposeListener=[],t}gt(t,e);var r=t.prototype;return r.isValid=function(){return!0},r.init=function(){var e=this,t=function(){return e.handleDestroy()},r=function(){var t=_t(lt.mark((function t(){return lt.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(-1===e.videoId){t.next=2;break}return t.abrupt("return");case 2:return t.next=4,e.manager.addIns({destroy:function(){var t=_t(lt.mark((function t(){return lt.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(e.context.logger.log("release by ins",e.context.id),!Ae||!Ie){t.next=7;break}return e.context.logger.log("release ios player"),t.next=5,e.context.release(!0);case 5:t.next=10;break;case 7:return e.context.logger.log("pause player"),t.next=10,e.context.pause();case 10:case"end":return t.stop()}}),t)})));return function(){return t.apply(this,arguments)}}()});case 4:e.videoId=t.sent,e.context.logger.log("[instance] add: ",e.videoId);case 6:case"end":return t.stop()}}),t)})));return function(){return t.apply(this,arguments)}}();["ios-video-player","ios-live-player"].includes(this.player.name)?(this.context.logger.log("[instance] ios player"),this.disposeListener=[this.context.listen("after-dispose",(function(){e.context.logger.log("[instance] remove instance by after-dispose"),t()})),this.context.listen("after-load",(function(){e.context.logger.log("[instance] add instance by after-load"),r()}))]):this.disposeListener.push(this.context.listen("play",(function(){e.context.logger.log("[instance] add instance by play"),r()})),this.context.listen("pause",(function(){e.context.logger.log("[instance] remove instance by pause"),t()})))},r.dispose=function(){this.handleDestroy()},r.handleDestroy=function(){-1!==this.videoId&&(this.manager.removeIns(this.videoId),this.videoId=-1)},Pt(t,[{key:"manager",get:function(){return this.pluginConfig.manager||Bi}}]),t}(Yr)},{name:"error",plugin:function(e){function t(){for(var t,r=arguments.length,i=new Array(r),n=0;n<r;n++)i[n]=arguments[n];return(t=e.call.apply(e,[this].concat(i))||this).eventDispose=null,t}gt(t,e);var r=t.prototype;return r.isValid=function(){return!0},r.init=function(){var e=this;this.eventDispose=this.context.listen("error",(function(){e.context.release()}))},r.dispose=function(){this.eventDispose&&this.eventDispose()},t}(Yr)},{name:"recovery-time",plugin:function(e){function t(){for(var t,r=arguments.length,i=new Array(r),n=0;n<r;n++)i[n]=arguments[n];return(t=e.call.apply(e,[this].concat(i))||this).disposeEvent=null,t}gt(t,e);var r=t.prototype;return r.isValid=function(){return this.context.config.type===Nt.VIDEO},r.init=function(){var e=this;this.disposeEvent=this.context.listen("timeupdate",(function(t){var r=t.data.to;e.context.logger.log("update startTime",r),e.context.updateConfig({startTime:r})}))},r.dispose=function(){this.disposeEvent&&this.disposeEvent(),this.disposeEvent=null},t}(Yr)},{name:"background",plugin:function(e){function t(){for(var t,r=arguments.length,i=new Array(r),n=0;n<r;n++)i[n]=arguments[n];return(t=e.call.apply(e,[this].concat(i))||this).disposeEvent=null,t}gt(t,e);var r=t.prototype;return r.isValid=function(){return this.pluginConfig.enableOnIos||!this.player.name.includes("ios")},r.init=function(){var e=this,t=!1,r=[],i=this.initUserState(),n=i.getUserWantsPlay,a=i.dispose,o=i.play,s=i.pause,u=Ke(),d=function(){o(),u.next()},c=function(){return!Oi()&&t&&(e.pluginConfig.shouldRecovery?e.pluginConfig.shouldRecovery():n())};r.push(ui((function(e){t=e})));var l,f=function(){if(!t)return e.context.logger.warn("[background] pause by unActive"),s()};if(r.push(this.context.listen("timeupdate",f),this.context.listen("playing",f),this.context.listen("play",f),this.context.listen("waiting",f)),this.pluginConfig.recoveryOnPause){var _=Qe((function(t){return e.context.listen("pause",t)}));r.push($e(u.stream)(qe((function(){var t=Date.now();return $e(_)(qe((function(){return Date.now()-t})),nt((function(t){return e.context.logger.log("[background] duration: "+t)})),Xe(1))})),(function(e){return function(t){var r=!1,i=[],n=e((function(e){if(!r&&e){var n=e((function(e){r||t(e)}));i.push(n)}}));return i.push(n),function(){r||(i.forEach((function(e){return e()})),i=[],r=!0)}}}),ze((function(e){return e<300})),(l=1500,function(e){return function(t){var r=[],i=e((function(e){var i=setTimeout((function(){r=r.filter((function(e){return e!==i})),t(e)}),l);r.push(i)})),n=!1;return function(){n||(n=!0,r.forEach((function(e){return clearTimeout(e)})),r=[],i())}}}),ze((function(){return c()})))((function(){d()})))}r.push(Ze($e(ui)(ze((function(e){return!e})),nt((function(){return e.context.logger.warn("[background] pause player by unVisible")}))),$e(Mi)(ze((function(e){return e})),nt((function(){return e.context.logger.warn("[background] pause player by audio pending")}))))((function(){s()}))),r.push(Ze($e(ui)(ze((function(e){return e&&!Oi()})),nt((function(){return e.context.logger.warn("[background] will recovery by visible")}))),$e(Mi)(ze((function(e){return!e})),nt((function(){return e.context.logger.warn("[background] will recovery by cancel audio pending")}))))((function(){c()?(e.context.logger.warn("recovery player"),"h5-live-player"===e.player.name&&e.context.updateSource&&e.context.updateSource({}),d()):e.context.logger.warn("skip recovery,  \n                    shouldRecovery: "+(e.pluginConfig.shouldRecovery&&e.pluginConfig.shouldRecovery())+"\n                    userWantsPlay: "+n()+"\n                    isAudioPending: "+Oi())}))),this.disposeEvent=function(){a(),r.forEach((function(e){return e()}))}},r.dispose=function(){this.disposeEvent&&this.disposeEvent(),this.disposeEvent=null},r.initUserState=function(){var e=this.context.config.playerConfig.autoplay||!1,t=this.context.play,r=this.context.pause;this.context.play=function(){return e=!0,t()},this.context.pause=function(){return e=!1,r()};var i=[this.context.listen("before-dispose",(function(){e=!1})),this.context.listen("ended",(function(){e=!1})),this.context.listen("error",(function(){e=!1}))];return{getUserWantsPlay:function(){return e},play:t,pause:r,dispose:function(){return i.forEach((function(e){return e()}))}}},t}(Yr)},{name:"timeout",plugin:function(e){function t(){for(var t,r=arguments.length,i=new Array(r),n=0;n<r;n++)i[n]=arguments[n];return(t=e.call.apply(e,[this].concat(i))||this).disposeEvent=null,t}gt(t,e);var r=t.prototype;return r.isValid=function(){return this.player.name.includes("h5")},r.init=function(){var e=this,t=this.pluginConfig,r=t.playTimeout,i=void 0===r?5e3:r,n=t.autoFixTime,a=void 0===n?0:n,o=t.maxFixTime,s=void 0===o?-1:o,u=a,d=0;var c=Qe((function(t){return e.context.listen("before-load",t)})),l=Qe((function(t){return e.context.listen("play",t)})),f=Qe((function(t){return e.context.listen("playing",t)})),_=Qe((function(t){return e.context.listen("timeupdate",t)})),h=Qe((function(t){return e.context.listen("waiting",t)})),p=Qe((function(t){return e.context.listen("pause",t)})),v=Qe((function(t){return e.context.listen("before-dispose",t)})),m=Qe((function(t){return e.context.listen("ended",t)})),g=Ke(),y=Ze(p,$e(g.stream)(bt(1),qe((function(){return $e(_)((function(e){return function(t){var r=null,i=!1,n=!1,a=e((function(e){var n=r;r=e,i?t([n,e]):i=!0}));return function(){n||(n=!0,r=null,i=!1,a())}}}),ze((function(e){var t=e[0],r=e[1];return t.data.to!==r.data.to})))})),(function(e){return function(t){var r=!1,i=[],n=e((function(e){if(!r&&e){var n=e((function(e){r||t(e)}));i.push(n)}}));return i.push(n),function(){r||(i.forEach((function(e){return e()})),i=[],r=!0)}}})),m,v),E=$e(c)(ze((function(e){return e.data})));$e(ui)(ze((function(e){return e})));var S=[g.stream((function(){e.context.updateSource&&e.context.updateSource({})})),y((function(){u=a,e.context.logger.log("[timeout] reset leftTime")})),$e(Ze(h,l,E,g.stream))(qe((function(){return $e(Ye(i))(it(Ze(g.stream,h,l,p,f,v)))})),(function(e){return function(t){var r=!1,i=[],n=e((function(e){if(!r&&e){var n=e((function(e){r||t(e)}));i.push(n)}}));return i.push(n),function(){r||(i.forEach((function(e){return e()})),i=[],r=!0)}}}),nt((function(){return e.context.logger.warn("[timeout] 播放超时")})))((function(){u>0&&(-1===s||d<s)&&e.context.updateSource?(u--,d++,g.next(),e.context.logger.warn("[timeout] try to update source, leftTime: "+u+", currentTime: "+d)):(e.context.logger.warn("[timeout] trigger error"),e.triggerContext("error",{type:"noMoreSource",originalError:{}}))}))];this.disposeEvent=function(){return S.forEach((function(e){return e()}))}},r.dispose=function(){this.disposeEvent&&(this.disposeEvent(),this.disposeEvent=null)},t}(Yr)}].forEach((function(e){!function(e,t){if("string"!=typeof e)throw new Error("Illegal plugin name, "+e);Kr[e]=t}(e.name,e.plugin)}));const Fi=e=>t=>r=>(r(e),t((e=>r(e))));var Vi="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{};function Hi(e){return e&&e.__esModule&&Object.prototype.hasOwnProperty.call(e,"default")?e.default:e}var ji={exports:{}};"undefined"!=typeof window&&(ji.exports=function(e){var t={};function r(i){if(t[i])return t[i].exports;var n=t[i]={i:i,l:!1,exports:{}};return e[i].call(n.exports,n,n.exports,r),n.l=!0,n.exports}return r.m=e,r.c=t,r.d=function(e,t,i){r.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:i})},r.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},r.t=function(e,t){if(1&t&&(e=r(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var i=Object.create(null);if(r.r(i),Object.defineProperty(i,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var n in e)r.d(i,n,function(t){return e[t]}.bind(null,n));return i},r.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return r.d(t,"a",t),t},r.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},r.p="",r(r.s="./src/index.ts")}({"./node_modules/events/events.js":function(e,t,r){var i,n="object"==typeof Reflect?Reflect:null,a=n&&"function"==typeof n.apply?n.apply:function(e,t,r){return Function.prototype.apply.call(e,t,r)};i=n&&"function"==typeof n.ownKeys?n.ownKeys:Object.getOwnPropertySymbols?function(e){return Object.getOwnPropertyNames(e).concat(Object.getOwnPropertySymbols(e))}:function(e){return Object.getOwnPropertyNames(e)};var o=Number.isNaN||function(e){return e!=e};function s(){s.init.call(this)}e.exports=s,e.exports.once=function(e,t){return new Promise((function(r,i){function n(){void 0!==a&&e.removeListener("error",a),r([].slice.call(arguments))}var a;"error"!==t&&(a=function(r){e.removeListener(t,n),i(r)},e.once("error",a)),e.once(t,n)}))},s.EventEmitter=s,s.prototype._events=void 0,s.prototype._eventsCount=0,s.prototype._maxListeners=void 0;var u=10;function d(e){if("function"!=typeof e)throw new TypeError('The "listener" argument must be of type Function. Received type '+typeof e)}function c(e){return void 0===e._maxListeners?s.defaultMaxListeners:e._maxListeners}function l(e,t,r,i){var n,a,o,s;if(d(r),void 0===(a=e._events)?(a=e._events=Object.create(null),e._eventsCount=0):(void 0!==a.newListener&&(e.emit("newListener",t,r.listener?r.listener:r),a=e._events),o=a[t]),void 0===o)o=a[t]=r,++e._eventsCount;else if("function"==typeof o?o=a[t]=i?[r,o]:[o,r]:i?o.unshift(r):o.push(r),(n=c(e))>0&&o.length>n&&!o.warned){o.warned=!0;var u=new Error("Possible EventEmitter memory leak detected. "+o.length+" "+String(t)+" listeners added. Use emitter.setMaxListeners() to increase limit");u.name="MaxListenersExceededWarning",u.emitter=e,u.type=t,u.count=o.length,s=u,console&&console.warn&&console.warn(s)}return e}function f(){if(!this.fired)return this.target.removeListener(this.type,this.wrapFn),this.fired=!0,0===arguments.length?this.listener.call(this.target):this.listener.apply(this.target,arguments)}function _(e,t,r){var i={fired:!1,wrapFn:void 0,target:e,type:t,listener:r},n=f.bind(i);return n.listener=r,i.wrapFn=n,n}function h(e,t,r){var i=e._events;if(void 0===i)return[];var n=i[t];return void 0===n?[]:"function"==typeof n?r?[n.listener||n]:[n]:r?function(e){for(var t=new Array(e.length),r=0;r<t.length;++r)t[r]=e[r].listener||e[r];return t}(n):v(n,n.length)}function p(e){var t=this._events;if(void 0!==t){var r=t[e];if("function"==typeof r)return 1;if(void 0!==r)return r.length}return 0}function v(e,t){for(var r=new Array(t),i=0;i<t;++i)r[i]=e[i];return r}Object.defineProperty(s,"defaultMaxListeners",{enumerable:!0,get:function(){return u},set:function(e){if("number"!=typeof e||e<0||o(e))throw new RangeError('The value of "defaultMaxListeners" is out of range. It must be a non-negative number. Received '+e+".");u=e}}),s.init=function(){void 0!==this._events&&this._events!==Object.getPrototypeOf(this)._events||(this._events=Object.create(null),this._eventsCount=0),this._maxListeners=this._maxListeners||void 0},s.prototype.setMaxListeners=function(e){if("number"!=typeof e||e<0||o(e))throw new RangeError('The value of "n" is out of range. It must be a non-negative number. Received '+e+".");return this._maxListeners=e,this},s.prototype.getMaxListeners=function(){return c(this)},s.prototype.emit=function(e){for(var t=[],r=1;r<arguments.length;r++)t.push(arguments[r]);var i="error"===e,n=this._events;if(void 0!==n)i=i&&void 0===n.error;else if(!i)return!1;if(i){var o;if(t.length>0&&(o=t[0]),o instanceof Error)throw o;var s=new Error("Unhandled error."+(o?" ("+o.message+")":""));throw s.context=o,s}var u=n[e];if(void 0===u)return!1;if("function"==typeof u)a(u,this,t);else{var d=u.length,c=v(u,d);for(r=0;r<d;++r)a(c[r],this,t)}return!0},s.prototype.addListener=function(e,t){return l(this,e,t,!1)},s.prototype.on=s.prototype.addListener,s.prototype.prependListener=function(e,t){return l(this,e,t,!0)},s.prototype.once=function(e,t){return d(t),this.on(e,_(this,e,t)),this},s.prototype.prependOnceListener=function(e,t){return d(t),this.prependListener(e,_(this,e,t)),this},s.prototype.removeListener=function(e,t){var r,i,n,a,o;if(d(t),void 0===(i=this._events))return this;if(void 0===(r=i[e]))return this;if(r===t||r.listener===t)0==--this._eventsCount?this._events=Object.create(null):(delete i[e],i.removeListener&&this.emit("removeListener",e,r.listener||t));else if("function"!=typeof r){for(n=-1,a=r.length-1;a>=0;a--)if(r[a]===t||r[a].listener===t){o=r[a].listener,n=a;break}if(n<0)return this;0===n?r.shift():function(e,t){for(;t+1<e.length;t++)e[t]=e[t+1];e.pop()}(r,n),1===r.length&&(i[e]=r[0]),void 0!==i.removeListener&&this.emit("removeListener",e,o||t)}return this},s.prototype.off=s.prototype.removeListener,s.prototype.removeAllListeners=function(e){var t,r,i;if(void 0===(r=this._events))return this;if(void 0===r.removeListener)return 0===arguments.length?(this._events=Object.create(null),this._eventsCount=0):void 0!==r[e]&&(0==--this._eventsCount?this._events=Object.create(null):delete r[e]),this;if(0===arguments.length){var n,a=Object.keys(r);for(i=0;i<a.length;++i)"removeListener"!==(n=a[i])&&this.removeAllListeners(n);return this.removeAllListeners("removeListener"),this._events=Object.create(null),this._eventsCount=0,this}if("function"==typeof(t=r[e]))this.removeListener(e,t);else if(void 0!==t)for(i=t.length-1;i>=0;i--)this.removeListener(e,t[i]);return this},s.prototype.listeners=function(e){return h(this,e,!0)},s.prototype.rawListeners=function(e){return h(this,e,!1)},s.listenerCount=function(e,t){return"function"==typeof e.listenerCount?e.listenerCount(t):p.call(e,t)},s.prototype.listenerCount=p,s.prototype.eventNames=function(){return this._eventsCount>0?i(this._events):[]}},"./node_modules/querystringify/index.js":function(e,t,r){var i=Object.prototype.hasOwnProperty;function n(e){try{return decodeURIComponent(e.replace(/\+/g," "))}catch(t){return null}}t.stringify=function(e,t){t=t||"";var r,n,a=[];for(n in"string"!=typeof t&&(t="?"),e)if(i.call(e,n)){if((r=e[n])||null!=r&&!isNaN(r)||(r=""),n=encodeURIComponent(n),r=encodeURIComponent(r),null===n||null===r)continue;a.push(n+"="+r)}return a.length?t+a.join("&"):""},t.parse=function(e){for(var t,r=/([^=?&]+)=?([^&]*)/g,i={};t=r.exec(e);){var a=n(t[1]),o=n(t[2]);null===a||null===o||a in i||(i[a]=o)}return i}},"./node_modules/requires-port/index.js":function(e,t,r){e.exports=function(e,t){if(t=t.split(":")[0],!(e=+e))return!1;switch(t){case"http":case"ws":return 80!==e;case"https":case"wss":return 443!==e;case"ftp":return 21!==e;case"gopher":return 70!==e;case"file":return!1}return 0!==e}},"./node_modules/url-parse/index.js":function(e,t,r){var i=r("./node_modules/requires-port/index.js"),n=r("./node_modules/querystringify/index.js"),a=/^[A-Za-z][A-Za-z0-9+-.]*:\/\//,o=/^([a-z][a-z0-9.+-]*:)?(\/\/)?([\S\s]*)/i,s=new RegExp("^[\\x09\\x0A\\x0B\\x0C\\x0D\\x20\\xA0\\u1680\\u180E\\u2000\\u2001\\u2002\\u2003\\u2004\\u2005\\u2006\\u2007\\u2008\\u2009\\u200A\\u202F\\u205F\\u3000\\u2028\\u2029\\uFEFF]+");function u(e){return(e||"").toString().replace(s,"")}var d=[["#","hash"],["?","query"],function(e){return e.replace("\\","/")},["/","pathname"],["@","auth",1],[NaN,"host",void 0,1,1],[/:(\d+)$/,"port",void 0,1],[NaN,"hostname",void 0,1,1]],c={hash:1,query:1};function l(e){var t,r=("undefined"!=typeof window?window:void 0!==Vi?Vi:"undefined"!=typeof self?self:{}).location||{},i={},n=typeof(e=e||r);if("blob:"===e.protocol)i=new _(unescape(e.pathname),{});else if("string"===n)for(t in i=new _(e,{}),c)delete i[t];else if("object"===n){for(t in e)t in c||(i[t]=e[t]);void 0===i.slashes&&(i.slashes=a.test(e.href))}return i}function f(e){e=u(e);var t=o.exec(e);return{protocol:t[1]?t[1].toLowerCase():"",slashes:!!t[2],rest:t[3]}}function _(e,t,r){if(e=u(e),!(this instanceof _))return new _(e,t,r);var a,o,s,c,h,p,v=d.slice(),m=typeof t,g=this,y=0;for("object"!==m&&"string"!==m&&(r=t,t=null),r&&"function"!=typeof r&&(r=n.parse),t=l(t),a=!(o=f(e||"")).protocol&&!o.slashes,g.slashes=o.slashes||a&&t.slashes,g.protocol=o.protocol||t.protocol||"",e=o.rest,o.slashes||(v[3]=[/(.*)/,"pathname"]);y<v.length;y++)"function"!=typeof(c=v[y])?(s=c[0],p=c[1],s!=s?g[p]=e:"string"==typeof s?~(h=e.indexOf(s))&&("number"==typeof c[2]?(g[p]=e.slice(0,h),e=e.slice(h+c[2])):(g[p]=e.slice(h),e=e.slice(0,h))):(h=s.exec(e))&&(g[p]=h[1],e=e.slice(0,h.index)),g[p]=g[p]||a&&c[3]&&t[p]||"",c[4]&&(g[p]=g[p].toLowerCase())):e=c(e);r&&(g.query=r(g.query)),a&&t.slashes&&"/"!==g.pathname.charAt(0)&&(""!==g.pathname||""!==t.pathname)&&(g.pathname=function(e,t){if(""===e)return t;for(var r=(t||"/").split("/").slice(0,-1).concat(e.split("/")),i=r.length,n=r[i-1],a=!1,o=0;i--;)"."===r[i]?r.splice(i,1):".."===r[i]?(r.splice(i,1),o++):o&&(0===i&&(a=!0),r.splice(i,1),o--);return a&&r.unshift(""),"."!==n&&".."!==n||r.push(""),r.join("/")}(g.pathname,t.pathname)),i(g.port,g.protocol)||(g.host=g.hostname,g.port=""),g.username=g.password="",g.auth&&(c=g.auth.split(":"),g.username=c[0]||"",g.password=c[1]||""),g.origin=g.protocol&&g.host&&"file:"!==g.protocol?g.protocol+"//"+g.host:"null",g.href=g.toString()}_.prototype={set:function(e,t,r){var a=this;switch(e){case"query":"string"==typeof t&&t.length&&(t=(r||n.parse)(t)),a[e]=t;break;case"port":a[e]=t,i(t,a.protocol)?t&&(a.host=a.hostname+":"+t):(a.host=a.hostname,a[e]="");break;case"hostname":a[e]=t,a.port&&(t+=":"+a.port),a.host=t;break;case"host":a[e]=t,/:\d+$/.test(t)?(t=t.split(":"),a.port=t.pop(),a.hostname=t.join(":")):(a.hostname=t,a.port="");break;case"protocol":a.protocol=t.toLowerCase(),a.slashes=!r;break;case"pathname":case"hash":if(t){var o="pathname"===e?"/":"#";a[e]=t.charAt(0)!==o?o+t:t}else a[e]=t;break;default:a[e]=t}for(var s=0;s<d.length;s++){var u=d[s];u[4]&&(a[u[1]]=a[u[1]].toLowerCase())}return a.origin=a.protocol&&a.host&&"file:"!==a.protocol?a.protocol+"//"+a.host:"null",a.href=a.toString(),a},toString:function(e){e&&"function"==typeof e||(e=n.stringify);var t,r=this,i=r.protocol;i&&":"!==i.charAt(i.length-1)&&(i+=":");var a=i+(r.slashes?"//":"");return r.username&&(a+=r.username,r.password&&(a+=":"+r.password),a+="@"),a+=r.host+r.pathname,(t="object"==typeof r.query?e(r.query):r.query)&&(a+="?"!==t.charAt(0)?"?"+t:t),r.hash&&(a+=r.hash),a}},_.extractProtocol=f,_.location=l,_.trimLeft=u,_.qs=n,e.exports=_},"./node_modules/url-toolkit/src/url-toolkit.js":function(e,t,r){var i,n,a,o,s;i=/^((?:[a-zA-Z0-9+\-.]+:)?)(\/\/[^\/?#]*)?((?:[^\/?#]*\/)*[^;?#]*)?(;[^?#]*)?(\?[^#]*)?(#.*)?$/,n=/^([^\/?#]*)(.*)$/,a=/(?:\/|^)\.(?=\/)/g,o=/(?:\/|^)\.\.\/(?!\.\.\/)[^\/]*(?=\/)/g,s={buildAbsoluteURL:function(e,t,r){if(r=r||{},e=e.trim(),!(t=t.trim())){if(!r.alwaysNormalize)return e;var i=s.parseURL(e);if(!i)throw new Error("Error trying to parse base URL.");return i.path=s.normalizePath(i.path),s.buildURLFromParts(i)}var a=s.parseURL(t);if(!a)throw new Error("Error trying to parse relative URL.");if(a.scheme)return r.alwaysNormalize?(a.path=s.normalizePath(a.path),s.buildURLFromParts(a)):t;var o=s.parseURL(e);if(!o)throw new Error("Error trying to parse base URL.");if(!o.netLoc&&o.path&&"/"!==o.path[0]){var u=n.exec(o.path);o.netLoc=u[1],o.path=u[2]}o.netLoc&&!o.path&&(o.path="/");var d={scheme:o.scheme,netLoc:a.netLoc,path:null,params:a.params,query:a.query,fragment:a.fragment};if(!a.netLoc&&(d.netLoc=o.netLoc,"/"!==a.path[0]))if(a.path){var c=o.path,l=c.substring(0,c.lastIndexOf("/")+1)+a.path;d.path=s.normalizePath(l)}else d.path=o.path,a.params||(d.params=o.params,a.query||(d.query=o.query));return null===d.path&&(d.path=r.alwaysNormalize?s.normalizePath(a.path):a.path),s.buildURLFromParts(d)},parseURL:function(e){var t=i.exec(e);return t?{scheme:t[1]||"",netLoc:t[2]||"",path:t[3]||"",params:t[4]||"",query:t[5]||"",fragment:t[6]||""}:null},normalizePath:function(e){for(e=e.split("").reverse().join("").replace(a,"");e.length!==(e=e.replace(o,"")).length;);return e.split("").reverse().join("")},buildURLFromParts:function(e){return e.scheme+e.netLoc+e.path+e.params+e.query+e.fragment}},e.exports=s},"./node_modules/webworkify-webpack/index.js":function(e,t,r){function i(e){var t={};function r(i){if(t[i])return t[i].exports;var n=t[i]={i:i,l:!1,exports:{}};return e[i].call(n.exports,n,n.exports,r),n.l=!0,n.exports}r.m=e,r.c=t,r.i=function(e){return e},r.d=function(e,t,i){r.o(e,t)||Object.defineProperty(e,t,{configurable:!1,enumerable:!0,get:i})},r.r=function(e){Object.defineProperty(e,"__esModule",{value:!0})},r.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return r.d(t,"a",t),t},r.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},r.p="/",r.oe=function(e){throw console.error(e),e};var i=r(r.s=ENTRY_MODULE);return i.default||i}var n="[\\.|\\-|\\+|\\w|/|@]+",a="\\(\\s*(/\\*.*?\\*/)?\\s*.*?([\\.|\\-|\\+|\\w|/|@]+).*?\\)";function o(e){return(e+"").replace(/[.?*+^$[\]\\(){}|-]/g,"\\$&")}function s(e,t,i){var s={};s[i]=[];var u=t.toString(),d=u.match(/^function\s?\w*\(\w+,\s*\w+,\s*(\w+)\)/);if(!d)return s;for(var c,l=d[1],f=new RegExp("(\\\\n|\\W)"+o(l)+a,"g");c=f.exec(u);)"dll-reference"!==c[3]&&s[i].push(c[3]);for(f=new RegExp("\\("+o(l)+'\\("(dll-reference\\s('+n+'))"\\)\\)'+a,"g");c=f.exec(u);)e[c[2]]||(s[i].push(c[1]),e[c[2]]=r(c[1]).m),s[c[2]]=s[c[2]]||[],s[c[2]].push(c[4]);for(var _,h=Object.keys(s),p=0;p<h.length;p++)for(var v=0;v<s[h[p]].length;v++)_=s[h[p]][v],isNaN(1*_)||(s[h[p]][v]=1*s[h[p]][v]);return s}function u(e){return Object.keys(e).reduce((function(t,r){return t||e[r].length>0}),!1)}e.exports=function(e,t){t=t||{};var n={main:r.m},a=t.all?{main:Object.keys(n.main)}:function(e,t){for(var r={main:[t]},i={main:[]},n={main:{}};u(r);)for(var a=Object.keys(r),o=0;o<a.length;o++){var d=a[o],c=r[d].pop();if(n[d]=n[d]||{},!n[d][c]&&e[d][c]){n[d][c]=!0,i[d]=i[d]||[],i[d].push(c);for(var l=s(e,e[d][c],d),f=Object.keys(l),_=0;_<f.length;_++)r[f[_]]=r[f[_]]||[],r[f[_]]=r[f[_]].concat(l[f[_]])}}return i}(n,e),o="";Object.keys(a).filter((function(e){return"main"!==e})).forEach((function(e){for(var t=0;a[e][t];)t++;a[e].push(t),n[e][t]="(function(module, exports, __webpack_require__) { module.exports = __webpack_require__; })",o=o+"var "+e+" = ("+i.toString().replace("ENTRY_MODULE",JSON.stringify(t))+")({"+a[e].map((function(t){return JSON.stringify(t)+": "+n[e][t].toString()})).join(",")+"});\n"})),o=o+"new (("+i.toString().replace("ENTRY_MODULE",JSON.stringify(e))+")({"+a.main.map((function(e){return JSON.stringify(e)+": "+n.main[e].toString()})).join(",")+"}))(self);";var d=new window.Blob([o],{type:"text/javascript"});if(t.bare)return d;var c=(window.URL||window.webkitURL||window.mozURL||window.msURL).createObjectURL(d),l=new window.Worker(c);return l.objectURL=c,l}},"./src/core/kernel-errors.ts":function(e,t,r){var i,n,a,o;r.r(t),r.d(t,"ErrorTypes",(function(){return i})),r.d(t,"ErrorDetails",(function(){return a})),(n=i||(i={})).NETWORK_ERROR="networkError",n.MEDIA_ERROR="mediaError",n.KEY_SYSTEM_ERROR="keySystemError",n.MUX_ERROR="muxError",n.OTHER_ERROR="otherError",n.MSE_ERROR="mseError",(o=a||(a={}))[o.LOAD_ERROR=10]="LOAD_ERROR",o[o.HLS_MANIFEST_LOAD_ERROR=11]="HLS_MANIFEST_LOAD_ERROR",o[o.HLS_LEVEL_LOAD_ERROR=12]="HLS_LEVEL_LOAD_ERROR",o[o.HLS_AUDIO_TRACK_LOAD_ERROR=13]="HLS_AUDIO_TRACK_LOAD_ERROR",o[o.HLS_KEY_LOAD_ERROR=14]="HLS_KEY_LOAD_ERROR",o[o.KEY_SYSTEM_LICENSE_REQUEST_FAILED=15]="KEY_SYSTEM_LICENSE_REQUEST_FAILED",o[o.CANNOT_SEEK=100]="CANNOT_SEEK",o[o.VIDEO_ERROR=101]="VIDEO_ERROR",o[o.UNSUPPORTED=102]="UNSUPPORTED",o[o.CONFIG_ERROR=103]="CONFIG_ERROR",o[o.OTHER=104]="OTHER",o[o.UNKNOWN=105]="UNKNOWN",o[o.MEDIASOURCE_ERROR=200]="MEDIASOURCE_ERROR",o[o.ADDSOURCEBUFFER_ERROR=201]="ADDSOURCEBUFFER_ERROR",o[o.SOURCEBUFFER_ERROR=202]="SOURCEBUFFER_ERROR",o[o.ENDOFSTREAM_ERROR=203]="ENDOFSTREAM_ERROR",o[o.APPENDBUFFER_ERROR=204]="APPENDBUFFER_ERROR",o[o.PARSING_ERROR=301]="PARSING_ERROR",o[o.REMUX_ERROR=302]="REMUX_ERROR",o[o.REMUX_ALLOC_ERROR=303]="REMUX_ALLOC_ERROR",o[o.MANIFEST_PARSING_ERROR=400]="MANIFEST_PARSING_ERROR",o[o.HLS_LEVEL_SWITCH_ERROR=401]="HLS_LEVEL_SWITCH_ERROR",o[o.KEY_SYSTEM_NO_ACCESS=500]="KEY_SYSTEM_NO_ACCESS",o[o.KEY_SYSTEM_NO_SESSION=501]="KEY_SYSTEM_NO_SESSION",o[o.KEY_SYSTEM_URL_ERROR=502]="KEY_SYSTEM_URL_ERROR",o[o.KEY_SYSTEM_NO_KEYS=505]="KEY_SYSTEM_NO_KEYS",o[o.FRAG_DECRYPT_ERROR=506]="FRAG_DECRYPT_ERROR",o[o.KEY_SYSTEM_NO_INIT_DATA=507]="KEY_SYSTEM_NO_INIT_DATA",o[o.KEY_SYSTEM_UNSUPPORTED=508]="KEY_SYSTEM_UNSUPPORTED",o[o.PRELOAD_ERROR=600]="PRELOAD_ERROR",o[o.LIVE_DISCONNECTED_ERROR=1009]="LIVE_DISCONNECTED_ERROR",o[o.WEBRTC_DISCONNECTED_ERROR=1010]="WEBRTC_DISCONNECTED_ERROR",o[o.WEBRTC_FAILED_ERROR=1011]="WEBRTC_FAILED_ERROR",o[o.WEBRTC_CLOSED_ERROR=1012]="WEBRTC_CLOSED_ERROR",o[o.WEBRTC_ICE_CANDIDATE_ERROR=1013]="WEBRTC_ICE_CANDIDATE_ERROR",o[o.WEBRTC_ICE_CONNECTION_ERROR=1014]="WEBRTC_ICE_CONNECTION_ERROR",o[o.WEBRTC_OFFER_ERROR=1015]="WEBRTC_OFFER_ERROR",o[o.WEBRTC_ANSWER_ERROR=1016]="WEBRTC_ANSWER_ERROR",o[o.WEBRTC_TRANSMISSION_DATA_NULL=1017]="WEBRTC_TRANSMISSION_DATA_NULL",o[o.WEBRTC_CONNECT_TIMEOUT=1018]="WEBRTC_CONNECT_TIMEOUT",o[o.WEBRTC_CONNECT_FAILED=1019]="WEBRTC_CONNECT_FAILED"},"./src/core/kernel-events.ts":function(e,t,r){var i,n;r.r(t),(n=i||(i={})).METADATA="metadata",n.PARSING_INIT_SEGMENT="parsingInitSegment",n.PARSING_DATA="parsingData",n.PARSED_DATA="parsedData",n.SCRIPT_PARSED="scriptParsed",n.KEY_FRAME_INDEXS="keyFrameIndexs",n.REPORT="report",n.LOAD_END="loadEnd",n.DISCONTINUITY="discontinuity",n.ERROR="error",n.LEVEL_SWITCH_FAILED="levelSwitchFailed",n.LEVEL_SWITCHING="levelSwitching",n.LEVEL_SWITCHED="levelSwitched",n.LEVEL_SWITCH_PLAYING="levelSwitchPlaying",n.LEVEL_LOADED="levelLoaded",n.LEVEL_UPDATED="levelUpdated",n.AUDIO_TRACK_SWITCHING="audioTrackSwitching",n.AUDIO_TRACK_SWITCHED="audioTrackSwitched",n.AUDIO_TRACK_UPDATED="audioTrackUpdated",n.MANIFEST_PARSED="manifestParsed",n.HLS_KEY_LOADED="hlsKeyLoaded",n.AUDIO_TRACK_LOADED="audioLoaded",n.SUBTITLE_TRACK_LOADED="subtitleTrackLoaded",n.SUBTITLE_LOADED="subtitleLoaded",n.SUBTITLE_TRACK_SWITCHED="subtitleTrackSwitched",n.BUFFER_FLUSHING="bufferFlushing",n.SEEK_KEYFRAME="seekKeyframe",n.PRELOAD_COMPLETE="preloadComplete",n.PRELOAD_HIT="preloadHit",n.ABR_NEXT="abrNext",n.PRIV_NAL="privNal",n.MP4_NOT_FASTSTART="mp4NotFaststart",n.LOADER_CHUNK_ARRIVAL="loaderChunkArrival",n.MEDIA_DEMUX="mediaDemux",n.KEY_FRAME="keyFrame",n.MUX_INFO="muxInfo",n.LOST_FRAMES="lostFrames",n.USE_BACKUP="useBackup",n.ABR_INFO="abrInfo",n.NEW_SOURCE="newSource",n.DOWNLOAD="download",n.STOP_LOAD="stopLoad",n.LOAD="load",n.WAITING="wating",n.LOADEDDATA="loadeddata",n.CANPLAY="canplay",n.SEEKING="seeking",n.SEEK_WITH_LOAD="onSeekWithLoad",n.SEEKED="seeked",n.PLAYING="playing",n.PAUSE="pause",n.PLAY="play",n.ENDED="ended",n.TIMEUPDATE="timeupdate",n.PROGRESS="progress",n.RATE_CHANGE="ratechange",n.DURATION_CHANGE="durationchange",n.HEARTBEAT="heartbeat",n.MSE_OPEN="mseOpen",n.MSE_UPDATE="mseUpdate",n.MSE_BUFFER_FULL="mseBufferFull",n.MSE_REMOVE="mseRemove",n.RETRY="retry",n.INIT_PTS_FOUND="initPtsFopund",n.FLV_HEAD="flvHead",t.default=i},"./src/core/worker-cmd.ts":function(e,t,r){var i,n;r.r(t),r.d(t,"WorkerCmd",(function(){return i})),(n=i||(i={})).INIT="init",n.FLUSH="flush",n.LOAD_END="loadEnd",n.DESTROY="destroy",n.PUSH="push"},"./src/demux/audio/adts.ts":function(e,t,r){r.r(t),r.d(t,"parseData",(function(){return u})),r.d(t,"parseASCData",(function(){return d})),r.d(t,"isHeaderPattern",(function(){return c})),r.d(t,"getHeaderLength",(function(){return l})),r.d(t,"getFullFrameLength",(function(){return f})),r.d(t,"isHeader",(function(){return _})),r.d(t,"probe",(function(){return h})),r.d(t,"isUpdate",(function(){return p})),r.d(t,"initTrackConfig",(function(){return v})),r.d(t,"initTrackConfigByInfo",(function(){return m})),r.d(t,"getFrameDuration",(function(){return g})),r.d(t,"parseFrameHeader",(function(){return y})),r.d(t,"appendFrame",(function(){return E}));var i=r("./src/core/kernel-errors.ts"),n=r("./src/core/kernel-events.ts"),a=r("./src/types/remux.ts"),o=r("./src/utils/log.ts"),s=r("./src/utils/uint8-array-tools.ts");function u(e){return{objectType:1+((192&e[0])>>>6),sampleingIndex:(60&e[0])>>>2,chanelConfig:(1&e[0])<<2|(192&e[1])>>>6}}function d(e){return{objectType:e[0]>>>3,sampleingIndex:(7&e[0])<<1|e[1]>>>7,chanelConfig:(120&e[1])>>>3}}function c(e,t){return 255===e[t]&&240==(246&e[t+1])}function l(e,t){return 1&e[t+1]?7:9}function f(e,t){return(3&e[t+3])<<11|e[t+4]<<3|(224&e[t+5])>>>5}function _(e,t){return!!(t+1<e.length&&c(e,t))}function h(e,t){if(t+1<e.length&&c(e,t)){var r=l(e,t);t+5<e.length&&(r=f(e,t));var i=t+r;if(i===e.length||i+1<e.length&&c(e,i))return!0}return!1}function p(e,t){return e.asc!==Object(s.readUint16)(t)}function v(e,t,r,o,c){if(void 0===c&&(c=""),p(e,r)||!e.samplerate||!e.configParsed){var l=o===a.AudioConfigType.ADTS?u(r):d(r);if(l.sampleingIndex<0||l.sampleingIndex>=13)return void t.emit(n.default.ERROR,{type:i.ErrorTypes.MUX_ERROR,details:i.ErrorDetails.PARSING_ERROR,fatal:!0,reason:"invalid sampling index:"+l.sampleingIndex});if(l.chanelConfig<0||l.chanelConfig>=8)return void t.emit(n.default.ERROR,{type:i.ErrorTypes.MUX_ERROR,details:i.ErrorDetails.PARSING_ERROR,fatal:!0,reason:"invalid chanelConfig:"+l.chanelConfig});m(e,l,c),e.asc=Object(s.readUint16)(r),e.configParsed=!0}}function m(e,t,r){void 0===r&&(r="");var i=function(e,t){void 0===t&&(t="");var r,i,n=e.objectType,a=e.sampleingIndex,s=e.chanelConfig,u=navigator.userAgent.toLowerCase(),d=t||"mp4a.40."+n,c=[96e3,88200,64e3,48e3,44100,32e3,24e3,22050,16e3,12e3,11025,8e3,7350];return o.Log.v("manifest codec:"+t+",data:type:"+n+",sampleingIndex:"+a+"["+c[a]+"Hz],channelConfig:"+s),/firefox/i.test(u)?a>=6?(n=5,i=new Array(4),r=a-3):(n=2,i=new Array(2),r=a):-1!==u.indexOf("android")?(n=2,i=new Array(2),r=a):(n=5,i=new Array(4),t&&(-1!==t.indexOf("mp4a.40.29")||-1!==t.indexOf("mp4a.40.5"))||!t&&a>=6?r=a-3:((t&&-1!==t.indexOf("mp4a.40.2")&&(a>=6&&1===s||/vivaldi/i.test(u))||!t&&1===s)&&(n=2,i=new Array(2)),r=a)),i[0]=n<<3,i[0]|=(14&a)>>1,i[1]|=(1&a)<<7,i[1]|=s<<3,5===n&&(i[1]|=(14&r)>>1,i[2]=(1&r)<<7,i[2]|=8,i[3]=0),{config:i,samplerate:c[a],channelCount:s,codec:"mp4a.40."+n,manifestCodec:d}}(t,r);i&&(e.config=i.config,e.samplerate=i.samplerate,e.channelCount=i.channelCount,e.codec=i.codec,e.manifestCodec=i.manifestCodec,e.sampleDuration=g(e.samplerate),o.Log.v("parsed codec:"+e.codec+",rate:"+i.samplerate+",nb channel:"+i.channelCount))}function g(e){return 9216e4/e}function y(e,t,r,i,n){var a,o=e.length,s=l(e,t);return a=f(e,t),(a-=s)>0&&t+s+a<=o?{headerLength:s,frameLength:a,stamp:r+i*n}:null}function E(e,t,r,i,n){var a=y(t,r,i,n,g(e.samplerate));if(a){var o=a.stamp,s=a.headerLength,u=a.frameLength,d={unit:t.subarray(r+s,r+s+u),pts:o,dts:o,streamDTS:0};return e.samples.push(d),{sample:d,length:u+s}}return null}},"./src/demux/create-track.ts":function(e,t,r){r.r(t),r.d(t,"createVideoTrack",(function(){return o})),r.d(t,"createAudioTrack",(function(){return s}));var i=r("./src/types/core.ts"),n=r("./src/types/remux.ts");function a(e,t){return{type:e,id:n.RemuxerTrackIdConfig[e],pid:-1,inputTimescale:9e4,timescale:9e4,codec:"",sequenceNumber:0,samples:[],mp4Samples:[],duration:t,sampleDuration:0}}function o(e){var t=a(i.TrackType.VIDEO,e);return t.width=0,t.height=0,t.codecWidth=0,t.codecHeight=0,t.sps=[],t.pps=[],t.pixelRatio=[],t.profile="",t.level="",t.chromaFormat="",t.fps=0,t}function s(e){var t=a(i.TrackType.AUDIO,e);return t.isAAC=!0,t.config=[],t.samplerate=0,t.channelCount=0,t}},"./src/demux/demuxer-inline.ts":function(e,t,r){r.r(t);var i=r("./src/core/kernel-errors.ts"),n=r("./src/core/kernel-events.ts"),a=r("./src/utils/log.ts");function o(e,t,r){return Uint8Array.prototype.slice?e.slice(t,r):new Uint8Array(Array.prototype.slice.call(e,t,r))}var s=function(){function e(e,t){this._subtle=void 0,this._aesIV=void 0,this._subtle=e,this._aesIV=t}return e.prototype.decrypt=function(e,t){return this._subtle.decrypt({name:"AES-CBC",iv:this._aesIV},t,e)},e}(),u=function(){function e(){this.rcon=[0,1,2,4,8,16,32,64,128,27,54],this.subMix=[new Uint32Array(256),new Uint32Array(256),new Uint32Array(256),new Uint32Array(256)],this.invSubMix=[new Uint32Array(256),new Uint32Array(256),new Uint32Array(256),new Uint32Array(256)],this.sBox=new Uint32Array(256),this.invSBox=new Uint32Array(256),this.key=new Uint32Array(0),this.ksRows=0,this.keySize=0,this.keySchedule=void 0,this.invKeySchedule=void 0,this.initTable()}var t=e.prototype;return t.uint8ArrayToUint32Array_=function(e){for(var t=new DataView(e),r=new Uint32Array(4),i=0;i<4;i++)r[i]=t.getUint32(4*i);return r},t.initTable=function(){var e=this.sBox,t=this.invSBox,r=this.subMix,i=r[0],n=r[1],a=r[2],o=r[3],s=this.invSubMix,u=s[0],d=s[1],c=s[2],l=s[3],f=new Uint32Array(256),_=0,h=0,p=0;for(p=0;p<256;p++)f[p]=p<128?p<<1:p<<1^283;for(p=0;p<256;p++){var v=h^h<<1^h<<2^h<<3^h<<4;v=v>>>8^255&v^99,e[_]=v,t[v]=_;var m=f[_],g=f[m],y=f[g],E=257*f[v]^16843008*v;i[_]=E<<24|E>>>8,n[_]=E<<16|E>>>16,a[_]=E<<8|E>>>24,o[_]=E,E=16843009*y^65537*g^257*m^16843008*_,u[v]=E<<24|E>>>8,d[v]=E<<16|E>>>16,c[v]=E<<8|E>>>24,l[v]=E,_?(_=m^f[f[f[y^m]]],h^=f[f[h]]):_=h=1}},t.expandKey=function(e){for(var t=this.uint8ArrayToUint32Array_(e),r=!0,i=0;i<t.length&&r;)r=t[i]===this.key[i],i++;if(!r){this.key=t;var n=this.keySize=t.length;if(4!==n&&6!==n&&8!==n)throw new Error("Invalid aes key size="+n);var a,o,s=this.ksRows=4*(n+6+1),u=this.keySchedule=new Uint32Array(s),d=this.invKeySchedule=new Uint32Array(s),c=this.sBox,l=this.rcon,f=this.invSubMix,_=f[0],h=f[1],p=f[2],v=f[3],m=0,g=0;for(a=0;a<s;a++)a<n?m=u[a]=t[a]:(g=m,a%n==0?(g=c[(g=g<<8|g>>>24)>>>24]<<24|c[g>>>16&255]<<16|c[g>>>8&255]<<8|c[255&g],g^=l[a/n|0]<<24):n>6&&a%n==4&&(g=c[g>>>24]<<24|c[g>>>16&255]<<16|c[g>>>8&255]<<8|c[255&g]),u[a]=m=(u[a-n]^g)>>>0);for(o=0;o<s;o++)a=s-o,g=3&o?u[a]:u[a-4],d[o]=o<4||a<=4?g:_[c[g>>>24]]^h[c[g>>>16&255]]^p[c[g>>>8&255]]^v[c[255&g]],d[o]=d[o]>>>0}},t.networkToHostOrderSwap=function(e){return e<<24|(65280&e)<<8|(16711680&e)>>8|e>>>24},t.decrypt=function(e,t,r){for(var i,n,a,o,s,u,d,c,l,f,_,h,p,v,m=this.keySize+6,g=this.invKeySchedule,y=this.invSBox,E=this.invSubMix,S=E[0],T=E[1],b=E[2],L=E[3],A=this.uint8ArrayToUint32Array_(r),R=A[0],I=A[1],k=A[2],C=A[3],x=new Int32Array(e),D=new Int32Array(x.length),w=this.networkToHostOrderSwap;t<x.length;){for(l=w(x[t]),f=w(x[t+1]),_=w(x[t+2]),h=w(x[t+3]),s=l^g[0],u=h^g[1],d=_^g[2],c=f^g[3],p=4,v=1;v<m;v++)i=S[s>>>24]^T[u>>16&255]^b[d>>8&255]^L[255&c]^g[p],n=S[u>>>24]^T[d>>16&255]^b[c>>8&255]^L[255&s]^g[p+1],a=S[d>>>24]^T[c>>16&255]^b[s>>8&255]^L[255&u]^g[p+2],o=S[c>>>24]^T[s>>16&255]^b[u>>8&255]^L[255&d]^g[p+3],s=i,u=n,d=a,c=o,p+=4;i=y[s>>>24]<<24^y[u>>16&255]<<16^y[d>>8&255]<<8^y[255&c]^g[p],n=y[u>>>24]<<24^y[d>>16&255]<<16^y[c>>8&255]<<8^y[255&s]^g[p+1],a=y[d>>>24]<<24^y[c>>16&255]<<16^y[s>>8&255]<<8^y[255&u]^g[p+2],o=y[c>>>24]<<24^y[s>>16&255]<<16^y[u>>8&255]<<8^y[255&d]^g[p+3],p+=3,D[t]=w(i^R),D[t+1]=w(o^I),D[t+2]=w(a^k),D[t+3]=w(n^C),R=l,I=f,k=_,C=h,t+=4}return D.buffer},e}(),d=function(){function e(e,t){this._subtle=void 0,this._key=void 0,this._subtle=e,this._key=t}return e.prototype.expandKey=function(){return this._subtle.importKey("raw",this._key,{name:"AES-CBC",length:128},!1,["encrypt","decrypt"])},e}(),c="decrypter",l=function(){function e(e,t,r){var i=(void 0===r?{}:r).removePKCS7Padding,n=void 0===i||i;if(this._logEnabled=!0,this._observer=void 0,this._config=void 0,this._removePKCS7Padding=void 0,this._subtle=null,this._softwareDecrypter=null,this._key=null,this._fastAesKey=null,this._remainderData=null,this._currentIV=null,this._currentResult=null,this._observer=e,this._config=t,this._removePKCS7Padding=n,n)try{var a=self.crypto;a&&(this._subtle=a.subtle||a.webkitSubtle)}catch(o){}null===this._subtle&&(this._config.enableSoftwareAES=!0)}var t=e.prototype;return t.isSync=function(){return this._config.enableSoftwareAES},t.flush=function(){var e=this._currentResult;if(e){var t,r,i,n=new Uint8Array(e);return this.reset(),this._removePKCS7Padding?(r=(t=n).byteLength,(i=r&&new DataView(t.buffer).getUint8(r-1))?o(t,0,r-i):t):n}this.reset()},t.reset=function(){this._currentResult=null,this._currentIV=null,this._remainderData=null,this._softwareDecrypter&&(this._softwareDecrypter=null)},t.decrypt=function(e,t,r,i){if(this._config.enableSoftwareAES){this.softwareDecrypt(new Uint8Array(e),t,r);var n=this.flush();n&&i(n.buffer)}else this.webCryptoDecrypt(new Uint8Array(e),t,r).then(i)},t.softwareDecrypt=function(e,t,r){var i,n,a,s=this._currentIV,d=this._currentResult,c=this._remainderData;this.logOnce("JS AES decrypt"),c&&(i=c,n=e,(a=new Uint8Array(i.length+n.length)).set(i),a.set(n,i.length),e=a,this._remainderData=null);var l=this.getValidChunk(e);if(!l.length)return null;s&&(r=s);var f=this._softwareDecrypter;f||(f=this._softwareDecrypter=new u),f.expandKey(t);var _=d;return this._currentResult=f.decrypt(l.buffer,0,r),this._currentIV=o(l,-16).buffer,_||null},t.webCryptoDecrypt=function(e,t,r){var i=this,n=this._subtle;return this._key===t&&this._fastAesKey||(this._key=t,this._fastAesKey=new d(n,t)),this._fastAesKey.expandKey().then((function(t){return n?new s(n,r).decrypt(e.buffer,t):Promise.reject(new Error("web crypto not initialized"))})).catch((function(n){return i.onWebCryptoError(n,e,t,r)}))},t.onWebCryptoError=function(e,t,r,i){return a.Log.w(c,"[decrypter.ts]: WebCrypto Error, disable WebCrypto API:",e),this._config.enableSoftwareAES=!0,this._logEnabled=!0,this.softwareDecrypt(t,r,i)},t.getValidChunk=function(e){var t=e,r=e.length-e.length%16;return r!==e.length&&(t=o(e,0,r),this._remainderData=o(e,r)),t},t.logOnce=function(e){this._logEnabled&&(a.Log.i(c,"[decrypter.ts]: "+e),this._logEnabled=!1)},e}(),f=r("./src/types/core.ts"),_=r("./src/types/remux.ts"),h=function(){function e(){}return e.parse=function(t,r){void 0===r&&(r=!0);var i={},n=new DataView(t.buffer,t.byteOffset).getUint32(0)!==(r?525030175:2113995134),a=6,o=new Uint8Array(1024);o.set(t.slice(0,6),0);for(var s=t.byteLength,u=[t[s-2],t[s-1]],d=6;d<s;){var c=t[d];0===u[0]&&0===u[1]&&3===c||(o[a++]=c),u[0]=u[1],u[1]=c,++d}for(var l=6,f=new DataView(o.buffer);l<a;){var _=l,h=f.getUint16(_,n);_+=2;var p=f.getUint16(_,n);_+=2;var v=f.getUint16(_,n);if(_+=2,e._readElem(f,i,_,v,h,p,n),_+=v,l+=p,!p)break}return i},e._readElem=function(t,r,i,n,a,o,s){var u=e._readString(t,i,n);switch(i+=n,a){case 1:break;case 2:r[u]=e._readString(t,i,o-4);break;case 3:r[u]=t.getUint32(i,s);break;case 4:var d=t.getUint32(i+4,s),c=t.getUint32(i,s);r[u]=Math.pow(2,32)*d+c;break;case 5:r[u]=t.getFloat32(i,s);break;case 6:r[u]=t.getFloat64(i,s)}},e._readString=function(e,t,r){for(var i="",n=t;n<t+r;n++)i+=String.fromCharCode(e.getUint8(n));return i},e}(),p=r("./src/demux/audio/adts.ts"),v=r("./src/demux/create-track.ts"),m=r("./src/utils/decode-utf8.ts"),g=function(){function e(){}return e.parseMetadata=function(t){var r={};try{var i=e.parseScript(t,0),n=e.parseScript(t,i.size);r[i.data]=n.data}catch(o){a.Log.e("AMF",o.toString())}return r},e.parseObject=function(t,r){var i=e.parseString(t,r),n=e.parseScript(t,r+i.size),a=n.objectEnd;return{data:{name:i.data,value:n.data},size:n.size,objectEnd:a}},e.parseVariable=function(t,r){return e.parseObject(t,r)},e.parseLongString=function(e,t){var r=new DataView(e,t).getUint32(0);return{data:r>0?Object(m.decodeUTF8)(new Uint8Array(e,t+4,r)):"",size:4+r}},e.parseDate=function(e,t){var r=new DataView(e,t),i=r.getFloat64(0),n=r.getInt16(8);return{data:new Date(i+=60*n*1e3),size:10}},e.parseString=function(e,t){var r=new DataView(e,t).getUint16(0);return{data:r>0?Object(m.decodeUTF8)(new Uint8Array(e,t+2,r)):"",size:2+r}},e.parseScript=function(t,r){var i=t.byteLength,n=r,o=t,s=new DataView(o,0),u=null,d=s.getUint8(n);n+=1;var c=!1;switch(d){case 0:u=s.getFloat64(n),n+=8;break;case 1:u=!!s.getUint8(n),n+=1;break;case 2:var l=e.parseString(o,n);u=l.data,n+=l.size;break;case 3:for(u={},s.getUint32(i-4);n<i-4;){var f=e.parseObject(o,n);if(f.objectEnd)break;u[f.data.name]=f.data.value,n=f.size}n<=i-3&&9==(16777215&s.getUint32(n-1))&&(n+=3);break;case 8:for(u={},n+=4,s.getUint32(i-4);n<i-8;){var _=e.parseVariable(o,n);if(_.objectEnd)break;u[_.data.name]=_.data.value,n=_.size}n<=i-3&&9==(16777215&s.getUint32(n-1))&&(n+=3);break;case 9:u=void 0,n=1,c=!0;break;case 10:u=[];var h=s.getUint32(n);n+=4;for(var p=0;p<h;p++){var v=e.parseScript(o,n);u.push(v.data),n=v.size}break;case 11:var m=e.parseDate(o,n+1);u=m.data,n+=m.size;break;case 12:var g=e.parseString(o,n+1);u=g.data,n+=g.size;break;default:n=i,a.Log.v("AMF","AMF","Unsupported AMF value type "+d)}return{data:u,size:n,objectEnd:c}},e}(),y=r("./src/demux/flv/flv.ts"),E=r("./src/io/data-cache.ts");function S(e,t){for(var r=0;r<t.length;r++){var i=t[r];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}var T,b,L,A,R=function(){function e(e){this._eventEmitter=void 0,this._cache=void 0,this._tag=void 0,this._result={tags:[]},this._parseLen=0,this._parseFunc=void 0,this._hasVideo=void 0,this._hasAudio=void 0,this._eventEmitter=e,this._cache=new E.default,this._parseLen=y.FLV_HEAD_LEN,this._parseFunc=this._parseFlvHead}var t,r,a,o=e.prototype;return o.reset=function(){this._parseLen=y.FLV_HEAD_LEN,this._parseFunc=this._parseFlvHead,this._cache.clear(),this._tag=void 0,this._result={tags:[]},this._hasAudio=void 0,this._hasVideo=void 0},o.append=function(e){for(this._result={tags:[]},this._cache.put(e);this._cache.unreadLen>=this._parseLen;)this._parseFunc();return this._result},o._parseFlvHead=function(){var e=this._cache.get(y.FLV_HEAD_LEN);e&&(70===e[0]&&76===e[1]&&86===e[2]&&1===e[3]||this._eventEmitter.emit(n.default.ERROR,{type:i.ErrorTypes.MUX_ERROR,details:i.ErrorDetails.PARSING_ERROR,fatal:!0,reason:"Flv: wrong head"}),this._hasAudio=!!((4&e[4])>>>2),this._hasVideo=!!(1&e[4]),this._result.head=e,this._parseLen=y.FLV_TAG_HEAD_LEN,this._parseFunc=this._parseFlvTagHead)},o._parseFlvTagHead=function(){this._tag=new y.FlvTag;var e=this._cache.get(y.FLV_TAG_HEAD_LEN);e&&(this._tag.tagType=e[0],this._tag.dataSize=((255&e[1])<<16)+((255&e[2])<<8)+(255&e[3]),this._tag.timestamp=((255&e[7])<<24)+((255&e[4])<<16)+((255&e[5])<<8)+(255&e[6]),this._parseFunc=this._parseFlvTag,this._parseLen=this._tag.dataSize+y.FLV_TAG_SIZE_LEN)},o._parseFlvTag=function(){var e=this._tag;e&&(e.tagType!==y.FlvTagType.SCRIPT&&e.tagType!==y.FlvTagType.AUDIO&&e.tagType!==y.FlvTagType.VIDEO||(e.body=this._cache.get(e.dataSize),this._cache.skip(4),this._result.tags.push(e),this._tag=void 0),this._parseFunc=this._parseFlvTagHead,this._parseLen=y.FLV_TAG_HEAD_LEN)},t=e,(r=[{key:"trackInfo",get:function(){return"boolean"==typeof this._hasVideo&&"boolean"==typeof this._hasAudio?{hasVideo:this._hasVideo,hasAudio:this._hasAudio}:void 0}}])&&S(t.prototype,r),a&&S(t,a),e}();(b=T||(T={}))[b.NAL_SLICE=1]="NAL_SLICE",b[b.NAL_DPA=2]="NAL_DPA",b[b.NAL_DPB=3]="NAL_DPB",b[b.NAL_DPC=4]="NAL_DPC",b[b.NAL_IDR_SLICE=5]="NAL_IDR_SLICE",b[b.NAL_SEI=6]="NAL_SEI",b[b.NAL_SPS=7]="NAL_SPS",b[b.NAL_PPS=8]="NAL_PPS",b[b.NAL_AUD=9]="NAL_AUD",b[b.NAL_END_SEQUENCE=10]="NAL_END_SEQUENCE",b[b.NAL_END_STREAM=11]="NAL_END_STREAM",b[b.NAL_FILLER_DATA=12]="NAL_FILLER_DATA",b[b.NAL_SPS_EXT=13]="NAL_SPS_EXT",b[b.NAL_AUXILIARY_SLICE=19]="NAL_AUXILIARY_SLICE",b[b.NAL_FF_IGNORE=267448321]="NAL_FF_IGNORE",b[b.PRIV_NAL_MAGIC_H264=31]="PRIV_NAL_MAGIC_H264",(A=L||(L={}))[A.NAL_UNIT_CODED_SLICE_TRAIL_N=0]="NAL_UNIT_CODED_SLICE_TRAIL_N",A[A.NAL_UNIT_CODED_SLICE_TRAIL_R=1]="NAL_UNIT_CODED_SLICE_TRAIL_R",A[A.NAL_UNIT_CODED_SLICE_TSA_N=2]="NAL_UNIT_CODED_SLICE_TSA_N",A[A.NAL_UNIT_CODED_SLICE_TSA_R=3]="NAL_UNIT_CODED_SLICE_TSA_R",A[A.NAL_UNIT_CODED_SLICE_STSA_N=4]="NAL_UNIT_CODED_SLICE_STSA_N",A[A.NAL_UNIT_CODED_SLICE_STSA_R=5]="NAL_UNIT_CODED_SLICE_STSA_R",A[A.NAL_UNIT_CODED_SLICE_RADL_N=6]="NAL_UNIT_CODED_SLICE_RADL_N",A[A.NAL_UNIT_CODED_SLICE_RADL_R=7]="NAL_UNIT_CODED_SLICE_RADL_R",A[A.NAL_UNIT_CODED_SLICE_RASL_N=8]="NAL_UNIT_CODED_SLICE_RASL_N",A[A.NAL_UNIT_CODED_SLICE_RASL_R=9]="NAL_UNIT_CODED_SLICE_RASL_R",A[A.NAL_UNIT_RESERVED_VCL_N10=10]="NAL_UNIT_RESERVED_VCL_N10",A[A.NAL_UNIT_RESERVED_VCL_R11=11]="NAL_UNIT_RESERVED_VCL_R11",A[A.NAL_UNIT_RESERVED_VCL_N12=12]="NAL_UNIT_RESERVED_VCL_N12",A[A.NAL_UNIT_RESERVED_VCL_R13=13]="NAL_UNIT_RESERVED_VCL_R13",A[A.NAL_UNIT_RESERVED_VCL_N14=14]="NAL_UNIT_RESERVED_VCL_N14",A[A.NAL_UNIT_RESERVED_VCL_R15=15]="NAL_UNIT_RESERVED_VCL_R15",A[A.NAL_UNIT_CODED_SLICE_BLA_W_LP=16]="NAL_UNIT_CODED_SLICE_BLA_W_LP",A[A.NAL_UNIT_CODED_SLICE_BLA_W_RADL=17]="NAL_UNIT_CODED_SLICE_BLA_W_RADL",A[A.NAL_UNIT_CODED_SLICE_BLA_N_LP=18]="NAL_UNIT_CODED_SLICE_BLA_N_LP",A[A.NAL_UNIT_CODED_SLICE_IDR_W_RADL=19]="NAL_UNIT_CODED_SLICE_IDR_W_RADL",A[A.NAL_UNIT_CODED_SLICE_IDR_N_LP=20]="NAL_UNIT_CODED_SLICE_IDR_N_LP",A[A.NAL_UNIT_CODED_SLICE_CRA=21]="NAL_UNIT_CODED_SLICE_CRA",A[A.NAL_UNIT_RESERVED_IRAP_VCL22=22]="NAL_UNIT_RESERVED_IRAP_VCL22",A[A.NAL_UNIT_RESERVED_IRAP_VCL23=23]="NAL_UNIT_RESERVED_IRAP_VCL23",A[A.NAL_UNIT_RESERVED_VCL24=24]="NAL_UNIT_RESERVED_VCL24",A[A.NAL_UNIT_RESERVED_VCL25=25]="NAL_UNIT_RESERVED_VCL25",A[A.NAL_UNIT_RESERVED_VCL26=26]="NAL_UNIT_RESERVED_VCL26",A[A.NAL_UNIT_RESERVED_VCL27=27]="NAL_UNIT_RESERVED_VCL27",A[A.NAL_UNIT_RESERVED_VCL28=28]="NAL_UNIT_RESERVED_VCL28",A[A.NAL_UNIT_RESERVED_VCL29=29]="NAL_UNIT_RESERVED_VCL29",A[A.NAL_UNIT_RESERVED_VCL30=30]="NAL_UNIT_RESERVED_VCL30",A[A.NAL_UNIT_RESERVED_VCL31=31]="NAL_UNIT_RESERVED_VCL31",A[A.NAL_UNIT_VPS=32]="NAL_UNIT_VPS",A[A.NAL_UNIT_SPS=33]="NAL_UNIT_SPS",A[A.NAL_UNIT_PPS=34]="NAL_UNIT_PPS",A[A.NAL_UNIT_ACCESS_UNIT_DELIMITER=35]="NAL_UNIT_ACCESS_UNIT_DELIMITER",A[A.NAL_UNIT_EOS=36]="NAL_UNIT_EOS",A[A.NAL_UNIT_EOB=37]="NAL_UNIT_EOB",A[A.NAL_UNIT_FILLER_DATA=38]="NAL_UNIT_FILLER_DATA",A[A.NAL_UNIT_PREFIX_SEI=39]="NAL_UNIT_PREFIX_SEI",A[A.NAL_UNIT_SUFFIX_SEI=40]="NAL_UNIT_SUFFIX_SEI",A[A.NAL_UNIT_RESERVED_NVCL41=41]="NAL_UNIT_RESERVED_NVCL41",A[A.NAL_UNIT_RESERVED_NVCL42=42]="NAL_UNIT_RESERVED_NVCL42",A[A.NAL_UNIT_RESERVED_NVCL43=43]="NAL_UNIT_RESERVED_NVCL43",A[A.NAL_UNIT_RESERVED_NVCL44=44]="NAL_UNIT_RESERVED_NVCL44",A[A.NAL_UNIT_RESERVED_NVCL45=45]="NAL_UNIT_RESERVED_NVCL45",A[A.NAL_UNIT_RESERVED_NVCL46=46]="NAL_UNIT_RESERVED_NVCL46",A[A.NAL_UNIT_RESERVED_NVCL47=47]="NAL_UNIT_RESERVED_NVCL47",A[A.NAL_UNIT_UNSPECIFIED_48=48]="NAL_UNIT_UNSPECIFIED_48",A[A.NAL_UNIT_UNSPECIFIED_49=49]="NAL_UNIT_UNSPECIFIED_49",A[A.NAL_UNIT_UNSPECIFIED_50=50]="NAL_UNIT_UNSPECIFIED_50",A[A.NAL_UNIT_UNSPECIFIED_51=51]="NAL_UNIT_UNSPECIFIED_51",A[A.NAL_UNIT_UNSPECIFIED_52=52]="NAL_UNIT_UNSPECIFIED_52",A[A.NAL_UNIT_UNSPECIFIED_53=53]="NAL_UNIT_UNSPECIFIED_53",A[A.NAL_UNIT_UNSPECIFIED_54=54]="NAL_UNIT_UNSPECIFIED_54",A[A.NAL_UNIT_UNSPECIFIED_55=55]="NAL_UNIT_UNSPECIFIED_55",A[A.NAL_UNIT_UNSPECIFIED_56=56]="NAL_UNIT_UNSPECIFIED_56",A[A.NAL_UNIT_UNSPECIFIED_57=57]="NAL_UNIT_UNSPECIFIED_57",A[A.NAL_UNIT_UNSPECIFIED_58=58]="NAL_UNIT_UNSPECIFIED_58",A[A.NAL_UNIT_UNSPECIFIED_59=59]="NAL_UNIT_UNSPECIFIED_59",A[A.NAL_UNIT_UNSPECIFIED_60=60]="NAL_UNIT_UNSPECIFIED_60",A[A.NAL_UNIT_UNSPECIFIED_61=61]="NAL_UNIT_UNSPECIFIED_61",A[A.NAL_UNIT_UNSPECIFIED_62=62]="NAL_UNIT_UNSPECIFIED_62",A[A.PRIV_NAL_MAGIC_HEVC=63]="PRIV_NAL_MAGIC_HEVC",A[A.NAL_UNIT_INVALID=64]="NAL_UNIT_INVALID";var I=r("./src/utils/uint8-array-tools.ts");function k(e){for(var t,r=e.byteLength,i=[],n=1,a=null;n<r-2;)0===e[n]&&0===e[n+1]&&3===e[n+2]?(i.push(n+2),n+=2):n++;if(0===i.length)return e;t=r-i.length,a=new Uint8Array(t);var o=0;for(n=0;n<t;o++,n++)o===i[0]&&(o++,i.shift()),a[n]=e[o];return a}function C(e,t){for(var r=0;r<t.length;r++){var i=t[r];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}var x=function(){function e(e){this._buffer=void 0,this._buffer_index=void 0,this._total_bytes=void 0,this._total_bits=void 0,this._current_word=void 0,this._current_word_bits_left=void 0,this._buffer=e,this._buffer_index=0,this._total_bytes=e.byteLength,this._total_bits=8*e.byteLength,this._current_word=0,this._current_word_bits_left=0}var t,r,i,n=e.prototype;return n.destroy=function(){this._buffer=null},n._fillCurrentWord=function(){var e=this._total_bytes-this._buffer_index;if(e<=0||!this._buffer)throw new Error("ExpGolomb: _fillCurrentWord() but no bytes available");var t=Math.min(4,e),r=new Uint8Array(4);r.set(this._buffer.subarray(this._buffer_index,this._buffer_index+t)),this._current_word=new DataView(r.buffer).getUint32(0,!1),this._buffer_index+=t,this._current_word_bits_left=8*t},n.readBits=function(e){if(e>32)throw new Error("ExpGolomb: readBits() bits exceeded max 32bits!");if(e<=this._current_word_bits_left){var t=this._current_word>>>32-e;return this._current_word<<=e,this._current_word_bits_left-=e,t}var r=this._current_word_bits_left?this._current_word:0;r>>>=32-this._current_word_bits_left;var i=e-this._current_word_bits_left;this._fillCurrentWord();var n=Math.min(i,this._current_word_bits_left),a=this._current_word>>>32-n;return this._current_word<<=n,this._current_word_bits_left-=n,r=r<<n|a},n.readBool=function(){return 1===this.readBits(1)},n.readUByte=function(){return this.readBits(8)},n.readUShort=function(){return this.readBits(16)},n.readUInt=function(){return this.readBits(32)},n.readByte=function(){return this.readBits(8)},n._skipLeadingZero=function(){var e;for(e=0;e<this._current_word_bits_left;e++)if(0!=(this._current_word&2147483648>>>e))return this._current_word<<=e,this._current_word_bits_left-=e,e;return this._fillCurrentWord(),e+this._skipLeadingZero()},n.readUEG=function(){var e=this._skipLeadingZero();return this.readBits(e+1)-1},n.readSEG=function(){var e=this.readUEG();return 1&e?e+1>>>1:-1*(e>>>1)},n.readSliceType=function(){return this.readUByte(),this.readUEG(),this.readUEG()},n.getBitsLeft=function(){return 8*(this._total_bytes-this._buffer_index)+this._current_word_bits_left},t=e,(r=[{key:"bytesAvailable",get:function(){return this._total_bytes-this._buffer_index}}])&&C(t.prototype,r),i&&C(t,i),e}(),D=function(){function e(){}return e.parseHEVCPPS=function(e){var t,r,i=k(e),n=new x(i),a={parallelismType:0};return n.readUEG(),n.readUEG(),n.readBits(7),n.readUEG(),n.readUEG(),n.readSEG(),n.readBits(2),n.readBits(1)&&n.readUEG(),n.readSEG(),n.readSEG(),n.readBits(4),t=n.readBits(1),r=n.readBits(1),a.parallelismType=r&&t?0:r?3:t?2:1,a},e}(),w=r("./src/demux/video/color-space.ts"),O={1:"Main",2:"Main 10",3:"Main Still Picture",4:"Rext"},P={30:"1",60:"2",63:"2.1",90:"3",93:"3.1",120:"4",123:"4.1",150:"5",153:"5.1",156:"5.2",180:"6",183:"6.1",186:"6.2",255:"8.5"},N=function(){function e(){}return e.parseHEVCSPS=function(t){var r=k(t),i=new x(r),n={general_ptl:this.getGeneralPTL(),sub_layer_ptl:[],sub_layer_profile_present_flag:[],sub_layer_level_present_flag:[]};i.readBits(16),i.readBits(4);var a=i.readBits(3),o=a+1;if(i.readBits(1),!e._parsePTL(i,n,o))return null;var s={chroma_format_idc:0,chroma_format_string:"",profile_string:"",level_string:"",bit_depth_luma_minus8:0,bit_depth_chroma_minus8:0,fps:0,width:0,height:0,codec:"",color_info:{colorRange:w.AVColorRange.AVCOL_RANGE_MPEG,colourPrimaries:2,transferCharacteristics:0,matrixCoefficients:0},min_spatial_segmentation_idc:0,ptl:n};if(i.readUEG()>=16)return null;var u=i.readUEG();3==u&&i.readBits(1)&&(u=0),s.width=i.readUEG(),s.height=i.readUEG(),i.readBits(1)&&(i.readUEG(),i.readUEG(),i.readUEG(),i.readUEG()),s.bit_depth_luma_minus8=i.readUEG(),s.bit_depth_chroma_minus8=i.readUEG();for(var d=i.readUEG(),c=i.readBits(1)?0:a;c<=a;c++)i.readUEG(),i.readUEG(),i.readUEG();i.readUEG(),i.readUEG(),i.readUEG(),i.readUEG(),i.readUEG(),i.readUEG(),i.readBits(1)&&i.readBits(1)&&this.skipScalingListData(i),i.readBits(1),i.readBits(1),i.readBits(1)&&(i.readBits(4),i.readBits(4),i.readUEG(),i.readUEG(),i.readBits(1));var l=i.readUEG();if(l>64)return null;for(var f=[],_=0;_<l;_++)if(this.parseRps(i,_,l,f)<0)return null;if(i.readBits(1)){var h=i.readUEG();if(h>31)return null;for(c=0;c<h;c++){var p=Math.min(d+4,16);i.readBits(p),i.readBits(1)}}return i.readBits(1),i.readBits(1),i.readBits(1)&&this.hvccParseVui(i,s,a),i.destroy(),i=null,s.chroma_format_idc=u,s.chroma_format_string=3===u?"4:4:4":"4:2:0",s.profile_string=n.general_ptl.profile_string,s.level_string=n.general_ptl.level_string,s.codec=this.getCodec(n.general_ptl),s},e._parsePTL=function(e,t,r){if(!this._decodeProfileTierLevel(e,t.general_ptl)||e.getBitsLeft()<8+16*(r-1>0?1:0))return!1;t.general_ptl.level_idc=e.readBits(8),t.general_ptl.level_string=this.getHEVCLevelString(t.general_ptl.level_idc),t.sub_layer_profile_present_flag=[],t.sub_layer_level_present_flag=[];for(var i=0;i<r-1;i++)t.sub_layer_profile_present_flag[i]=e.readBits(1),t.sub_layer_level_present_flag[i]=e.readBits(1);if(r-1>0)for(var n=r-1;n<8;n++)e.readBits(2);for(var a=0;a<r-1;a++){if(t.sub_layer_ptl[a]=this.getGeneralPTL(),t.sub_layer_profile_present_flag[a]&&this._decodeProfileTierLevel(e,t.sub_layer_ptl[a]))return!1;if(t.sub_layer_level_present_flag[a]){if(e.getBitsLeft()<8)return!1;t.sub_layer_ptl[a].level_idc=e.readBits(8)}}return!0},e._decodeProfileTierLevel=function(e,t){if(e.getBitsLeft()<88)return!1;t.profile_space=e.readBits(2),t.tier_flag=e.readBits(1),t.profile_idc=e.readBits(5),t.profile_compatibility_flag=[];for(var r=0;r<32;r++)t.profile_compatibility_flag[r]=e.readBits(1),t.profile_compatibility=(t.profile_compatibility_flag[r]<<31-r)+t.profile_compatibility,0==t.profile_idc&&r>0&&t.profile_compatibility_flag[r]&&(t.profile_idc=r);for(var i=0;i<6;i++)t.constraint_indicator.push(e.readBits(8));return t.profile_string=this.getHEVCProfileString(t.profile_idc),!0},e.parseSPS=function(t){var r=k(t),i=new x(r);i.readByte();var n=i.readByte();i.readByte();var a=i.readByte();i.readUEG();var o=e.getProfileString(n),s=e.getLevelString(a),u=1,d=420,c=8,l=0;if((100===n||110===n||122===n||244===n||44===n||83===n||86===n||118===n||128===n||138===n||144===n)&&(3===(u=i.readUEG())&&i.readBits(1),u<=3&&(d=[0,420,422,444][u]),c=i.readUEG(),l=i.readUEG(),i.readBits(1),i.readBool()))for(var f=3!==u?8:12,_=0;_<f;_++)i.readBool()&&(_<6?e._skipScalingList(i,16):e._skipScalingList(i,64));i.readUEG();var h=i.readUEG();if(0===h)i.readUEG();else if(1===h){i.readBits(1),i.readSEG(),i.readSEG();for(var p=i.readUEG(),v=0;v<p;v++)i.readSEG()}i.readUEG(),i.readBits(1);var m=i.readUEG(),g=i.readUEG(),y=i.readBits(1);0===y&&i.readBits(1),i.readBits(1);var E=0,S=0,T=0,b=0;i.readBool()&&(E=i.readUEG(),S=i.readUEG(),T=i.readUEG(),b=i.readUEG());var L=1,A=1,R=0,I=!0,C=0,D=0,O=w.AVColorRange.AVCOL_RANGE_MPEG,P=2,N=0,M=0;if(i.readBool()){if(i.readBool()){var U=i.readByte();U>0&&U<16?(L=[1,12,10,16,40,24,20,32,80,18,15,64,160,4,3,2][U-1],A=[1,11,11,11,33,11,11,11,33,11,11,33,99,3,2,1][U-1]):255===U&&(L=i.readByte()<<8|i.readByte(),A=i.readByte()<<8|i.readByte())}if(i.readBool()&&i.readBool(),i.readBool()&&(i.readBits(3),O=i.readBits(1)?w.AVColorRange.AVCOL_RANGE_JPEG:w.AVColorRange.AVCOL_RANGE_MPEG,i.readBool()&&(P=i.readBits(8),N=i.readBits(8),M=i.readBits(8))),i.readBool()&&(i.readUEG(),i.readUEG()),i.readBool()){var B=i.readBits(32),F=i.readBits(32);I=i.readBool(),R=(C=F)/(D=2*B)}}var V=1;1===L&&1===A||(V=L/A);var H=0,j=0;0===u?(H=1,j=2-y):(H=3===u?1:2,j=(1===u?2:1)*(2-y));var G=16*(m+1),K=16*(g+1)*(2-y);G-=(E+S)*H,K-=(T+b)*j;var W=Math.ceil(G*V);i.destroy(),i=null;for(var q=t.subarray(1,4),z="avc1.",Y=0;Y<3;Y++){var X=q[Y].toString(16);X.length<2&&(X="0"+X),z+=X}return{profile_string:o,level_string:s,bit_depth_luma_minus8:c,bit_depth_chroma_minus8:l,chroma_format:d,chroma_format_string:e.getChromaFormatString(d),frame_rate:{fixed:I,fps:R,fps_den:D,fps_num:C},sar_ratio:{width:L,height:A},codec_size:{width:G,height:K},present_size:{width:W,height:K},color_info:{colorRange:O,colourPrimaries:P,transferCharacteristics:N,matrixCoefficients:M},codec:z}},e._skipScalingList=function(e,t){for(var r=8,i=8,n=0;n<t;n++)0!==i&&(i=(r+e.readSEG()+256)%256),r=0===i?r:i},e.getProfileString=function(e){switch(e){case 66:return"Baseline";case 77:return"Main";case 88:return"Extended";case 100:return"High";case 110:return"High10";case 122:return"High422";case 244:return"High444";default:return"Unknown"}},e.getLevelString=function(e){return(e/10).toFixed(1)},e.getChromaFormatString=function(e){switch(e){case 420:return"4:2:0";case 422:return"4:2:2";case 444:return"4:4:4";default:return"Unknown"}},e.getHEVCProfileString=function(e){return O[e]},e.getHEVCLevelString=function(e){return P[e]},e.getCodec=function(e){for(var t=e.profile_compatibility.toString(16);t.length>1;){var r=t.length-1;if("0"!==t.charAt(r))break;t=t.slice(0,r)}for(var i="",n=!1,a=5;a>=0;a--)(e.constraint_indicator[a]||n)&&(i="."+e.constraint_indicator[a].toString(16)+i,n=!0);return"hev1."+["","A","B","C"][e.profile_space]+e.profile_idc+"."+t+"."+(0===e.tier_flag?"L":"H")+e.level_idc+i},e.getGeneralPTL=function(){return{profile_space:0,tier_flag:0,profile_idc:0,profile_compatibility:0,profile_compatibility_flag:[],constraint_indicator:[],level_idc:0,profile_string:"",level_string:""}},e.skipScalingListData=function(e){var t,r,i,n;for(t=0;t<4;t++)for(r=0;r<(3==t?2:6);r++)if(e.readBits(1))for(n=Math.min(64,1<<4+(t<<1)),t>1&&e.readSEG(),i=0;i<n;i++)e.readSEG();else e.readUEG()},e.parseRps=function(e,t,r,i){var n;if(t&&e.readBits(1)){if(t>=r)return-1;for(e.readBits(1),e.readUEG(),i[t]=0,n=0;n<=i[t-1];n++){var a=0,o=e.readBits(1);o||(a=e.readBits(1)),(o||a)&&i[t]++}}else{var s=e.readUEG(),u=e.readUEG();if(2*(u+s)>e.getBitsLeft())return-1;for(i[t]=s+u,n=0;n<s;n++)e.readUEG(),e.readBits(1);for(n=0;n<u;n++)e.readUEG(),e.readBits(1)}return 0},e.hvccParseVui=function(e,t,r){var i;e.readBits(1)&&255===e.readBits(8)&&e.readBits(32),e.readBits(1)&&e.readBits(1),e.readBits(1)&&(e.readBits(3),e.readBits(1),e.readBits(1)&&(t.color_info.colourPrimaries=e.readBits(8),t.color_info.transferCharacteristics=e.readBits(8),t.color_info.matrixCoefficients=e.readBits(8))),e.readBits(1)&&(e.readUEG(),e.readUEG()),e.readBits(3),e.readBits(1)&&(e.readUEG(),e.readUEG(),e.readUEG(),e.readUEG()),e.readBits(1)&&(this.parseTimingInfo(e,t),e.readBits(1)&&this.skipHrdParameters(e,1,r)),e.readBits(1)&&(e.readBits(3),i=e.readUEG(),t.min_spatial_segmentation_idc=Math.min(t.min_spatial_segmentation_idc,i),e.readUEG(),e.readUEG(),e.readUEG(),e.readUEG())},e.parseTimingInfo=function(e,t){var r=e.readBits(32),i=e.readBits(32);t.fps=i/r||0,e.readBits(1)&&e.readUEG()},e.skipHrdParameters=function(e,t,r){var i,n=0,a=0,o=0;for(t&&(a=e.readBits(1),o=e.readBits(1),(a||o)&&((n=e.readBits(1))&&e.readBits(19),e.readBits(8),n&&e.readBits(4),e.readBits(15))),i=0;i<=r;i++){var s=0,u=0,d=0;if(e.readBits(1)||(d=e.readBits(1)),d?e.readUEG():u=e.readBits(1),!u&&(s=e.readUEG())>31)return-1;a&&this._skipSubLayerHrdParameters(e,s,n),o&&this._skipSubLayerHrdParameters(e,s,n)}return 0},e._skipSubLayerHrdParameters=function(e,t,r){var i;for(i=0;i<=t;i++)e.readUEG(),e.readUEG(),r&&(e.readUEG(),e.readUEG()),e.readBits(1)},e}(),M="video-config",U=function(){function e(){}return e.parseAVCC=function(e){var t=e[0],r=e[1],i=e[2],n=e[3];if(1===t&&0!==r){var o=1+(3&e[4]);if(3===o||4===o){var s=31&e[5];if(0!==s){s>1&&a.Log.w(M,"H264 SPS count: "+s);for(var u=6,d=[],c=[],l=[],f=0;f<s;f++){var _=Object(I.readUint16)(e,u);if(u+=2,0!==_){var h=e.subarray(u,u+_);u+=_,d.push(h),c.push(N.parseSPS(h));var p=e[u];if(0===p)return void a.Log.e(M,"Invalid H264 PPS count: "+p);p>1&&a.Log.w(M,"H264 PPS count: "+p),u++;for(var v=0;v<p;v++){var m=Object(I.readUint16)(e,u);u+=2;var g=e.subarray(u,u+m);l.push(g),0!==m&&(u+=m)}}}return{version:t,avcProfile:r,profileCompatibility:i,avcLevel:n,naluLengthSize:o,spsList:d,ppsList:l,spsConfigList:c}}a.Log.e(M,"Invalid H264 SPS count: "+s)}else a.Log.e(M,"MP4: Strange NaluLengthSizeMinusOne: "+(o-1))}else a.Log.e(M,"Invalid AVCDecoderConfigurationRecord")},e.parseHVCC=function(e){var t=22,r=e[t];t++;for(var i=[],n=[],o=[],s=[],u=[],d=0;d<r;d++){var c=63&e[t];t+=1;var l=Object(I.readUint16)(e,t);t+=2;for(var f=0;f<l;f++){var _=Object(I.readUint16)(e,t);if(t+=2,0!==_){var h=e.subarray(t,t+_);if(c===L.NAL_UNIT_VPS)a.Log.v(M,"VPS lengh "+_),u.push(h);else if(c===L.NAL_UNIT_SPS){a.Log.v(M,"SPS lengh "+_),i.push(h);var p=N.parseHEVCSPS(h);p&&n.push(p)}else if(c===L.NAL_UNIT_PPS){o.push(h),a.Log.v(M,"PPS lengh "+_);var v=D.parseHEVCPPS(h);v&&s.push(v)}t+=_}}}return{vpsList:u,spsList:i,ppsList:o,spsConfigList:n,ppsConfigList:s}},e}(),B=function(){function e(){}return e.isAVCTrackUpdate=function(e,t){return!!e.codec&&(e.width!==t.codec_size.width||e.height!==t.codec_size.height||t.codec!==e.codec)},e.updateAVCTrack=function(e,t){if(t.spsConfigList.length){var r=t.spsConfigList[t.spsConfigList.length-1];e.sps=t.spsList,e.pps=t.ppsList,e.width=r.codec_size.width,e.height=r.codec_size.height,e.pixelRatio=[r.sar_ratio.width,r.sar_ratio.height],r.frame_rate.fixed&&0!==r.frame_rate.fps&&(e.fps=r.frame_rate.fps),e.codec=r.codec,e.profile=r.profile_string,e.level=r.level_string,e.chromaFormat=r.chroma_format_string,e.bitDepth=r.bit_depth_luma_minus8+8,e.colorInfo=r.color_info,e.fps&&(e.sampleDuration=Math.floor(e.timescale/e.fps))}},e.isHEVCTrackUpdate=function(e,t){return!!e.codec&&(e.width!==t.width||e.height!==t.height||t.codec!==e.codec)},e.updateHEVCTrack=function(e,t){if(t.spsConfigList.length){var r=t.spsConfigList[t.spsConfigList.length-1];e.sps=t.spsList,e.pps=t.ppsList,e.width=e.codecWidth=r.width,e.height=e.codecHeight=r.height,e.codec=r.codec,e.profile=r.profile_string,e.level=r.level_string,e.chromaFormat=r.chroma_format_string,e.bitDepth=r.bit_depth_luma_minus8+8,e.fps=r.fps,e.colorInfo=r.color_info}},e}();function F(){return(F=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var i in r)Object.prototype.hasOwnProperty.call(r,i)&&(e[i]=r[i])}return e}).apply(this,arguments)}function V(e,t){for(var r=0;r<t.length;r++){var i=t[r];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}var H="flv-demuxer",j=function(){var e,t,r;function o(e,t,r,i){this._eventEmitter=void 0,this._remuxer=void 0,this._config=void 0,this._duration=1/0,this._naluLengthSize=4,this._videoTrack=void 0,this._audioTrack=void 0,this._remuxStat=void 0,this._firstRemux=!0,this._currentTimestamp=0,this._aLastDTS=void 0,this._vLastDTS=void 0,this._typeSupported=void 0,this._transmuxData=void 0,this._tagDump=void 0,this._gopRemux=!1,this._timeExceptionInfo=void 0,this._lastKeyFrame=void 0,this._firstVideoTag=!1,this._eventEmitter=e,this._remuxer=t,this._config=r,this._typeSupported=i,this._gopRemux=!!this._config.gopRemux,this._videoTrack=Object(v.createVideoTrack)(1/0),this._audioTrack=Object(v.createAudioTrack)(1/0),this._tagDump=new R(this._eventEmitter)}o.probe=function(e){return e.byteLength>=3&&70===e[0]&&76===e[1]&&86===e[2]},e=o,r=[{key:"probeSize",get:function(){return 188}}],(t=null)&&V(e.prototype,t),r&&V(e,r);var s=o.prototype;return s.append=function(e,t,r,i,a){var o=this;if(void 0===a&&(a=!1),!e.byteLength&&a)return this._gopRemux?this._onGOPEnd():this._remux(a),this._tagDump.reset(),void this._eventEmitter.emit(n.default.PARSED_DATA,{extra:this._transmuxData});var s=this._tagDump.append(e),u=this._tagDump.trackInfo;void 0===this._videoTrack.active&&u&&(this._videoTrack.active=u.hasVideo,this._audioTrack.active=u.hasAudio,this._videoTrack.active||(this._gopRemux=!1));var d=s.tags;s.head&&this._eventEmitter.emit(n.default.FLV_HEAD,{head:s.head}),this._remuxStat||(this._remuxStat={timeOffset:t,contiguous:r,accurateTimeOffset:i}),d.length&&(d.forEach((function(e){e.tagType===y.FlvTagType.VIDEO&&o._videoTrack.active&&(o._firstVideoTag||(o._audioTrack.samples.length&&o._discontinuity(),o._firstVideoTag=!0),o._parseVideoData(e)),e.tagType===y.FlvTagType.AUDIO&&o._audioTrack.active&&o._parseAudioData(e),e.tagType===y.FlvTagType.SCRIPT&&o._parseScriptTag(e)})),this._gopRemux||this._remux(a),a&&(this._tagDump.reset(),this._eventEmitter.emit(n.default.PARSED_DATA,{extra:this._transmuxData})))},s.destroy=function(){},s.flush=function(){this._remux(!0),this._remuxStat=void 0},s.resetInitSegment=function(e){this._transmuxData=e,this._firstRemux=!0,this._videoTrack.samples=[],this._audioTrack.samples=[],this._aLastDTS=this._vLastDTS=void 0,this._remuxStat=void 0,this._duration=e.duration,this._lastKeyFrame=void 0,this._timeExceptionInfo=void 0,"boolean"==typeof e.hasAudio&&"boolean"==typeof e.hasVideo&&(this._audioTrack.active=e.hasAudio,this._videoTrack.active=e.hasVideo,this._videoTrack.active||(this._gopRemux=!1)),this._tagDump.reset()},s.resetTimeStamp=function(){},s._discontinuity=function(){this._remux(!0),this._remuxer.ISGenerated&&this._transmuxData&&this._remuxer.resetInitSegment(this._transmuxData)},s._isTimeException=function(e,t,r){return r<t||r-t>1e3},s._checkTimestamp=function(e,t,r){this._isTimeException(e,t,r)&&(this._gopRemux=!0,this._timeExceptionInfo?this._timeExceptionInfo.list.push({aDTS:this._aLastDTS,vDTS:this._vLastDTS}):(this._timeExceptionInfo={list:[{aDTS:this._aLastDTS,vDTS:this._vLastDTS}]},(this._videoTrack.active&&"number"==typeof this._vLastDTS||this._audioTrack.active&&"number"==typeof this._aLastDTS)&&this._remux(!0)))},s._onGOPEnd=function(){this._gopRemux&&(a.Log.v(H,"gop end"),this._timeExceptionInfo&&this._videoTrack.active&&this._videoTrack.samples.length?(this._fixTime(),this._timeExceptionInfo=void 0,this._gopRemux=!!this._config.gopRemux):this._remux(!0))},s._resetTrackSamples=function(e){var t=e.samples;if(t.length>1)for(var r=e.sampleDuration||1,i=t[t.length-1],n=t.length-2;n>=0;n--){var a=t[n].pts-t[n].dts;t[n].dts=i.dts-r,t[n].pts=t[n].dts+a,i=t[n]}},s._fixTime=function(){this._timeExceptionInfo&&(this._videoTrack.samples,this._timeExceptionInfo.list.length>1&&(this._resetTrackSamples(this._videoTrack),this._resetTrackSamples(this._audioTrack)));var e=this._remuxer.getLastPTS(),t=0===e.audio||e.video>0&&e.video<e.audio?e.video:e.audio;a.Log.i(H,"fix offset",t),this._remuxStat={accurateTimeOffset:!0,contiguous:!1,timeOffset:t},this._transmuxData&&this._remuxer.resetInitSegment(this._transmuxData),this._remuxer.resetTimeStamp(),this._audioTrack.samples.length&&(this._aLastDTS=1e3*this._audioTrack.samples[this._audioTrack.samples.length-1].dts/this._audioTrack.inputTimescale),this._videoTrack.samples.length&&(this._vLastDTS=1e3*this._videoTrack.samples[this._videoTrack.samples.length-1].dts/this._videoTrack.inputTimescale),this._remux(!0)},s._parseScriptTag=function(e){if(e.body){var t=g.parseMetadata(e.body.buffer);if(t.timestamp=this._currentTimestamp||0,t.hasOwnProperty("onMetaData")){var r=t.onMetaData;if("number"==typeof r.duration&&(this._duration=this._duration||r.duration),"number"==typeof r.framerate&&(this._videoTrack.fps=this._videoTrack.fps||r.framerate),r.keyframes&&r.keyframes.filepositions&&Array.isArray(r.keyframes.filepositions)&&r.keyframes.times&&Array.isArray(r.keyframes.times)&&r.keyframes.filepositions.length===r.keyframes.times.length){var i=[];r.keyframes.times.forEach((function(e,t){i.push({time:e,position:r.keyframes.filepositions[t]})})),r.keyframes=i}a.Log.i(H,"Parsed onMetaData"),this._eventEmitter.emit(n.default.METADATA,r)}}},s._parseVideoData=function(e){if(e.body){var t=e.body[0];e.frameType=(240&t)>>>4;var r=15&t;if(7===r||12===r){e.codecId=r;var o=e.body[1];if(e.cts=((255&e.body[2])<<16)+((255&e.body[3])<<8)+(255&e.body[4]),8388608&e.cts&&(e.cts=e.cts+1-16777215),e.cts<0&&(e.cts=0),0===o)7===r?this._parseAVCDecoderConfigurationRecord(e):12===r&&(this._typeSupported.h265?(this._config.gopRemux=this._gopRemux=!0,this._parseHEVCDecoderConfigurationRecord(e)):(this._videoTrack.active=!1,a.Log.w("HEVC stream type found, not supported for now")));else if(1===o){if(!this._videoTrack.codec)return;var s=this._parseAVCVideoData(e)||{};1===e.frameType&&(s.timestamp=e.timestamp,s.ptsOrignMs=e.timestamp+e.cts,this._eventEmitter.emit(n.default.PRIV_NAL,s))}else if(2!==o)return void this._eventEmitter.emit(n.default.ERROR,{type:i.ErrorTypes.MUX_ERROR,details:i.ErrorDetails.PARSING_ERROR,fatal:!0,reason:"Flv: Invalid video packet type "+o})}else this._eventEmitter.emit(n.default.ERROR,{type:i.ErrorTypes.MUX_ERROR,details:i.ErrorDetails.PARSING_ERROR,fatal:!0,reason:"Flv: Unsupported codec in video frame: "+r})}},s._parseHEVCDecoderConfigurationRecord=function(e){if(e.body){var t=this._videoTrack,r=e.body.subarray(y.FLV_VIDEO_TAG_HEAD_LEN,e.body.byteLength),a=U.parseHVCC(r);a&&a.spsConfigList.length?(B.isHEVCTrackUpdate(t,a.spsConfigList[a.spsConfigList.length-1])&&this._discontinuity(),B.updateHEVCTrack(t,a),t.hvcc=r,t.duration=this._duration):this._eventEmitter.emit(n.default.ERROR,{type:i.ErrorTypes.MUX_ERROR,details:i.ErrorDetails.PARSING_ERROR,fatal:!0,reason:"Invalid HEVCDecoderConfigurationRecord"})}},s._parseAVCDecoderConfigurationRecord=function(e){if(e.body){var t=this._videoTrack,r=U.parseAVCC(e.body.subarray(y.FLV_VIDEO_TAG_HEAD_LEN,e.body.byteLength));r&&r.spsConfigList.length?(B.isAVCTrackUpdate(t,r.spsConfigList[r.spsConfigList.length-1])&&this._discontinuity(),B.updateAVCTrack(t,r),t.duration=this._duration):this._eventEmitter.emit(n.default.ERROR,{type:i.ErrorTypes.MUX_ERROR,details:i.ErrorDetails.PARSING_ERROR,fatal:!0,reason:"Invalid AVCDecoderConfigurationRecord"})}},s._parseAVCVideoData=function(e){if(e.body){var t,r=e.body.buffer,i=e.body.byteLength-y.FLV_VIDEO_TAG_HEAD_LEN,n=new DataView(r,y.FLV_VIDEO_TAG_HEAD_LEN,i),o=[],s=0,u=0,d=this._naluLengthSize,c=e.timestamp,l=c+e.cts,_=1===e.frameType;for(_&&this._onGOPEnd(),"number"==typeof this._vLastDTS&&this._checkTimestamp(f.TrackType.VIDEO,this._vLastDTS,c);u<i;){if(u+4>=i){a.Log.v(H,"Malformed Nalu near timestamp "+c+", offset = "+u+", dataSize = "+i);break}var p=n.getUint32(u);if(3===d&&(p>>>=8),p>i-d)return void a.Log.v(H,"Malformed Nalus near timestamp "+c+", NaluSize > DataSize!");var v=new Uint8Array(r,y.FLV_VIDEO_TAG_HEAD_LEN+u+4,d+p-4),m=void 0;if(7===e.codecId){if((m=31&n.getUint8(u+d))===T.NAL_IDR_SLICE)_=!0;else if(m===T.PRIV_NAL_MAGIC_H264)try{t=h.parse(v,!0)}catch(b){a.Log.w(H,"PrivNal parse error "+b)}}else if(12===e.codecId)if((m=(126&n.getUint8(u+d))>>1)===L.NAL_UNIT_CODED_SLICE_IDR_W_RADL||m===L.NAL_UNIT_CODED_SLICE_IDR_N_LP||m===L.NAL_UNIT_CODED_SLICE_CRA)_=!0;else if(m===L.PRIV_NAL_MAGIC_HEVC)try{t=h.parse(v,!1)}catch(b){a.Log.w(H,"PrivNal parse error "+b)}var g={type:m,data:v};o.push(g),s+=v.byteLength,u+=d+p}if(o.length){var E=this._videoTrack,S={units:o,length:s,dts:90*c,cts:90*e.cts,pts:90*l,streamDTS:e.timestamp,key:_,extraInfo:{dtsOrignMs:c,ptsOrignMs:c+e.cts,parseMs:0}};self.performance&&(S.extraInfo.parseMs=performance.now()),S.key&&(this._lastKeyFrame=F({},S)),E.samples.push(S)}return this._vLastDTS=c,t}},s._parseAudioData=function(e){var t;if(e.body)if(e.body.byteLength<=1)a.Log.v(H,"Flv: Invalid audio packet, missing SoundData payload!");else{var r=this._audioTrack,i=e.body[0]>>4;if(10!==i)return a.Log.w(H,"audio unsupported codec "+i),void(r.active=!1);var n=e.body[1];if(0===n){if(e.body.byteLength<4)return;var o=e.body.subarray(2,4);return(p.isUpdate(r,o)||!r.configParsed)&&r.codec&&r.samples.length&&this._discontinuity(),p.initTrackConfig(r,this._eventEmitter,o,_.AudioConfigType.ASC,this._config.audioCodec),void(r.duration=this._duration)}if(1===n&&r.samplerate){var s=e.body.subarray(2),u=e.timestamp;t=r.sampleDuration/90,"number"==typeof this._aLastDTS&&(this._videoTrack.active?(this._checkTimestamp(f.TrackType.AUDIO,this._aLastDTS,e.timestamp),this._timeExceptionInfo||(u=this._aLastDTS+t)):u=this._aLastDTS+t);var d=u/1e3*r.inputTimescale,c={unit:s,dts:d,pts:d,streamDTS:e.timestamp,length:s.byteLength,extraInfo:{dtsOrignMs:u,ptsOrignMs:u,parseMs:0}};self.performance&&(c.extraInfo.parseMs=performance.now()),this._aLastDTS=u,r.samples.push(c)}else a.Log.v(H,"Flv: Unsupported AAC data type "+n)}},s._remux=function(e){void 0===e&&(e=!1);var t=this._audioTrack,r=this._videoTrack,o=!0,s=0,u=!1;if(this._remuxStat&&(o=this._remuxStat.contiguous,s=this._remuxStat.timeOffset,u=this._remuxStat.accurateTimeOffset),0!==t.samples.length||0!==r.samples.length)if(e||!(this._audioTrack.active&&0===t.samples.length||this._videoTrack.active&&r.samples.length<2)){this._firstRemux&&(this._firstRemux=!1,this._eventEmitter.emit(n.default.MEDIA_DEMUX,{type:_.DemuxerType.FLV}));try{this._remuxer.remux(t,r,s,o,u,e),this._remuxStat=void 0}catch(d){a.Log.e(H,d),this._eventEmitter.emit(n.default.ERROR,{type:i.ErrorTypes.MUX_ERROR,details:i.ErrorDetails.REMUX_ERROR,fatal:!0,reason:d.message})}}else(t.configParsed&&this._getTrackDuration(t)>30||r.codec&&this._getTrackDuration(r)>30)&&this._remux(!0);else e&&this._remuxer.flush()},s._getTrackDuration=function(e){return e.samples.length?(e.samples[e.samples.length-1].pts-e.samples[0].pts)/9e4:0},o}(),G=r("./src/remux/mp4-remuxer.ts");function K(e,t){for(var r=0;r<t.length;r++){var i=t[r];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}var W,q,z=function(){function e(e,t,r,i){this._eventEmitter=void 0,this._transmuxData=void 0,this._eventEmitter=e}var t,r,i,a=e.prototype;return a.destroy=function(){},a.resetTimeStamp=function(){},a.resetInitSegment=function(e){this._transmuxData=e},a.flush=function(){},a.getLastPTS=function(){},a.remux=function(e,t,r,i,a,o,s){if(void 0===s&&(s=void 0),s){var u={payload:s,startPTS:r,startDTS:r,endPTS:0,endDTS:0,type:e?f.TrackType.AUDIO:f.TrackType.VIDEO,streamDTS:0,framesInfo:[]};this._eventEmitter.emit(n.default.PARSING_DATA,{segments:[u],extra:this._transmuxData})}},t=e,(r=[{key:"ISGenerated",get:function(){return!0}}])&&K(t.prototype,r),i&&K(t,i),e}(),Y=function(){function e(){}return e.parseOneDescriptor=function(t){var r,i,n=0;for(r=t.data[t.pos],i=t.data[t.pos+1],t.pos+=2;128&i;)n=(127&i)<<7,i=t.data[t.pos],t.pos++;n+=127&i;var a=t.data.subarray(t.pos,t.pos+n);return 3===r?e._parseESDesc(t):4===r?e._parseDecoderConfigDescriptor(t):(t.pos+=n,{tag:r,data:a})},e.getAudioConfig=function(t){if(5===t.tag)return t.data;if(t.descs&&t.descs.length)for(var r=0;r<t.descs.length;r++){var i=e.getAudioConfig(t.descs[r]);if(i)return i}},e._parseESDesc=function(t){var r=Object(I.readUint16)(t.data,t.pos);t.pos+=2;var i=t.data[t.pos];t.pos++;var n=0;128&i&&(n=Object(I.readUint16)(t.data,t.pos),t.pos+=2);var a="";if(64&i){var o=t.data[t.pos];a=Object(I.bin2str)(t.data,t.pos+1,o),t.pos+=o+1}var s=0;32&i&&(s=Object(I.readUint16)(t.data,t.pos),t.pos+=2);var u={tag:3,data:t.data,id:r,dependsOnESID:n,url:a,ocrESID:s};return t.pos<t.data.byteLength&&(u.descs=e._parseRemainingDescriptors(t)),u},e._parseDecoderConfigDescriptor=function(t){var r={tag:4,data:t.data,oti:t.data[t.pos],streamType:t.data[t.pos+1],bufferSize:Object(I.readUint24)(t.data,t.pos+2),maxBitrate:Object(I.readUint32)(t.data,t.pos+5),avgBitrate:Object(I.readUint32)(t.data,t.pos+9)};return t.pos+=13,t.data.byteLength>13&&(r.descs=e._parseRemainingDescriptors(t)),r},e._parseRemainingDescriptors=function(t){for(var r=[];t.pos<t.data.byteLength;){var i=e.parseOneDescriptor(t);r.push(i)}return r},e}();(q=W||(W={}))[q.SIZE=0]="SIZE",q[q.NAME=1]="NAME",q[q.BIG_SIZE=2]="BIG_SIZE",q[q.DATA=3]="DATA";var X=function(){function e(){}return e.findBox=function(t,r){var i,n,a,o,s=[];if(!r.length)return s;for(var u=0;0<t.byteLength;)i=Object(I.readUint32)(t,0),n=Object(I.bin2str)(t.subarray(4,8),4),u=8,1===i&&(i=Object(I.readUint64)(t,8),u=16),o=0+i,n===r[0]&&(1===r.length?s.push(t.subarray(0+u,o)):(a=e.findBox(t.subarray(0+u,o),r.slice(1))).length&&(s=s.concat(a)));return s},e.readBoxes=function(e){for(var t=0,r=W.SIZE,i={size:0,headSize:8,name:""},n=[];t<e.byteLength;)switch(r){case W.SIZE:i.size=Object(I.readUint32)(e,t),t+=4,r=W.NAME;break;case W.NAME:i.name=Object(I.bin2str)(e,t,4),t+=4,r=1===i.size?W.BIG_SIZE:W.DATA;break;case W.BIG_SIZE:i.size=Object(I.readUint64)(e,t),i.headSize=16,t+=8,r=W.DATA;break;case W.DATA:i.data=e.subarray(t,t+i.size-i.headSize),t+=i.data.byteLength,r=W.SIZE,n.push(i),i={size:0,headSize:8,name:""}}return n},e.readBox=function(e,t){void 0===t&&(t=0);for(var r=t,i=W.SIZE,n={size:0,headSize:8,name:""};r<e.byteLength&&!n.data;)switch(i){case W.SIZE:n.size=Object(I.readUint32)(e,r),r+=4,i=W.NAME;break;case W.NAME:n.name=Object(I.bin2str)(e,r,4),r+=4,i=1===n.size?W.BIG_SIZE:W.DATA;break;case W.BIG_SIZE:n.size=Object(I.readUint64)(e,r),n.headSize=16,r+=8,i=W.DATA;break;case W.DATA:if(!(e.byteLength-r>=n.size-n.headSize)){r=e.byteLength;break}n.data=e.subarray(r,r+n.size-n.headSize),r+=n.data.byteLength,i=W.SIZE}if(n.size)return n},e.moov=function(t){var r={trak:[]};return t.data&&e.readBoxes(t.data).forEach((function(t){t.data&&("mvhd"===t.name?r.mvhd=e._mvhd(t.data):"trak"===t.name&&r.trak.push(e._trak(t.data)))})),r},e.moof=function(e){},e.esds=function(e){if(e.data)return Y.parseOneDescriptor({data:e.data,pos:4})},e._mvhd=function(e){var t=e[0],r=0,i=0;return 1===t?(r=Object(I.readUint32)(e,20),i=Object(I.readUint64)(e,24)):0===t&&(r=Object(I.readUint32)(e,12),i=Object(I.readUint32)(e,16)),{timescale:r,duration:i}},e._trak=function(t){var r={};return e.readBoxes(t).forEach((function(t){t.data&&("tkhd"===t.name?r.tkhd=e._tkhd(t.data):"tref"===t.name?r.tref=e._tref(t.data):"mdia"===t.name&&(r.mdia=e._mdia(t.data)))})),r},e._tkhd=function(e){var t=0,r=0,i=4;return 1===e[0]?(t=Object(I.readUint32)(e,i+16),r=Object(I.readUint64)(e,i+24),i+=32):(t=Object(I.readUint32)(e,i+8),r=Object(I.readUint32)(e,i+16),i+=20),i+=52,{width:Object(I.readUint32)(e,i)>>16,height:Object(I.readUint32)(e,i+4)>>16,trackId:t,duration:r}},e._tref=function(e){return{referenceType:Object(I.bin2str)(e,4,4),trackId:Object(I.readUint32)(e,8)}},e._mdia=function(t){var r={};return e.readBoxes(t).forEach((function(t){t.data&&("minf"===t.name?r.minf=e._minf(t.data):"hdlr"===t.name?r.hdlr=e._hdlr(t.data):"mdhd"===t.name&&(r.mdhd=e._mdhd(t.data)))})),r},e._hdlr=function(e){var t={};return 0===e[0]&&(t.type=Object(I.bin2str)(e,8,4)),t},e._minf=function(t){var r={};return e.readBoxes(t).forEach((function(t){t.data&&("dinf"===t.name?e._dinf(t.data):"stbl"===t.name&&(r.stbl=e._stbl(t.data)))})),r},e._dinf=function(t){e.readBoxes(t).forEach((function(t){t.data&&"dref"===t.name&&e._dref(t.data)}))},e._dref=function(e){e[0];for(var t=Object(I.readUint32)(e,4),r=0;r<t&&8<e.byteLength;r++);},e._stbl=function(t){var r={};return e.readBoxes(t).forEach((function(t){t.data&&("stsd"===t.name?r.stsd=e._stsd(t.data):"stts"===t.name?r.stts=e._stts(t.data):"stsc"===t.name?r.stsc=e._stsc(t.data):"stco"===t.name?r.stco=e._stco(t.data):"co64"===t.name?r.stco=e._co64(t.data):"stsz"===t.name?r.stsz=e._stsz(t.data):"stss"===t.name?r.stss=e._stss(t.data):"ctts"===t.name?r.ctts=e._ctts(t.data):"sgpd"===t.name?r.sgpd=e._sgpd(t.data):"stdp"===t.name?r.stdp=e._stdp(t.data):"sdtp"===t.name?r.sdtp=e._sdtp(t.data):"sbgp"===t.name?r.sbgp=e._sbgp(t.data):"subs"===t.name&&(r.subs=e._subs(t.data)))})),r},e._subs=function(e){var t=e[0],r={entries:[]},i=4,n=Object(I.readUint32)(e,i);i+=4;for(var a=0;a<n;a++){var o={sampleDelta:Object(I.readUint32)(e,i),subSamples:[]};r.entries.push(o);var s=Object(I.readUint16)(e,i+4);i+=6;for(var u=0;u<s;u++){1===t?(Object(I.readUint32)(e,i),i+=4):(Object(I.readUint16)(e,i),i+=2);var d={priority:e[i],discardable:e[i+1],codecSpecificParameters:Object(I.readUint32)(e,i+2)};o.subSamples.push(d),i+=6}}return r},e._sbgp=function(e){var t=e[0],r=4,i={groupingType:Object(I.bin2str)(e,r,4),entries:[]};r+=4,1===t&&(Object(I.readUint32)(e,r),r+=4);var n=Object(I.readUint32)(e,r);r+=4;for(var a=0;a<n;a++)i.entries.push({sampleCount:Object(I.readInt32)(e,r),groupDescriptionIndex:Object(I.readInt32)(e,r+4)}),r+=8;return i},e._sdtp=function(e){for(var t={entries:[]},r=4;r<e.byteLength;)t.entries.push({sampleDependsOn:e[r]>>4&3,sampleIsDependedOn:e[r]>>2&3,sampleHasRedundancy:3&e[r]}),r++;return t},e._stdp=function(e){for(var t={priority:[]},r=4;r<e.length;)t.priority.push(Object(I.readUint16)(e,r)),r+=2;return t},e._sgpd=function(e){var t=e[0],r={type:Object(I.bin2str)(e,4,4),entries:[]},i=0,n=8;1===t&&(i=Object(I.readUint32)(e,n),n+=4),2===t&&(Object(I.readUint32)(e,n),n+=4);var a=Object(I.readUint32)(e,n);n+=4;for(var o=0;o<a;o++){var s=0;1===t&&0===i?(s=Object(I.readUint32)(e,n),n+=4):s=i;var u={descriptionLength:s,data:e.subarray(n,n+s)};n+=s,r.entries.push(u)}return r},e._stsd=function(t){return t[0],Object(I.readUint32)(t,4),{sampleEntrys:e.readBoxes(t.subarray(8,t.byteLength))}},e._stts=function(e){for(var t=Object(I.readUint32)(e,4),r=8,i=[],n=0;n<t;n++)i.push({sampleCount:Object(I.readUint32)(e,r),sampleDelta:Object(I.readUint32)(e,r+4)}),r+=8;return{timeToSample:i}},e._stsc=function(e){e[0];for(var t=Object(I.readUint32)(e,4),r=8,i=[],n=0;n<t;n++)i.push({firstChunk:Object(I.readUint32)(e,r),samplesPerChunk:Object(I.readUint32)(e,r+4),sampleDescriptionIndex:Object(I.readUint32)(e,r+8)}),r+=12;return{sampleToChunkBox:i}},e._stco=function(e){for(var t=Object(I.readUint32)(e,4),r=8,i=[],n=0;n<t;n++)i.push(Object(I.readUint32)(e,r)),r+=4;return{chunkOffset:i}},e._co64=function(e){for(var t=Object(I.readUint32)(e,4),r=8,i=[],n=0;n<t;n++)i.push(Object(I.readUint64)(e,r)),r+=4;return{chunkOffset:i}},e._stsz=function(e){var t=Object(I.readUint32)(e,4),r=Object(I.readUint32)(e,8),i=12;if(0===t){t=[];for(var n=0;n<r;n++)t.push(Object(I.readUint32)(e,i)),i+=4}return{sampleCount:r,SampleSize:t}},e._stss=function(e){for(var t=Object(I.readUint32)(e,4),r=8,i=[],n=0;n<t;n++)i.push(Object(I.readUint32)(e,r)),r+=4;return{sampleNumber:i}},e._ctts=function(e){var t=e[0],r=Object(I.readUint32)(e,4),i=8,n=[];if(0===t)for(var a=0;a<r;a++){var o=Object(I.readUint32)(e,i),s=Object(I.readInt32)(e,i+4);n.push({sampleCount:o,sampleOffset:s}),i+=8}else if(1===t)for(var u=0;u<r;u++)n.push({sampleCount:Object(I.readUint32)(e,i),sampleOffset:Object(I.readInt32)(e,i+4)}),i+=8;return{compositionOffset:n}},e._mdhd=function(e){var t=0,r=0;return 1===e[0]?(t=Object(I.readUint32)(e,20),r=Object(I.readUint64)(e,24)):(t=Object(I.readUint32)(e,12),r=Object(I.readUint64)(e,16)),{timescale:t,duration:r}},e}();function Q(e,t){for(var r=0;r<t.length;r++){var i=t[r];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}var J=Math.pow(2,32)-1,$={soun:"audio",vide:"video"},Z=function(){function e(e,t,r,i){this._eventEmitter=void 0,this._remuxer=void 0,this._initPTS=0,this._audioCodec="",this._videoCodec="",this._initData=void 0,this._transmuxData=void 0,this._firstRemux=!0,this._eventEmitter=e,this._remuxer=t}var t,r,i,o=e.prototype;return o.flush=function(){},o.resetTimeStamp=function(e){void 0===e&&(e=0),this._initPTS=e},o.resetInitSegment=function(t,r){if(this._transmuxData=t,this._firstRemux=!0,r&&r.byteLength){var i=this._initData=e.parseInitSegment(r);t.audioCodec||(t.audioCodec="mp4a.40.5"),t.videoCodec||(t.videoCodec="avc1.42e01e");var a={};i.audio&&i.video?a.audiovideo={container:"video/mp4",codec:t.audioCodec+","+t.videoCodec,initSegment:t.duration?r:null}:(i.audio&&(a.audio={container:"audio/mp4",codec:t.audioCodec,initSegment:t.duration?r:null}),i.video&&(a.video={container:"video/mp4",codec:t.videoCodec,initSegment:t.duration?r:null})),this._eventEmitter.emit(n.default.PARSING_INIT_SEGMENT,{tracks:a})}else t.audioCodec&&(this._audioCodec=t.audioCodec),t.videoCodec&&(this._videoCodec=t.videoCodec)},e.probe=function(t){return e.findBox(t.subarray(0,Math.min(t.length,16384)),["moof"]).length>0},e.writeUint32=function(e,t,r){e[t]=r>>24,e[t+1]=r>>16&255,e[t+2]=r>>8&255,e[t+3]=255&r},e.findBox=function(t,r){var i,n,a,o,s=[],u=t.byteLength;if(!r.length)return s;for(i=0;i<u;)o=(n=Object(I.readUint32)(t,i))>1?i+n:u,Object(I.bin2str)(t,i+4,4)===r[0]&&(1===r.length?s.push(t.subarray(i+8,o)):(a=e.findBox(t.subarray(i+8,o),r.slice(1))).length&&(s=s.concat(a))),i=o;return s},e.parseSegmentIndex=function(t){var r,i=e.findBox(t,["moov"])[0],n=i?i.byteLength:null,a=0,o=e.findBox(t,["sidx"]);if(o&&o[0]){r=[];var s=o[0],u=s[0];a=0===u?8:16;var d=Object(I.readUint32)(s,a);a+=4,a+=0===u?8:16,a+=2;var c=s.byteLength+0,l=Object(I.readUint16)(s,a);a+=2;for(var f=0;f<l;f++){var _=a,h=Object(I.readUint32)(s,_);_+=4;var p=2147483647&h;if(1==(2147483648&h)>>>31)return void console.warn("SIDX has hierarchical references (not supported)");var v=Object(I.readUint32)(s,_);_+=4,r.push({referenceSize:p,subsegmentDuration:v,info:{duration:v/d,start:c,end:c+p-1}}),c+=p,a=_+=4}return{earliestPresentationTime:0,timescale:d,version:u,referencesCount:l,references:r,moovEndOffset:n}}},e.parseInitSegment=function(t){var r={};return e.findBox(t,["moov","trak"]).forEach((function(t){var i=e.findBox(t,["tkhd"])[0];if(i){var n=i[0],o=0===n?12:20,s=Object(I.readUint32)(i,o),u=e.findBox(t,["mdia","mdhd"])[0];if(u){o=0===(n=u[0])?12:20;var d=Object(I.readUint32)(u,o),c=e.findBox(t,["mdia","hdlr"])[0];if(c){var l=Object(I.bin2str)(c,8,4),f=$[l];if(f){var _=e.findBox(t,["mdia","minf","stbl","stsd"]);if(_.length){var h=_[0],p=Object(I.bin2str)(h,12,4);a.Log.v("fmp4-remuxer","MP4Demuxer:"+f+":"+p+" found")}r[s]={timescale:d,type:f},r[f]={timescale:d,id:s}}}}}})),r},e.getStartTime=function(t,r){var i,n=e.findBox(r,["moof","traf"]).map((function(r){return e.findBox(r,["tfhd"]).map((function(i){var n,a,o,s;return n=Object(I.readUint32)(i,4),a=t[n].timescale||9e4,{dts:(o=e.findBox(r,["tfdt"]).map((function(e){var t,r;return t=e[0],r=Object(I.readUint32)(e,4),1===t&&(r*=Math.pow(2,32),r+=Object(I.readUint32)(e,8)),r}))[0])/a,cts:(s=e.findBox(r,["trun"]).map((function(e){var t;t=e[0];var r=Object(I.readUint24)(e,1),i=Object(I.readUint32)(e,4),n=8;return 1&r&&(Object(I.readUint32)(e,n),n+=4),4&r&&(Object(I.readUint32)(e,12),n+=4),i&&(256&r&&(n+=4),512&r&&(n+=4),1024&r&&(n+=4),2048&r)?0===t?Object(I.readUint32)(e,n):Object(I.readInt32)(e,n):0}))[0])/a,pts:(o+s)/a}}))}));return i=[].concat.apply([],n).reduce((function(e,t){return e?e.pts>t.pts?t:e:t})),isFinite(i.pts)?i:{pts:0,dts:0,cts:0}},e.offsetStartDTS=function(t,r,i){e.findBox(r,["moof","traf"]).map((function(r){return e.findBox(r,["tfhd"]).map((function(n){var a=Object(I.readUint32)(n,4),o=t[a].timescale||9e4;e.findBox(r,["tfdt"]).map((function(t){var r=t[0],n=Object(I.readUint32)(t,4);if(0===r)e.writeUint32(t,4,n-i*o);else{n*=Math.pow(2,32),n+=Object(I.readUint32)(t,8),n-=i*o,n=Math.max(n,0);var a=Math.floor(n/(J+1)),s=Math.floor(n%(J+1));e.writeUint32(t,4,a),e.writeUint32(t,8,s)}}))}))}))},o.append=function(t,r,i,a,o){var s=this._initData;!s&&this._transmuxData&&(this._transmuxData.duration=0,this.resetInitSegment(this._transmuxData,t),s=this._initData);var u,d=0,c=this._initPTS;if(void 0===c){var l=e.getStartTime(s,t);this._initPTS=c=l.pts-r,d=l.dts-r,this._eventEmitter.emit(n.default.INIT_PTS_FOUND,{initPTS:c,timescale:1})}e.offsetStartDTS(s,t,d),u=e.getStartTime(s,t).pts,this._firstRemux&&(this._firstRemux=!1,this._eventEmitter.emit(n.default.MEDIA_DEMUX,{type:_.DemuxerType.FMP4})),this._remuxer.remux(s.audio,s.video,u,i,a,!1,t),this._eventEmitter.emit(n.default.PARSED_DATA,{extra:this._transmuxData})},o.destroy=function(){},t=e,i=[{key:"probeSize",get:function(){return 15040}}],(r=null)&&Q(t.prototype,r),i&&Q(t,i),e}(),ee=r("./src/utils/keyframes-utils.ts");function te(e,t){for(var r=0;r<t.length;r++){var i=t[r];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}var re="mp4-demuxer",ie=function(){var e,t,r;function o(e,t,r,i){this._eventEmitter=void 0,this._remuxer=void 0,this._config=void 0,this._duration=1/0,this._naluLengthSize=4,this._videoTrack=void 0,this._audioTrack=void 0,this._remuxStat=void 0,this._firstRemux=!0,this._typeSupported=void 0,this._transmuxData=void 0,this._gopRemux=!1,this._cache=void 0,this._moov=void 0,this._vSampleIndex=0,this._aSampleIndex=0,this._offset=0,this._vSampleInfoList=void 0,this._aSampleInfoList=void 0,this._nextSampleInfo=void 0,this._readSamples=!0,this._readPos=0,this._codecType=f.CodecType.h264,this._eventEmitter=e,this._remuxer=t,this._config=r,this._typeSupported=i,this._gopRemux=!!this._config.gopRemux,this._videoTrack=Object(v.createVideoTrack)(1/0),this._audioTrack=Object(v.createAudioTrack)(1/0),this._cache=new E.default}o.probe=function(e){var t=X.readBoxes(e);return!(!t.length||"ftyp"!==t[0].name)},e=o,r=[{key:"probeSize",get:function(){return 15040}}],(t=null)&&te(e.prototype,t),r&&te(e,r);var s=o.prototype;return s.append=function(e,t,r,a,o){if(this._readSamples){if(this._cache.put(e),!this._moov&&this._cache.unreadLen){var s=this._cache.read(this._cache.unreadLen);if(!s)return;for(var u=X.readBox(s,0),d=0;u;){if("moov"===u.name){if(u.data){this._parseMOOV(u);break}}else if("mdat"===u.name&&!this._moov)return this._readPos,u.size,this._readSamples=!1,void this._eventEmitter.emit(n.default.MP4_NOT_FASTSTART,{pos:this._readPos+u.size});u.data?(this._readPos+=u.size,this._cache.skip(u.size),d+=u.size,this._offset+=u.size,u=X.readBox(s,d)):u=void 0}}if(this._remuxStat||(this._remuxStat={timeOffset:t,contiguous:r,accurateTimeOffset:a}),this._moov&&this._readSamples){for(r||this._seek(t);this._cache.unreadLen&&this._hasMoreSamples();){if(this._nextSampleInfo||(this._nextSampleInfo=this._getNextSampleInfo()),!this._nextSampleInfo)return void this._eventEmitter.emit(n.default.ERROR,{type:i.ErrorTypes.MUX_ERROR,details:i.ErrorDetails.REMUX_ERROR,fatal:!0,reason:"can not find next sample"});if(this._offset&&this._cache.skip(this._nextSampleInfo.start-this._offset),this._offset=this._nextSampleInfo.start,!(this._nextSampleInfo&&this._nextSampleInfo.end-this._nextSampleInfo.start<this._cache.unreadLen))break;var c=this._cache.get(this._nextSampleInfo.end-this._nextSampleInfo.start);if(!c)return;this._offset+=c.byteLength,this._nextSampleInfo.type===f.TrackType.VIDEO?(this._parseVideoSample(this._nextSampleInfo,c),this._vSampleIndex++):(this._parseAudioSample(this._nextSampleInfo,c),this._aSampleIndex++),this._nextSampleInfo=void 0}this._remux()}}},s.destroy=function(){},s.flush=function(){this._remux(!0),this._remuxStat=void 0},s.resetInitSegment=function(e){this._transmuxData=e,this._readSamples=!0,this._readPos=0,this._firstRemux=!0,this._videoTrack.samples=[],this._audioTrack.samples=[],this._remuxStat=void 0,this._duration=e.duration,"boolean"==typeof e.hasAudio&&"boolean"==typeof e.hasVideo&&(this._audioTrack.active=e.hasAudio,this._videoTrack.active=e.hasVideo,this._videoTrack.active||(this._gopRemux=!1)),this._cache.clear(),this._vSampleIndex=0,this._aSampleIndex=0,this._offset=0,this._nextSampleInfo=void 0,a.Log.i(re,"reset init")},s.resetTimeStamp=function(){},s._parseVideoSample=function(e,t){for(var r=0,i=[],n=!1,a=0;r<t.byteLength;){var o=Object(I.readUint32)(t,r);r+=4;var s=t.subarray(r,r+o);3===this._naluLengthSize&&(o>>>=8);var u=0;this._codecType===f.CodecType.h264?(u=31&s[0])===T.NAL_IDR_SLICE?n=!0:T.PRIV_NAL_MAGIC_H264:this._codecType===f.CodecType.h265&&((u=(126&s[0])>>1)===L.NAL_UNIT_CODED_SLICE_IDR_W_RADL||u===L.NAL_UNIT_CODED_SLICE_IDR_N_LP||u===L.NAL_UNIT_CODED_SLICE_CRA?n=!0:L.PRIV_NAL_MAGIC_HEVC),i.push({type:u,data:s}),r+=o,a+=s.byteLength}if(i.length){var d=this._videoTrack,c={units:i,length:a,dts:e.dts,cts:e.cts,pts:e.cts+e.dts,streamDTS:e.dts,key:n,extraInfo:{dtsOrignMs:e.dts,ptsOrignMs:e.cts+e.dts,parseMs:0}};self.performance&&(c.extraInfo.parseMs=performance.now()),d.samples.push(c)}},s._parseAudioSample=function(e,t){var r=this._audioTrack,i={unit:t,dts:e.dts,pts:e.dts,streamDTS:e.dts,length:t.byteLength,extraInfo:{dtsOrignMs:e.dts,ptsOrignMs:e.dts,parseMs:0}};self.performance&&(i.extraInfo.parseMs=performance.now()),r.samples.push(i)},s._hasMoreSamples=function(){return!!(this._aSampleInfoList&&this._aSampleIndex<this._aSampleInfoList.samples.length||this._vSampleInfoList&&this._vSampleIndex<this._vSampleInfoList.samples.length)},s._getNextSampleInfo=function(){var e=this._aSampleInfoList?this._aSampleInfoList.samples[this._aSampleIndex]:void 0,t=this._vSampleInfoList?this._vSampleInfoList.samples[this._vSampleIndex]:void 0,r=e?e.start-this._offset:-1,a=t?t.start-this._offset:-1;return a>=0&&(a<r||a>r&&r<0)?t:r>=0&&(r<a||r>a&&a<0)?e:void this._eventEmitter.emit(n.default.ERROR,{type:i.ErrorTypes.MUX_ERROR,details:i.ErrorDetails.REMUX_ERROR,fatal:!0,reason:"get next sample error"})},s._remux=function(e){void 0===e&&(e=!1);var t=this._audioTrack,r=this._videoTrack,o=!0,s=0,u=!1;if(this._remuxStat&&(o=this._remuxStat.contiguous,s=this._remuxStat.timeOffset,u=this._remuxStat.accurateTimeOffset),0!==t.samples.length||0!==r.samples.length){if(e||!(this._audioTrack.active&&0===t.samples.length||r.active&&r.samples.length<2)){this._firstRemux&&(this._firstRemux=!1,this._eventEmitter.emit(n.default.MEDIA_DEMUX,{type:_.DemuxerType.MP4}));try{this._remuxer.remux(t,r,s,o,u,e),this._remuxStat=void 0}catch(d){a.Log.e(re,d),this._eventEmitter.emit(n.default.ERROR,{type:i.ErrorTypes.MUX_ERROR,details:i.ErrorDetails.REMUX_ERROR,fatal:!0,reason:d.message})}}}else e&&this._remuxer.flush()},s._parseMOOV=function(e){var t=this;this._moov=X.moov(e);var r={};this._moov.mvhd&&(r.duration=this._moov.mvhd.duration/this._moov.mvhd.timescale,this._duration=r.duration),this._moov.trak.forEach((function(e){e.mdia&&e.mdia.minf&&e.mdia.minf.stbl&&e.mdia.hdlr&&e.mdia.mdhd&&("vide"===e.mdia.hdlr.type?(void 0===t._videoTrack.active&&(t._videoTrack.active=!0),t._vSampleInfoList=t._parseSTBL(t._videoTrack,e.mdia.minf.stbl,e.mdia.mdhd)):"soun"===e.mdia.hdlr.type&&(void 0===t._audioTrack.active&&(t._audioTrack.active=!0),t._aSampleInfoList=t._parseSTBL(t._audioTrack,e.mdia.minf.stbl,e.mdia.mdhd)))})),this._vSampleInfoList&&this._vSampleInfoList.description.length&&this._parseVideoDescription(this._vSampleInfoList.description),this._aSampleInfoList&&this._aSampleInfoList.description.length&&this._parseAudioDescription(this._aSampleInfoList.description),this._vSampleInfoList&&this._vSampleInfoList.keyframes&&(r.keyframes=this._vSampleInfoList.keyframes),a.Log.i(re,"Parsed onMetaData"),this._eventEmitter.emit(n.default.METADATA,r)},s._seek=function(e){var t,r;a.Log.i(re,"seek:"+e);var i=null==(t=this._vSampleInfoList)?void 0:t.samples,n=null==(r=this._aSampleInfoList)?void 0:r.samples;if(i&&this._vSampleInfoList){var o=ee.default.getPosByTime(this._vSampleInfoList.keyframes,e);o&&(this._vSampleIndex=this._findSampleIndexByPos(i,o.position))}n&&(this._vSampleInfoList?i&&(this._aSampleIndex=this._findSampleIndexByPos(n,i[this._vSampleIndex].end),a.Log.i(re,"seek audio by video pos: "+e+" a: "+this._aSampleIndex+" v: "+this._vSampleIndex)):(this._aSampleIndex=this._findSampleIndexByTime(n,e*this._videoTrack.inputTimescale),a.Log.i(re,"seek audio by time: "+e+" a: "+this._aSampleIndex+" v: "+this._vSampleIndex)))},s._findSampleIndexByPos=function(e,t){if(e[0]&&t<e[0].start)return 0;if(e[e.length-1]&&t>=e[e.length-1].end)return e.length-1;for(var r,i=0,n=e.length-1,a=0,o=0;i<=n;){if(t>=((r=(o=(a=(i+n)/2|0)-1)>=0?e[o]:void 0)?r.end:e[a].start)&&t<e[a].end)return a;if(t===e[a].end)return a+1;t>e[a].end?i=a+1:n=a-1}return 0},s._findSampleIndexByTime=function(e,t){if(e[0]&&t<e[0].dts)return 0;if(e[e.length-1]&&t>=e[e.length-1].dts)return e.length-1;for(var r=0,i=e.length-1,n=0,a=0,o=0;r<=i;)if(t>(o=e[a=1+(n=(r+i)/2|0)]?e[a].dts:Number.MAX_SAFE_INTEGER))r=a;else{if(!(t<e[n].dts))return t===o?a:n;i=n-1}return 0},s._parseVideoDescription=function(e){a.Log.i(re,"parse video desc: "+e[0].name),"avc1"===e[0].name||"hev1"===e[0].name||"hvc1"===e[0].name?this._parseVideoSampleEntry(e[0]):a.Log.w(re,"video codec unsupported")},s._parseAudioDescription=function(e){a.Log.i(re,"parse audio desc: "+e[0].name),"mp4a"===e[0].name?this._parseAudioSampleEntry(e[0]):(a.Log.w(re,"audio codec unsupported"),this._audioTrack.active=!1)},s._parseAudioSampleEntry=function(e){var t=this;if(e.data){var r=6;Object(I.readUint16)(e.data,r),r+=2;var i=Object(I.readUint16)(e.data,r);r+=8,Object(I.readUint16)(e.data,r),r+=2,Object(I.readUint16)(e.data,r),r+=2,Object(I.readUint16)(e.data,r),r+=2,Object(I.readUint16)(e.data,r),r+=2,Object(I.readUint32)(e.data,r),r+=4,i>0&&(r+=16),X.readBoxes(e.data.subarray(r,e.data.byteLength)).forEach((function(e){"esds"===e.name?t._readEsds(e):"wave"===e.name&&e.data&&X.readBoxes(e.data).forEach((function(e){"esds"===e.name&&t._readEsds(e)}))}))}},s._readEsds=function(e){if("esds"===e.name){var t=X.esds(e);if(t){var r=Y.getAudioConfig(t);r&&p.initTrackConfig(this._audioTrack,this._eventEmitter,r,_.AudioConfigType.ASC)}}},s._parseVideoSampleEntry=function(e){var t=this;e.data&&X.readBoxes(e.data.subarray(78,e.data.byteLength)).forEach((function(e){"avcC"===e.name?t._parseAvcC(t._videoTrack,e):"hvcC"===e.name&&(t._typeSupported.h265?(t._config.gopRemux=t._gopRemux=!0,t._parseHvcC(t._videoTrack,e)):(t._videoTrack.active=!1,a.Log.w("HEVC stream type found, not supported for now")))}))},s._parseAvcC=function(e,t){if(t.data){var r=U.parseAVCC(t.data);r?(B.updateAVCTrack(e,r),e.sampleDuration=this._vSampleInfoList?Math.round(this._duration*e.inputTimescale/this._vSampleInfoList.samples.length):3003,e.duration=this._duration):this._eventEmitter.emit(n.default.ERROR,{type:i.ErrorTypes.MUX_ERROR,details:i.ErrorDetails.PARSING_ERROR,fatal:!0,reason:"Invalid AVCDecoderConfigurationRecord"})}},s._parseHvcC=function(e,t){if(a.Log.i(re,"parse hvcc"),t.data){var r=U.parseHVCC(t.data);r&&r.spsConfigList.length?(B.updateHEVCTrack(e,r),e.sampleDuration=this._vSampleInfoList?Math.round(this._duration*e.inputTimescale/this._vSampleInfoList.samples.length):3003,e.duration=this._duration,e.hvcc=t.data,this._codecType=f.CodecType.h265):this._eventEmitter.emit(n.default.ERROR,{type:i.ErrorTypes.MUX_ERROR,details:i.ErrorDetails.PARSING_ERROR,fatal:!0,reason:"Invalid HEVCDecoderConfigurationRecord"})}},s._parseSTBL=function(e,t,r){if(a.Log.i(re,"parse stbl"),t.stco&&t.stsc&&t.stsz){var i,n={description:t.stsd?t.stsd.sampleEntrys:[],samples:[],keyframes:[]},o=0,s=0,u=t.stco.chunkOffset[o],d=t.stsc.sampleToChunkBox[s],c=d.samplesPerChunk,l=t.stsc.sampleToChunkBox[s].firstChunk,f=0,_=0,h=void 0,p=0,v=0;t.stts&&(h=t.stts.timeToSample[_],p=t.stts.timeToSample[_].sampleCount);var m=0,g=void 0,y=0,E=0;t.ctts&&(g=t.ctts.compositionOffset[m],y=t.ctts.compositionOffset[m].sampleCount);var S=0,T=0;t.stss&&(T=t.stss.sampleNumber[S]);for(var b=0;b<t.stsz.sampleCount;b++)if(b>=c&&o<t.stco.chunkOffset.length&&(f=0,l++,o++,u=t.stco.chunkOffset[o],t.stsc.sampleToChunkBox[s+1]&&l>=t.stsc.sampleToChunkBox[s+1].firstChunk&&(s++,d=t.stsc.sampleToChunkBox[s]),c+=d.samplesPerChunk),t.stts&&b>=p&&_<t.stts.timeToSample.length&&(_++,p+=(h=t.stts.timeToSample[_]).sampleCount),t.ctts&&b>=y&&m<t.ctts.compositionOffset.length&&(m++,y+=(g=t.ctts.compositionOffset[m]).sampleCount),t.stss&&b>=T-1&&T&&(S++,T=t.stss.sampleNumber[S],i={time:0,position:0}),d&&u){var L="number"==typeof t.stsz.SampleSize?t.stsz.SampleSize:t.stsz.SampleSize[b],A=e.inputTimescale/r.timescale;E=g&&g.sampleOffset>=0?g.sampleOffset*A:0;var R=h?h.sampleDelta*A:30,I={type:e.type,index:b,gopID:n.keyframes.length,dts:v,cts:E,duration:R,start:u+f,end:u+f+L};n.samples.push(I),i&&(i.time=Math.round(v/r.timescale*1e3)/1e3,i.position=I.start,n.keyframes.push(i),i=void 0),v+=R,f+=L}return n}},o}(),ne=function(){function e(e,t,r){this._decrypter=void 0,this._decryptdata=void 0,this._decryptdata=r,this._decrypter=new l(e,t,{removePKCS7Padding:!1})}var t=e.prototype;return t.decryptAacSamples=function(e,t,r){for(;;t++){if(t>=e.length)return void r();if(!(e[t].unit.length<32)){var i=this._decrypter.isSync();if(this._decryptAacSample(e,t,r,i),!i)return}}},t.decryptAvcSamples=function(e,t,r,i){for(;;t++,r=0){if(t>=e.length)return void i();for(var n=e[t].units;!(r>=n.length);r++){var a=n[r];if(!(a.length<=48||1!==a.type&&5!==a.type)){var o=this._decrypter.isSync();if(this._decryptAvcSample(e,t,r,i,a,o),!o)return}}}},t._decryptBuffer=function(e,t){this._decryptdata.key&&this._decrypter.decrypt(e,this._decryptdata.key.buffer,this._decryptdata.iv.buffer,t)},t._decryptAacSample=function(e,t,r,i){var n=e[t].unit,a=n.subarray(16,n.length-n.length%16),o=a.buffer.slice(a.byteOffset,a.byteOffset+a.length),s=this;this._decryptBuffer(o,(function(a){a=new Uint8Array(a),n.set(a,16),i||s.decryptAacSamples(e,t+1,r)}))},t._getAvcEncryptedData=function(e){for(var t=16*Math.floor((e.length-48)/160)+16,r=new Uint8Array(t),i=0,n=32;n<=e.length-16;n+=160,i+=16)r.set(e.subarray(n,n+16),i);return r},t._getAvcDecryptedUnit=function(e,t){for(var r=new Uint8Array(t),i=0,n=32;n<=e.length-16;n+=160,i+=16)e.set(r.subarray(i,i+16),n);return e},t._decryptAvcSample=function(e,t,r,i,n,a){var o=k(n.data),s=this._getAvcEncryptedData(o),u=this;this._decryptBuffer(s.buffer,(function(s){n.data=u._getAvcDecryptedUnit(o,s),a||u.decryptAvcSamples(e,t,r+1,i)}))},e}();function ae(){return(ae=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var i in r)Object.prototype.hasOwnProperty.call(r,i)&&(e[i]=r[i])}return e}).apply(this,arguments)}function oe(e,t){for(var r=0;r<t.length;r++){var i=t[r];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}var se=function(){function e(e,t,r,o){var s=this;this._eventEmitter=void 0,this._config=void 0,this._typeSupported=void 0,this._remuxer=void 0,this._sampleAes=void 0,this._remuxStat=void 0,this._pmtParsed=!1,this._pmtId=-1,this._avcTrack=void 0,this._audioTrack=void 0,this._audioCodec="",this._videoCodec="",this._duration=0,this._vLastDts=0,this._lastDts=0,this._aLastDts=0,this._aacOverFlow=null,this._aacLastPTS=null,this._avcSample=null,this._contiguous=!1,this._timeOffset=0,this._accurateTimeOffset=!1,this._firstNalTypes=0,this._transmuxData=void 0,this._audioNonMonotonous=0,this._qos={vMaxDtsDiff:0,aMaxDtsDiff:0,aacOverhead:0,unknownTSPacketCount:0},this._hvcCData={sps:[],pps:[],vps:[]},this._codecType=f.CodecType.h264,this._parsePMT=function(e,t,r,i){var n,o,u={audio:-1,video:-1,id3:-1,isAAC:!0,codecType:f.CodecType.h264};for(n=t+3+((15&e[t+1])<<8|e[t+2])-4,t+=12+((15&e[t+10])<<8|e[t+11]);t<n;){switch(o=(31&e[t+1])<<8|e[t+2],e[t]){case 207:if(!i){a.Log.v("unkown stream type:"+e[t]);break}case 15:-1===u.audio&&(u.audio=o);break;case 21:-1===u.id3&&(u.id3=o);break;case 219:if(!i){a.Log.v("unkown stream type:"+e[t]);break}case 27:-1===u.video&&(u.video=o);break;case 3:case 4:r?-1===u.audio&&(u.audio=o,u.isAAC=!1):a.Log.v("MPEG audio found, not supported in this browser for now");break;case 36:s._typeSupported.h265?-1===u.video&&(u.video=o,u.codecType=f.CodecType.h265):a.Log.w("HEVC stream type found, not supported for now");break;default:a.Log.v("unkown stream type:"+e[t])}t+=5+((15&e[t+3])<<8|e[t+4])}return u},this._pushAccesUnit=function(e,t){if(e.units.length&&e.frame){var r=t.samples,i=r.length;if(!s._config.forceKeyFrameOnDiscontinuity||!0===e.key||t.sps&&(i||s._contiguous)){if(s._config.gopRemux&&e.key&&r&&r.length>1&&s._remuxStat){var n=s._remuxStat;s._remux(n.timeOffset,n.contiguous,n.accurateTimeOffset)}e.id=s._avcTrack.samples.length,s._avcTrack.samples.push(e)}}e.debug.length&&a.Log.v(e.pts+"/"+e.dts+":"+e.debug)},this._parseAVCPES=function(e,t){if(e.data){var r,i,n,o=s._avcTrack,u=s._parseAVCNALu(e.data),d=s._pushAccesUnit,c=s,l=function(e,t,r,i){return r===c._lastDts&&(r+=1),c._lastDts=r,{key:e,pts:t,dts:r,units:[],debug:i}},_=s._avcSample,h=!1,p=!1;if(s._vLastDts>0){var v=e.dts-s._vLastDts;Math.abs(v)>Math.abs(s._qos.vMaxDtsDiff)&&(s._qos.vMaxDtsDiff=v)}s._vLastDts=e.dts,e.data=null,_&&u.length&&!o.audFound&&(d(_,o),_=s._avcSample=l(!1,e.pts,e.dts,"")),s._codecType===f.CodecType.h265?(u.forEach((function(t){switch(t.type){case L.NAL_UNIT_CODED_SLICE_IDR_W_RADL:case L.NAL_UNIT_CODED_SLICE_IDR_N_LP:case L.NAL_UNIT_CODED_SLICE_CRA:s._firstNalTypes||(s._firstNalTypes=t.type),i=!0,_||(_=s._avcSample=l(!0,e.pts,e.dts,"")),_.key=!0,_.frame=!0;break;case L.NAL_UNIT_ACCESS_UNIT_DELIMITER:i=!1,o.audFound=!0,_&&d(_,o),_=s._avcSample=l(!1,e.pts,e.dts,"");break;case L.NAL_UNIT_SPS:i=!0,h=!0;var r=N.parseHEVCSPS(t.data);r&&(!o.width||o.width===r.width&&o.height===r.height&&r.codec===o.codec||(p=!0),o.width=o.codecWidth=r.width,o.height=o.codecHeight=r.height,o.pixelRatio=[1,1],o.sps=[t.data],o.bitDepth=r.bit_depth_luma_minus8+8,o.colorInfo=r.color_info,o.fps=r.fps,o.duration=s._duration,o.profile=r.profile_string,o.level=r.level_string,o.chromaFormat=r.chroma_format_string,o.codec=r.codec,s._hvcCData.sps=o.sps,s._hvcCData.spsInfo=r);break;case L.NAL_UNIT_PPS:i=!0,t.data=t.data,o.pps=[t.data];var n=D.parseHEVCPPS(t.data);n&&(s._hvcCData.pps=o.pps,s._hvcCData.ppsInfo=n);break;case L.NAL_UNIT_VPS:i=!0,s._hvcCData.vps=[t.data];break;default:if(i=!0,void 0===t.type){i=!1;break}s._firstNalTypes||(s._firstNalTypes=t.type),_||(_=s._avcSample=l(!0,e.pts,e.dts,"")),_.frame=!0}_&&i&&_.units.push(t)})),s._hvcCData.sps.length&&s._hvcCData.pps.length&&s._hvcCData.vps.length&&(p&&s._remuxer.ISGenerated&&s._transmuxData&&s._remuxer.resetInitSegment(s._transmuxData),s._avcTrack.hvcc&&!p||(a.Log.v("ts-demuxer","hevc generate hvcC sps:",s._hvcCData.spsInfo,"pps:",s._hvcCData.ppsInfo),s._avcTrack.hvcc=function(e){if(e.spsInfo&&e.ppsInfo&&e.sps.length&&e.pps.length&&e.vps.length){var t=e.sps.reduce((function(e,t){return e+t.byteLength}),0)+e.pps.reduce((function(e,t){return e+t.byteLength}),0)+e.vps.reduce((function(e,t){return e+t.byteLength}),0)+2*(e.sps.length+e.pps.length+e.vps.length),r=e.spsInfo.ptl,i=new Uint8Array(32+t),n=new DataView(i.buffer,0);i[0]=1,i[1]=(192&r.general_ptl.profile_space)+((1&r.general_ptl.tier_flag)<<5)+r.general_ptl.profile_idc&31,n.setUint32(2,r.general_ptl.profile_compatibility);for(var a=0;a<6;a++)n.setUint8(a+6,r.general_ptl.constraint_indicator[a]||0);n.setUint8(12,r.general_ptl.level_idc),i[13]=240+(3840&e.spsInfo.min_spatial_segmentation_idc),i[14]=255&e.spsInfo.min_spatial_segmentation_idc,i[15]=252+(3&e.ppsInfo.parallelismType),i[16]=252+(3&e.spsInfo.chroma_format_idc),i[17]=248+(7&e.spsInfo.bit_depth_luma_minus8),i[18]=248+(7&e.spsInfo.bit_depth_chroma_minus8),i[21]=3,i[22]=3;var o=23;return[{nalus:e.vps,type:L.NAL_UNIT_VPS},{nalus:e.sps,type:L.NAL_UNIT_SPS},{nalus:e.pps,type:L.NAL_UNIT_PPS}].forEach((function(e){i[o]=e.type,o++,n.setUint16(o,e.nalus.length),o+=2,e.nalus.forEach((function(e){n.setUint16(o,e.length),o+=2,i.set(e,o),o+=e.byteLength}))})),i}}(s._hvcCData),s._hvcCData={sps:[],pps:[],vps:[]}))):u.forEach((function(t){switch(t.type){case 1:s._firstNalTypes||(s._firstNalTypes=t.type),i=!0,_||(_=s._avcSample=l(!0,e.pts,e.dts,"")),_.frame=!0;var a=t.data;if(h&&a.length>4){var u=new x(a).readSliceType();2!==u&&4!==u&&7!==u&&9!==u||(_.key=!0)}break;case 5:s._firstNalTypes||(s._firstNalTypes=t.type),i=!0,_||(_=s._avcSample=l(!0,e.pts,e.dts,"")),_.key=!0,_.frame=!0;break;case 6:i=!0,(r=new x(k(t.data))).readUByte();for(var c=0,f=0,v=!1,m=0;!v&&r.bytesAvailable>1;){c=0;do{c+=m=r.readUByte()}while(255===m);f=0;do{f+=m=r.readUByte()}while(255===m);if(4===c&&0!==r.bytesAvailable){if(v=!0,181===r.readUByte()&&49===r.readUShort()&&1195456820===r.readUInt()&&3===r.readUByte()){var g=r.readUByte(),y=31&g,E=[g,r.readUByte()];for(n=0;n<y;n++)E.push(r.readUByte()),E.push(r.readUByte()),E.push(r.readUByte())}}else if(f<r.bytesAvailable)for(n=0;n<f;n++)r.readUByte()}break;case 7:i=!0,h=!0;var S=N.parseSPS(t.data);!o.width||o.width===S.codec_size.width&&o.height===S.codec_size.height&&S.codec===o.codec||(p=!0),o.width=S.codec_size.width,o.height=S.codec_size.height,o.pixelRatio=[S.sar_ratio.width,S.sar_ratio.height],o.sps=[t.data],o.duration=s._duration,o.fps=S.frame_rate.fps,o.bitDepth=S.bit_depth_luma_minus8+8,o.colorInfo=S.color_info,o.profile=S.profile_string,o.level=S.level_string,o.chromaFormat=S.chroma_format_string,o.codec=S.codec;break;case 8:i=!0,o.pps=[t.data];break;case 9:i=!1,o.audFound=!0,_&&d(_,o),_=s._avcSample=l(!1,e.pts,e.dts,"");break;case 12:i=!1;break;default:i=!1,_&&(_.debug+="unknown NAL "+t.type+" ")}p&&o.sps&&o.pps&&(s._remuxer.ISGenerated&&s._transmuxData&&s._remuxer.resetInitSegment(s._transmuxData),p=!1),_&&i&&_.units.push(t)})),t&&_&&(d(_,o),s._avcSample=null)}},this._parseMPEGPES=function(){s._eventEmitter.emit(n.default.ERROR,{type:i.ErrorTypes.MUX_ERROR,details:i.ErrorDetails.PARSING_ERROR,fatal:!0,reason:"unsupport mpeg"})},this._parseAACPES=function(e){if(e.data){var t,r,o,u,d,c,l=s._audioTrack,f=s._aacLastPTS,h=e.data,v=e.pts,m=s._aacOverFlow,g=null;if(s._aLastDts>0){var y=e.dts-s._aLastDts;Math.abs(y)>Math.abs(s._qos.aMaxDtsDiff)&&(s._qos.aMaxDtsDiff=y)}if(s._aLastDts=e.dts,m){var E=new Uint8Array(m.byteLength+h.byteLength);E.set(m,0),E.set(h,m.byteLength),h=E}for(o=0,u=h.length;o<u-1&&!p.isHeader(h,o);o++);if(o&&(o<u-1?(d="AAC PES did not start with ADTS header,offset:"+o,c=!1):(d="no ADTS header found in AAC PES",c=!0),a.Log.w("parsing error:"+d),s._eventEmitter.emit(n.default.ERROR,{type:i.ErrorTypes.MUX_ERROR,details:i.ErrorDetails.PARSING_ERROR,fatal:c,reason:d}),c))return;var S=h.subarray(o+2,o+4);if((p.isUpdate(l,S)||!l.configParsed)&&s._remuxer.ISGenerated&&s._transmuxData&&s._remuxer.resetInitSegment(s._transmuxData),p.initTrackConfig(l,s._eventEmitter,S,_.AudioConfigType.ADTS,s._audioCodec),r=0,t=p.getFrameDuration(l.samplerate),f&&(s._audioNonMonotonous||(s._audioNonMonotonous=v<f?1:0),s._audioNonMonotonous||m)){var T=f+t;Math.abs(T-v)>1&&(a.Log.v("AAC: align PTS for overlapping frames by "+Math.round((T-v)/90)),v=T)}for(;o<u;)if(p.isHeader(h,o)&&o+5<u){var b=p.appendFrame(l,h,o,v,r);if(!b)break;o+=b.length,g=b.sample.pts,r++}else o++;r>1&&(s._qos.aacOverhead=1),m=o<u?h.subarray(o,u):null,s._aacOverFlow=m,s._aacLastPTS=g}},this._eventEmitter=e,this._config=r,this._typeSupported=o,this._remuxer=t,this._sampleAes=null,this._remuxStat=null}var t,r,o,s=e.prototype;return s.setDecryptData=function(e){e&&e.key&&"SAMPLE-AES"===e.method?this._sampleAes=new ne(this._eventEmitter,this._config,e):this._sampleAes=null},e.probe=function(t){var r=e.syncOffset(t);return!(r<0||(r&&a.Log.w("MPEG2-TS detected but first sync word found @ offset "+r+", junk ahead ?"),0))},e.syncOffset=function(e){for(var t=Math.min(1e3,e.length-564),r=0;r<t;){if(71===e[r]&&71===e[r+188]&&71===e[r+376])return r;r++}return-1},e.createTrack=function(e,t){if(e===f.TrackType.AUDIO)return Object(v.createAudioTrack)(t);var r=Object(v.createVideoTrack)(t);return r.audFound=!1,r.naluState=0,r},s.resetInitSegment=function(t){this._pmtParsed=!1,this._pmtId=-1,this._avcTrack=e.createTrack(f.TrackType.VIDEO,t.duration),this._audioTrack=e.createTrack(f.TrackType.AUDIO,t.duration),this._aacOverFlow=null,this._aacLastPTS=null,this._avcSample=null,this._audioCodec=t.audioCodec,this._videoCodec=t.videoCodec,this._duration=t.duration,this._vLastDts=0,this._aLastDts=0,this._audioNonMonotonous=0,this._qos.vMaxDtsDiff=0,this._qos.aMaxDtsDiff=0,this._qos.aacOverhead=0,this._remuxStat=null,this._firstNalTypes=0,this._transmuxData=t},s.resetTimeStamp=function(){},s.append=function(e,t,r,a,o){void 0===o&&(o=!1),this._contiguous=r,this._timeOffset=t,this._accurateTimeOffset=a,null===this._remuxStat&&(this._remuxStat={timeOffset:t,contiguous:r,accurateTimeOffset:a});var s,u,d,c,l,f=this._remuxStat,_=this._avcTrack,h=this._audioTrack,p=this._parsePAT,v=this._parsePMT,m=this._parsePES,g=this._parseAVCPES,y=this._parseAACPES,E=this._parseMPEGPES,S=e.length;this._pmtParsed;var T=_.pid,b=h.pid,L=this._pmtId,A=_.pesData,R=h.pesData;if(!e.byteLength&&o)return this._remux(f.timeOffset,f.contiguous,f.accurateTimeOffset,!0),this._remuxStat=null,void this._onParsed();for(S-=(S+0)%188,s=0;s<S;s+=188)if(71===e[s]){if(u=!!(64&e[s+1]),d=((31&e[s+1])<<8)+e[s+2],(48&e[s+3])>>4>1){if((c=s+5+e[s+4])===s+188)continue}else c=s+4;switch(d){case T:u&&(A&&(l=m(A,!0))&&void 0!==l.pts&&g(l,!1),A={data:[],size:0}),A&&(A.data.push(e.subarray(c,s+188)),A.size+=s+188-c);break;case b:u&&(R&&(l=m(R))&&void 0!==l.pts&&(h.isAAC?y(l):E()),R={data:[],size:0}),R&&(R.data.push(e.subarray(c,s+188)),R.size+=s+188-c);break;case 0:u&&(c+=e[c]+1),L=this._pmtId=p(e,c);break;case L:u&&(c+=e[c]+1);var I=v(e,c,!0===this._typeSupported.mpeg||!0===this._typeSupported.mp3,null!==this._sampleAes);(T=I.video)>0&&(_.pid=T,_.active=!0,this._codecType=I.codecType),(b=I.audio)>0&&(h.pid=b,h.active=!0,h.isAAC=I.isAAC),this._pmtParsed=!0;break;case 17:case 8191:break;default:this._qos.unknownTSPacketCount++}}else this._eventEmitter.emit(n.default.ERROR,{type:i.ErrorTypes.MUX_ERROR,details:i.ErrorDetails.PARSING_ERROR,fatal:!1,reason:"TS packet did not start with 0x47"});A&&(l=m(A,o))&&void 0!==l.pts?(g(l,o),_.pesData=void 0):(this._avcSample&&(this._pushAccesUnit(this._avcSample,_),this._avcSample=null),_.pesData=A),R&&(l=m(R))&&void 0!==l.pts?(h.isAAC?y(l):E(),h.pesData=void 0):(R&&R.size,h.pesData=R),(b>0&&0===h.samples.length||T>0&&0===_.samples.length||T<=0&&b<=0)&&!o||(!o&&this._config.gopRemux||(this._remux(f.timeOffset,f.contiguous,f.accurateTimeOffset,o),this._remuxStat=null),o&&this._onParsed())},s._onParsed=function(){var e=ae({extra:this._transmuxData,audioNonMonotonous:this._audioNonMonotonous,fragStartWithNonIdr:5!==this._firstNalTypes},this._qos);this._eventEmitter.emit(n.default.PARSED_DATA,e),this._qos.vMaxDtsDiff=0,this._qos.aMaxDtsDiff=0,this._firstNalTypes=0},s.flush=function(){var e,t=this._avcTrack,r=this._audioTrack,i=t.pesData,n=r.pesData,a=this._parsePES,o=this._parseAVCPES,s=this._parseAACPES;if(i&&(e=a(i,!0))&&void 0!==e.pts&&o(e,!0),t.pesData=void 0,n&&(e=a(n))&&void 0!==e.pts&&r.isAAC&&s(e),r.pesData=void 0,r.pid&&0===r.samples.length&&t.pid&&0===t.samples.length)this._remuxer.flush();else{var u=this._remuxStat;u?this._remux(u.timeOffset,u.contiguous,u.accurateTimeOffset,!0):this._remux(this._timeOffset,!0,this._accurateTimeOffset,!0),this._avcSample=null,this._remuxStat=null,this._firstNalTypes=0}},s._remux=function(e,t,r,i){void 0===i&&(i=!1);var a=this._audioTrack,o=this._avcTrack;0==o.samples.length&&0===a.samples.length||(this._eventEmitter.emit(n.default.MEDIA_DEMUX,{type:_.DemuxerType.TS}),this._sampleAes?this._decryptAndRemux(a,o,e,t,r,i):this._remuxer.remux(a,o,e,t,r,i))},s._decryptAndRemux=function(e,t,r,i,n,a){if(void 0===a&&(a=!1),e.samples&&e.isAAC&&this._sampleAes){var o=this;this._sampleAes.decryptAacSamples(e.samples,0,(function(){o._decryptAndRemuxAvc(e,t,r,i,n,a)}))}else this._decryptAndRemuxAvc(e,t,r,i,n,a)},s._decryptAndRemuxAvc=function(e,t,r,i,n,a){if(void 0===a&&(a=!1),t.samples&&this._sampleAes){var o=this;this._sampleAes.decryptAvcSamples(t.samples,0,0,(function(){o._remuxer.remux(e,t,r,i,n,a)}))}else this._remuxer.remux(e,t,r,i,n,a)},s.destroy=function(){this._duration=0},s._parsePAT=function(e,t){return(31&e[t+10])<<8|e[t+11]},s._parsePES=function(e,t){void 0===t&&(t=!1);var r,i,n,o,s,u,d=e.data,c=0,l=0,f=0;if(!e||0===e.size)return null;for(;d[0].length<19&&d.length>1;){var _=new Uint8Array(d[0].length+d[1].length);_.set(d[0]),_.set(d[1],d[0].length),d[0]=_,d.splice(1,1)}if(1===((r=d[0])[0]<<16)+(r[1]<<8)+r[2]){if((n=(r[4]<<8)+r[5])&&n>e.size-6)return null;if(0===n&&!t)return null;192&(i=r[7])&&((l=536870912*(14&r[9])+4194304*(255&r[10])+16384*(254&r[11])+128*(255&r[12])+(254&r[13])/2)>4294967295&&(l-=8589934592),64&i?((f=536870912*(14&r[14])+4194304*(255&r[15])+16384*(254&r[16])+128*(255&r[17])+(254&r[18])/2)>4294967295&&(f-=8589934592),l-f>54e5&&(a.Log.w(Math.round((l-f)/9e4)+"s delta between PTS and DTS, align them"),l=f)):f=l),u=(o=r[8])+9,e.size-=u,s=new Uint8Array(e.size);for(var h=0,p=d.length;h<p;h++){var v=(r=d[h]).byteLength;if(u){if(u>v){u-=v;continue}r=r.subarray(u),v-=u,u=0}s.set(r,c),c+=v}return n&&(n-=o+3),{data:s,pts:l,dts:f,len:n}}return null},s._getLastNalUnit=function(){var e,t=this._avcSample;if(!t||0===t.units.length){var r=this._avcTrack.samples;t=r[r.length-1]}if(t){var i=t.units;e=i[i.length-1]}return e},s._parseAVCNALu=function(e){var t,r,i,n,a=this._avcTrack,o=e.byteLength,s=o,u=[],d=0,c=0,l=a.naluState||0,_=-1,h=l;if(-1===l)_=0,n=this._codecType===f.CodecType.h265?(126&e[0])>>1:31&e[0],l=0,d=1;else if(l>0)for(;c<4;c++){var p=e[c];if(0!==p){if(1===p&&l>=2){_=c+1,n=this._codecType===f.CodecType.h265?(126&e[_])>>1:31&e[_],l=0;var v=this._getLastNalUnit();v&&h&&c<=4-h&&v.state&&(v.data=v.data.subarray(0,v.data.byteLength-h));break}c<o&&(l=0);break}l++,d=c+1}for(;d<s;)if(1===(t=e[d+2]))if(0===e[d]&&0===e[d+1]){if(l=d>0&&0===e[d-1]?3:2,d+=3,_>=0)i={data:e.subarray(_,d-l-1),type:n},u.push(i);else{var m=this._getLastNalUnit();if(m&&(r=d-l-1)>0){var g=new Uint8Array(m.data.byteLength+r);g.set(m.data,0),g.set(e.subarray(0,r),m.data.byteLength),m.data=g}}d<o?(_=d,n=this._codecType===f.CodecType.h265?(126&e[d])>>1:31&e[d],l=0):l=-1}else d+=3;else 0===t?d++:d+=3;for(var y=o-1;y>o-4&&y>=c&&0===e[y];y--)l++;if(_>=0&&l>=0&&_<o&&(i={data:e.subarray(_,o),type:n,state:l},u.push(i)),0===u.length){var E=this._getLastNalUnit();if(E){var S=new Uint8Array(E.data.byteLength+e.byteLength);S.set(E.data,0),S.set(e,E.data.byteLength),E.data=S}}return a.naluState=l,u},t=e,o=[{key:"probeSize",get:function(){return 752}}],(r=[{key:"minChunkSize",get:function(){return 188}},{key:"encryptedChunkSize",get:function(){return 752}}])&&oe(t.prototype,r),o&&oe(t,o),e}(),ue=function(){function e(e,t,r,i){this._eventEmitter=void 0,this._config=void 0,this._vendor=void 0,this._typeSupported=void 0,this._decrypter=void 0,this._nextIV=null,this._cache=new E.default,this._probe=void 0,this._muxConfig=[{Demux:j,Remux:G.default},{Demux:se,Remux:G.default},{Demux:Z,Remux:z},{Demux:ie,Remux:G.default}],this._demuxer=void 0,this._remuxer=void 0,this._stat=void 0,this._minChunkSize=0,this._eventEmitter=e,this._typeSupported=t,this._config=r,this._vendor=i,this._minChunkSize=this._muxConfig.reduce((function(e,t){return Math.max(t.Demux.probeSize,e)}),0)}var t=e.prototype;return t.push=function(e,t,r,i,n,a,o,s,u,d){var c=this,f=e;if((o||a)&&this._cache.clear(),d.progress&&this._minChunkSize)if(this._cache.put(e),u)f=this._cache.get(this._cache.unreadLen);else{var _=Math.floor(this._cache.unreadLen/this._minChunkSize)*this._minChunkSize;if(!(_>=this._minChunkSize))return void(this._stat||(this._stat={contiguous:n,trackSwitch:a,discontinuity:o,accurateTimeOffset:s}));f=this._cache.get(_)}else this._cache.unreadLen&&(this._cache.put(e),f=this._cache.get(this._cache.unreadLen));if(f)if(e=f,this._stat&&(n=this._stat.contiguous,a=this._stat.trackSwitch,o=this._stat.discontinuity,s=this._stat.accurateTimeOffset,this._stat=void 0),e.byteLength>0&&t&&t.key&&"AES-128"===t.method){var h=this._decrypter;h||(h=this._decrypter=new l(this._eventEmitter,this._config,{removePKCS7Padding:u})),o&&(this._nextIV=null);var p=this._nextIV?this._nextIV:t.iv;h.decrypt(e,t.key.buffer,p.buffer,(function(l){u?c._nextIV=null:(c._nextIV=new Uint8Array(16),c._nextIV.set(e.subarray(e.byteLength-16),0)),c._pushDecrypted(new Uint8Array(l),t,r,i,n,a,o,s,u,d)}))}else t&&u&&(this._nextIV=null),this._pushDecrypted(e,t,r,i,n,a,o,s,u,d)},t.flush=function(){this._demuxer&&this._demuxer.flush(),this._cache.clear()},t.end=function(){this._eventEmitter.emit(n.default.LOAD_END)},t._probeData=function(e,t,r,a){if(!this._demuxer||t&&this._probe&&!this._probe(e)){for(var o=this._eventEmitter,s=this._typeSupported,u=this._config,d=0,c=this._muxConfig.length;d<c;d++){var l=this._muxConfig[d],f=l.Demux.probe;if(f(e)){this._remuxer=new l.Remux(o,u,s,this._vendor),this._demuxer=new l.Demux(o,this._remuxer,u,s),this._probe=f;break}}if(!this._demuxer)return void this._eventEmitter.emit(n.default.ERROR,{type:i.ErrorTypes.MUX_ERROR,details:i.ErrorDetails.PARSING_ERROR,fatal:!0,reason:"no demux matching with content found"})}},t._pushDecrypted=function(e,t,r,i,n,a,o,s,u,d){this._demuxer||this._probeData(e,!0,r,d);var c=this._demuxer,l=this._remuxer;l&&c&&(this._minChunkSize=t?c.encryptedChunkSize||16:c.minChunkSize||0,(a||o)&&(c.resetInitSegment(d,r),l.resetInitSegment(d)),o&&(c.resetTimeStamp(),l.resetTimeStamp()),t&&c.hasOwnProperty("setDecryptData")&&c.setDecryptData(t),c.append(e,i,n,s,u))},e}();t.default=ue},"./src/demux/demuxer-worker.ts":function(e,t,r){r.r(t);var i=r("./node_modules/events/events.js"),n=r("./src/core/kernel-events.ts"),a=r("./src/core/worker-cmd.ts"),o=r("./src/utils/log.ts"),s=r("./src/demux/demuxer-inline.ts");t.default=function(e){var t,r=new i.EventEmitter;r.on(n.default.INIT_PTS_FOUND,(function(t){return e.postMessage({event:n.default.INIT_PTS_FOUND,data:t})})),r.on(n.default.PARSING_INIT_SEGMENT,(function(t){return e.postMessage({event:n.default.PARSING_INIT_SEGMENT,data:t})})),r.on(n.default.PARSED_DATA,(function(t){return e.postMessage({event:n.default.PARSED_DATA,data:t})})),r.on(n.default.LOAD_END,(function(t){return e.postMessage({event:n.default.LOAD_END,data:t})})),r.on(n.default.ERROR,(function(t){return e.postMessage({event:n.default.ERROR,data:t})})),r.on(n.default.MEDIA_DEMUX,(function(t){return e.postMessage({event:n.default.MEDIA_DEMUX,data:t})})),r.on(n.default.METADATA,(function(t){return e.postMessage({event:n.default.METADATA,data:t})})),r.on(n.default.FLV_HEAD,(function(t){return e.postMessage({event:n.default.FLV_HEAD,data:t})})),r.on(n.default.MP4_NOT_FASTSTART,(function(t){return e.postMessage({event:n.default.MP4_NOT_FASTSTART,data:t})})),r.on(n.default.PARSING_DATA,(function(t){var r={event:n.default.PARSING_DATA,data:t},i=[];t.segments.forEach((function(e){i.push(e.payload.buffer)})),e.postMessage(r,i)})),e.addEventListener("message",(function(e){var i,n,u,d,c=e.data;switch(c.cmd){case a.WorkerCmd.INIT:o.Log.level(c.config.kwaiKernelLog),i=r,n=c.typeSupported,u=c.config,d=c.vendor,t=new s.default(i,n,u,d);break;case a.WorkerCmd.PUSH:t.push(c.data,c.decryptdata,c.initSegment,c.timeOffset,c.contiguous,c.trackSwitch,c.discontinuity,c.accurateTimeOffset,c.fragEnd,c.transmuxData);break;case a.WorkerCmd.FLUSH:t.flush();break;case a.WorkerCmd.LOAD_END:t.end()}}))}},"./src/demux/flv/flv.ts":function(e,t,r){var i,n;r.r(t),r.d(t,"FlvTagType",(function(){return i})),r.d(t,"FLV_HEAD_LEN",(function(){return a})),r.d(t,"FLV_TAG_HEAD_LEN",(function(){return o})),r.d(t,"FLV_TAG_SIZE_LEN",(function(){return s})),r.d(t,"FLV_VIDEO_TAG_HEAD_LEN",(function(){return u})),r.d(t,"FlvTag",(function(){return d})),(n=i||(i={}))[n.AUDIO=8]="AUDIO",n[n.VIDEO=9]="VIDEO",n[n.SCRIPT=18]="SCRIPT";var a=13,o=11,s=4,u=5,d=function(){this.tagType=i.VIDEO,this.dataSize=0,this.timestamp=0,this.size=0,this.cts=0,this.frameType=0,this.codecId=0,this.body=void 0,this.packetType=void 0}},"./src/demux/video/color-space.ts":function(e,t,r){var i,n,a,o,s,u,d,c,l,f;r.r(t),r.d(t,"AVColorPrimaries",(function(){return s})),r.d(t,"AVColorTransferCharacteristic",(function(){return d})),r.d(t,"AVColorSpace",(function(){return l})),r.d(t,"AVColorRange",(function(){return _})),r.d(t,"getColorStr",(function(){return y})),(u=s||(s={}))[u.AVCOL_PRI_RESERVED0=0]="AVCOL_PRI_RESERVED0",u[u.AVCOL_PRI_BT709=1]="AVCOL_PRI_BT709",u[u.AVCOL_PRI_UNSPECIFIED=2]="AVCOL_PRI_UNSPECIFIED",u[u.AVCOL_PRI_RESERVED=3]="AVCOL_PRI_RESERVED",u[u.AVCOL_PRI_BT470M=4]="AVCOL_PRI_BT470M",u[u.AVCOL_PRI_BT470BG=5]="AVCOL_PRI_BT470BG",u[u.AVCOL_PRI_SMPTE170M=6]="AVCOL_PRI_SMPTE170M",u[u.AVCOL_PRI_SMPTE240M=7]="AVCOL_PRI_SMPTE240M",u[u.AVCOL_PRI_FILM=8]="AVCOL_PRI_FILM",u[u.AVCOL_PRI_BT2020=9]="AVCOL_PRI_BT2020",u[u.AVCOL_PRI_SMPTE428=10]="AVCOL_PRI_SMPTE428",u[u.AVCOL_PRI_SMPTEST428_1=10]="AVCOL_PRI_SMPTEST428_1",u[u.AVCOL_PRI_SMPTE431=11]="AVCOL_PRI_SMPTE431",u[u.AVCOL_PRI_SMPTE432=12]="AVCOL_PRI_SMPTE432",u[u.AVCOL_PRI_EBU3213=22]="AVCOL_PRI_EBU3213",u[u.AVCOL_PRI_JEDEC_P22=22]="AVCOL_PRI_JEDEC_P22",u[u.AVCOL_PRI_NB=23]="AVCOL_PRI_NB",(c=d||(d={}))[c.AVCOL_TRC_RESERVED0=0]="AVCOL_TRC_RESERVED0",c[c.AVCOL_TRC_BT709=1]="AVCOL_TRC_BT709",c[c.AVCOL_TRC_UNSPECIFIED=2]="AVCOL_TRC_UNSPECIFIED",c[c.AVCOL_TRC_RESERVED=3]="AVCOL_TRC_RESERVED",c[c.AVCOL_TRC_GAMMA22=4]="AVCOL_TRC_GAMMA22",c[c.AVCOL_TRC_GAMMA28=5]="AVCOL_TRC_GAMMA28",c[c.AVCOL_TRC_SMPTE170M=6]="AVCOL_TRC_SMPTE170M",c[c.AVCOL_TRC_SMPTE240M=7]="AVCOL_TRC_SMPTE240M",c[c.AVCOL_TRC_LINEAR=8]="AVCOL_TRC_LINEAR",c[c.AVCOL_TRC_LOG=9]="AVCOL_TRC_LOG",c[c.AVCOL_TRC_LOG_SQRT=10]="AVCOL_TRC_LOG_SQRT",c[c.AVCOL_TRC_IEC61966_2_4=11]="AVCOL_TRC_IEC61966_2_4",c[c.AVCOL_TRC_BT1361_ECG=12]="AVCOL_TRC_BT1361_ECG",c[c.AVCOL_TRC_IEC61966_2_1=13]="AVCOL_TRC_IEC61966_2_1",c[c.AVCOL_TRC_BT2020_10=14]="AVCOL_TRC_BT2020_10",c[c.AVCOL_TRC_BT2020_12=15]="AVCOL_TRC_BT2020_12",c[c.AVCOL_TRC_SMPTE2084=16]="AVCOL_TRC_SMPTE2084",c[c.AVCOL_TRC_SMPTEST2084=16]="AVCOL_TRC_SMPTEST2084",c[c.AVCOL_TRC_SMPTE428=17]="AVCOL_TRC_SMPTE428",c[c.AVCOL_TRC_SMPTEST428_1=17]="AVCOL_TRC_SMPTEST428_1",c[c.AVCOL_TRC_ARIB_STD_B67=18]="AVCOL_TRC_ARIB_STD_B67",c[c.AVCOL_TRC_NB=19]="AVCOL_TRC_NB",(f=l||(l={}))[f.AVCOL_SPC_RGB=0]="AVCOL_SPC_RGB",f[f.AVCOL_SPC_BT709=1]="AVCOL_SPC_BT709",f[f.AVCOL_SPC_UNSPECIFIED=2]="AVCOL_SPC_UNSPECIFIED",f[f.AVCOL_SPC_RESERVED=3]="AVCOL_SPC_RESERVED",f[f.AVCOL_SPC_FCC=4]="AVCOL_SPC_FCC",f[f.AVCOL_SPC_BT470BG=5]="AVCOL_SPC_BT470BG",f[f.AVCOL_SPC_SMPTE170M=6]="AVCOL_SPC_SMPTE170M",f[f.AVCOL_SPC_SMPTE240M=7]="AVCOL_SPC_SMPTE240M",f[f.AVCOL_SPC_YCGCO=8]="AVCOL_SPC_YCGCO",f[f.AVCOL_SPC_YCOCG=8]="AVCOL_SPC_YCOCG",f[f.AVCOL_SPC_BT2020_NCL=9]="AVCOL_SPC_BT2020_NCL",f[f.AVCOL_SPC_BT2020_CL=10]="AVCOL_SPC_BT2020_CL",f[f.AVCOL_SPC_SMPTE2085=11]="AVCOL_SPC_SMPTE2085",f[f.AVCOL_SPC_CHROMA_DERIVED_NCL=12]="AVCOL_SPC_CHROMA_DERIVED_NCL",f[f.AVCOL_SPC_CHROMA_DERIVED_CL=13]="AVCOL_SPC_CHROMA_DERIVED_CL",f[f.AVCOL_SPC_ICTCP=14]="AVCOL_SPC_ICTCP",f[f.AVCOL_SPC_NB=15]="AVCOL_SPC_NB";var _,h,p=((i={})[s.AVCOL_PRI_RESERVED0]="reserved",i[s.AVCOL_PRI_BT709]="bt709",i[s.AVCOL_PRI_UNSPECIFIED]="unknown",i[s.AVCOL_PRI_RESERVED]="reserved",i[s.AVCOL_PRI_BT470M]="bt470m",i[s.AVCOL_PRI_BT470BG]="bt470bg",i[s.AVCOL_PRI_SMPTE170M]="smpte170m",i[s.AVCOL_PRI_SMPTE240M]="smpte240m",i[s.AVCOL_PRI_FILM]="film",i[s.AVCOL_PRI_BT2020]="bt2020",i[s.AVCOL_PRI_SMPTE428]="smpte428",i[s.AVCOL_PRI_SMPTE431]="smpte431",i[s.AVCOL_PRI_SMPTE432]="smpte432",i[s.AVCOL_PRI_EBU3213]="ebu3213",i),v=((n={})[d.AVCOL_TRC_RESERVED0]="reserved",n[d.AVCOL_TRC_BT709]="bt709",n[d.AVCOL_TRC_UNSPECIFIED]="unknown",n[d.AVCOL_TRC_RESERVED]="reserved",n[d.AVCOL_TRC_GAMMA22]="bt470m",n[d.AVCOL_TRC_GAMMA28]="bt470bg",n[d.AVCOL_TRC_SMPTE170M]="smpte170m",n[d.AVCOL_TRC_SMPTE240M]="smpte240m",n[d.AVCOL_TRC_LINEAR]="linear",n[d.AVCOL_TRC_LOG]="log100",n[d.AVCOL_TRC_LOG_SQRT]="log316",n[d.AVCOL_TRC_IEC61966_2_4]="iec61966-2-4",n[d.AVCOL_TRC_BT1361_ECG]="bt1361e",n[d.AVCOL_TRC_IEC61966_2_1]="iec61966-2-1",n[d.AVCOL_TRC_BT2020_10]="bt2020-10",n[d.AVCOL_TRC_BT2020_12]="bt2020-12",n[d.AVCOL_TRC_SMPTE2084]="smpte2084",n[d.AVCOL_TRC_SMPTE428]="smpte428",n[d.AVCOL_TRC_ARIB_STD_B67]="arib-std-b67",n),m=((a={})[l.AVCOL_SPC_RGB]="gbr",a[l.AVCOL_SPC_BT709]="bt709",a[l.AVCOL_SPC_UNSPECIFIED]="unknown",a[l.AVCOL_SPC_RESERVED]="reserved",a[l.AVCOL_SPC_FCC]="fcc",a[l.AVCOL_SPC_BT470BG]="bt470bg",a[l.AVCOL_SPC_SMPTE170M]="smpte170m",a[l.AVCOL_SPC_SMPTE240M]="smpte240m",a[l.AVCOL_SPC_YCGCO]="ycgco",a[l.AVCOL_SPC_BT2020_NCL]="bt2020nc",a[l.AVCOL_SPC_BT2020_CL]="bt2020c",a[l.AVCOL_SPC_SMPTE2085]="smpte2085",a[l.AVCOL_SPC_CHROMA_DERIVED_NCL]="chroma-derived-nc",a[l.AVCOL_SPC_CHROMA_DERIVED_CL]="chroma-derived-c",a[l.AVCOL_SPC_ICTCP]="ictcp",a);(h=_||(_={}))[h.AVCOL_RANGE_UNSPECIFIED=0]="AVCOL_RANGE_UNSPECIFIED",h[h.AVCOL_RANGE_MPEG=1]="AVCOL_RANGE_MPEG",h[h.AVCOL_RANGE_JPEG=2]="AVCOL_RANGE_JPEG";var g=((o={})[_.AVCOL_RANGE_UNSPECIFIED]="unknown",o[_.AVCOL_RANGE_MPEG]="tv",o[_.AVCOL_RANGE_JPEG]="pc",o);function y(e){if(e&&"number"==typeof e.colorRange&&"number"==typeof e.matrixCoefficients&&"number"==typeof e.colourPrimaries&&"number"==typeof e.transferCharacteristics){var t=m[e.matrixCoefficients],r=p[e.colourPrimaries],i=v[e.transferCharacteristics];return t===r&&t===i?"("+(e.colorRange?g[e.colorRange]+" ":"")+t+")":"("+(e.colorRange?g[e.colorRange]+" ":"")+t+"/"+r+"/"+i+")"}return""}},"./src/index.ts":function(e,t,r){r.r(t),r.d(t,"default",(function(){return An}));var i,n,a=r("./node_modules/events/events.js"),o=function(){function e(){this.tag="fetch",this._context=void 0,this._callbacks=null,this._controller=null,this._reader=null,this._abort=!1}e.isSupport=function(){return!(!self.fetch||!self.ReadableStream)};var t=e.prototype;return t.load=function(e,t){var r=this;this._context=e,this._callbacks=t;var i=new Headers;e.headers&&e.headers.forEach((function(e){i.append(e.header,e.value)})),e.range&&i.append("Range",e.range);var n={method:e.requestMethod?e.requestMethod:"GET",headers:i,mode:"cors",cache:"default",referrerPolicy:"no-referrer-when-downgrade",signal:this._getAbortSignal()};e.requestBody&&(n.body=e.requestBody),e.credentials&&(n.credentials="include"),fetch(e.url,n).then((function(t){if(e.responseUrl=t.url,e.responseHeader=t.headers,r._callbacks&&r._callbacks.onConnect&&r._callbacks.onConnect(t.status),t.ok)return r._abort?void(t.body&&t.body.getReader().cancel()):"arraybuffer"===e.responseType?e.progress?void(t.body&&(r._reader=t.body.getReader(),r._pump(r._reader))):void t.arrayBuffer().then((function(t){r._onEnd(e,t)})):void t.text().then((function(t){r._onEnd(e,t)}));var i=new Error(t.status+" "+t.statusText);r._onError(i)})).catch((function(e){"AbortError"!==e.name&&r._onError(e)}))},t.abort=function(){this._controller?this._controller.abort():this._reader&&(this._reader.cancel(),this._reader=null),this._abort=!0},t.destroy=function(){this._callbacks=null,this.abort()},t._onProgress=function(e,t){this._callbacks&&this._callbacks.onProgress&&this._callbacks.onProgress(e,t)},t._onEnd=function(e,t){this._callbacks&&this._callbacks.onEnd&&(this._reader=null,this._controller=null,this._callbacks.onEnd(e,t))},t._onError=function(e){this._callbacks&&this._callbacks.onError&&this._callbacks.onError(e)},t._pump=function(e){var t=this;e.read().then((function(r){if(t._abort)return e.cancel(),null;if(r.done)return t._onEnd(t._context,null),null;var i=r.value.buffer;return t._onProgress(t._context,i),t._pump(e)})).catch((function(e){"AbortError"!==e.name&&t._onError(e)}))},t._getAbortSignal=function(){try{if(AbortController)return this._controller=new AbortController,this._controller.signal}catch(e){return null}return null},e}();(n=i||(i={})).MOZ_CHUNK="moz-chunked-arraybuffer",n.UNKNOW="unknow",n.UNSUPPORT="";var s=function(){function e(){var e=this;this.tag="xhr",this._xhr=null,this._context=void 0,this._callbacks=null,this._progress=i.UNKNOW,this._onReadyStateChange=function(t){if(e._xhr){var r=e._xhr;2===r.readyState&&(e._context.responseUrl=r.responseURL,e._context.responseHeader=r.getAllResponseHeaders(),e._callbacks&&e._callbacks.onConnect&&e._callbacks.onConnect(r.status),(r.status<200||r.status>299)&&e._onError(new Error("xhr error")))}},this._onProgress=function(t){if(e._xhr){var r=e._xhr.response;e._callbacks&&e._callbacks.onProgress&&r&&e._callbacks.onProgress(e._context,r)}},this._onLoadEnd=function(t){var r=null,i=e._xhr;!e._progress&&i&&(r=i.response),e._callbacks&&e._callbacks.onEnd(e._context,r)},this._onError=function(t){e._callbacks&&e._callbacks.onError&&e._callbacks.onError(t)},this._xhr=null}e.isSupportChunk=function(){if(e.supportChunk!==i.UNKNOW)return e.supportChunk;try{var t=new XMLHttpRequest;if(t.open("GET","https://example.com",!0),t.responseType=i.MOZ_CHUNK,t.responseType===i.MOZ_CHUNK)return e.supportChunk=i.MOZ_CHUNK,e.supportChunk}catch(r){e.supportChunk=i.UNSUPPORT}return i.UNSUPPORT};var t=e.prototype;return t.load=function(t,r){this._callbacks=r,this._context=t,this._progress=i.UNSUPPORT,t.progress&&"arraybuffer"===t.responseType&&(this._progress=e.isSupportChunk());var n=this._xhr=new XMLHttpRequest;n.open(t.requestMethod?t.requestMethod:"GET",this._context.url,!0),this._progress===i.MOZ_CHUNK?(n.responseType=i.MOZ_CHUNK,n.onprogress=this._onProgress,n.onload=this._onLoadEnd):(n.responseType=t.responseType||"arraybuffer",n.onload=this._onLoadEnd),n.onreadystatechange=this._onReadyStateChange,n.onerror=this._onError,n.withCredentials=!!t.credentials,t.range&&n.setRequestHeader("Range",t.range),t.headers&&t.headers.forEach((function(e){n.setRequestHeader(e.header,e.value)})),n.send(t.requestBody)},t.abort=function(){this._xhr&&(this._xhr.onreadystatechange=null,this._xhr.onprogress=null,this._xhr.onload=null,this._xhr.onerror=null,this._xhr.abort(),this._xhr=null)},t.destroy=function(){this._callbacks=null,this.abort()},e}();s.supportChunk=i.UNKNOW;var u=r("./src/types/core.ts"),d=r("./src/utils/browser.ts"),c=r("./src/utils/log.ts");function l(){return(l=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var i in r)Object.prototype.hasOwnProperty.call(r,i)&&(e[i]=r[i])}return e}).apply(this,arguments)}var f=new RegExp("^(http|https)://"),_={isLive:!1,box:u.MediaBox.flv,alwaysSeekKeyframe:!1,lazyLoadMaxDuration:90,lazyLoadRecoverDuration:60,webWorker:!0,appendErrorMaxRetry:3,credentials:!1,streamingMux:!0,autoPlaybackRate:!0,autoPlaybackRateConf:void 0,enableSoftwareAES:!0,startPlayBufferSec:0,startFromSec:0,startFromKeyframe:!0,defaultSpts:-5e3,lazyLoad:!1,kwaiKernelLog:c.LOG_LEVEL.LEVEL_ERROR,retryWithBackup:!0,resourceBuffer:!0,resourceBufferSize:500,ntp:!0,ensureAudio:!0,dbCache:!0,adaptive:!0,autoRecoverMedia:!0,abrSpeedTest:!0,initMseOnDemand:!1,stretchShortVideoTrack:!1,maxBufferHole:.5,maxAudioFramesDrift:5,forceKeyFrameOnDiscontinuity:!1,maxRetry:3,connectionTimeout:1e4,transmissionTimeout:3e4,retryDelay:2e3,maxFragFailSec:11,flvLoadEndError:!0,flvPreloadTimeout:18e3,catchUpPausedLive:!0,manifestLoadingMaxRetry:3,manifestConnectionTimeout:1e4,manifestTransmissionTimeout:1e4,manifestLoadingRetryDelay:1,levelLoadingMaxRetry:3,levelConnectionTimeout:1e4,levelTransmissionTimeout:1e4,levelLoadingRetryDelay:100,emeEnabled:!0,widevineLicenseUrl:"",playreadyLicenseUrl:"",fairplayLicenseUrl:"",keyLoadingMaxRetry:3,keyConnectionTimeout:1e4,keyTransmissionTimeout:5e3,keyLoadingRetryDelay:300,sdpConnectionTimeout:1e4,peerConnectionTimeout:1e4,peerConnectionMaxRetry:5,peerConnectionRetryDelay:3e3},h={maxRetry:1,retryDelay:100,connectionTimeout:1e4,levelConnectionTimeout:1e4,manifestConnectionTimeout:1e4},p={startDelay:10,interval:.6,rule:[{rate:1.25,lower:27,upper:Number.MAX_SAFE_INTEGER},{rate:1.1,lower:17,upper:21},{rate:1,lower:5,upper:11}]},v=function(){function e(){}return e.isStreamingSupport=function(e){return e&&"flv"===e.box&&e.isLive?o.isSupport()||s.isSupportChunk()===i.MOZ_CHUNK:o.isSupport()||s.isSupportChunk()},e.processConfig=function(t){var r=t.box===u.MediaBox.hls?l({},_,h):l({},_);return l(r,t),r.startPlayBufferSec=Math.min(5,Math.max(0,r.startPlayBufferSec)),e.setSrc(r),this._initPlayBackRateRule(r),window.Worker||(r.webWorker=!1),r.isLive&&(r.startFromSec=0),r.lazyLoad=!(r.isLive&&r.box===u.MediaBox.flv),e.detectStreamingMux(r),r},e.detectStreamingMux=function(t){t.streamingMux=!(!t.streamingMux||!e.isStreamingSupport(t)||d.default.msie||d.default.safari||d.default.msedge);var r=d.default.safari&&!t.isLive||d.default.opera&&d.default.version.major<37;t.gopRemux=t.streamingMux&&r},e.setSrc=function(e,t){if(void 0===t&&(t=null),t&&(e.src=t),"string"==typeof e.src&&!f.test(e.src))try{var r=JSON.parse(e.src);r&&(e.src=r)}catch(i){}},e._initPlayBackRateRule=function(e){e.autoPlaybackRate=e.isLive&&e.autoPlaybackRate;var t=e.autoPlaybackRateConf;if(t){var r=t.rule;if(r&&Array.isArray(r)&&((r=r.filter((function(e){return e.upper>e.lower&&e.rate>0}))).sort((function(e,t){return t.rate-e.rate})),r.length>1))return t.rule=r,void(e.autoPlaybackRateConf=t)}else{var i=-e.defaultSpts/1e3,n={startDelay:i,interval:.6,rule:[{rate:1.5,lower:i+7,upper:Number.MAX_SAFE_INTEGER},{rate:1.25,lower:i+4,upper:i+6},{rate:1.1,lower:i+1,upper:i+3},{rate:1,lower:0,upper:i}]};e.autoPlaybackRateConf=e.adaptive&&e.box===u.MediaBox.flv?n:p}},e}(),m=10,g=100,y=101,E=102,S=103,T=104,b=105,L=107,A=108,R=111,I=r("./src/core/kernel-errors.ts"),k=r("./src/core/kernel-events.ts");function C(e,t){for(var r=0;r<t.length;r++){var i=t[r];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}var x=function(){function e(e){this._video=void 0,this._mse=void 0,this._streamTime=0,this._localTime=0,this._video=e}var t,r,i,n=e.prototype;return n.attachVideo=function(e){this._video=e},n.attachMSE=function(e){this._mse=e},n.isTimeinBuffered=function(e){if(this._video)for(var t=this._video.buffered,r=0;r<t.length;r++)if(e>=t.start(r)&&e<t.end(r))return!0;return!1},n.bufferedSec=function(){return this._video&&this._video.buffered.length>0?Math.max(0,this._video.buffered.end(this._video.buffered.length-1)-this._video.currentTime):0},n.bufferedSecByType=function(e){return this._mse&&this._video&&this._mse.bufferedEndByType(e)>0?this._mse.bufferedEndByType(e)-this._video.currentTime:0},n.mseBufferedSecByType=function(e){return this._mse?this._mse.bufferedByType(e):{start:0,end:0}},n.mediaBufferedSec=function(){return this._video&&this._video.buffered&&this._video.buffered.length?{start:this._video.buffered.start(0),end:this._video.buffered.end(this._video.buffered.length-1)}:{start:0,end:0}},n.bufferedEnd=function(){return this._video&&this._video.buffered.length?this._video.buffered.end(this._video.buffered.length-1):0},n.bufferSliceNum=function(){return this._video?this._video.buffered.length:0},n.bufferSliceNumByType=function(e){return this._mse?this._mse.bufferSliceNumByType(e):0},n.pendingNum=function(){return this._mse?this._mse.pendingNum():0},n.pendingSecByType=function(e){return this._mse?this._mse.pendingSecByType(e):0},n.currentBuffer=function(e){if(this._video)for(var t=this._video.buffered,r=0;r<t.length;r++){var i=t.start(r),n=t.end(r);if(i<=e&&e<n)return{start:i,end:n}}},n.nextBuffer=function(e){if(this._video)for(var t=this._video.buffered,r=0;r<t.length;r++){var i=t.start(r),n=t.end(r);if(i>e)return{start:i,end:n}}},n.updateStreamTime=function(e,t){this._streamTime=e,this._localTime=t},n.getLocalTime=function(e){if(this._streamTime)return e-this._streamTime+this._localTime},n.getStreamTime=function(e){if(this._streamTime)return e+1e3*(this._streamTime-this._localTime)},t=e,(r=[{key:"hasStreamTime",get:function(){return!!this._streamTime}},{key:"video",get:function(){return this._video}},{key:"mse",get:function(){return this._mse}},{key:"mseReadyState",get:function(){return this._mse?this._mse.readyState:"closed"}},{key:"videoReadyState",get:function(){return this._video?this._video.readyState:0}},{key:"currentTime",get:function(){return this._video?this._video.currentTime:0}}])&&C(t.prototype,r),i&&C(t,i),e}(),D="metadata",w="mediaInfo",O="heartbeat",P="performance",N="download",M="realtimeBeacon",U="discontinuity",B=r("./node_modules/webworkify-webpack/index.js"),F=r.n(B),V=function(){function e(){}return e.prepareWorker=function(){if(!1!==this._isSupported&&!this._w)try{this._w=F()("./src/demux/demuxer-worker.ts"),this._isSupported=!0}catch(e){this._isSupported=!1}},e.getWorker=function(){this._w||e.prepareWorker();var t=this._w;return this._w=void 0,t},e.clear=function(){this._w&&(this._w.terminate(),this._w=void 0)},e}();V._isSupported=void 0,V._w=void 0;var H=V,j=Number.isFinite||function(e){return"number"==typeof e&&isFinite(e)},G=r("./node_modules/url-toolkit/src/url-toolkit.js");function K(e,t){for(var r=0;r<t.length;r++){var i=t[r];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}var W,q,z=function(){function e(e,t){this._uri=null,this.baseuri=void 0,this.reluri=void 0,this.method=null,this.key=null,this.iv=void 0,this.baseuri=e,this.reluri=t}var t,r,i;return t=e,(r=[{key:"uri",get:function(){return!this._uri&&this.reluri&&(this._uri=Object(G.buildAbsoluteURL)(this.baseuri,this.reluri,{alwaysNormalize:!0})),this._uri}}])&&K(t.prototype,r),i&&K(t,i),e}();function Y(e,t){for(var r=0;r<t.length;r++){var i=t[r];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}(q=W||(W={})).AUDIO="audio",q.VIDEO="video";var X=function(){function e(){var e;this._url="",this._byteRange=null,this._decryptdata=null,this._elementaryStreams=((e={})[W.AUDIO]=!1,e[W.VIDEO]=!1,e),this.rawProgramDateTime=null,this.programDateTime=null,this.tagList=[],this.relurl=void 0,this.baseurl=void 0,this.duration=void 0,this.sn=0,this.levelkey=void 0,this.level=0,this.start=0,this.cc=0,this.maxStartPTS=0,this.startPTS=void 0,this.endPTS=void 0,this.startDTS=void 0,this.endDTS=void 0,this.deltaPTS=void 0,this.dropped=void 0,this.backtracked=void 0,this.type=void 0,this.loader=void 0,this.title=null,this.urlId=void 0,this.data=void 0}var t,r,i,n=e.prototype;return n.setByteRange=function(e,t){var r=e.split("@",2),i=[];1===r.length?i[0]=t?t.byteRangeEndOffset:0:i[0]=parseInt(r[1],10),i[1]=parseInt(r[0],10)+i[0],this._byteRange=i},n.addElementaryStream=function(e){this._elementaryStreams[e]=!0},n.hasElementaryStream=function(e){return!0===this._elementaryStreams[e]},n.createInitializationVector=function(e){for(var t=new Uint8Array(16),r=12;r<16;r++)t[r]=e>>8*(15-r)&255;return t},n.setDecryptDataFromLevelKey=function(e,t){var r=e;return e&&e.method&&e.uri&&!e.iv&&((r=new z(e.baseuri,e.reluri)).method=e.method,r.iv=this.createInitializationVector(t)),r},t=e,(r=[{key:"url",get:function(){return!this._url&&this.relurl&&(this._url=Object(G.buildAbsoluteURL)(this.baseurl,this.relurl,{alwaysNormalize:!0})),this._url},set:function(e){this._url=e}},{key:"byteRange",get:function(){return this._byteRange?this._byteRange:[]}},{key:"byteRangeStartOffset",get:function(){return this.byteRange[0]}},{key:"byteRangeEndOffset",get:function(){return this.byteRange[1]}},{key:"decryptdata",get:function(){if(!this.levelkey&&!this._decryptdata)return null;if(!this._decryptdata&&this.levelkey){var e=this.sn;"number"!=typeof e&&(e=0),this._decryptdata=this.setDecryptDataFromLevelKey(this.levelkey,e)}return this._decryptdata}},{key:"endProgramDateTime",get:function(){if(null===this.programDateTime)return null;if(!j(this.programDateTime))return null;var e=j(this.duration)?this.duration:0;return this.programDateTime+1e3*e}},{key:"encrypted",get:function(){return!(!this.decryptdata||null===this.decryptdata.uri||null!==this.decryptdata.key)}}])&&Y(t.prototype,r),i&&Y(t,i),e}();function Q(e,t){for(var r=0;r<t.length;r++){var i=t[r];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}var J=function(){function e(e){this.url=[],this.urlId=0,this.bitrate=0,this.maxBitrate=0,this.avgBitrate=0,this.qualityType="",this.qualityLabel="",this.id=0,this.codec="",this.audioCodec="",this.videoCodec="",this.hidden=!1,this.enableAdaptive=!0,this.default=!1,this.width=void 0,this.height=void 0,this.index=0,this.drmSchemaId="",this.drmToken="",this.url=[e],this.urlId=0}var t,r,i;return e.prototype.getKLevel=function(){return{width:this.width,height:this.height,bandwidth:this.bitrate,qualityLabel:this.qualityLabel,qualityType:this.qualityType,bitrate:this.bitrate,maxBitrate:this.maxBitrate,avgBitrate:this.avgBitrate}},t=e,(r=[{key:"currentUrl",get:function(){return this.url[this.urlId]||""}}])&&Q(t.prototype,r),i&&Q(t,i),e}();function $(e,t){for(var r=0;r<t.length;r++){var i=t[r];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}var Z=function(e){var t,r,i,n,a;function o(t){var r;return(r=e.call(this,t)||this).startSN=0,r.endSN=0,r.fragments=[],r.initSegment=null,r.live=!0,r.needSidxRanges=!1,r.startTimeOffset=null,r.targetduration=0,r.totalduration=0,r.type=null,r.version=null,r.details=null,r.PTSKnown=!1,r.m3u8Slice=void 0,r.audioGroupIds=void 0,r.attrs=void 0,r.averagetargetduration=void 0,r.name=void 0,r.lang=void 0,r.groupId="",r.instreamId="",r.autoselect=void 0,r.forced=void 0,r}return r=e,(t=o).prototype=Object.create(r.prototype),t.prototype.constructor=t,t.__proto__=r,i=o,(n=[{key:"hasProgramDateTime",get:function(){return!(!this.fragments[0]||"number"!=typeof this.fragments[0].programDateTime||!j(this.fragments[0].programDateTime))}}])&&$(i.prototype,n),a&&$(i,a),o}(J),ee=function(){function e(){}return e.verify=function(e){return!!(e&&e.hasOwnProperty("segments")&&Array.isArray(e.segments)&&e.segments.length>0)&&(e.segments.forEach((function(e){if(!e.url||!e.duration||!e.time)return!1})),!0)},e.parse=function(t,r){void 0===r&&(r="");var i=[],n={levels:i,withCredentials:!1,hasVideo:!0,hasAudio:!0};if(e.verify(t)){var a=new Z("");i.push(a);var o=new Z(""),s=t;n.withCredentials=!!s.withCredentials,void 0!==s.hasAudio&&(n.hasAudio=!!s.hasAudio),void 0!==s.hasVideo&&(n.hasVideo=!!s.hasVideo);var d=0,c=0,l=0;s.segments.forEach((function(e,t){var i=new X;i.sn=t,"string"==typeof e.startUtcTime?i.programDateTime=parseInt(e.startUtcTime):"number"==typeof e.startUtcTime&&(i.programDateTime=e.startUtcTime),"string"==typeof e.duration?i.duration=(parseFloat(e.duration)||0)/1e3:i.duration=(e.duration||0)/1e3,i.start=d,i.baseurl=r,i.relurl=e.url,d+=i.duration,t>0&&l!==e.periodId&&(i.tagList.push(["DIS"]),c++),i.cc=c,l=e.periodId,o.fragments.push(i)})),o.live=!1,o.type=u.LevelType.MAIN,o.startSN=0,o.endSN=o.fragments.length-1,o.totalduration=d,a.details=o}return n},e}(),te={400:"01",401:"02",403:"03",404:"04",other4xx:"05",serverError:"06",timeoutOpen:"07",timeoutIO:"08",200:"09",206:"09"};function re(e,t,r){if(void 0===r&&(r=0),e>=100)return e;var i="00";return"timeout"===t?i=r?te.timeoutIO:te.timeoutOpen:te.hasOwnProperty(r)?i=te[r]||i:/^4\d{2}$/.test(r.toString())?i=te.other4xx:/^5\d{2}$/.test(r.toString())&&(i=te.serverError),parseInt(e+i,10)}var ie,ne,ae=["x-ks-cache","kwaisign","x-ks-request-id","x-ks-client-ip"];function oe(e){var t=[];return"string"==typeof e?e.trim().split(/[\r\n]+/).forEach((function(e){var r=e.split(": "),i=r.shift(),n=r.join(":");i&&t.push([i,n])})):e&&e.forEach((function(e,r){e.split(",").forEach((function(e){t.push([r,e])}))})),t}function se(e){var t=oe(e),r=[];return t&&(r=[],t.forEach((function(e){-1!==ae.indexOf(e[0].toLowerCase())&&r.push(e[0]+": "+e[1].slice(0,255))}))),r.length?(r.slice(0,10),r):null}function ue(){performance&&("function"==typeof performance.clearResourceTimings?performance.clearResourceTimings():"function"==typeof performance.webkitClearResourceTimings&&performance.webkitClearResourceTimings())}function de(){return(de=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var i in r)Object.prototype.hasOwnProperty.call(r,i)&&(e[i]=r[i])}return e}).apply(this,arguments)}function ce(e,t,r,i,n){void 0===n&&(n=!1);var a={url:t.url,startTime:r.tsload,spendTime:r.tload?Math.round(r.tload-r.tstart):Math.round(performance.now()-r.tstart),httpResponseTime:r.tfirst?Math.round(r.tfirst-r.tstart):0,status:e,httpStatusCode:r.code,retry:r.retry,errorCode:0,errorMessage:"",loaderId:r.id,byteLength:r.total||r.loaded||0,resourceType:t.type||"",preload:n,cacheHit:!!r.cacheHit,cacheFail:!!r.cacheFail};i&&(a.qualityType=i);var o=t.frag;if(o&&(a.slice=!0,a.slicePlayStartTime=Math.round(1e3*o.start),a.slicePlayDuration=Math.round(1e3*o.duration),a.sliceIndex=o.sn,a.sliceLevelIndex=o.level),e===ie.FAIL&&(a.errorCode=re(I.ErrorDetails.LOAD_ERROR,r.text,r.code)),r.text&&(a.errorMessage=r.text),t.responseHeader){var s=se(t.responseHeader);s&&(a.customHeader=s)}a.rangeStart=t.rangeStart,a.rangeEnd=t.rangeEnd;var u=function(e){if(performance&&"function"==typeof performance.getEntriesByName){var t=performance.getEntriesByName(e,"resource");if(t.length){var r=t[t.length-1],i={};return r.redirectStart&&(i.redirect=r.redirectEnd-r.redirectStart),i.dns=r.domainLookupEnd-r.domainLookupStart,i.tcp=r.connectEnd-r.connectStart,i.request=r.requestStart-r.connectEnd,i.firstResponse=r.responseStart-r.requestStart,r.responseStart>0?i.response=r.responseEnd-r.responseStart:i.response=r.responseEnd-r.fetchStart,i.duration=r.duration||0,i}}return null}(t.url);return u&&de(a,u),a}function le(e,t){for(var r=0;r<t.length;r++){var i=t[r];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}(ne=ie||(ie={})).FAIL="FAIL",ne.ABORT="ABORT",ne.SUCCESS="SUCCESS";var fe=function(){function e(){this.timeout=6048e5}var t,r,i,n=e.prototype;return n.write=function(t,r){if(e.available)try{localStorage.setItem(t,JSON.stringify({value:r,time:Date.now()}))}catch(i){}},n.read=function(t){if(e.available)try{var r=localStorage.getItem(t);if(r){var i=JSON.parse(r),n=i.value,a=i.time,o=void 0===a?0:a;if(Date.now()-o<this.timeout)return n}}catch(s){}},t=e,i=[{key:"available",get:function(){if(void 0===e._available)try{localStorage.setItem("alg","test"),e._available=!0}catch(t){e._available=!1}return e._available}}],(r=null)&&le(t.prototype,r),i&&le(t,i),e}();fe._available=void 0;var _e=fe;function he(){return(he=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var i in r)Object.prototype.hasOwnProperty.call(r,i)&&(e[i]=r[i])}return e}).apply(this,arguments)}function pe(e,t){for(var r=0;r<t.length;r++){var i=t[r];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}var ve,me,ge={beacon:!1,predictStep:5,targetBuffer:10,duration:5,smoothRatioToTarget:0,switchpanelty:2.5*1e-6,slidingWindowSize:3,kalmanR:Math.pow(.2,2),kalmanQ:4e-4,initBitrate:2e6,startBitrateLimit:!0,speedPredictRatio:1.5,speedPredictNum:3,algorithm:1,speedPredictRatioOnStart:3,lowProfileThreshold:4,lowProfileBitrate:25e5,lowProfileStartThreshold:5};(me=ve||(ve={}))[me.Default=0]="Default",me[me.Seek=1]="Seek";var ye="kwai_hls_adaptive",Ee="algorithm-hls",Se=function(){function e(e){this._conf=void 0,this._bufferSize=0,this._lastBufferSize=0,this._pastThroughput=void 0,this._bitrates=[],this._qos={},this._storage=void 0,this._index=0,this._nextIndex=0,this._status=ve.Default,this._speedPredictCnt=0,this._playbackRate=1,this._lowProfile=!1,this._lowProfileIndex=0,this._lowProfileHistory=0,this._renderBlockCount=0,this._storage=new _e;var t=he({},ge);this._conf=he(t,e)}var t,r,i,n=e.prototype;return n.setInfo=function(e){var t=this;this._bitrates=[],e.levels.forEach((function(e){t._bitrates.push(e.bitrate)})),this._index=Math.min(e.index,this._bitrates.length-1),c.Log.i(Ee,"setInfo "+this._bitrates+", "+this._index),this._nextIndex=0,this._bufferSize=this._conf.duration,this._lastBufferSize=0,this._pastThroughput=new Array(this._conf.slidingWindowSize),this._pastThroughput[this._conf.slidingWindowSize-1]=0,this._status=ve.Default,this._lowProfileIndex=this._maxBitrateIndex(this._bitrates,this._conf.lowProfileBitrate)},n.bitrateInit=function(){var e=this,t=this._bitrateToIndex(this._bitrates,this._conf.initBitrate),r=this._storage.read(ye);if(c.Log.i(Ee,"storage read:"+r),void 0!==r&&r.bitrate>=0&&r.speed>0&&2===r.version){r.time&&r.lowProfile&&Date.now()-r.time<2592e5&&(this._lowProfileHistory=Math.min(parseInt(r.lowProfile),this._conf.lowProfileStartThreshold+1),this._lowProfileHistory>this._conf.lowProfileStartThreshold&&(this._lowProfile=!0,t=Math.min(t,this._lowProfileIndex)));var i=Math.min(r.bitrate,1024*r.speed/this._conf.speedPredictRatioOnStart),n=this._bitrates.reduce((function(t,r,n){return Math.abs(r-i)<Math.abs(e._bitrates[t]-i)?n:t}),0);t=this._conf.startBitrateLimit?Math.min(t,n):n}return t},n.onLevelLoad=function(e){e<this._bitrates.length&&e>=0&&(this._index=e)},n.onDownload=function(e){if(e.byteLength){var t=e.duration||e.spendTime,r=e.byteLength/t*7.8125;this._qos=he({cache:!1},e),c.Log.v(Ee,"report download time:"+t+" bytes:"+e.byteLength+" buffered:"+e.buffered+" speed:"+r+" cache:"+this._qos.cache);var i=this._nextRateIndex(r,e.buffered/1e3);this._nextIndex=i,i!==this._nextIndex&&this._storage.write(ye,{version:2,index:i,bitrate:this._bitrates[i],speed:this._qos&&this._qos.speed?this._qos.speed:0,lowProfile:Math.max(0,this._lowProfile?this._lowProfileHistory+1:this._lowProfileHistory-1),time:Date.now()}),this._qos.speed=r,this._qos.buffered=e.buffered,this._qos.nextBitrate=this._bitrates[this._nextIndex],this._qos.currentBitrate=this._bitrates[this._index]}},n.onSeek=function(e){c.Log.v(Ee,"report seek buffered:"+e.buffered+" inBuffer:"+e.isInBuffer),e.isInBuffer?this._resetAlgorithm():this._qos.seek=1,(!e.isInBuffer||e.buffered/1e3<this._conf.targetBuffer)&&(c.Log.i(Ee,"status change to seek."),this._status=ve.Seek,this._speedPredictCnt=this._conf.speedPredictNum)},n.onRatechange=function(e){e&&(this._playbackRate=e)},n.onWaiting=function(e){e.buffered>1e3&&this._index>this._lowProfileIndex&&(this._renderBlockCount++,this._renderBlockCount>this._conf.lowProfileThreshold&&(this._lowProfile=!0))},n.onDownloadEnabled=function(e){e||this._resetAlgorithm()},n._resetAlgorithm=function(){this._bufferSize=0,this._lastBufferSize=0,this._pastThroughput=new Array(this._conf.slidingWindowSize)},n._nextRateIndex=function(e,t){this._bufferSize=t,this._pastThroughput.shift(),this._pastThroughput.push(e),this._status===ve.Seek&&(t>=this._conf.targetBuffer||this._speedPredictCnt<=0)&&(this._speedPredictCnt=0,this._status=ve.Default,c.Log.i(Ee,"status change to default. buffered:"+t+" step:"+this._speedPredictCnt));var r=-1;return this._status===ve.Seek?(this._speedPredictCnt--,this._lastBufferSize=this._bufferSize,r=this._nextRateBySpeed(e)):r=this._nextRateBySpeedAndBuffered(e,t),this._lowProfile&&(r=Math.min(r,this._lowProfileIndex)),r},n._nextRateBySpeed=function(e){var t=1024*e,r=this._bitrates[this._index];if(t<r||t>r*this._conf.speedPredictRatio)for(var i=this._bitrates.length-1;i>=0;i--)if(t>this._bitrates[i]*this._conf.speedPredictRatio)return i;return this._index},n._nextRateBySpeedAndBuffered=function(e,t){var r,i=1024*e,n=this._bitrates,a=n[this._index];for(r=n.length-1;r>0&&!(i>n[r]*this._playbackRate);r--);var o=n[r],s=this._index,u=t/this._playbackRate;return o>a?u>o*this._conf.duration/i&&(s=r):o<a&&u<a*this._conf.duration/i+this._conf.duration&&(s=r),c.Log.v(Ee,"_nextRateBySpeedAndBuffered bitrateBySpeed:"+o+", nextBitrate:"+s+", bitrate:"+a+", remainingTime:"+u+", speed:"+i+", playbackRate:"+this._playbackRate),s},n._bitrateToIndex=function(e,t){return e.reduce((function(r,i,n){return(e[r]+i)/2>=t?r:n}),0)},n._maxBitrateIndex=function(e,t){return e.reduce((function(e,r,i){return r>t?e:i}),0)},t=e,(r=[{key:"nextIndex",get:function(){return this._nextIndex}},{key:"lowProfile",get:function(){return this._lowProfile}}])&&pe(t.prototype,r),i&&pe(t,i),e}();function Te(e,t){for(var r=0;r<t.length;r++){var i=t[r];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}var be={speedPredictRatioOnStart:6},Le=function(e){var t,r;function i(t,r){var i;return(i=e.call(this)||this)._config=void 0,i._media=void 0,i._algorithm=void 0,i._info=void 0,i._activity=!1,i._downloadEnd=void 0,i._downloadStartTime=0,i._index=0,i._availableList=void 0,i._orignList=[],i._abrList=[],i._abrInitLevel=0,i._config=t,i._media=r,i._downloadEnd=0,i}r=e,(t=i).prototype=Object.create(r.prototype),t.prototype.constructor=t,t.__proto__=r;var n,a,o,s=i.prototype;return s.init=function(e){var t=this;return this._info=e,this._abrInitLevel=e.index,this._activity=!!(this._config.adaptive&&e.levels.length>1),e.levels.forEach((function(e,r){t._orignList.push({index:r,bitrate:e.bitrate,enableAdaptive:e.enableAdaptive})})),this._activity?(this._algorithm=new Se(this._config.hlsAdaptiveConfig||be),this._updateAbrList(),this.emit(k.default.ABR_INFO,{lowProfile:this._algorithm.lowProfile?1:0})):this.active(!1),this._abrInitLevel||0},s.setAvailableAbrLevels=function(e){this._availableList=e,this._updateAbrList()},s.destory=function(){this._algorithm&&(this._algorithm=void 0)},s.onRatechange=function(e){this._algorithm&&this._algorithm.onRatechange(e)},s.onWaiting=function(){this._algorithm&&(this._algorithm.onWaiting({buffered:1e3*this._media.bufferedSec()}),this._algorithm.lowProfile&&this.emit(k.default.ABR_INFO,{lowProfile:this._algorithm.lowProfile?1:0}))},s.onDownload=function(e){if(this._algorithm&&this._info&&"number"==typeof e.slicePlayStartTime&&"number"==typeof e.slicePlayDuration&&j(e.slicePlayStartTime)&&j(e.slicePlayDuration)&&e.status===ie.SUCCESS){this._downloadEnd=e.slicePlayStartTime+e.slicePlayDuration;var t={buffered:this._downloadEnd-1e3*this._media.currentTime,duration:e.duration||0,spendTime:e.spendTime,byteLength:e.byteLength};this._algorithm.onDownload(t)}},s.onNewSource=function(e){this._algorithm&&this._info&&(this._downloadStartTime=this._downloadStartTime||performance.now(),this._info&&e.index>=0&&e.index<this._info.levels.length&&(this._index=e.index),this._algorithm.onLevelLoad(this._orignIndexToAbr(e.index)))},s.onSeek=function(e){this._algorithm&&this._info&&this._algorithm.onSeek({isInBuffer:e.isInBuffer,buffered:this._downloadEnd-1e3*this._media.currentTime})},s.active=function(e){this._activity=e},s.nextBitrateIndex=function(){if(this._activity&&this._info&&this._info.levels.length>1&&this._algorithm){var e=this._abrIndexToOrign(this._algorithm.nextIndex);if(e!==this._index&&e>=0&&e<this._info.levels.length)return e}return this._index},s.setDownloadEnabled=function(e){this._algorithm&&this._algorithm.onDownloadEnabled(e)},s._updateAbrList=function(){this._algorithm&&(this._generateAbrList(),this._algorithm.setInfo({levels:this._abrList,index:this._index}),this._abrInitLevel=this._abrIndexToOrign(this._algorithm.bitrateInit())||0)},s._generateAbrList=function(){var e=this,t=this._availableList;this._abrList=[],this._orignList.forEach((function(r,i){r.enableAdaptive&&(!t||t&&-1!==t.indexOf(i))&&e._abrList.push(r)})),this._abrList.sort((function(e,t){return e.bitrate-t.bitrate}))},s._abrIndexToOrign=function(e){var t=this._abrList[e];return t?t.index:0},s._orignIndexToAbr=function(e){var t=0;return this._abrList.forEach((function(r,i){r.index!==e||(t=i)})),t},n=i,(a=[{key:"autoLevelEnabled",get:function(){return!!this._activity}},{key:"abrInitLevel",get:function(){return this._abrInitLevel}}])&&Te(n.prototype,a),o&&Te(n,o),i}(a.EventEmitter),Ae="LevelHelper";function Re(e,t,r){var i=e[t],n=e[r],a=n.startPTS;j(a)?r>t?(i.duration=a-i.start,i.duration<0&&c.Log.w(Ae,"negative duration computed for frag "+i.sn+",level "+i.level+", there should be some duration drift between playlist and fragment!")):(n.duration=i.start-a,n.duration<0&&c.Log.w(Ae,"negative duration computed for frag "+n.sn+",level "+n.level+", there should be some duration drift between playlist and fragment!")):n.start=r>t?i.start+i.duration:Math.max(i.start-n.duration,0)}function Ie(e,t,r,i,n,a){var o=r;if(j(t.startPTS)){var s=Math.abs(t.startPTS-r);j(t.deltaPTS)?t.deltaPTS=Math.max(s,t.deltaPTS):t.deltaPTS=s,o=Math.max(r,t.startPTS),r=Math.min(r,t.startPTS),i=Math.max(i,t.endPTS),n=Math.min(n,t.startDTS),a=Math.max(a,t.endDTS)}var u=r-t.start;t.start=t.startPTS=r,t.maxStartPTS=o,t.endPTS=i,t.startDTS=n,t.endDTS=a,t.duration=i-r;var d,c=t.sn;if(!e||c<e.startSN||c>e.endSN||"number"!=typeof c)return 0;var l=c-e.startSN,f=e.fragments;for(f[l]=t,d=l;d>0;d--)Re(f,d,d-1);for(d=l;d<f.length-1;d++)Re(f,d,d+1);return e.PTSKnown=!0,u}function ke(e,t){t.initSegment&&e.initSegment&&(t.initSegment=e.initSegment);var r,i=0;if(function(e,t,r){if(e&&t)for(var i=Math.max(e.startSN,t.startSN)-t.startSN,n=Math.min(e.endSN,t.endSN)-t.startSN,a=t.startSN-e.startSN,o=i;o<=n;o++){var s=e.fragments[a+o],u=t.fragments[o];if(!s||!u)break;r(s,u,o)}}(e,t,(function(e,n){i=e.cc-n.cc,j(e.startPTS)&&(n.start=n.startPTS=e.startPTS,n.endPTS=e.endPTS,n.duration=e.duration,n.backtracked=e.backtracked,n.dropped=e.dropped,r=n),t.PTSKnown=!0})),t.PTSKnown){if(i){c.Log.v(Ae,"discontinuity sliding from playlist, take drift into account");for(var n=t.fragments,a=0;a<n.length;a++)n[a].cc+=i}r?Ie(t,r,r.startPTS,r.endPTS,r.startDTS,r.endDTS):function(e,t){var r=t.startSN-e.startSN,i=e.fragments,n=t.fragments;if(!(r<0||r>i.length))for(var a=0;a<n.length;a++)n[a].start+=i[r].start}(e,t),t.PTSKnown=e.PTSKnown}}function Ce(e,t){for(var r=0;r<t.length;r++){var i=t[r];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}var xe=function(e){var t,r;function i(t){var r;return(r=e.call(this)||this)._protocol=u.Protocol.UNKNOWN,r._config=void 0,r._onManifestLoaded=function(e){r.emit(k.default.MANIFEST_PARSED,e)},r._config=t,r}r=e,(t=i).prototype=Object.create(r.prototype),t.prototype.constructor=t,t.__proto__=r;var n,a,o,s=i.prototype;return s.loadManifest=function(e){var t=ee.parse(this._config.src,this._config.baseURL);this._onManifestLoaded({levels:t.levels,hasVideo:t.hasVideo,hasAudio:t.hasAudio})},s.loadLevel=function(e,t){void 0===t&&(t=u.LevelType.MAIN)},s.destroy=function(){},n=i,(a=[{key:"protocol",get:function(){return this._protocol}}])&&Ce(n.prototype,a),o&&Ce(n,o),i}(a.EventEmitter),De=/^(\d+)x(\d+)$/,we=/\s*(.+?)\s*=((?:\".*?\")|.*?)(?:,|$)/g,Oe=function(){function e(t){for(var r in"string"==typeof t&&(t=e.parseAttrList(t)),t)t.hasOwnProperty(r)&&(this[r]=t[r])}var t=e.prototype;return t.decimalInteger=function(e){var t=parseInt(this[e],10);return t>Number.MAX_SAFE_INTEGER?1/0:t},t.hexadecimalInteger=function(e){if(this[e]){var t=(this[e]||"0x").slice(2);t=(1&t.length?"0":"")+t;for(var r=new Uint8Array(t.length/2),i=0;i<t.length/2;i++)r[i]=parseInt(t.slice(2*i,2*i+2),16);return r}return null},t.hexadecimalIntegerAsNumber=function(e){var t=parseInt(this[e],16);return t>Number.MAX_SAFE_INTEGER?1/0:t},t.decimalFloatingPoint=function(e){return parseFloat(this[e])},t.optionalFloat=function(e,t){var r=this[e];return r?parseFloat(r):t},t.enumeratedString=function(e){return this[e]},t.bool=function(e){return"YES"===this[e]},t.decimalResolution=function(e){var t=De.exec(this[e]);if(null!==t)return{width:parseInt(t[1],10),height:parseInt(t[2],10)}},e.parseAttrList=function(e){var t,r={};for(we.lastIndex=0;null!==(t=we.exec(e));){var i=t[2];0===i.indexOf('"')&&i.lastIndexOf('"')===i.length-1&&(i=i.slice(1,-1)),r[t[1]]=i}return r},e}();function Pe(){return window.MediaSource||window.WebKitMediaSource}var Ne={audio:{a3ds:!0,"ac-3":!0,"ac-4":!0,alac:!0,alaw:!0,dra1:!0,"dts+":!0,"dts-":!0,dtsc:!0,dtse:!0,dtsh:!0,"ec-3":!0,enca:!0,g719:!0,g726:!0,m4ae:!0,mha1:!0,mha2:!0,mhm1:!0,mhm2:!0,mlpa:!0,mp4a:!0,"raw ":!0,Opus:!0,samr:!0,sawb:!0,sawp:!0,sevc:!0,sqcp:!0,ssmv:!0,twos:!0,ulaw:!0},video:{avc1:!0,avc2:!0,avc3:!0,avc4:!0,avcp:!0,drac:!0,dvav:!0,dvhe:!0,encv:!0,hev1:!0,hvc1:!0,mjp2:!0,mp4v:!0,mvc1:!0,mvc2:!0,mvc3:!0,mvc4:!0,resv:!0,rv60:!0,s263:!0,svc1:!0,svc2:!0,"vc-1":!0,vp08:!0,vp09:!0}};function Me(e,t){return void 0===t&&(t=""),Pe().isTypeSupported((t||"video")+'/mp4;codecs="'+e+'"')}var Ue=/#EXT-X-STREAM-INF:([^\n\r]*)[\r\n]+([^\r\n]+)/g,Be=/#EXT-X-MEDIA:(.*)/g,Fe=new RegExp([/#EXTINF:\s*(\d*(?:\.\d+)?)(?:,(.*)\s+)?/.source,/|(?!#)([\S+ ?]+)/.source,/|#EXT-X-BYTERANGE:*(.+)/.source,/|#EXT-X-PROGRAM-DATE-TIME:(.+)/.source,/|#.*/.source].join(""),"g"),Ve=/(?:(?:#(EXTM3U))|(?:#EXT-X-(PLAYLIST-TYPE):(.+))|(?:#EXT-X-(MEDIA-SEQUENCE): *(\d+))|(?:#EXT-X-(TARGETDURATION): *(\d+))|(?:#EXT-X-(KEY):(.+))|(?:#EXT-X-(START):(.+))|(?:#EXT-X-(ENDLIST))|(?:#EXT-X-(DISCONTINUITY-SEQ)UENCE:(\d+))|(?:#EXT-X-(DIS)CONTINUITY))|(?:#EXT-X-(VERSION):(\d+))|(?:#EXT-X-(MAP):(.+))|(?:(#)([^:]*):(.*))|(?:(#)(.*))(?:.*)\r?\n?/,He=/\.(mp4|m4s|m4v|m4a)$/i;function je(e,t){e.rawProgramDateTime?e.programDateTime=Date.parse(e.rawProgramDateTime):t&&t.programDateTime&&(e.programDateTime=t.endProgramDateTime),"number"==typeof e.programDateTime&&j(e.programDateTime)||(e.programDateTime=null,e.rawProgramDateTime=null)}var Ge,Ke,We,qe,ze=function(){function e(){}return e.findGroup=function(e,t){for(var r=0;r<e.length;r++){var i=e[r];if(i.id===t)return i}},e.convertAVC1ToAVCOTI=function(e){var t,r=e.split(".");return r.length>2?(t=r.shift()+".",t+=parseInt(r.shift(),10).toString(16),t+=("000"+parseInt(r.shift(),10).toString(16)).substr(-4)):t=e,t},e.resolve=function(e,t){return Object(G.buildAbsoluteURL)(t,e,{alwaysNormalize:!0})},e.setCodecs=function(e,t){["video","audio"].forEach((function(r){var i=e.filter((function(e){return function(e,t){var r=Ne[t];return!!r&&!0===r[e.slice(0,4)]}(e,r)}));if(i.length){var n=i.filter((function(e){return 0===e.lastIndexOf("avc1",0)||0===e.lastIndexOf("mp4a",0)}));t[r+"Codec"]=n.length>0?n[0]:i[0],e=e.filter((function(e){return-1===i.indexOf(e)}))}})),t.codec=e.join(",")},e.parseMasterPlaylist=function(t,r){var i,n=[];for(Ue.lastIndex=0;null!==(i=Ue.exec(t));){var a=new Z(e.resolve(i[2],r)),o=a.attrs=new Oe(i[1]),s=o.decimalResolution("RESOLUTION");s&&(a.width=s.width,a.height=s.height),a.maxBitrate=o.decimalInteger("BANDWIDTH"),a.avgBitrate=o.decimalInteger("AVERAGE-BANDWIDTH"),a.bitrate=a.avgBitrate||a.maxBitrate,a.name=o.NAME,e.setCodecs([].concat((o.CODECS||"").split(/[ ,]+/)),a),a.videoCodec&&-1!==a.videoCodec.indexOf("avc1")&&(a.videoCodec=e.convertAVC1ToAVCOTI(a.videoCodec)),n.push(a)}return n},e.parseMasterPlaylistMedia=function(t,r,i,n){var a;void 0===n&&(n=[]);var o=[],s=0;for(Be.lastIndex=0;null!==(a=Be.exec(t));){var u=new Oe(a[1]);if(u.TYPE===i){var d=new Z(u.URI?e.resolve(u.URI,r):"");if(d.attrs=u,d.index=d.id=s++,d.groupId=u["GROUP-ID"]||"",d.instreamId=u["INSTREAM-ID"]||"",d.name=u.NAME||u.LANGUAGE,d.type=i,d.default="YES"===u.DEFAULT,d.autoselect="YES"===u.AUTOSELECT,d.forced="YES"===u.FORCED,d.lang=u.LANGUAGE||"",n.length){var c=e.findGroup(n,d.groupId);d.audioCodec=c?c.codec:n[0].codec}o.push(d)}}return o},e.parseLevelPlaylist=function(e,t,r,i,n){var a,o,s,u=0,d=0,l=0,f=null,_=new X,h=null,p=new Z(t);for(Fe.lastIndex=0;null!==(o=Fe.exec(e));){var v=o[1];if(v){_.duration=parseFloat(v);var m=(" "+o[2]).slice(1);_.title=m||null,_.tagList.push(m?["INF",v,m]:["INF",v])}else if(o[3]){if(j(_.duration)){var g=u++;_.type=i,_.start=d,_.levelkey=a,_.sn=g,_.level=r,_.cc=l,_.urlId=n,_.baseurl=t,_.relurl=(" "+o[3]).slice(1),je(_,f),p.fragments.push(_),f=_,d+=_.duration,_=new X}}else if(o[4]){var y=(" "+o[4]).slice(1);f?_.setByteRange(y,f):_.setByteRange(y)}else if(o[5])_.rawProgramDateTime=(" "+o[5]).slice(1),_.tagList.push(["PROGRAM-DATE-TIME",_.rawProgramDateTime]),null===h&&(h=p.fragments.length);else{if(!(o=o[0].match(Ve))||o.length<=0)break;for(s=1;s<o.length&&void 0===o[s];s++);var E=(" "+o[s+1]).slice(1),S=(" "+o[s+2]).slice(1);switch(o[s]){case"#":_.tagList.push(S?[E,S]:[E]);break;case"PLAYLIST-TYPE":p.type=E.toUpperCase();break;case"MEDIA-SEQUENCE":u=p.startSN=parseInt(E,10);break;case"TARGETDURATION":p.targetduration=parseFloat(E);break;case"VERSION":p.version=parseInt(E,10);break;case"EXTM3U":break;case"ENDLIST":p.live=!1;break;case"DIS":l++,_.tagList.push(["DIS"]);break;case"DISCONTINUITY-SEQ":l=parseInt(E,10);break;case"KEY":var T=new Oe(E),b=T.enumeratedString("METHOD"),L=T.URI,A=T.hexadecimalInteger("IV");b&&(a=new z(t,L),L&&["AES-128","SAMPLE-AES","SAMPLE-AES-CENC"].indexOf(b)>=0&&(a.method=b,a.key=null,A&&(a.iv=A)));break;case"START":var R=new Oe(E).decimalFloatingPoint("TIME-OFFSET");j(R)&&(p.startTimeOffset=R);break;case"MAP":var I=new Oe(E);_.relurl=I.URI,I.BYTERANGE&&_.setByteRange(I.BYTERANGE),_.baseurl=t,_.level=r,_.type=i,_.sn="initSegment",p.initSegment=_,(_=new X).rawProgramDateTime=p.initSegment.rawProgramDateTime;break;default:c.Log.w("line parsed but not handled: "+o)}}}return(_=f)&&!_.relurl&&(p.fragments.pop(),d-=_.duration),p.totalduration=d,p.averagetargetduration=d/p.fragments.length,p.endSN=u-1,!p.initSegment&&p.fragments.length&&p.fragments.every((function(e){return He.test(e.relurl)}))&&(c.Log.w("MP4 fragments found but no init segment (probably no MAP, incomplete M3U8), trying to fetch SIDX"),(_=new X).relurl=p.fragments[0].relurl,_.baseurl=t,_.level=r,_.type=i,_.sn="initSegment",p.initSegment=_,p.needSidxRanges=!0),h&&function(e,t){for(var r=e[t],i=t-1;i>=0;i--){var n=e[i];r.programDateTime&&(n.programDateTime=r.programDateTime-1e3*n.duration),r=n}}(p.fragments,h),p},e}(),Ye=function(){function e(){}return e.verify=function(e){return!!(e&&e.adaptationSet&&e.adaptationSet.representation&&e.adaptationSet.representation.length)},e.parse=function(t){var r=[];return e.verify(t)&&t.adaptationSet.representation.forEach((function(e){if(e&&(e.url||e.m3u8)){var t=new Z(e.baseUrl?ze.resolve(e.url,e.baseUrl):e.url);t.bitrate=e.bandwidth,t.maxBitrate=e.bandwidth,t.bitrate=t.avgBitrate||t.maxBitrate,t.qualityType=e.qualityType||"",t.qualityLabel=e.qualityLabel||"",e.width&&e.height&&(t.width=e.width,t.height=e.height),ze.setCodecs([].concat((e.codecs||"").split(/[ ,]+/)),t),t.audioCodec="",t.m3u8Slice=e.m3u8||e.m3u8Slice,t.totalduration=e.duration,e.backupUrl&&e.backupUrl.length&&(t.url=t.url.concat(e.backupUrl)),t.urlId=0,r.push(t)}})),{levels:r,def:0}},e}();function Xe(e){var t={};return(e||"").split(/[ ,]+/).forEach((function(e){0!==e.indexOf("avc1")&&0!==e.indexOf("hev1")||(t.video=e),0===e.indexOf("mp4a")&&(t.audio=e)})),t}(Ke=Ge||(Ge={}))[Ke.HLSTS=1]="HLSTS",Ke[Ke.MP4=2]="MP4",Ke[Ke.FLV=3]="FLV",(qe=We||(We={}))[qe.LongVideo=1]="LongVideo",qe[qe.ShortVideo=2]="ShortVideo",qe[qe.LiveGame=3]="LiveGame",qe[qe.LiveShow=4]="LiveShow",qe[qe.LivePlayBack=5]="LivePlayBack";var Qe,Je,$e,Ze=function(){function e(){}return e.verify=function(e){return!!(e&&e.adaptationSet&&e.adaptationSet.length)&&e.adaptationSet.reduce((function(e,t){return!!(e&&t.representation&&t.representation.length)}),!0)},e.parse=function(t,r){var i,n=[],a=[],o=[],s=!1,d=0;if(e.verify(t)){var c=t;c.adaptationSet.forEach((function(e){var t=e.duration/1e3;!d&&t&&(d=t);var l=e.drmSchemaId,f=e.drmToken;e.drmSchemaId&&(s=!0);var _=u.LevelType.MAIN;if(e.mimeType&&(-1!==e.mimeType.indexOf("video")||(_=-1!==e.mimeType.indexOf("audio")?u.LevelType.AUDIO:"text/vtt"===e.mimeType?u.LevelType.SUBTITLE:void 0)),_){var h=e.representation.map((function(n,h){var p;if(r===u.Protocol.HLS?((p=new Z(n.url)).lang=e.language||"",p.default=n.defaultSelect,_===u.LevelType.MAIN?p.id=n.id||h:_===u.LevelType.AUDIO?p.id=n.id||a.length+h:_===u.LevelType.SUBTITLE&&(p.id=n.id||o.length+h),p.m3u8Slice=n.m3u8Slice,p.totalduration=t||d,p.maxBitrate=1024*(n.maxBitrate||0)):(p=new J(n.url)).maxBitrate=n.maxBitrate||0,p.bitrate=p.avgBitrate||p.maxBitrate,p.qualityType=n.qualityType||"",p.qualityLabel=n.qualityLabel||"",p.codec=n.codecs||"",p.codec){var v=Xe(p.codec);p.audioCodec=v.audio||"",p.videoCodec=v.video||""}return 1===c.adaptationSet.length&&(p.audioCodec=""),n.width&&n.height&&(p.width=n.width,p.height=n.height),p.hidden=n.hidden||!1,p.enableAdaptive=void 0===n.disableAdaptive||!n.disableAdaptive,p.default=n.defaultSelect||!1,p.index=h,p.drmSchemaId=n.drmSchemaId||l,p.drmToken=n.drmToken||f,p.drmSchemaId&&(s=!0),n.backupUrl&&n.backupUrl.length&&(p.url=p.url.concat(n.backupUrl)),p.urlId=0,_===u.LevelType.MAIN&&p.default&&void 0===i&&(i=h),p}));_===u.LevelType.MAIN?n=n.concat(h):_===u.LevelType.AUDIO?a=a.concat(h):_===u.LevelType.SUBTITLE&&(o=o.concat(h))}}))}return e.processingSubtitleType(o,d),{levels:n,def:i||0,audioTracks:a,subtitleTracks:o,drm:s}},e.processingSubtitleType=function(e,t){e.forEach((function(e,r){if(-1===e.currentUrl.indexOf(".m3u8")){e.live=!1,e.index=r,e.details=new Z(""),e.totalduration=t;var i=new X;i.type=u.LevelType.SUBTITLE,i.start=0,i.sn=1,i.level=r,i.cc=0,i.url=e.currentUrl,i.duration=t,e.details.live=!1,e.details.targetduration=t,e.details.totalduration=t,e.details.endSN=1,e.details.fragments=[i]}}))},e}(),et=function(){function e(){}return e.parse=function(e){if(Ye.verify(e))return{levels:Ye.parse(e).levels,audioTracks:[],subtitleTracks:[]};if(Ze.verify(e)){var t=Ze.parse(e,u.Protocol.HLS);return{levels:t.levels,audioTracks:t.audioTracks,subtitleTracks:t.subtitleTracks,drm:t.drm}}return{levels:[],audioTracks:[],subtitleTracks:[]}},e.parseLevelSlice=function(e){if(e.m3u8Slice){var t=ze.parseLevelPlaylist(e.m3u8Slice,e.url[0],e.index,u.LevelType.MAIN,0);return delete e.m3u8Slice,t}},e}(),tt=0,rt=function(){var e=t.prototype;function t(){var e=this;this.context=void 0,this._loader=void 0,this._callbacks=null,this._config=void 0,this._loaderCallback=void 0,this._stats=void 0,this._retryDelay=0,this._loading=!1,this._aborted=!1,this._requestTimeout=void 0,this._transTimer=void 0,this._retryTimeout=void 0,this._rangeStart=void 0,this._continuedTransmissionRetry=!1,this._progressTime=0,this._loadInternal=function(){e._loading=!0,e._aborted=!1;var t=e._stats;t.code=0,t.tfirst=0,t.loaded=0,e._retryTimeout&&(clearTimeout(e._retryTimeout),e._retryTimeout=null),e.context.progress?e._loader=new(e._getInternalLoader(!!e._config.useFetch)):e._loader=new s,e._loader&&(t.id=e._loader.tag+"-"+tt,e._config.connectionTimeout&&(e._requestTimeout=setTimeout(e._onTimeout,e._config.connectionTimeout)),e.context.rangeEnd?e.context.range="bytes="+e.context.rangeStart+"-"+(e.context.rangeEnd-1):e.context.rangeStart&&(e.context.range="bytes="+e.context.rangeStart+"-"),t.tsload=Date.now(),t.tstart=performance.now(),e._loader.load(e.context,e._loaderCallback))},this._onConnect=function(t){e._requestTimeout&&(clearTimeout(e._requestTimeout),e._requestTimeout=null),e._startTransmissionTimer(),e._stats.code=t,e._stats.tfirst=Math.max(e._stats.trequest,performance.now()),e._callbacks&&e._callbacks.onConnect&&e._callbacks.onConnect(e.context,e._stats)},this._onProgress=function(t,r){var i=e._stats;if(e._progressTime=performance.now(),!e._continuedTransmissionRetry&&i.output>i.loaded){if(i.loaded+r.byteLength-i.output>0){var n=r.slice(i.output-i.loaded);i.loaded+=r.byteLength,e._callProgress(e.context,n,i)}}else i.loaded+=r.byteLength,e._callProgress(e.context,r,i)},this._onError=function(t){c.Log.i("loader",t),e._stopTimer(),e._destroyLoader();var r=e._stats,i=e._config;e._loading=!1,r.fatal=!i.maxRetry||r.retry>=i.maxRetry||!i.maxRetry,r.text=t.message||"load error",e._callbacks&&e._callbacks.onError&&e._callbacks.onError(e.context,r),r.fatal||(e._stats.output&&e._stats.loaded>0?(e._rangeStart?e.context.rangeStart=e._rangeStart+e._stats.output:e.context.rangeStart=e._stats.output,e._continuedTransmissionRetry=!0):(e.context.rangeStart=e._rangeStart,e._continuedTransmissionRetry=!1),r.retry++,e._callbacks&&(e._retryDelay?(e._retryTimeout=setTimeout(e._loadInternal,e._retryDelay),e._retryDelay=2*e._retryDelay):e._loadInternal()))},this._onTimeout=function(){e._loading=!1,e._abortInternal();var t=new Error("timeout");e._onError(t)},tt++,this._loader=null,this._config={useFetch:!1,connectionTimeout:0,transmissionTimeout:0,maxRetry:0,retryDelay:0},this._loaderCallback={onConnect:this._onConnect,onProgress:this._onProgress,onEnd:this._onEnd.bind(this),onError:this._onError}}return e._getInternalLoader=function(e){if(void 0!==Qe)return Qe;if(Qe=null,d.default.msie||d.default.msedge){if(e)return o.isSupport()&&(Qe=o),Qe;s.isSupportChunk()?Qe=s:o.isSupport()&&(Qe=o)}else o.isSupport()?Qe=o:s.isSupportChunk()&&(Qe=s);return Qe},e.load=function(e,t,r){this._init(e,t,r),this._loadInternal()},e.destroy=function(){this._stopTimer(),this._abortInternal(),this._destroyLoader(),this._callbacks=null},e._init=function(e,t,r){this.context=e,this._rangeStart=e.rangeStart,this._callbacks=t,this._config=r||this._config,this._stats={id:"",trequest:performance.now(),retry:0,loaded:0,code:0,output:0,tfirst:0,tload:0,total:0,tsload:0,tstart:0,fatal:!1,text:""},this._config.retryDelay&&(this._retryDelay=this._config.retryDelay)},e._destroyLoader=function(){this._loader&&(this._loader.destroy(),this._loader=null)},e._abortInternal=function(){this._callbacks&&this._callbacks.onAbort&&!this._aborted&&this._loading&&this._callbacks.onAbort(this.context,this._stats),this._aborted=!0,this._loader&&this._loader.abort()},e.abort=function(){this._stopTimer(),this._abortInternal()},e._stopTimer=function(){this._requestTimeout&&(clearTimeout(this._requestTimeout),this._requestTimeout=null),this._retryTimeout&&(clearTimeout(this._retryTimeout),this._retryTimeout=null),this._stopTransmissionTimer()},e._callProgress=function(e,t,r){this._stats.output+=t.byteLength,this._callbacks&&this._callbacks.onProgress&&this._callbacks.onProgress(e,t,r)},e._onEnd=function(e,t){this._stopTimer();var r=this._stats;r.total=t?r.loaded="string"==typeof t?t.length||0:t.byteLength||0:r.loaded,r.tload=Math.max(r.tfirst,performance.now()),this._loading=!1,r.output=0,this._callbacks&&this._callbacks.onEnd(e,t,r)},e._startTransmissionTimer=function(){var e=this;this._stopTransmissionTimer(),this._progressTime=performance.now();var t=this._config.transmissionTimeout||0;t&&(this._transTimer=setInterval((function(){performance.now()-e._progressTime>t&&e._onTimeout()}),1e3))},e._stopTransmissionTimer=function(){this._transTimer&&(clearInterval(this._transTimer),this._transTimer=null)},t}();function it(e){switch(e){case u.LevelType.MAIN:return Je.LEVEL;case u.LevelType.SUBTITLE:return Je.SUBTITLE_TRACK;case u.LevelType.AUDIO:return Je.AUDIO_TRACK;default:return Je.LEVEL}}($e=Je||(Je={})).MANIFEST="manifest",$e.LEVEL="level",$e.AUDIO_TRACK="audioTrack",$e.SUBTITLE_TRACK="subtitleTrack";var nt=function(e){var t,r;function i(t){var r;return(r=e.call(this)||this).loaders={},r.tag="PlaylistLoader",r._config=void 0,r._loadsuccess=function(e,t,i){if(r.emit(k.default.DOWNLOAD,ce(ie.SUCCESS,e,i)),e.isSidxRequest)r.emit(k.default.ERROR,{type:I.ErrorTypes.OTHER_ERROR,details:I.ErrorDetails.UNSUPPORTED,fatal:!0,url:e.url,reason:"unsupport sidx",statusCode:i.code});else if(r._resetInternalLoader(e.type),"string"==typeof t){var n=t;if(0!==n.indexOf("#EXTM3U")){var a=n;return a.length>4096&&(a=a.slice(0,4096)),void r._handleManifestParsingError(e,a,i)}n.indexOf("#EXTINF:")>0||n.indexOf("#EXT-X-TARGETDURATION:")>0?r._handleTrackOrLevelPlaylist(e,t,i):r._handleMasterPlaylist(e,t,i)}else r.emit(k.default.ERROR,{type:I.ErrorTypes.NETWORK_ERROR,details:I.ErrorDetails.MANIFEST_PARSING_ERROR,fatal:!0,url:e.url,reason:'expected responseType of "text" for PlaylistLoader',statusCode:i.code})},r._loaderror=function(e,t){r._handleNetworkError(e,t)},r._loadAbort=function(e,t){r.emit(k.default.DOWNLOAD,ce(ie.ABORT,e,t))},r._config=t,r.loaders={},r}r=e,(t=i).prototype=Object.create(r.prototype),t.prototype.constructor=t,t.__proto__=r,i.canHaveQualityLevels=function(e){return e===Je.LEVEL},i.mapContextToLevelType=function(e){switch(e.type){case Je.AUDIO_TRACK:return u.LevelType.AUDIO;case Je.SUBTITLE_TRACK:return u.LevelType.SUBTITLE;default:return u.LevelType.MAIN}},i.getResponseUrl=function(e){var t=e.responseUrl;return t&&0!==t.indexOf("data:")||(t=e.url),t};var n=i.prototype;return n._createInternalLoader=function(e){var t=new rt;return e.loader=t,this.loaders[e.type]=t,t},n._getInternalLoader=function(e){return this.loaders[e.type]},n._resetInternalLoader=function(e){this.loaders[e]&&delete this.loaders[e]},n._destroyInternalLoaders=function(){for(var e in this.loaders){var t=this.loaders[e];t&&t.destroy(),this._resetInternalLoader(e)}},n.destroy=function(){this.removeAllListeners(),this._destroyInternalLoaders()},n.load=function(e){c.Log.d(this.tag,"Loading playlist of type "+e.type+", level: "+e.level+", id: "+e.id);var t,r,i,n,a=this._getInternalLoader(e);if(a){var o=a.context;if(o&&o.url===e.url)return c.Log.i(this.tag,"playlist request ongoing"),!1;c.Log.w(this.tag,"aborting previous loader for type: "+e.type),a.abort()}switch(e.type){case Je.MANIFEST:t=this._config.manifestLoadingMaxRetry,r=this._config.manifestConnectionTimeout,i=this._config.manifestTransmissionTimeout,n=this._config.manifestLoadingRetryDelay;break;default:t=this._config.levelLoadingMaxRetry,r=this._config.levelConnectionTimeout,i=this._config.levelTransmissionTimeout,n=this._config.levelLoadingRetryDelay}a=this._createInternalLoader(e),e.responseType=e.responseType||"text";var s={connectionTimeout:r,transmissionTimeout:i,maxRetry:t,retryDelay:n},u={onEnd:this._loadsuccess,onError:this._loaderror,onAbort:this._loadAbort};return c.Log.d(this.tag,"Calling internal loader delegate for URL: "+e.url),a.load(e,u,s),!0},n._handleMasterPlaylist=function(e,t,r){var n=t,a=i.getResponseUrl(e),o=ze.parseMasterPlaylist(n,a);if(o.length){var s=o.map((function(e){return{id:e.attrs.AUDIO,codec:e.audioCodec}})),d=ze.parseMasterPlaylistMedia(n,a,"AUDIO",s),l=ze.parseMasterPlaylistMedia(n,a,"SUBTITLES",s);if(d.length){var f=!1;if(d.forEach((function(e){e.url||(f=!0)})),!1===f&&o[0].audioCodec&&!o[0].attrs.AUDIO){c.Log.v(this.tag,"audio codec signaled in quality level, but no embedded audio track signaled, create one");var _=new Z("");_.type=u.LevelType.MAIN,_.name="main",_.id=-1,d.unshift(_)}}this.emit(k.default.MANIFEST_PARSED,{levels:o,audioTracks:d,subtitleTracks:l,url:a,stats:r})}else this._handleManifestParsingError(e,"no level found in manifest",r)},n._handleTrackOrLevelPlaylist=function(e,t,r){var n=e.id,a=e.level,o=e.type,s=i.getResponseUrl(e),u=j(n)?n:0,d=j(a)?a:u,c=i.mapContextToLevelType(e),l=ze.parseLevelPlaylist(t,s,d,c,u);if(o===Je.MANIFEST){var f=new Z(s);f.details=l,this.emit(k.default.MANIFEST_PARSED,{levels:[f],singleLevel:!0,url:s,stats:r})}if(l.needSidxRanges&&l.initSegment){var _=l.initSegment.url;this.load({url:_,isSidxRequest:!0,type:o,level:a,levelDetails:l,id:n,rangeStart:0,rangeEnd:2048,responseType:"arraybuffer",headers:this._config.headers})}else e.levelDetails=l,this._handlePlaylistLoaded(e,r)},n._handleManifestParsingError=function(e,t,r){this.emit(k.default.ERROR,{type:I.ErrorTypes.NETWORK_ERROR,details:I.ErrorDetails.MANIFEST_PARSING_ERROR,fatal:!0,url:e.url,reason:t,statusCode:r.code})},n._handleNetworkError=function(e,t){var r,i;c.Log.i(this.tag,"A network error occured while loading a "+e.type+"-type playlist");var n=this._getInternalLoader(e);switch(e.type){case Je.MANIFEST:r=I.ErrorDetails.HLS_MANIFEST_LOAD_ERROR,i=!0;break;case Je.LEVEL:r=I.ErrorDetails.HLS_LEVEL_LOAD_ERROR,i=!1;break;case Je.AUDIO_TRACK:r=I.ErrorDetails.HLS_AUDIO_TRACK_LOAD_ERROR,i=!1;break;default:i=!1}this.emit(k.default.DOWNLOAD,ce(ie.FAIL,e,t)),t.fatal&&(n&&(n.abort(),this._resetInternalLoader(e.type)),this.emit(k.default.ERROR,{type:I.ErrorTypes.NETWORK_ERROR,details:r,fatal:i,url:e.url,reason:t.text,statusCode:t.code}))},n._handlePlaylistLoaded=function(e,t){var r=e.type,n=e.level,a=e.id,o=e.levelDetails;if(o&&o.targetduration)if(i.canHaveQualityLevels(e.type))this.emit(k.default.LEVEL_LOADED,{details:o,level:n||0,id:a||0,stats:t});else switch(r){case Je.AUDIO_TRACK:this.emit(k.default.AUDIO_TRACK_LOADED,{details:o,level:n||0,id:a,stats:t});break;case Je.SUBTITLE_TRACK:this.emit(k.default.SUBTITLE_TRACK_LOADED,{details:o,level:n||0,id:a,stats:t})}else this._handleManifestParsingError(e,"invalid target duration",t)},i}(a.EventEmitter);function at(e,t){for(var r=0;r<t.length;r++){var i=t[r];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}var ot={hls:function(e){var t,r;function i(t){var r;return(r=e.call(this)||this)._protocol=u.Protocol.UNKNOWN,r._playlistLoader=void 0,r._config=void 0,r._onManifestLoaded=function(e){r.emit(k.default.MANIFEST_PARSED,e)},r._onLevelLoaded=function(e){r.emit(k.default.LEVEL_LOADED,e,u.LevelType.MAIN)},r._onAudioLevelLoaded=function(e){r.emit(k.default.AUDIO_TRACK_LOADED,e)},r._onSubtitleLevelLoaded=function(e){r.emit(k.default.SUBTITLE_TRACK_LOADED,e)},r._config=t,r._playlistLoader=new nt(r._config),r._playlistLoader.on(k.default.MANIFEST_PARSED,r._onManifestLoaded),r._playlistLoader.on(k.default.LEVEL_LOADED,r._onLevelLoaded),r._playlistLoader.on(k.default.AUDIO_TRACK_LOADED,r._onAudioLevelLoaded),r._playlistLoader.on(k.default.SUBTITLE_TRACK_LOADED,r._onSubtitleLevelLoaded),r._playlistLoader.on(k.default.DOWNLOAD,(function(e){r.emit(k.default.DOWNLOAD,e)})),r._playlistLoader.on(k.default.ERROR,(function(e){r.emit(k.default.ERROR,e)})),"object"==typeof t.src&&(r._protocol=u.Protocol.KWAI_HLS),r}r=e,(t=i).prototype=Object.create(r.prototype),t.prototype.constructor=t,t.__proto__=r;var n,a,o,s=i.prototype;return s.loadManifest=function(e){this._protocol!==u.Protocol.KWAI_HLS?this._playlistLoader&&this._playlistLoader.load({url:this._config.src,type:Je.MANIFEST,level:0,id:null,credentials:this._config.credentials,headers:this._config.headers}):this._onManifestLoaded(et.parse(this._config.src))},s.loadLevel=function(e,t){if(void 0===t&&(t=u.LevelType.MAIN),e.m3u8Slice){var r=et.parseLevelSlice(e);if(r&&(e.totalduration&&(r.totalduration=e.totalduration),e.details=r,this.emit(k.default.LEVEL_UPDATED,t),!r.live))return}if(this._playlistLoader){var i=e.urlId,n=e.url[i];this._playlistLoader.load({url:n,type:it(t),level:e.index,id:i,credentials:this._config.credentials,headers:this._config.headers})}},s.destroy=function(){this._playlistLoader&&(this._playlistLoader.destroy(),this._playlistLoader=void 0)},n=i,(a=[{key:"protocol",get:function(){return this._protocol}}])&&at(n.prototype,a),o&&at(n,o),i}(a.EventEmitter),flv:xe},st=r("./src/io/data-cache.ts"),ut=r("./src/core/worker-cmd.ts");function dt(e){void 0===e&&(e=u.CodecType.h264);var t=Pe(),r='video/mp4; codecs="avc1.42E01E,mp4a.40.2"';return e===u.CodecType.av1?r='video/mp4; codecs="av01.0.15M.10,mp4a.40.2"':e===u.CodecType.h265&&(r='video/mp4; codecs="hev1.1.6.L150.90,mp4a.40.2"'),t&&"function"==typeof t.isTypeSupported&&t.isTypeSupported(r)}var ct=r("./src/demux/demuxer-inline.ts");function lt(){return(lt=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var i in r)Object.prototype.hasOwnProperty.call(r,i)&&(e[i]=r[i])}return e}).apply(this,arguments)}function ft(e,t){for(var r=0;r<t.length;r++){var i=t[r];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}var _t="demuxer-base",ht=function(){function e(e,t,r,i){var n=this;this._id=void 0,this._eventEmitter=void 0,this._config=void 0,this._w=void 0,this._typeSupported=void 0,this._inlineEventEmitter=void 0,this._chunkIndex=void 0,this._seek=!1,this._demuxer=void 0,this._progressTime=0,this._transmuxData=void 0,this._ended=!1,this._onWorkMessage=function(e){var t=e.data;n._onMessage(e.data.event,t.data)},this._id=r,this._eventEmitter=e,this._config=t,this._w=i,this._typeSupported={mp4:!0,mpeg:!1,mp3:!1,h265:dt(u.CodecType.h265)},this._chunkIndex=0,this._transmuxData={audioCodec:"",videoCodec:"",duration:0,remuxId:1}}var t,r,i,n=e.prototype;return n.init=function(){var e=this._inlineEventEmitter=new a.EventEmitter,t=this._onMessage.bind(this);e.on(k.default.INIT_PTS_FOUND,(function(e){return t(k.default.INIT_PTS_FOUND,e)})),e.on(k.default.PARSING_INIT_SEGMENT,(function(e){return t(k.default.PARSING_INIT_SEGMENT,e)})),e.on(k.default.PARSED_DATA,(function(e){return t(k.default.PARSED_DATA,e)})),e.on(k.default.LOAD_END,(function(e){return t(k.default.LOAD_END,e)})),e.on(k.default.ERROR,(function(e){return t(k.default.ERROR,e)})),e.on(k.default.PARSING_DATA,(function(e){return t(k.default.PARSING_DATA,e)})),e.on(k.default.MEDIA_DEMUX,(function(e){return t(k.default.MEDIA_DEMUX,e)})),e.on(k.default.METADATA,(function(e){return t(k.default.METADATA,e)})),e.on(k.default.FLV_HEAD,(function(e){return t(k.default.FLV_HEAD,e)})),e.on(k.default.MP4_NOT_FASTSTART,(function(e){return t(k.default.MP4_NOT_FASTSTART,e)})),this._w?(this._w.addEventListener("message",this._onWorkMessage),this._w.postMessage({cmd:ut.WorkerCmd.INIT,typeSupported:this._typeSupported,config:this._config,vendor:navigator.vendor})):this._demuxer=new ct.default(e,this._typeSupported,this._config,navigator.vendor)},n.destroy=function(){this._w&&(this._w.postMessage({cmd:ut.WorkerCmd.DESTROY}),this._w.removeEventListener("message",this._onWorkMessage),this._w.terminate()),this._inlineEventEmitter&&(this._inlineEventEmitter.removeAllListeners(),this._inlineEventEmitter=void 0)},n.trackInfo=function(e,t){this._transmuxData.hasVideo=e,this._transmuxData.hasAudio=t},n.reset=function(e){this._transmuxData.remuxId++,this._chunkIndex=0,this._seek=e,this._ended=!1},n.end=function(){this._ended||(this._ended=!0,this._w?this._w.postMessage({cmd:ut.WorkerCmd.LOAD_END}):this._demuxer&&this._demuxer.end())},n.onFragProgress=function(e){this._demux(e,!1)},n.onFragLoaded=function(e){this._demux(e,!0)},n._demux=function(e,t){var r=e.context.frag,i=!1,n=r.start||0,a=!1,o=!0,s=null;if(this._transmuxData.progress=e.progress,e.data&&e.data.byteLength){var u=performance.now(),d={byteLength:e.data.byteLength,timeCost:performance.now()-(this._progressTime||e.stats.trequest)};this._progressTime=u,this._eventEmitter.emit(k.default.LOADER_CHUNK_ARRIVAL,d)}0===this._chunkIndex&&(i=!0,a=!1,o=!1),t?(this._progressTime=0,this._chunkIndex=0,s=e.data?new Uint8Array(e.data):new Uint8Array):(this._chunkIndex++,e.data&&(s=new Uint8Array(e.data))),s&&(this._push(s,r.decryptdata,e.initData,n,o,i,a,!this._seek||0===r.start,t),this._seek=!1)},n._onParsing=function(e){return!(e.extra&&e.extra.remuxId!==this._transmuxData.remuxId&&(c.Log.i(_t,"parsing data expired"),1))},n._onParsed=function(e){return!(e.extra&&e.extra.remuxId!==this._transmuxData.remuxId&&(c.Log.i(_t,"parsed expired"),1))},n._push=function(e,t,r,i,n,a,o,s,u){var d=this._transmuxData;this._w?this._w.postMessage({cmd:ut.WorkerCmd.PUSH,data:e,decryptdata:t,initSegment:r,timeOffset:i||0,contiguous:n,trackSwitch:a,discontinuity:o,accurateTimeOffset:s,fragEnd:u,transmuxData:d},[e.buffer]):this._demuxer&&this._demuxer.push(e,t,r,i,n,a,o,s,u,lt({},d))},n._onMessage=function(e,t){switch(e){case k.default.PARSING_DATA:if(!this._onParsing(t))return;break;case k.default.PARSED_DATA:if(!this._onParsed(t))return;t&&(t.trackType=this._id)}this._eventEmitter.emit(e,t)},t=e,(r=[{key:"totalDuration",set:function(e){this._transmuxData.duration=e}},{key:"seek",set:function(e){this._seek=e}},{key:"id",get:function(){return this._id}}])&&ft(t.prototype,r),i&&ft(t,i),e}();function pt(){return(pt=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var i in r)Object.prototype.hasOwnProperty.call(r,i)&&(e[i]=r[i])}return e}).apply(this,arguments)}var vt="demuxer-multipart",mt=function(e){var t,r;function i(t,r,i,n){var a;return(a=e.call(this,t,r,i,n)||this)._frag=null,a._fragInfo=void 0,a._frag=null,a._fragInfo={},a}r=e,(t=i).prototype=Object.create(r.prototype),t.prototype.constructor=t,t.__proto__=r;var n=i.prototype;return n.reset=function(t){e.prototype.reset.call(this,t),this._frag=null},n._demux=function(e,t){var r=e.context.frag,i=this._frag,n=!1,a=j(r.startDTS)?r.startDTS:r.start,o=!1,s=!0,u=null;if(this._transmuxData.progress=e.progress,e.data&&e.data.byteLength){var d=performance.now(),c={byteLength:e.data.byteLength,timeCost:performance.now()-(this._progressTime||e.stats.trequest)};this._progressTime=d,this._eventEmitter.emit(k.default.LOADER_CHUNK_ARRIVAL,c)}if(0===this._chunkIndex){this._fragInfo={},n=!(i&&r.level===i.level),o=!(i&&r.cc===i.cc);var l=i&&r.sn===i.sn+1;s=!(n||!l),this._config.isLive&&(o=o||!l),i&&e.remuxContiguous&&(s||(a=j(i.endDTS)?i.endDTS:i.start+i.duration),s=!0)}t?(this._progressTime=0,this._chunkIndex=0,this._frag=e.context.frag,u=e.data?new Uint8Array(e.data):new Uint8Array,this._frag=r):(this._chunkIndex++,e.data&&(u=new Uint8Array(e.data))),u&&(this._push(u,r.decryptdata,e.initData,a,s,n,o,!this._seek||0===e.context.frag.start,t),this._seek=!1)},n._onParsing=function(e){var t=this;if(e.extra&&e.extra.remuxId!==this._transmuxData.remuxId)return c.Log.i(vt,"parsing data expired"),!1;var r=this._fragInfo;return e.segments.forEach((function(e){var i=e.type;r.hasOwnProperty(i)?(r[i].endPTS=e.endPTS,r[i].endDTS=e.endDTS):(e.endPTS||e.endDTS||!t._frag||(e.endPTS=e.startPTS+t._frag.duration,e.endDTS=e.startDTS+t._frag.duration),r[i]={startDTS:e.startDTS,startPTS:e.startPTS,endPTS:e.endPTS,endDTS:e.endDTS})})),!0},n._onParsed=function(e){return e.extra&&e.extra.remuxId!==this._transmuxData.remuxId?(c.Log.i(vt,"parsed expired"),!1):(e.info=pt({},this._fragInfo),e.frag=this._frag,this._fragInfo={},!0)},i}(ht),gt={search:function(e,t){for(var r=0,i=e.length-1,n=null,a=null;r<=i;){var o=t(a=e[n=(r+i)/2|0]);if(o>0)r=n+1;else{if(!(o<0))return a;i=n-1}}return null},searchIndex:function(e,t){for(var r=0,i=e.length-1,n=null;r<=i;){var a=t(e[n=(r+i)/2|0]);if(a>0)r=n+1;else{if(!(a<0))return n;i=n-1}}return-1}};function yt(e,t){return t?gt.searchIndex(t,(function(t){return e<t.start?-1:e>t.start+t.duration?1:0})):-1}var Et=function(e){var t,r;function i(t,r){var i;return(i=e.call(this)||this)._loaders=void 0,i._config=void 0,i._loaderConfig=void 0,i._decryptkey=void 0,i._decrypturl=void 0,i._loadEnd=function(e,t,r){if(t&&t instanceof ArrayBuffer){var n=e.frag;i._decryptkey=n.decryptdata.key=new Uint8Array(t),i._loaders[n.type]=null,i.emit(k.default.HLS_KEY_LOADED,{frag:n})}else i.emit(k.default.ERROR,{type:I.ErrorTypes.NETWORK_ERROR,details:I.ErrorDetails.HLS_KEY_LOAD_ERROR,fatal:!0,reason:"key empty",statusCode:r.code})},i._loadError=function(e,t){var r=e.frag.loader;t.fatal&&(r&&r.abort(),i._loaders[e.frag.type]=null,i.emit(k.default.ERROR,{type:I.ErrorTypes.NETWORK_ERROR,details:I.ErrorDetails.HLS_KEY_LOAD_ERROR,fatal:!0,reason:t.text,statusCode:t.code}))},i._config=t,i._loaderConfig=r,i._loaders={},i._decryptkey=null,i._decrypturl=null,i}r=e,(t=i).prototype=Object.create(r.prototype),t.prototype.constructor=t,t.__proto__=r;var n=i.prototype;return n.destroy=function(){for(var e in this._loaders){var t=this._loaders[e];t&&t.destroy()}this._loaders={}},n.load=function(e){var t=e.type,r=this._loaders[t],i=e.decryptdata,n=null;if(i&&(n=i.uri),!n||n===this._decrypturl&&null!==this._decryptkey)this._decryptkey&&(i&&(i.key=this._decryptkey),this.emit(k.default.HLS_KEY_LOADED,{frag:e}));else{var a=this._loaderConfig;r&&(c.Log.w("KeyLoader","abort previous key loader for type:"+t),r.abort()),e.loader=this._loaders[t]=new rt,this._decrypturl=n,this._decryptkey=null;var o={url:n,frag:e,responseType:"arraybuffer",credentials:this._config.credentials,headers:this._config.headers},s=a,u={onEnd:this._loadEnd,onError:this._loadError};e.loader.load(o,u,s)}},i}(a.EventEmitter);function St(e,t){for(var r=0;r<t.length;r++){var i=t[r];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}var Tt="initSegment",bt=function(){function e(e,t,r,i,n,a,o,s){var d=this;void 0===s&&(s=!1),this._eventEmitter=void 0,this._type=void 0,this._config=void 0,this._levels=void 0,this._index=void 0,this._next=void 0,this._pos=0,this._failPos=-1,this._demuxer=void 0,this._loadEnabled=!0,this._newSource=!0,this._startSN=0,this._fragLoadFailSec=0,this._demuxing=!1,this._loader=void 0,this._initFragLoader=void 0,this._keyLoader=void 0,this._remuxContiguous=!1,this._media=void 0,this._fragAlign=void 0,this._callback=void 0,this._loadConfig=void 0,this._keyLoadConfig=void 0,this._streamingMux=!0,this._parallelStartCache=void 0,this._preload=!1,this._preloadData=void 0,this._tryLoadNext=function(){d._next!==d._index&&(d._index=d._next);var e=d.level;if(e){if(d._fragAlign&&e.details){var t=d._fragAlign.frag,r=e.details.fragments[d._pos];r&&d._pos===d._fragAlign.pos&&t&&j(t.startPTS)&&Ie(e.details,r,t.startPTS,t.endPTS,t.startDTS,t.endDTS)}if(d._loadEnabled&&!d._loader&&!d._demuxing){if(d._isLevelEnd())return void d._demuxer.end();var i=d._nextFragment();i&&(e.details&&e.details.initSegment&&!e.details.initSegment.data&&d._loadFrag(e.details.initSegment),d._loadFrag(i))}}},this._fragParsed=function(e){if(e.trackType===d._type){for(var t in d._demuxing=!1,d._remuxContiguous=!1,d._eventEmitter.emit(k.default.MUX_INFO,e),e.info){var r=e.info[t];if(r&&r.endPTS&&r.endDTS){var i=e.frag,n=d._levels[i.level].details;n&&Ie(n,i,r.startPTS,r.endPTS,r.startDTS,r.endDTS)}}d._fragAlign&&(d._fragAlign=void 0),d._isLevelEnd()?d._demuxer.end():d._type===u.LevelType.MAIN&&d._eventEmitter.emit(k.default.ABR_NEXT,{startSec:d._getFragStartByPos(d._pos)}),d._tryLoadNext()}},this._tryStartDemux=function(){if(d._parallelStartCache){var e=d._levels[d._parallelStartCache.context.frag.level]||{};if(d._isReady(d._parallelStartCache.context.frag,e)){var t=d._parallelStartCache.data.get(d._parallelStartCache.data.unreadLen);t&&d._startDemux(d._parallelStartCache.context,t.buffer,d._parallelStartCache.stats,d._parallelStartCache.progress),d._parallelStartCache=void 0}}},this._onProgress=function(e,t,r){d._levels[e.frag.level],e.frag&&e.frag.sn===Tt||t instanceof ArrayBuffer&&d._preprocessed(e,t,r,!0)},this._onEnd=function(e,t,r){d._failPos=-1,d._fragLoadFailSec=0,e.frag&&e.frag.sn===Tt?d._destroyInitLoader():d._destroyLoader();var i=d._levels[e.frag.level]||{},n=ce(ie.SUCCESS,e,r,i.qualityType,d._preload);d._eventEmitter.emit(k.default.DOWNLOAD,n),"string"!=typeof t&&(e.frag&&e.frag.sn===Tt&&t?(e.frag.data=new Uint8Array(t),d._demuxing=!1,d._tryStartDemux()):d._preprocessed(e,t,r,!1))},this._onError=function(e,t){d._demuxing=!1;var r=d._levels[e.frag.level]||{};d._eventEmitter.emit(k.default.DOWNLOAD,ce(ie.FAIL,e,t,r.qualityType,d._preload)),t.fatal&&(d._remuxContiguous=!1,d._failPos<0&&(d._failPos=Math.max(0,d._pos-1)),d._resetIO(),d._fragLoadFailSec+=e.frag.duration||0,e.frag.sn===Tt||404!==t.code||d._config.maxFragFailSec&&d._fragLoadFailSec>=d._config.maxFragFailSec||d._isLevelEnd()?d._eventEmitter.emit(k.default.ERROR,{type:I.ErrorTypes.NETWORK_ERROR,details:I.ErrorDetails.LOAD_ERROR,fatal:!0,reason:t.text,statusCode:t.code,url:e.url}):d._tryLoadNext())},this._onAbort=function(e,t){var r=d._levels[e.frag.level]||{};d._eventEmitter.emit(k.default.DOWNLOAD,ce(ie.ABORT,e,t,r.qualityType,d._preload))},this._type=e,this._eventEmitter=t,this._media=r,this._config=i,this._levels=n,this._next=this._index=a,this._callback={onProgress:this._onProgress,onEnd:this._onEnd,onError:this._onError,onAbort:this._onAbort},this._loadConfig={connectionTimeout:i.connectionTimeout,transmissionTimeout:i.transmissionTimeout,maxRetry:i.maxRetry,retryDelay:i.retryDelay},this._keyLoadConfig={connectionTimeout:i.keyConnectionTimeout,transmissionTimeout:i.keyTransmissionTimeout,maxRetry:i.keyLoadingMaxRetry,retryDelay:i.keyLoadingRetryDelay},this._eventEmitter.on(k.default.PARSED_DATA,this._fragParsed),this._demuxer=new mt(t,i,e,o),this._preload=s,this._preload?this.streamingMux(!1):this._demuxer.init()}var t,r,i,n=e.prototype;return n.levelUpdated=function(){if(this.level&&this.level.details){var e=this.level.details.startSN;j(this._startSN)&&this._startSN!==e&&(this._pos=Math.max(0,this._pos-(e-this._startSN))),this._startSN=e,this._demuxer.totalDuration=this.level.details.totalduration,this.level.details.initSegment&&(this._config.streamingMux=!1),this._tryLoadNext()}},n.seek=function(e,t){void 0===t&&(t=!1),this._remuxContiguous=!1;var r=this.level;if(this._loadEnabled=!0,this._fragAlign=void 0,this._resetIO(),this._parallelStartCache=void 0,r&&r.details){var i=0===e?0:yt(e,r.details.fragments);i>=0?this._pos=i:(this._pos=0,r.details.fragments.length&&e>=r.details.fragments[0].start&&(this._pos=r.details.fragments.length-1)),this._reset(!0),t&&(e=r.details.fragments[this._pos].start,this._eventEmitter.emit(k.default.SEEK_KEYFRAME,{keyFrameSec:e})),this._tryLoadNext()}return e},n.destroy=function(){this._resetIO(),this._demuxer&&this._demuxer.destroy(),this._keyLoader&&(this._keyLoader.destroy(),this._keyLoader=void 0),this._fragAlign=void 0},n.nextBackup=function(e){if(this._levels)for(var t=0;t<this._levels.length;t++){var r=this._levels[t];if(r.urlId>=r.url.length-1)return!1;r.urlId++,delete r.m3u8Slice,r.details=null}return this._resetIO(),this._newSource=!0,this._failPos>=0&&(this._pos=this._failPos),this._reset(!0),!0},n.streamingMux=function(e){this._streamingMux=e},n.usePreload=function(){this._preloadData&&(this._demuxer.init(),this._demuxer.onFragLoaded(this._preloadData),this._preloadData=void 0,this._preload=!1)},n.trackInfo=function(e,t){this._demuxer.trackInfo(e,t)},n._fragAlignStart=function(e){return e.maxStartPTS||e.startPTS||e.start},n._getFragByPos=function(e){if(this.level.details)return this.level.details.fragments[e]},n._getFragStartByPos=function(e){var t=this._getFragByPos(e);return t?this._fragAlignStart(t):0},n._reset=function(e){this._demuxing=!1,this._demuxer.reset(e)},n._resetIO=function(){this._parallelStartCache=void 0,this._destroyLoader(),this._destroyInitLoader()},n._destroyLoader=function(){this._loader&&(this._loader.destroy(),this._loader=void 0)},n._destroyInitLoader=function(){this._initFragLoader&&(this._initFragLoader.destroy(),this._initFragLoader=void 0)},n._loadKey=function(e){var t=this;this._keyLoader||(this._keyLoader=new Et({credentials:this._config.credentials,headers:this._config.headers},this._keyLoadConfig),this._keyLoader.on(k.default.HLS_KEY_LOADED,this._tryStartDemux),this._keyLoader.on(k.default.ERROR,(function(e){t._eventEmitter.emit(k.default.ERROR,e)}))),this._keyLoader.load(e)},n._isLevelEnd=function(){var e=this.level;return!!(e&&e.details&&!e.details.live&&this._pos>=e.details.fragments.length)},n._nextFragment=function(){var e=this.level,t=null;return e&&e.details&&this._pos<e.details.fragments.length&&(t=e.details.fragments[this._pos]),t&&(t.encrypted&&t.decryptdata&&this._loadKey(t),"number"==typeof t.sn&&this._pos++),t},n._loadFrag=function(e){if(e){var t={url:e.url,responseType:"arraybuffer",progress:this._streamingMux&&this._config.streamingMux,frag:e,type:"frag",credentials:this._config.credentials,headers:this._config.headers},r=e.byteRangeStartOffset,i=e.byteRangeEndOffset;if(j(r)&&j(i)&&(t.rangeStart=r,t.rangeEnd=i),this._loadConfig.cache=this._preload,e.sn===Tt)t.progress=!1,this._destroyInitLoader(),this._initFragLoader=new rt,this._initFragLoader.load(t,this._callback,this._loadConfig);else if(this._destroyLoader(),this._loader=new rt,this._loader.load(t,this._callback,this._loadConfig),this._demuxing=!0,this._type===u.LevelType.MAIN&&this._newSource){var n=e.start;this._eventEmitter.emit(k.default.NEW_SOURCE,{index:this._index,sync:n}),this._newSource=!1}}},n._preprocessed=function(e,t,r,i){var n=this._levels[e.frag.level]||{};if(this._isReady(e.frag,n)){if(this._parallelStartCache){this._updateParallelStartCache(e,t,r,i);var a=this._parallelStartCache.data.get(this._parallelStartCache.data.unreadLen);this._parallelStartCache=void 0,a&&(t=a)}this._startDemux(e,t,r,i)}else this._parallelStartCache?this._updateParallelStartCache(e,t,r,i):(this._parallelStartCache={context:e,stats:r,data:new st.default,progress:i},t&&this._parallelStartCache.data.put(new Uint8Array(t)))},n._updateParallelStartCache=function(e,t,r,i){this._parallelStartCache&&(this._parallelStartCache.context=e,this._parallelStartCache.stats=r,this._parallelStartCache.progress=i,t&&this._parallelStartCache.data.put(new Uint8Array(t)))},n._isReady=function(e,t){return!(e.encrypted&&e.decryptdata&&!e.decryptdata.key||t.details&&t.details.initSegment&&!t.details.initSegment.data)},n._startDemux=function(e,t,r,i){var n=this._levels[e.frag.level]||{},a={context:e,data:t,initData:n.details&&n.details.initSegment?n.details.initSegment.data:void 0,stats:r,audioCodec:n.audioCodec,videoCodec:n.videoCodec,remuxContiguous:this._remuxContiguous||!(!n.details||!n.details.live),progress:i};i?this._demuxer.onFragProgress(a):this._preload?(this._preloadData=a,this._eventEmitter.emit(k.default.PRELOAD_COMPLETE)):this._demuxer.onFragLoaded(a)},t=e,(r=[{key:"downloadEnabled",set:function(e){!this._loadEnabled&&e?(this._loadEnabled=e,this._tryLoadNext()):this._loadEnabled=e},get:function(){return this._loadEnabled}},{key:"isNetworkInUse",get:function(){return!(!this._loadEnabled&&!this._loader)}},{key:"levels",get:function(){return this._levels}},{key:"level",get:function(){return this._levels[this._index]}},{key:"index",get:function(){return this._index},set:function(e){this._resetIO(),this._newSource=!0,this._index=this._next=e,this._fragAlign=void 0}},{key:"next",get:function(){return this._next},set:function(e){this._newSource=!0,this._next=e,this._remuxContiguous=!0}},{key:"manualNext",set:function(e){if(this._type===u.LevelType.MAIN){var t=this.level.details;if(t){var r=yt(this._media.currentTime+(t.targetduration||5)/2,t.fragments)+1;if(r>0&&r<t.fragments.length){r<this._pos&&(this._resetIO(),this._reset(!1),this._pos=r,this._remuxContiguous=!1),this._newSource=!0,this._next=e;var i=t.fragments[this._pos],n=this._fragAlignStart(i);return this._eventEmitter.emit(k.default.LEVEL_SWITCHING,{type:this._type,startSec:n,level:e,smooth:!0}),(this._fragAlign&&this._fragAlign.frag.sn!==i.sn||!this._fragAlign)&&(this._fragAlign={level:this._next,pos:this._pos,frag:i,alignPTS:n}),this._eventEmitter.emit(k.default.BUFFER_FLUSHING,{startSec:this._fragAlign.alignPTS||n}),void this._tryLoadNext()}}this._eventEmitter.emit(k.default.LEVEL_SWITCH_FAILED,{smooth:!0,level:e})}}},{key:"type",get:function(){return this._type}},{key:"lastLoadedFrag",get:function(){var e=this._pos;return this._loader&&e--,this._getFragByPos(e)}}])&&St(t.prototype,r),i&&St(t,i),e}();function Lt(e,t){for(var r=0;r<t.length;r++){var i=t[r];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}var At=function(){function e(e,t,r){var i=this;this._eventEmitter=void 0,this._type=u.LevelType.SUBTITLE,this._levels=void 0,this._config=void 0,this._index=0,this._loader=void 0,this._loadEnabled=!0,this._pos=0,this._startSN=0,this._callback=void 0,this._loadConfig=void 0,this._fullyLoaded=[],this._tryLoadNext=function(){if(!(i._index<0)){var e=i.level;if(i._loadEnabled&&e&&!i._loader){var t=i._nextFragment();t&&i._loadFrag(t)}}},this._onEnd=function(e,t,r){i._destroyLoader();var n=i._levels[e.frag.level]||{},a=ce(ie.SUCCESS,e,r,n.qualityType);i._eventEmitter.emit(k.default.DOWNLOAD,a),t&&"string"!=typeof t&&(n.details&&1===n.details.fragments.length&&!n.details.live&&-1===i._fullyLoaded.indexOf(e.frag.level)&&i._fullyLoaded.push(e.frag.level),i._eventEmitter.emit(k.default.SUBTITLE_LOADED,{data:t,cc:e.frag.cc,start:e.frag.start})),i._tryLoadNext()},this._onError=function(e,t){var r=i._levels[e.frag.level]||{};i._eventEmitter.emit(k.default.DOWNLOAD,ce(ie.FAIL,e,t,r.qualityType)),i._destroyLoader(),i._tryLoadNext()},this._eventEmitter=e,this._config=t,this._levels=r,this._index=r.reduce((function(e,t,r){return t.default?r:e}),-1),this._callback={onEnd:this._onEnd,onError:this._onError},this._loadConfig={connectionTimeout:t.connectionTimeout,transmissionTimeout:t.transmissionTimeout,maxRetry:t.maxRetry,retryDelay:t.retryDelay}}var t,r,i,n=e.prototype;return n.levelUpdated=function(){if(this.level&&this.level.details){var e=this.level.details.startSN;j(this._startSN)&&this._startSN!==e&&(this._pos=Math.max(0,this._pos-(e-this._startSN))),this._startSN=e,this._tryLoadNext()}},n.seek=function(e){if(this._index<0)return 0;var t=this.level;if(-1!==this._fullyLoaded.indexOf(this._index))return e;if(this._loadEnabled=!0,t&&t.details){var r=0===e?0:yt(e,t.details.fragments),i=t.details.fragments[r];this._loader&&i&&this._loader.context.frag.sn===i.sn&&this._loader.context.frag.level===i.level||(this._pos=r>=0?r:t.details.fragments.length-1,this._destroyLoader(),this._tryLoadNext())}return e},n._nextFragment=function(){var e=this.level;if(e&&e.details&&this._pos<e.details.fragments.length){var t=e.details.fragments[this._pos];if(t&&"number"==typeof t.sn)return this._pos++,t}},n._destroyLoader=function(){this._loader&&(this._loader.destroy(),this._loader=void 0)},n._loadFrag=function(e){if(e){var t={url:e.url,responseType:"arraybuffer",frag:e,type:"frag",credentials:this._config.credentials},r=e.byteRangeStartOffset,i=e.byteRangeEndOffset;j(r)&&j(i)&&(t.rangeStart=r,t.rangeEnd=i),this._destroyLoader(),this._loader=new rt,this._loader.load(t,this._callback,this._loadConfig)}},t=e,(r=[{key:"downloadEnabled",set:function(e){!this._loadEnabled&&e?(this._loadEnabled=e,this._tryLoadNext()):this._loadEnabled=e},get:function(){return this._loadEnabled}},{key:"levels",get:function(){return this._levels}},{key:"level",get:function(){return this._levels[this._index]}},{key:"index",get:function(){return this._index},set:function(e){this._destroyLoader(),this._index=e}},{key:"lastLoadedFrag",get:function(){var e=this._pos;if(this._loader&&e--,this.level&&this.level.details)return this.level.details.fragments[e]}}])&&Lt(t.prototype,r),i&&Lt(t,i),e}();function Rt(e,t){for(var r=0;r<t.length;r++){var i=t[r];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}var It=function(){function e(e,t,r,i){var n=this;void 0===i&&(i=!1),this._eventEmitter=void 0,this._config=void 0,this._abr=void 0,this._media=void 0,this._main=void 0,this._audio=void 0,this._timer=void 0,this._startTimeSec=void 0,this._seekKeyframe=void 0,this._levels=[],this._audioLevels=[],this._subtitleLevels=[],this._totalduration=0,this._preload=!1,this._manifestReady=!1,this._mediaProtocol=void 0,this._subtitle=void 0,this._subtitleStarted=!1,this._onManifestLoaded=function(e){if(c.Log.i("hls","_onManifestLoaded",e),e.drm&&n._preload)n._eventEmitter.emit(k.default.ERROR,{type:I.ErrorTypes.OTHER_ERROR,details:I.ErrorDetails.UNSUPPORTED,fatal:!0,reason:"drm no supported preload"});else{var t=[],r=!1,i=!1,a=d.default.chrome||d.default.firefox;if(e.levels.forEach((function(e){r=r||!!e.videoCodec,i=i||!!e.audioCodec||!(!e.attrs||!e.attrs.AUDIO),a&&e.audioCodec&&-1!==e.audioCodec.indexOf("mp4a.40.34")&&(e.audioCodec=""),e.audioCodec=n._config.audioCodec||e.audioCodec,t.push(e)})),r&&i&&(t=t.filter((function(e){return!!e.videoCodec}))),(t=t.filter((function(e){var t=e.audioCodec,r=e.videoCodec;return(!t||Me(t))&&(!r||Me(r))}))).forEach((function(e,t){return e.index=t})),e.audioTracks&&(n._audioLevels=e.audioTracks.filter((function(e){return!e.audioCodec||Me(e.audioCodec,"audio")})),n._audioLevels.forEach((function(e,t){return e.index=t})),n._audioLevels.length&&(n._audio=new bt(u.LevelType.AUDIO,n._eventEmitter,n._media,n._config,n._audioLevels,0,void 0,n._preload))),e.subtitleTracks&&e.subtitleTracks.length&&(n._subtitleLevels=e.subtitleTracks,n._subtitleLevels.forEach((function(e,t){return e.index=t})),n._subtitle||(n._subtitle=new At(n._eventEmitter,n._config,n._subtitleLevels))),t.length>0){var o=0;n._levels=t;var s,l,f=t.length>1&&!t[o].details&&n._abr&&n._abr.autoLevelEnabled;n._abr&&f&&(o=n._abr.init({levels:t,index:o})||0),n._main=new bt(u.LevelType.MAIN,n._eventEmitter,n._media,n._config,t,o,n._audio?void 0:H.getWorker(),n._preload),"boolean"==typeof e.hasVideo&&"boolean"==typeof e.hasAudio&&n._main.trackInfo(e.hasVideo,e.hasAudio),n._eventEmitter.emit(k.default.MANIFEST_PARSED,{drm:e.drm}),n._abr&&n._abr.autoLevelEnabled&&f&&(n._main.index=n._abr.abrInitLevel),n._manifestReady=!0,n._levels[n._main.index].details?(n._levelUpdated(u.LevelType.MAIN),null!=(s=n._levels[n._main.index].details)&&s.live&&n._loadLevel(n._main.index,u.LevelType.MAIN,!0)):n._loadLevel(n._main.index,u.LevelType.MAIN,!0),n._audio&&n._audioLevels.length&&(n._audioLevels[n._audio.index].details?(n._levelUpdated(u.LevelType.AUDIO),null!=(l=n._levels[n._main.index].details)&&l.live&&n._loadLevel(n._audio.index,u.LevelType.AUDIO,!0)):n._loadLevel(n._audio.index,u.LevelType.AUDIO,!0))}else r||i?n._eventEmitter.emit(k.default.ERROR,{type:I.ErrorTypes.MUX_ERROR,details:I.ErrorDetails.UNSUPPORTED,fatal:!0,reason:"no supported codec"}):n._eventEmitter.emit(k.default.ERROR,{type:I.ErrorTypes.MUX_ERROR,details:I.ErrorDetails.MANIFEST_PARSING_ERROR,fatal:!0,reason:"manifest parsing error"})}},this._onAudioLevelLoaded=function(e){n._onLevelLoaded(e,u.LevelType.AUDIO)},this._onSubtitleLevelLoaded=function(e){n._onLevelLoaded(e,u.LevelType.SUBTITLE)},this._onLevelLoaded=function(e,t){void 0===t&&(t=u.LevelType.MAIN);var r=e.level,i=n._getTrack(t);if(i&&i.level&&r===i.index){var a=i.level,o=e.details;if(o.live){var s=a.details,d=function(e,t,r){var i=1e3*(t.averagetargetduration?t.averagetargetduration:t.targetduration),n=i/2;return e&&t.endSN===e.endSN&&(i=n),r&&(i=Math.max(n,i-(window.performance.now()-r))),Math.round(i)}(a.details,e.details,e.stats?e.stats.trequest:0);s?o.endSN!==s.endSN&&(ke(s,o),a.details=o,n._levelUpdated(t)):(a.details=o,n._levelUpdated(t)),c.Log.v("live playlist, reload in "+Math.round(d)+" ms"),n._timer=setTimeout((function(e){return n._loadLevel(e,t)}),d,i.index)}else n._clearLevelTimer(),a.details&&ke(a.details,o),a.details=o,a.live=a.details.live,n._levelUpdated(t);t===u.LevelType.MAIN&&n._eventEmitter.emit(k.default.LEVEL_LOADED,{bitrate:i.level.bitrate,duration:n._totalduration})}},this._levelUpdated=function(e){void 0===e&&(e=u.LevelType.MAIN),n._startTimeSec>=0&&n.seek(n._startTimeSec,n._seekKeyframe);var t=n._getTrack(e);if(t&&t.level&&t.level.details){t.downloadEnabled=!0,n._totalduration=t.level.details.totalduration;var r=[],i=[];t.level.details.live||t.level.details.fragments.forEach((function(e){r.push(e.start),"number"==typeof e.programDateTime&&i.push(e.programDateTime)})),n._eventEmitter.emit(k.default.LEVEL_UPDATED,{type:e,duration:n._totalduration,times:r,utcs:i,targetduration:t.level.details.targetduration}),t.levelUpdated(),e!==u.LevelType.SUBTITLE||t.level.details.live||t.seek(n._media.currentTime)}},this._onInitPTSFound=function(e){},this._abrNext=function(e){if(n._abr&&n._abr.autoLevelEnabled&&n._main){var t=n._abr.nextBitrateIndex();t>=0&&t!==n._main.index&&(n._eventEmitter.emit(k.default.LEVEL_SWITCHING,{startSec:e.startSec,level:t,smooth:!0}),n.nextLevel=t)}},this._syncStream=function(e,t){var r=e.lastLoadedFrag,i=t.lastLoadedFrag;r?i&&(i.start+i.duration>r.start+r.duration-.5?t.downloadEnabled=!1:t.downloadEnabled=!0):t.downloadEnabled=!0},this._getTrack=function(e){return void 0===e&&(e=u.LevelType.MAIN),e===u.LevelType.MAIN?n._main:e===u.LevelType.AUDIO?n._audio:n._subtitle},this._getTrackLevels=function(e){return void 0===e&&(e=u.LevelType.MAIN),e===u.LevelType.MAIN?n._levels:e===u.LevelType.AUDIO?n._audioLevels:n._subtitleLevels},this._eventEmitter=e,this._config=t,this._media=r,this._preload=i,this._startTimeSec=t.startFromSec||-1,this._seekKeyframe=t.startFromKeyframe}var t,r,i,n=e.prototype;return n.init=function(){var e=this;this._eventEmitter.on(k.default.DOWNLOAD,(function(t){e._abr&&e._abr.onDownload(t),e._main&&(e._audio&&e._syncStream(e._main,e._audio),e._subtitle&&e._syncStream(e._main,e._subtitle))})),this._eventEmitter.on(k.default.BUFFER_FLUSHING,(function(t){e._audio&&e._audio.seek(t.startSec)})),this._initMultirate();var t=ot[this._config.box];t?(this._mediaProtocol=new t(this._config),this._mediaProtocol.on(k.default.MANIFEST_PARSED,this._onManifestLoaded),this._mediaProtocol.on(k.default.LEVEL_LOADED,this._onLevelLoaded),this._mediaProtocol.on(k.default.LEVEL_UPDATED,this._levelUpdated),this._mediaProtocol.on(k.default.AUDIO_TRACK_LOADED,this._onAudioLevelLoaded),this._mediaProtocol.on(k.default.SUBTITLE_TRACK_LOADED,this._onSubtitleLevelLoaded),this._mediaProtocol.on(k.default.DOWNLOAD,(function(t){e._eventEmitter.emit(k.default.DOWNLOAD,t)})),this._mediaProtocol.on(k.default.ERROR,(function(t){!e.current||e._config.isLive||e.current.details&&e.current.details.live||(t.fatal=!0),e._eventEmitter.emit(k.default.ERROR,t)}))):this._eventEmitter.emit(k.default.ERROR,{type:I.ErrorTypes.OTHER_ERROR,details:I.ErrorDetails.UNSUPPORTED,fatal:!0,reason:"unsupported"})},n.destroy=function(){this._mediaProtocol&&(this._mediaProtocol.destroy(),this._mediaProtocol=void 0),this._clearLevelTimer(),this._main&&(this._main.destroy(),this._main=void 0),this._audio&&(this._audio.destroy(),this._audio=void 0),this._abr&&(this._abr.removeAllListeners(),this._abr.destory(),this._abr=void 0)},n.loadSource=function(){this._mediaProtocol&&this._mediaProtocol.loadManifest(this._config.src)},n.setDownloadEnabled=function(e){void 0===e&&(e=!0),this._main&&(this._main.downloadEnabled=e),this._abr&&this._abr.setDownloadEnabled(e)},n.isSeekable=function(){return!this._config.isLive},n.seek=function(e,t,r){if(void 0===t&&(t=!1),void 0===r&&(r=!1),this._abr&&this._abr.onSeek({isInBuffer:r}),!r&&this._main){if(this._main.level.details&&!this._main.level.details.live){if(!this._audio)return this._main.seek(e,t),this._subtitle&&this._subtitle.seek(e),void(this._startTimeSec=-1);if(this._audio.level.details&&!this._audio.level.details.live){var i=this._main.seek(e,t);return this._audio.seek(i),this._subtitle&&this._subtitle.seek(i),void(this._startTimeSec=-1)}}this._startTimeSec=e,this._seekKeyframe=t}},n.nextBackup=function(){if(this._main){var e=this._main.nextBackup(this._media.currentTime);if(this._audio&&e&&(e=this._main.nextBackup(this._media.currentTime)),e)return this._main.downloadEnabled=!1,this._seekKeyframe=!1,this._loadLevel(this._main.index,u.LevelType.MAIN),this._audio&&(this._audio.downloadEnabled=!1,this._loadLevel(this._audio.index,u.LevelType.AUDIO)),!0}return!1},n.streamingMux=function(e){this._main&&this._main.streamingMux(e)},n.setAvailableAbrLevels=function(e){this._abr&&this._abr.setAvailableAbrLevels(e)},n.usePreload=function(){this._main&&this._main.usePreload(),this._audio&&this._audio.usePreload(),this._preload=!1},n._loadLevel=function(e,t,r){var i=this._getTrackLevels(t);if(i.length){var n=i[e];n&&"object"==typeof n&&n.url.length>0&&this._mediaProtocol&&this._mediaProtocol.loadLevel(n,t)}},n._clearLevelTimer=function(){null!==this._timer&&(clearTimeout(this._timer),this._timer=null)},n._initMultirate=function(){var e=this;this._config.adaptive&&!this._abr&&(this._abr=new Le(this._config,this._media),this._abr.active(!0),this._abr.on(k.default.ABR_INFO,(function(t){e._eventEmitter.emit(k.default.ABR_INFO,t)})),this._eventEmitter.on(k.default.INIT_PTS_FOUND,this._onInitPTSFound),this._eventEmitter.on(k.default.ABR_NEXT,this._abrNext),this._eventEmitter.on(k.default.NEW_SOURCE,(function(t){e._abr&&e._abr.onNewSource(t)})),this._eventEmitter.on("mainNotify",(function(t){e._abr&&("ratechange"===t.type?e._abr.onRatechange(t.playbackRate):"waiting"===t.type&&e._abr.onWaiting()),"canplay"===t.type&&e._startSubtitle()})))},n._checkNextLevel=function(e,t){void 0===t&&(t=u.LevelType.MAIN);var r=this._getTrack(t);return!(!r||!r.levels||r.levels[e].details&&!r.levels[e].live||(r.downloadEnabled=!1,this._loadLevel(e,t),0))},n._abrActive=function(e){this._abr&&this._config.adaptive&&(e&&!this._abr.autoLevelEnabled&&this._eventEmitter.emit(k.default.LEVEL_SWITCHING,{startSec:this._media.currentTime,level:-1,smooth:!0}),this._abr.active(e))},n._startSubtitle=function(){!this._subtitleStarted&&this._subtitle&&(this._subtitle.index>=0&&(this._subtitleLevels[this._subtitle.index].details?this._levelUpdated(u.LevelType.SUBTITLE):this._loadLevel(this._subtitle.index,u.LevelType.SUBTITLE,!0)),this._subtitleStarted=!0)},t=e,(r=[{key:"levels",get:function(){return this._main?this._main.levels:[]}},{key:"protocol",get:function(){var e;return(null==(e=this._mediaProtocol)?void 0:e.protocol)||u.Protocol.UNKNOWN}},{key:"isNetworkInUse",get:function(){return!!this._main&&this._main.isNetworkInUse}},{key:"autoLevelEnabled",get:function(){return!!this._abr&&!!this._abr.autoLevelEnabled}},{key:"current",get:function(){if(this._main)return this._main.level}},{key:"mediaTrackNum",get:function(){return this._audio?2:1}},{key:"audioTrack",get:function(){var e;return(null==(e=this._audio)?void 0:e.index)||0},set:function(e){this._audio&&(e=Math.min(e,this._audio.levels.length-1),this._audio.index=e,this._manifestReady&&(this.seek(this._media.currentTime),this._checkNextLevel(e,u.LevelType.AUDIO),this._eventEmitter.emit(k.default.LEVEL_SWITCHING,{type:u.LevelType.AUDIO,startSec:this._media.currentTime,level:e,smooth:!1})))}},{key:"audioTracks",get:function(){return this._audio?this._audio.levels:[]}},{key:"subtitleTrack",get:function(){var e;return(null==(e=this._subtitle)?void 0:e.index)||0},set:function(e){this._subtitle&&(e=Math.min(e,this._subtitle.levels.length-1),this._subtitle.index=e,this._manifestReady&&e>=0&&(this._checkNextLevel(e,u.LevelType.SUBTITLE)||this._subtitle.seek(this._media.currentTime),this._eventEmitter.emit(k.default.LEVEL_SWITCHING,{type:u.LevelType.SUBTITLE,startSec:this._media.currentTime,level:e,smooth:!1})))}},{key:"subtitleTracks",get:function(){return this._subtitle?this._subtitle.levels:[]}},{key:"currentLevel",get:function(){return this._main?this._main.index:0},set:function(e){e>=0?(this._abrActive(!1),this._main&&(e=Math.min(e,this._main.levels.length-1),this._main.index=e,this._manifestReady&&(this.seek(this._media.currentTime),this._checkNextLevel(e),this._eventEmitter.emit(k.default.LEVEL_SWITCHING,{startSec:this._media.currentTime,level:e,smooth:!1})))):this._abrActive(!0)}},{key:"manualNextLevel",set:function(e){this._abrActive(e<0),this._manifestReady?this._main&&this._main.level.details&&e>=0&&(e=Math.min(e,this._main.levels.length-1),this._main.manualNext=e,this._checkNextLevel(e)||this.setDownloadEnabled(!0)):this.currentLevel=e}},{key:"nextLevel",get:function(){return this._main?this._main.next:0},set:function(e){this._main&&this._main.next!==e&&(this._main.next=e,this._checkNextLevel(e))}}])&&Rt(t.prototype,r),i&&Rt(t,i),e}(),kt=r("./node_modules/url-parse/index.js"),Ct=r.n(kt);function xt(e,t){if(void 0===t)return e;var r=new Ct.a(e,!0);return t&&(r.query.kabr_spts=""+t),r.toString()}var Dt=function(){function e(){var e=this;this._context=void 0,this._result=void 0,this._callback=void 0,this._loader=void 0,this._loaderConf=void 0,this._loaderCallbacks=void 0,this._timer=void 0,this._startTime=0,this._testEnd=function(){e._stopTimer(),e._loader&&e._loader.destroy(),e._context&&e._result&&e._callback&&(e._result.firstPackageDuration=Math.round(e._result.firstPackageDuration),e._result.duration=Math.round(performance.now()-e._startTime),e._callback.onEnd(e._context,e._result))},this._onProgress=function(t,r,i){e._result&&(e._result.firstPackageDuration=i.tfirst?i.tfirst-i.trequest:0,e._result.loaded=i.loaded)},this._onLoaderError=function(t,r){e._result&&(e._result.succeeded=!1),e._testEnd()},this._onLoaderEnd=function(){e._testEnd()},this._loaderConf={connectionTimeout:0,transmissionTimeout:0,maxRetry:0,retryDelay:0,useFetch:!0},this._loaderCallbacks={onProgress:this._onProgress,onError:this._onLoaderError,onEnd:this._onLoaderEnd}}var t=e.prototype;return t.start=function(e,t){this._context=e,this._callback=t,this._result={loaded:0,duration:0,firstPackageDuration:0,succeeded:!0},this._startTime=performance.now(),this._loader&&this._loader.destroy();var r=Math.min(1e4,e.timeout);this._loaderConf.connectionTimeout=r;var i={url:e.url,progress:!0,responseType:"arraybuffer"};this._loader=new rt,this._startTimer(r),this._loader.load(i,this._loaderCallbacks,this._loaderConf)},t.cancel=function(){this._stopTimer(),this._loader&&this._loader.destroy()},t.destroy=function(){this.cancel()},t._startTimer=function(e){var t=this;this._timer=setTimeout((function(){return t._testEnd()}),e)},t._stopTimer=function(){clearTimeout(this._timer)},e}();function wt(){return(wt=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var i in r)Object.prototype.hasOwnProperty.call(r,i)&&(e[i]=r[i])}return e}).apply(this,arguments)}function Ot(e,t){for(var r=0;r<t.length;r++){var i=t[r];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}var Pt,Nt,Mt="algorithm-simple",Ut={stableBufferDiffThresholdSecond:.15,stableBufferIntervalMs:2e3,speedTestTimeoutMs:500,generateSpeedGapMs:3e3,bufferCheckIntervalMs:500,smoothedSpeedUtilizationRatio:.8,smallSpeedToBitrateRatio:.7,enoughSpeedToBitrateRatio:.9,bufferLowerLimitSecond:.8,recentBufferedSize:16,smoothedSpeedRatio:.9,isSpeedFullyUsed:!1},Bt=function(e){var t,r;function i(){var t;return(t=e.call(this)||this)._conf=void 0,t._pastBuffer=void 0,t._levels=void 0,t._current=0,t._next=0,t._stableBufferStartTime=performance.now(),t._speedTester=new Dt,t._generatedSpeed=0,t._lastCheckBuffer=0,t._lastSpeed=0,t._timer=void 0,t._autoLevelEnabled=!1,t._speedTestEnabled=!0,t}r=e,(t=i).prototype=Object.create(r.prototype),t.prototype.constructor=t,t.__proto__=r;var n,a,o,s=i.prototype;return s.init=function(e,t,r){var i=this;this._conf=wt({},Ut),wt(this._conf,r),c.Log.i(Mt,"init",e,r,this._conf),this._levels=e.abrLevels.slice(0),this._next=e.abrDefault,this._pastBuffer=[0],t&&(this._timer=setInterval((function(){i._checkBuffer(t)}),this._conf.bufferCheckIntervalMs))},s._updateStableBuffer=function(e){var t=e-this._lastCheckBuffer,r=t/e,i=performance.now();return(t<-this._conf.stableBufferDiffThresholdSecond||r<-.2)&&(c.Log.v(Mt,"bufferDiffDown: "+t.toFixed(2)+"s, diffRatio: "+r.toFixed(2)),this._stableBufferStartTime=Math.max(i,this._stableBufferStartTime)),t>this._conf.stableBufferDiffThresholdSecond&&i-this._stableBufferStartTime+this._conf.bufferCheckIntervalMs>this._conf.stableBufferIntervalMs&&(this._stableBufferStartTime=Math.max(i-2*this._conf.bufferCheckIntervalMs,this._stableBufferStartTime+2*this._conf.bufferCheckIntervalMs),c.Log.v(Mt,"bufferDiffUp: "+t.toFixed(2)+"s")),this._lastCheckBuffer=e,i-this._stableBufferStartTime>this._conf.stableBufferIntervalMs},s._isSpeedFullyUsed=function(){return this._conf.isSpeedFullyUsed},s._checkBuffer=function(e){var t=e.bufferedSec(),r=this._updateStableBuffer(t);this._isSpeedFullyUsed()?r&&this._current+1<this._levels.length?this._generatedSpeed=this._levels[this._current+1].bitrate:this._generatedSpeed=0:r&&this._current+1<this._levels.length&&this._autoLevelEnabled&&this._speedTestEnabled&&(this._startTesting(e),this._stableBufferStartTime=performance.now()+this._conf.generateSpeedGapMs),this._pastBuffer.push(t),this._pastBuffer.length>this._conf.recentBufferedSize&&this._pastBuffer.shift()},s._startTesting=function(e){var t=this;c.Log.v(Mt,"start speed testing on index: "+(this._current+1));var r=e.downloadSize(),i=this._levels[this._current+1].bitrate;this._speedTester.start({url:this._levels[this._current+1].url[this._levels[this._current+1].urlId],timeout:this._conf.speedTestTimeoutMs},{onEnd:function(n,a){var o=e.downloadSize()-r;if(a.succeeded&&a.duration>0&&a.firstPackageDuration>0){var s=8*(o+a.loaded)/a.duration;c.Log.v(Mt,"testSpeed: "+s.toFixed(0)),s>=i&&(t._generatedSpeed=i)}c.Log.v(Mt,"succeeded: "+a.succeeded+", firstPackageDuration: "+a.firstPackageDuration+", originalDownloadSize: "+o+", downloadSize: "+a.loaded+", downloadTime: "+a.duration)}})},s.setAvailableBitrates=function(e){},s.onGOP=function(e,t,r){var i=t/Math.max(r,.05)*8/1024;c.Log.v(Mt,"buffered: "+e.toFixed(2)+", size: "+t+", time: "+r.toFixed(2)),this._next=this._nextRateIndex(i,e)},s.onLevelLoad=function(e){this._current=Math.max(0,e)},s.destroy=function(){this._speedTester.destroy(),clearInterval(this._timer)},s._quantization=function(e){for(var t=0,r=this._levels.length-1;r>=0;r--)if(e>=this._levels[r].bitrate){t=r;break}return t},s._nextRateIndex=function(e,t){var r=this._nextRateBySpeedAndBuffered(e,t);return r!=this._current&&(this._stableBufferStartTime=performance.now()+this._conf.generateSpeedGapMs),r<this._current?(this._speedTester.cancel(),this._generatedSpeed=0,this._lastSpeed=e,this._pastBuffer=[t]):this._lastSpeed=this._getSmoothedSpeed(e),r},s._getSmoothedSpeed=function(e){return this._lastSpeed>0?e*(1-this._conf.smoothedSpeedRatio)+this._lastSpeed*this._conf.smoothedSpeedRatio:e},s._getPredictedBuffer=function(e){return e+(e-Math.max.apply(Math,this._pastBuffer))},s._getBufferSpeed=function(e){var t=Math.max.apply(Math,this._pastBuffer);return(1+(e-t)/t)*this._levels[this._current].bitrate},s._isSpeedTooSmall=function(e){return e/this._levels[this._current].bitrate<this._conf.smallSpeedToBitrateRatio},s._isSpeedEnough=function(e){return e/this._levels[this._current].bitrate>this._conf.enoughSpeedToBitrateRatio},s._nextRateBySpeedAndBuffered=function(e,t){var r=this._getBufferSpeed(t),i=this._getSmoothedSpeed(e);c.Log.v(Mt,"gopSpeed: "+e.toFixed(0)+", smoothedSpeed: "+i.toFixed(0));var n=this._getPredictedBuffer(t);c.Log.v(Mt,"bufferSpeed: "+r.toFixed(0)+", predictedBuffered: "+n.toFixed(1));var a=this._current;return n<this._conf.bufferLowerLimitSecond||this._isSpeedTooSmall(r)?a=Math.min(this._current,this._quantization(r)):this._isSpeedEnough(r)&&(this._generatedSpeed>0?(c.Log.i(Mt,"generatedSpeed used"),a=this._quantization(this._generatedSpeed),this._generatedSpeed=0):a=this._quantization(i*this._conf.smoothedSpeedUtilizationRatio),a=Math.min(this._current+1,Math.max(a,this._current))),a},n=i,(a=[{key:"autoLevelEnabled",set:function(e){this._autoLevelEnabled=e}},{key:"speedTestEnabled",set:function(e){this._speedTestEnabled=e}},{key:"nextLevel",get:function(){return c.Log.v(Mt,"nextLevel: "+this._next),this._next}}])&&Ot(n.prototype,a),o&&Ot(n,o),i}(a.EventEmitter);(Nt=Pt||(Pt={})).Kalman="kalman",Nt.Simple="simple";var Ft={simple:Bt},Vt=function(){function e(){}return e.verify=function(e){return!!(e&&e.hasOwnProperty("version")&&e.hasOwnProperty("adaptationSet")&&e.adaptationSet.hasOwnProperty("representation")&&Array.isArray(e.adaptationSet.representation)&&e.adaptationSet.representation.length>0)&&(e.adaptationSet.representation.forEach((function(e){if(!e.url||!e.bitrate||!e.qualityType)return!1})),!0)},e.parse=function(t){var r,i=[];return e.verify(t)&&t.adaptationSet.representation.forEach((function(e,t){var n=new J(e.url);n.id=e.id||t,n.maxBitrate=e.bitrate||0,n.avgBitrate=e.averageBitrate||0,n.bitrate=e.averageBitrate||n.maxBitrate,n.qualityType=e.qualityType||"",n.qualityLabel=e.name||"",n.codec=e.codec||"",n.hidden=e.hidden||!1,n.enableAdaptive=void 0===e.enableAdaptive||!!e.enableAdaptive,n.default=e.defaultSelect||!1,n.index=t,i.push(n),n.default&&void 0===r&&(r=t)})),{levels:i,def:r||0}},e}();function Ht(e,t){for(var r=0;r<t.length;r++){var i=t[r];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}var jt=function(){function e(e){var t;this._levels=[],this._abrLevels=[],this._default=void 0,this._availableList=void 0,this._availableList=void 0,Vt.verify(e)?t=Vt.parse(e):Ze.verify(e)?t=Ze.parse(e):ee.verify(e)?t={levels:[new J("")],def:0}:e&&"string"==typeof e&&(t={levels:[new J(e)],def:0}),t&&(this._levels=t.levels,this._default=t.def),this._generateAbrList()}var t,r,i,n=e.prototype;return n.setAvailableAbrLevels=function(e){this._availableList=e,this._generateAbrList()},n.abrIndexToOrign=function(e){var t=this._abrLevels[e];return t?t.index:0},n.orignIndexToAbr=function(e){var t=0;return this._abrLevels.forEach((function(r,i){r.index!==e||(t=i)})),t},n._generateAbrList=function(){var e=this,t=this._availableList;t&&"number"==typeof this._default&&-1===t.indexOf(this._default)&&(this._default=0),this._abrLevels=[],this._levels.forEach((function(r,i){r.enableAdaptive&&(!t||t&&-1!==t.indexOf(i))&&e._abrLevels.push(r)})),this._abrLevels.sort((function(e,t){return e.bitrate-t.bitrate}))},t=e,(r=[{key:"levels",get:function(){return this._levels}},{key:"abrLevels",get:function(){return this._abrLevels}},{key:"default",get:function(){return this._default||0}},{key:"abrDefault",get:function(){var e=0;return this._abrLevels.forEach((function(t,r){if(t.default)return e=r})),e}}])&&Ht(t.prototype,r),i&&Ht(t,i),e}();function Gt(e,t){for(var r=0;r<t.length;r++){var i=t[r];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}var Kt,Wt,qt=function(){function e(e,t,r){var i;this._eventEmitter=void 0,this._config=void 0,this._media=void 0,this._smooth=void 0,this._downloadSizeTotal=0,this._downloadSize=0,this._downloadStartTime=0,this._keyCount=0,this._index=0,this._algorithm=void 0,this._autoLevelEnabled=!1,this._manifest=void 0,this._eventEmitter=e,this._config=t,this._media=r,this._manifest=new jt(t.src),this._algorithm=(i=Pt.Simple,Ft[i]?new Ft[i]:new Ft[Pt.Simple]),this._algorithm.speedTestEnabled=this._config.abrSpeedTest,this._autoLevelEnabled=!!t.adaptive&&this._manifest.abrLevels.length>0,this._algorithm.autoLevelEnabled=this._autoLevelEnabled}var t,r,i,n=e.prototype;return n.init=function(){var e=this;if(this._downloadSizeTotal=0,this._downloadSize=0,this._downloadStartTime=performance.now(),this._keyCount=0,this._manifest.levels){this._autoLevelEnabled&&(this._index=this._manifest.abrIndexToOrign(this._algorithm.nextLevel)),this._index=this._manifest.default,this._eventEmitter.emit(k.default.MANIFEST_PARSED,{});var t={bufferedSec:function(){return e._media.bufferedSec()},downloadSize:function(){return e._downloadSizeTotal}};this._algorithm.init(this._manifest,t,this._config.liveAdaptiveConfig)}},n.destory=function(){this._algorithm&&(this._algorithm.destroy(),this._algorithm.removeAllListeners())},n.setAvailableAbrLevels=function(e){this._manifest.setAvailableAbrLevels(e)},n.onLoaderChunk=function(e){this._downloadSize+=e,this._downloadSizeTotal+=e},n.onLevelLoad=function(e){this._manifest.levels.length&&e>=0&&e<this._manifest.levels.length&&(this._keyCount=0,this._downloadStartTime=performance.now(),this._downloadSize=0,this._index=e,this._algorithm.onLevelLoad(this._manifest.orignIndexToAbr(e)))},n.onKeyFrame=function(e){var t=this._manifest.levels;if(this._keyCount++,(this._algorithm||"number"==typeof this._smooth)&&this._keyCount>1&&t){var r=this._index,i=!1,n=performance.now();if(this._algorithm.onGOP(this._media.bufferedSec(),this._downloadSize,(n-this._downloadStartTime)/1e3),this._downloadSize=0,this._downloadStartTime=n,"number"==typeof this._smooth)r=this._smooth,this._smooth=void 0;else{if(!this._autoLevelEnabled||!this._algorithm)return;r=this._manifest.abrIndexToOrign(this._algorithm.nextLevel),i=!0}if(r!==this._index)return{url:this.getRequestUrl(r,e),level:r,auto:i}}},n.getRequestUrl=function(e,t){var r=this._config.src,i=this._manifest.levels[e];return i&&(r=i.currentUrl),this._config.box===u.MediaBox.flv?xt(r,t||this._config.defaultSpts):r},t=e,(r=[{key:"autoLevelEnabled",set:function(e){this._autoLevelEnabled=e&&this._config.adaptive},get:function(){return this._autoLevelEnabled}},{key:"levels",get:function(){return this._manifest.levels}},{key:"nextLevel",get:function(){return"number"==typeof this._smooth?this._smooth:this._index},set:function(e){e>=0?(e=Math.min(this._manifest.levels.length-1,e),this._autoLevelEnabled=!1,this._smooth=e):-1===e&&(this._autoLevelEnabled=this._config.adaptive),this._algorithm.autoLevelEnabled=this._autoLevelEnabled}},{key:"currentLevel",get:function(){return this._index},set:function(e){e>=0?(e=Math.min(this._manifest.levels.length-1,e),this._autoLevelEnabled=!1,this._index=e):-1===e&&(this._autoLevelEnabled=this._config.adaptive),this._algorithm.autoLevelEnabled=this._autoLevelEnabled}}])&&Gt(t.prototype,r),i&&Gt(t,i),e}(),zt=r("./src/demux/flv/flv.ts");(Wt=Kt||(Kt={}))[Wt.tagType=0]="tagType",Wt[Wt.tagSize=1]="tagSize",Wt[Wt.timestamp=2]="timestamp",Wt[Wt.frameType=3]="frameType",Wt[Wt.packetType=4]="packetType";var Yt=function(){function e(){this._pos=0,this._detectType=Kt.tagType,this._tagSize=0,this._tagSizeLen=0,this._timestamp=0,this._timestampLen=0,this._tagType=0,this._frameType=0,this._keyframeList=[],this.reset()}var t=e.prototype;return t.reset=function(){c.Log.i("flv-key-detector","reset"),this._pos=zt.FLV_HEAD_LEN,this._detectType=Kt.tagType,this._tagSize=0,this._tagSizeLen=3,this._timestamp=0,this._timestampLen=4,this._tagType=0,this._frameType=0,this._keyframeList=[]},t.append=function(e){if(this._pos>e.byteLength)return this._pos-=e.byteLength,[];this._keyframeList=[];for(var t=this._pos,r=0;t<e.byteLength;)switch(this._detectType){case Kt.tagType:this._tagType=e[t],this._tagSize=0,this._tagSizeLen=3,r=t,t++,this._detectType=Kt.tagSize;break;case Kt.tagSize:if(this._tagSize=this._tagSize+(e[t]<<8*(this._tagSizeLen-1)),this._tagSizeLen--,t++,this._tagSizeLen>0)break;this._tagType===zt.FlvTagType.VIDEO?(this._timestamp=0,this._timestampLen=4,this._detectType=Kt.timestamp):(t+=7+this._tagSize+4,this._detectType=Kt.tagType);break;case Kt.timestamp:this._timestamp+=1===this._timestampLen?e[t]<<24:e[t]<<8*(this._timestampLen-2),this._timestampLen--,t++,0===this._timestampLen&&(t+=3,this._frameType=0,this._detectType=Kt.frameType);break;case Kt.frameType:this._frameType=e[t]>>4,t++,this._detectType=Kt.packetType;break;case Kt.packetType:1===this._frameType&&1===e[t]&&this._keyframeList.push({timestamp:this._timestamp,pos:r}),t+=this._tagSize-1+4,this._detectType=Kt.tagType}return this._pos=t-e.byteLength,this._keyframeList},e}(),Xt=function(){function e(){var e=this;this._callback=void 0,this._loader=void 0,this._loaderConf=void 0,this._loaderCallbacks=void 0,this._timer=void 0,this._conplete=function(t){e._stopTimer(),e._destroyLoader(),e._callback&&(t?e._callback({responseHeader:t.responseHeader}):e._callback({}))},this._onLoaderError=function(t){e._conplete(t)},this._onLoaderEnd=function(t){e._conplete(t)},this._onLoaderProgress=function(t){e._conplete(t)},this._onLoaderConnect=function(t){e._conplete(t)},this._loaderConf={connectionTimeout:0,transmissionTimeout:0,maxRetry:0,retryDelay:0,useFetch:!1},this._loaderCallbacks={onConnect:this._onLoaderConnect,onProgress:this._onLoaderProgress,onError:this._onLoaderError,onEnd:this._onLoaderEnd}}var t=e.prototype;return t.start=function(e,t){this._destroyLoader(),this._callback=t,this._loaderConf.connectionTimeout=1e4;var r={url:e,progress:!1,responseType:"arraybuffer"};this._loader=new rt,this._startTimer(1e4),this._loader.load(r,this._loaderCallbacks,this._loaderConf)},t.cancel=function(){this._stopTimer(),this._destroyLoader()},t.destroy=function(){this.cancel()},t._destroyLoader=function(){this._loader&&this._loader.destroy()},t._startTimer=function(e){var t=this;this._timer=setTimeout((function(){return t._conplete()}),e)},t._stopTimer=function(){clearTimeout(this._timer)},e}(),Qt=1048576,Jt="media-loader",$t=function(){function e(e,t){var r=this;this._callback=void 0,this._config=void 0,this._context=void 0,this._contentLen=0,this._loader=void 0,this._internalCallback=void 0,this._loaderConfig=void 0,this._firstReq=!0,this._ended=!1,this._pos=void 0,this._nextRangeStart=0,this._downloadEnabled=!0,this._currentReqLen=0,this._streamingMux=!1,this._headerReq=void 0,this._onLoaderConnect=function(e,t){r._getContentLen(e)},this._onLoaderProgress=function(e,t,i){"string"!=typeof t&&(r._currentReqLen+=t.byteLength,r._getContentLen(e),!e.rangeEnd&&r._currentReqLen>=Qt&&!r._config.isLive&&(r._destroyLoader(),r._nextRangeStart=r._currentReqLen,r._request()),r._callback.onProgress&&r._callback.onProgress(e,t,i))},this._onLoaderAbort=function(e,t){},this._onLoaderError=function(e,t){r._callback.onError&&r._callback.onError(e,t)},this._onLoaderEnd=function(e,t,i){r._getContentLen(e),"string"!=typeof t&&(!r._config.isLive&&t&&r._callback.onProgress&&r._callback.onProgress(e,t,i),r._ended||r._config.isLive?r._callback.onEnd(e,null,i):r._request())},this._onHeaderReqEnded=function(e){!r._contentLen&&e&&(r._contentLen=r._getContentLenFromHeader(e.responseHeader),c.Log.i(Jt,"get content length by header req: "+r._contentLen)),r._headerReq&&r._headerReq.destroy()},this._callback=e,this._config=t,this._internalCallback={onConnect:this._onLoaderConnect,onEnd:this._onLoaderEnd,onError:this._onLoaderError,onAbort:this._onLoaderAbort,onProgress:this._onLoaderProgress},this._loaderConfig={connectionTimeout:this._config.connectionTimeout,transmissionTimeout:this._config.transmissionTimeout,maxRetry:this._config.isLive?0:this._config.maxRetry,retryDelay:this._config.isLive?0:this._config.retryDelay,useFetch:this._config.isLive}}var t=e.prototype;return t.load=function(e){this._destroyLoader(),this._firstReq=!0,this._streamingMux=this._config.box===u.MediaBox.flv&&this._config.isLive||this._config.streamingMux,this._context=e,this._context.progress=this._streamingMux,this._context.responseType="arraybuffer",this._context.credentials=this._config.credentials,this._context.headers=this._config.headers,this._request()},t.seek=function(e){this._destroyLoader(),this._pos=e,this._ended=!1,this._request()},t.destroy=function(){this._destroyLoader(),this._headerReq&&this._headerReq.destroy()},t.ended=function(){return this._ended},t.streamingMux=function(e){this._streamingMux=e},t.setDownloadEnabled=function(e){void 0===e&&(e=!0),this._downloadEnabled!==e&&(this._downloadEnabled=e,this._request())},t._request=function(){if(this._downloadEnabled&&!this._ended&&this._context){this._destroyLoader(),this._pos&&(this._nextRangeStart=this._pos.position,this._context.frag.start=this._pos.time,this._pos=void 0);var e=this._context;this._config.isLive||(this._context.progress=this._streamingMux,this._firstReq&&e.progress?this._firstReq=!1:(this._firstReq&&(this._firstReq=!1,this._headerReq=new Xt,this._headerReq.start(e.url,this._onHeaderReqEnded),c.Log.i(Jt,"start header req")),e.rangeStart=this._nextRangeStart,e.rangeEnd=(1+(this._nextRangeStart/Qt|0))*Qt,this._nextRangeStart=e.rangeEnd,e.rangeEnd&&this._contentLen&&e.rangeEnd>this._contentLen&&(this._ended=!0))),this._currentReqLen=0,this._loader=new rt,this._loader.load(e,this._internalCallback,this._loaderConfig)}},t._destroyLoader=function(){this._loader&&(this._loader.destroy(),this._loader=void 0)},t._getContentLen=function(e){this._config.isLive||this._contentLen||e.rangeStart||e.rangeEnd||(this._contentLen=this._getContentLenFromHeader(e.responseHeader),c.Log.i(Jt,"get content length: "+this._contentLen))},t._getContentLenFromHeader=function(e){var t=0;return e&&oe(e).forEach((function(e){"content-length"===e[0].toLowerCase()&&(t=parseInt(e[1]))})),t},e}(),Zt=r("./src/types/remux.ts"),er=r("./src/utils/keyframes-utils.ts");function tr(){return(tr=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var i in r)Object.prototype.hasOwnProperty.call(r,i)&&(e[i]=r[i])}return e}).apply(this,arguments)}function rr(e,t){for(var r=0;r<t.length;r++){var i=t[r];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}var ir="single",nr=function(){function e(e,t,r,i){var n=this;void 0===i&&(i=!1),this._eventEmitter=void 0,this._config=void 0,this._media=void 0,this._preload=void 0,this._loader=void 0,this._loaderCallbacks=void 0,this._multirate=void 0,this._baseTimeSec=0,this._ready=!1,this._protocol=u.Protocol.UNKNOWN,this._remuxContiguous=!0,this._flvKeyDetector=void 0,this._metadata=void 0,this._appendFLVHead=!1,this._demuxerType=Zt.DemuxerType.UNKNOWN,this._flvHead=void 0,this._startTimeSec=-1,this._faststart=!0,this._loadEndCallbackonMeta=!1,this._demuxer=void 0,this._onProgress=function(e,t,r){if(t instanceof ArrayBuffer){var i;if(n._multirate&&n._multirate.onLoaderChunk(t.byteLength),n._flvKeyDetector)for(var a=n._flvKeyDetector.append(new Uint8Array(t)),o=0;o<a.length;o++){if(n._media.hasStreamTime||n._media.updateStreamTime(a[o].timestamp/1e3,0),n._multirate&&(i=n._multirate.onKeyFrame(a[o].timestamp))){var s=new Uint8Array(a[o].pos);s.set(new Uint8Array(t).subarray(0,a[o].pos)),t=s.buffer;var u=tr({},i);u.smooth=!0,u.timestamp=a[o].timestamp,u.startSec=n._baseTimeSec||n._media.currentTime,n._eventEmitter.emit(k.default.LEVEL_SWITCHING,u),n._baseTimeSec=n._media.getLocalTime(a[o].timestamp/1e3)||0;break}n._eventEmitter.emit(k.default.KEY_FRAME)}n._appendFLVHead&&(n._demuxerType===Zt.DemuxerType.FLV&&(t=n._onFlvSeekFirstChunk(t)),n._appendFLVHead=!1);var d={context:e,data:t,stats:r,remuxContiguous:n._remuxContiguous,progress:!0};i?(n._demuxer.onFragLoaded(d),n._flvKeyDetector&&n._flvKeyDetector.reset(),n._load(i.url,i.level)):n._demuxer.onFragProgress(d)}},this._onAbort=function(e,t){n._onDownload(ie.ABORT,e,t)},this._onLoaderError=function(e,t){if(n._onDownload(ie.FAIL,e,t),t.fatal){var r={type:I.ErrorTypes.NETWORK_ERROR,details:I.ErrorDetails.LOAD_ERROR,fatal:!0,reason:t.text,statusCode:t.code,url:e.url};n._eventEmitter.emit(k.default.ERROR,r)}},this._onLoaderEnd=function(e,t,r){n._demuxer.onFragLoaded({context:e,data:null,stats:r,remuxContiguous:n._remuxContiguous,progress:!0}),n._onDownload(ie.SUCCESS,e,r),n._metadata?n._demuxer.end():n._loadEndCallbackonMeta=!0},this._onMetadata=function(e){n._metadata=tr({},e),n._startTimeSec>0||!n._faststart?(n.seek(n._startTimeSec),n._startTimeSec=-1):n._loadEndCallbackonMeta&&n._demuxer.end(),n._loadEndCallbackonMeta=!1},this._onMediaDemux=function(e){c.Log.i(ir,"demuxer: "+e.type),e.type&&(n._demuxerType=e.type,e.type!==Zt.DemuxerType.FLV&&n._flvKeyDetector&&(n._flvKeyDetector=void 0))},this._onFlvHead=function(e){n._flvHead=e.head},this._onNotFaststart=function(e){c.Log.i(ir,"not faststart",e.pos),n._loader.seek({position:e.pos,time:0}),n._demuxer.reset(!0),n._faststart=!1,n._loadEndCallbackonMeta=!1},this._eventEmitter=e,this._config=t,this._media=r,this._preload=i,this._startTimeSec=t.startFromSec||-1,this._loaderCallbacks={onProgress:this._onProgress,onError:this._onLoaderError,onEnd:this._onLoaderEnd,onAbort:this._onAbort},this._loader=new $t(this._loaderCallbacks,t),this._demuxer=new ht(this._eventEmitter,t,u.LevelType.MAIN,this._config.webWorker?H.getWorker():void 0),this._demuxer.init(),this._eventEmitter.on(k.default.METADATA,this._onMetadata),this._eventEmitter.on(k.default.MEDIA_DEMUX,this._onMediaDemux),this._eventEmitter.on(k.default.FLV_HEAD,this._onFlvHead),this._eventEmitter.on(k.default.MP4_NOT_FASTSTART,this._onNotFaststart)}var t,r,i,n=e.prototype;return n.init=function(){"object"==typeof this._config?(Vt.verify(this._config.src)||Ze.verify(this._config.src))&&(this._protocol=u.Protocol.ABR_FLV):this._protocol=u.Protocol.FLV,this._multirate||(this._multirate=new qt(this._eventEmitter,this._config,this._media),this._multirate.levels.length>1&&this._config.box===u.MediaBox.flv&&this._config.isLive&&(this._flvKeyDetector=new Yt),this._multirate.init(),this._preload&&(this._multirate.autoLevelEnabled=!1)),this._ready=!0},n.destroy=function(){this._eventEmitter.off(k.default.METADATA,this._onMetadata),this._eventEmitter.off(k.default.MEDIA_DEMUX,this._onMediaDemux),this._eventEmitter.off(k.default.FLV_HEAD,this._onFlvHead),this._eventEmitter.off(k.default.MP4_NOT_FASTSTART,this._onNotFaststart),this._loader&&this._loader.destroy(),this._multirate&&this._multirate.destory(),this._demuxer.destroy()},n.loadSource=function(){var e=this._multirate;if(e){var t=e.levels[e.currentLevel];t?this._load(this._config.isLive?xt(t.currentUrl,this._config.defaultSpts):t.currentUrl,e.currentLevel):this._eventEmitter.emit(k.default.ERROR,{type:I.ErrorTypes.OTHER_ERROR,details:I.ErrorDetails.PARSING_ERROR,fatal:!0,reason:"manifest parse error"})}else this._load(this._config.src)},n.setDownloadEnabled=function(e){void 0===e&&(e=!0),this._loader.setDownloadEnabled(e)},n.isSeekable=function(){return!(!this._metadata||!this._metadata.keyframes||this._config.isLive)},n.seek=function(e,t,r){var i;void 0===t&&(t=!1),void 0===r&&(r=!1),c.Log.i(ir,"seek: "+e+" "+t+" "+r);var n=null==(i=this._metadata)?void 0:i.keyframes;if((n||e<u.UNSEEKABLE_START_TIME_THRESHOLD)&&!r){this.setDownloadEnabled(!0);var a=n?er.default.getPosByTime(n,e):{time:0,position:0};a&&(this._loader.seek(a),this._baseTimeSec=a.time,this._demuxer.reset(!0),this._appendFLVHead=a.position>0,t&&this._eventEmitter.emit(k.default.SEEK_KEYFRAME,{keyFrameSec:a.time}))}else c.Log.w(ir,"no keyframe index"),this._eventEmitter.emit(k.default.ERROR,{type:I.ErrorTypes.MEDIA_ERROR,details:I.ErrorDetails.CANNOT_SEEK,fatal:!1,reason:"can not seek"})},n.nextBackup=function(){return!1},n.streamingMux=function(e){this._loader.streamingMux(e)},n.setAvailableAbrLevels=function(e){},n.usePreload=function(){},n._load=function(e,t){void 0===t&&(t=0),this._multirate&&this._multirate.onLevelLoad(t);var r=this._multirate?this._multirate.levels[t]:void 0;this._config.audioCodec=this._config.audioCodec||(r?r.audioCodec:""),this._eventEmitter.emit(k.default.NEW_SOURCE,{sync:this._baseTimeSec,index:t});var i={url:e,frag:{start:this._baseTimeSec}};this._loader.load(i)},n._onDownload=function(e,t,r){var i=ce(e,t,r,this.levels[this.currentLevel].qualityType);this._eventEmitter.emit(k.default.DOWNLOAD,i)},n._onFlvSeekFirstChunk=function(e){if(this._flvHead){var t=new Uint8Array(e.byteLength+this._flvHead.length);return t.set(this._flvHead),t.set(new Uint8Array(e),this._flvHead.length),t.buffer}return e},t=e,(r=[{key:"levels",get:function(){return this._multirate?this._multirate.levels:[]}},{key:"protocol",get:function(){return u.Protocol.FLV}},{key:"isNetworkInUse",get:function(){return!0}},{key:"autoLevelEnabled",get:function(){return!!this._multirate&&this._multirate.autoLevelEnabled}},{key:"current",get:function(){if(this._multirate)return this._multirate.levels[this._multirate.currentLevel]}},{key:"mediaTrackNum",get:function(){return 1}},{key:"currentLevel",get:function(){return this._multirate?this._multirate.currentLevel:0},set:function(e){var t=this._multirate;if(t){var r=e>=0||e!==t.currentLevel;t.currentLevel=e;var i=t.levels[t.currentLevel];if(r&&i&&this._ready){var n=this._config.isLive?xt(i.currentUrl,this._config.defaultSpts):i.currentUrl;this._flvKeyDetector&&this._flvKeyDetector.reset(),this._baseTimeSec=this._media.currentTime,this._eventEmitter.emit(k.default.LEVEL_SWITCHING,{level:t.currentLevel,startSec:this._baseTimeSec,smooth:!1,auto:!1}),this._demuxer.reset(!0),this._load(n,t.currentLevel)}}}},{key:"manualNextLevel",set:function(e){this.nextLevel=e}},{key:"nextLevel",get:function(){return this._multirate?this._multirate.nextLevel:0},set:function(e){this._ready||(this.currentLevel=e);var t=this._multirate;t&&(-1===e&&this._eventEmitter.emit(k.default.LEVEL_SWITCHING,{level:-1,startSec:this._media.currentTime,smooth:!0,auto:!0}),t.nextLevel=e)}}])&&rr(t.prototype,r),i&&rr(t,i),e}();function ar(e,t){for(var r=0;r<t.length;r++){var i=t[r];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}var or=function(e){var t,r;function i(t,r,i){var n;return void 0===i&&(i=!1),(n=e.call(this)||this)._config=void 0,n._eventEmitter=void 0,n._trans=void 0,n._media=void 0,n._initSegments={main:void 0,audio:void 0},n._initSegmentReady=!1,n._loadEnd=0,n._mediaSegmentsBuffer=[],n._isMultipart=!1,n._onMessage=function(e,t){switch(e){case k.default.PARSING_INIT_SEGMENT:var r=n._getInitSegment(t);if(r){if(n.emit(k.default.PARSING_INIT_SEGMENT,r),!n._initSegmentReady)for(;n._mediaSegmentsBuffer.length;)n.emit(k.default.PARSING_DATA,n._mediaSegmentsBuffer.shift());n._initSegmentReady=!0}break;case k.default.PARSING_DATA:t.segments.forEach((function(e){e.type===u.TrackType.AUDIO&&n._media.updateStreamTime(e.streamDTS,e.startDTS)})),n._initSegmentReady?n.emit(e,t):n._mediaSegmentsBuffer.push(t);break;case k.default.MANIFEST_PARSED:n._initSegmentReady=1===n._trans.mediaTrackNum,n.emit(e,t);break;case k.default.ERROR:n._config.retryWithBackup&&n._trans.nextBackup()?n.emit(k.default.USE_BACKUP):n.emit(e,t);break;case k.default.LOAD_END:n._loadEnd++,n._loadEnd>=n._trans.mediaTrackNum&&n.emit(e,t);break;default:n.emit(e,t)}},n._config=t,n._eventEmitter=new a.EventEmitter,n._media=r,n._isMultipart="hls"===t.box||"flv"===t.box&&ee.verify(t.src),n._isMultipart?n._trans=new It(n._eventEmitter,n._config,r,i):n._trans=new nr(n._eventEmitter,n._config,r,i),n}r=e,(t=i).prototype=Object.create(r.prototype),t.prototype.constructor=t,t.__proto__=r;var n,o,s,d=i.prototype;return d.init=function(){var e=this;this._bindEvents(this._eventEmitter),this._trans.init(),this.on("mainNotify",(function(t){e._eventEmitter.emit("mainNotify",t)}))},d.destroy=function(){var e=this._trans;e&&e.destroy(),this._eventEmitter&&this._eventEmitter.removeAllListeners()},d.loadSource=function(){this._trans.loadSource()},d.setDownloadEnabled=function(e){void 0===e&&(e=!0),this._trans.setDownloadEnabled(e)},d.seek=function(e,t,r){void 0===r&&(r=!1),this._trans.seek(e,t,r)},d.heartbeat=function(){},d.getCurrentUrl=function(){var e=this._trans.current;return e?e.currentUrl:""},d.isSeekable=function(){return!this._config.isLive},d.setAvailableAbrLevels=function(e){this._trans.setAvailableAbrLevels(e)},d.streamingMux=function(e){this._trans.streamingMux(e)},d.usePreload=function(){this._trans.usePreload()},d._bindEvents=function(e){var t=this._onMessage;e.on(k.default.PARSING_INIT_SEGMENT,(function(e){return t(k.default.PARSING_INIT_SEGMENT,e)})),e.on(k.default.PARSING_DATA,(function(e){return t(k.default.PARSING_DATA,e)})),e.on(k.default.ERROR,(function(e){return t(k.default.ERROR,e)})),e.on(k.default.LEVEL_UPDATED,(function(e){return t(k.default.LEVEL_UPDATED,e)})),e.on(k.default.LEVEL_SWITCH_FAILED,(function(e){return t(k.default.LEVEL_SWITCH_FAILED,e)})),e.on(k.default.LEVEL_SWITCHING,(function(e){return t(k.default.LEVEL_SWITCHING,e)})),e.on(k.default.SUBTITLE_LOADED,(function(e){return t(k.default.SUBTITLE_LOADED,e)})),e.on(k.default.MANIFEST_PARSED,(function(e){return t(k.default.MANIFEST_PARSED,e)})),e.on(k.default.LOAD_END,(function(e){return t(k.default.LOAD_END,e)})),e.on(k.default.BUFFER_FLUSHING,(function(e){return t(k.default.BUFFER_FLUSHING,e)})),e.on(k.default.SEEK_KEYFRAME,(function(e){return t(k.default.SEEK_KEYFRAME,e)})),e.on(k.default.PRELOAD_COMPLETE,(function(e){return t(k.default.PRELOAD_COMPLETE,e)})),e.on(k.default.LOADER_CHUNK_ARRIVAL,(function(e){return t(k.default.LOADER_CHUNK_ARRIVAL,e)})),e.on(k.default.MEDIA_DEMUX,(function(e){return t(k.default.MEDIA_DEMUX,e)})),e.on(k.default.MUX_INFO,(function(e){return t(k.default.MUX_INFO,e)})),e.on(k.default.ABR_INFO,(function(e){return t(k.default.ABR_INFO,e)})),e.on(k.default.NEW_SOURCE,(function(e){return t(k.default.NEW_SOURCE,e)})),e.on(k.default.DOWNLOAD,(function(e){return t(k.default.DOWNLOAD,e)})),e.on(k.default.DISCONTINUITY,(function(e){return t(k.default.DISCONTINUITY,e)})),e.on(k.default.KEY_FRAME,(function(e){return t(k.default.KEY_FRAME,e)})),e.on(k.default.METADATA,(function(e){return t(k.default.METADATA,e)}))},d._resetInitSegments=function(){this._initSegments.audio=this._initSegments.main=void 0,this._initSegmentReady=1===this._trans.mediaTrackNum,this._loadEnd=0},d._getInitSegment=function(e){var t=e;if(1===this._trans.mediaTrackNum);else{if(e.tracks.hasOwnProperty("video")?this._initSegments.main=e.tracks.video:this._initSegments.audio=e.tracks.audio,!this._initSegments.main||!this._initSegments.audio)return;t={tracks:{video:this._initSegments.main,audio:this._initSegments.audio}}}return this._trans.current&&(t.manifestAudioCodec=this._trans.current.audioCodec,t.manifestVideoCodec=this._trans.current.videoCodec),t},n=i,(o=[{key:"levels",get:function(){return this._trans.levels}},{key:"autoLevelEnabled",get:function(){return this._trans.autoLevelEnabled}},{key:"nextLevel",get:function(){return this._trans.nextLevel},set:function(e){this._resetInitSegments(),this._trans.manualNextLevel=e}},{key:"currentLevel",get:function(){return this._trans.currentLevel},set:function(e){this._resetInitSegments(),this._trans.currentLevel=e}},{key:"protocol",get:function(){return this._trans.protocol}},{key:"isNetworkInUse",get:function(){return this._trans.isNetworkInUse}},{key:"audioTrack",get:function(){return this._trans.audioTrack||0},set:function(e){this._resetInitSegments(),void 0!==typeof this._trans.audioTrack&&(this._trans.audioTrack=e)}},{key:"audioTracks",get:function(){return this._trans.audioTracks||[]}},{key:"subtitleTrack",get:function(){return"number"==typeof this._trans.subtitleTrack?this._trans.subtitleTrack:-1},set:function(e){void 0!==typeof this._trans.subtitleTrack&&(this._trans.subtitleTrack=e)}},{key:"subtitleTracks",get:function(){return this._trans.subtitleTracks||[]}},{key:"isMultipart",get:function(){return this._isMultipart}}])&&ar(n.prototype,o),s&&ar(n,s),i}(a.EventEmitter);function sr(){return(sr=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var i in r)Object.prototype.hasOwnProperty.call(r,i)&&(e[i]=r[i])}return e}).apply(this,arguments)}function ur(e,t){for(var r=0;r<t.length;r++){var i=t[r];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}var dr,cr,lr=function(){function e(){var e=this;this._trans=void 0,this._eQueue=[],this._src=void 0,this._timeout=void 0,this._config=void 0,this._level=void 0,this._events=[k.default.NEW_SOURCE,k.default.LOADER_CHUNK_ARRIVAL,k.default.KEY_FRAME],this._onEvents=function(t){return function(r){e._eQueue.push({type:t,data:r})}},this._preloadError=function(){e.destroy()},this._onManifestParsed=function(t){"number"==typeof e._level&&e._trans&&(e._trans.currentLevel=e._level),e._eQueue.push({type:k.default.MANIFEST_PARSED,data:t})}}var t,r,i,n=e.prototype;return n.start=function(e,t,r,i){var n=this;if(this._level=i,this._trans&&this.destroy(),e=e||r.src,this._config=r=sr({},r),e&&r.isLive){v.setSrc(r,e),this._src=r.src;var a=new or(r,t,!0);this._trans=a,a.on(k.default.ERROR,this._preloadError),this._events.forEach((function(e){a.on(e,n._onEvents(e))})),a.on(k.default.MANIFEST_PARSED,this._onManifestParsed),a.init(),a.loadSource()}this._startTimeout()},n.check=function(e){if(e&&this._src&&this._config){if("string"==typeof e)return e===this._src;try{return JSON.stringify(e)===JSON.stringify(this._src)}catch(t){}}return!1},n.destroy=function(){this._eQueue=[],this._trans&&(this._trans.destroy(),this._trans.removeAllListeners(),this._trans=void 0),this._stopTimeout()},n.use=function(){var e=this;this._eQueue.forEach((function(t){e._trans&&e._trans.emit(t.type,t.data)})),this._eQueue=[],this._trans=void 0,this._stopTimeout()},n._startTimeout=function(){var e,t=this;this._stopTimeout(),this._timeout=setTimeout((function(){c.Log.i("preload-flv","timeout"),t.destroy()}),(null==(e=this._config)?void 0:e.flvPreloadTimeout)||3e3)},n._stopTimeout=function(){this._timeout&&(clearTimeout(this._timeout),this._timeout=void 0)},t=e,(r=[{key:"trans",get:function(){return this._trans}}])&&ur(t.prototype,r),i&&ur(t,i),e}(),fr=function(){function e(e,t){this._media=void 0,this._config=void 0,this._startDelay=5e3,this._enabled=!1,this._lastTickTime=0,this._media=e,this._config=t}var t=e.prototype;return t.start=function(){this._enabled=!0,this._lastTickTime=performance.now(),this._startDelay=this._config.startDelay?1e3*this._config.startDelay:this._startDelay},t.stop=function(){this._enabled=!1},t.tick=function(){if(this._enabled&&this._media.video&&!this._media.video.paused){if(this._startDelay>0){var e=performance.now();return this._startDelay-=e-this._lastTickTime,void(this._lastTickTime=e)}this._nextPlayBackRate(this._media.bufferedSec(),this._media.video)}},t._nextPlayBackRate=function(e,t){var r=1,i=this._config.rule,n=0;for(n=0;n<i.length&&!(t.playbackRate>=i[n].rate);n++);var a=n<i.length-1?i[n+1]:null,o=n>0?i[n-1]:null;r=i[n].rate,o&&e>o.lower&&(r=o.rate),a&&e<a.upper&&(r=a.rate),t.playbackRate!==r&&(c.Log.i("playback-rate-manager","auto change playback rate from "+t.playbackRate+" to "+r),t.playbackRate=r)},e}();function _r(){return(_r=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var i in r)Object.prototype.hasOwnProperty.call(r,i)&&(e[i]=r[i])}return e}).apply(this,arguments)}function hr(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(cr=dr||(dr={}))[cr.NONE=0]="NONE",cr[cr.WAITING=1]="WAITING",cr[cr.SEEK=2]="SEEK",cr[cr.SELECT_BITRATE=3]="SELECT_BITRATE",cr[cr.INIT=4]="INIT",cr[cr.LOADING=5]="LOADING";var pr,vr,mr,gr="kernel-base",yr=function(e){var t,r;function i(t,r){var i;if((i=e.call(this)||this)._video=void 0,i._error=void 0,i._monitor=void 0,i._hbTimer=void 0,i._stat=dr.INIT,i._mediaInfo=void 0,i._levelSwitchId=0,i._startLevel=void 0,i._nextLevel=[],i._nextAudio=void 0,i._playingLevel=0,i._eventHandlers=void 0,!t)throw new Error("video is null");return i._video=t,i._monitor=r,i._eventHandlers={loadedmetadata:i._onVideoLoadedmetadata.bind(hr(i)),loadeddata:i._onVideoLoadeddata.bind(hr(i)),canplay:i._onVideoCanplay.bind(hr(i)),seeking:i._onVideoSeeking.bind(hr(i)),seeked:i._onVideoSeeked.bind(hr(i)),waiting:i._onVideoWaiting.bind(hr(i)),playing:i._onVideoPlaying.bind(hr(i)),pause:i._onVideoPause.bind(hr(i)),play:i._onVideoPlay.bind(hr(i)),error:i._onVideoError.bind(hr(i)),ended:i._onVideoEnded.bind(hr(i)),ratechange:i._onVideoRatechange.bind(hr(i)),durationchange:i._onVideoDurationchange.bind(hr(i)),timeupdate:i._onVideoTimeupdate.bind(hr(i)),progress:i._onVideoProgress.bind(hr(i))},i._bindVideoEvents(),i}r=e,(t=i).prototype=Object.create(r.prototype),t.prototype.constructor=t,t.__proto__=r;var n=i.prototype;return n.destroy=function(){this._stopHeartbeat(),this._unbindVideoEvents(),this.removeAllListeners()},n.getError=function(){return this._error},n.getMediaInfo=function(){return _r({},this._mediaInfo)},n.setStartLevel=function(e){},n.getStartLevel=function(){return 0},n.getAudioTracks=function(){return[]},n.setAudioTrack=function(e){},n.getAudioTrack=function(){return 0},n.getSubtitleTracks=function(){return[]},n.setSubtitleTrack=function(e){},n.getSubtitleTrack=function(){return 0},n.getAutoLevelEnabled=function(){return!1},n._bindVideoEvents=function(){if(this._video)for(var e in this._eventHandlers)this._video.addEventListener(e,this._eventHandlers[e])},n._unbindVideoEvents=function(){if(this._video)for(var e in this._eventHandlers)this._video.removeEventListener(e,this._eventHandlers[e])},n._onVideoLoadedmetadata=function(e){},n._onVideoLoadeddata=function(){c.Log.i(gr,"loadeddata"),this.emit(k.default.LOADEDDATA)},n._onVideoCanplay=function(){c.Log.i(gr,"canplay "+!!this._stat),this.emit(k.default.CANPLAY)},n._onVideoSeeking=function(){this.emit(k.default.SEEKING)},n._onVideoSeeked=function(){this.emit(k.default.SEEKED)},n._onVideoWaiting=function(){},n._onVideoPlaying=function(){c.Log.i(gr,"playing"),this._error||(this._stat=dr.NONE,this._startHeartbeat(),this.emit(k.default.PLAYING))},n._onVideoPause=function(){c.Log.i(gr,"pause"),this._video.ended||this.emit(k.default.PAUSE)},n._onVideoPlay=function(){c.Log.i(gr,"play",this._error),this.emit(k.default.PLAY)},n._onVideoError=function(e){},n._onVideoEnded=function(){c.Log.i(gr,"ended"),this.emit(k.default.ENDED),this._stopHeartbeat()},n._onVideoRatechange=function(){c.Log.v(gr,"ratechange "+this._video.playbackRate),this.emit(k.default.RATE_CHANGE,this._video.playbackRate)},n._onVideoDurationchange=function(){this.emit(k.default.DURATION_CHANGE,this._video.duration)},n._onVideoTimeupdate=function(){this.emit(k.default.TIMEUPDATE)},n._onVideoProgress=function(){this.emit(k.default.PROGRESS)},n._onError=function(e){this._error=e.details||I.ErrorDetails.UNKNOWN,c.Log.i(gr,"error",this._error,e),this.emit(k.default.ERROR,e)},n._heartbeat=function(){this.emit(k.default.HEARTBEAT)},n._startHeartbeat=function(){this._hbTimer||(this._hbTimer=setInterval(this._heartbeat.bind(this),1e3))},n._stopHeartbeat=function(){this._hbTimer&&(clearInterval(this._hbTimer),this._hbTimer=void 0)},i}(a.EventEmitter);(vr=pr||(pr={})).WIDEVINE="com.widevine.alpha",vr.PLAYREADY="com.microsoft.playready",vr.FAIRPLAY="com.apple.fairplay",(mr||(mr={})).WIDEVINE="urn:uuid:edef8ba9-79d6-4ace-a3c8-27dcd51d21ed";var Er="undefined"!=typeof window&&window.navigator&&window.navigator.requestMediaKeySystemAccess?window.navigator.requestMediaKeySystemAccess.bind(window.navigator):void 0;function Sr(e,t){for(var r=0;r<t.length;r++){var i=t[r];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}var Tr="eme",br=function(e){var t,r;function i(t,r){var i;return(i=e.call(this)||this)._media=void 0,i._config=void 0,i._drmSystemOptions={audioRobustness:"SW_SECURE_CRYPTO",videoRobustness:"SW_SECURE_DECODE"},i._mediaKeysList=[],i._hasSetMediaKeys=!1,i._loader=void 0,i._loaderConfig=void 0,i._mediaKeysPromise=void 0,i._licenseServerUrl="",i._onMediaEncrypted=function(e){if(c.Log.i(Tr,'Media is encrypted using "'+e.initDataType+'" init data type'),!i._mediaKeysPromise)return c.Log.e(Tr,"Fatal: Media is encrypted but no CDM access or no keys have been requested"),void i.emit(k.default.ERROR,{type:I.ErrorTypes.KEY_SYSTEM_ERROR,details:I.ErrorDetails.KEY_SYSTEM_NO_KEYS,fatal:!0,reason:"media is encrypted but no CDM access or no keys have been requested"});var t=function(t){i._media.video&&(i._attemptSetMediaKeys(t),i._generateRequestWithPreferredKeySession(e.initDataType,e.initData))};i._mediaKeysPromise.then(t).catch(t)},i._onKeySessionMessage=function(e){var t=e.target;i._requestLicense(e.message,t)},i._onLoaderError=function(e,t){t.fatal&&i.emit(k.default.ERROR,{type:I.ErrorTypes.NETWORK_ERROR,details:I.ErrorDetails.KEY_SYSTEM_LICENSE_REQUEST_FAILED,fatal:!0,reason:t.text,statusCode:t.code})},i._media=t,i._config=r,i._media.video&&i._media.video.addEventListener("encrypted",i._onMediaEncrypted),i._loaderConfig={useFetch:!1,maxRetry:i._config.keyLoadingMaxRetry,connectionTimeout:i._config.keyConnectionTimeout,transmissionTimeout:i._config.keyTransmissionTimeout,retryDelay:i._config.keyLoadingRetryDelay},i}r=e,(t=i).prototype=Object.create(r.prototype),t.prototype.constructor=t,t.__proto__=r,i.getSupportedMediaKeySystemConfigurations=function(e,t,r){var i={audioCapabilities:[{contentType:'audio/mp4; codecs="mp4a.40.5"',robustness:r.audioRobustness||""},{contentType:'audio/mp4; codecs="mp4a.40.2"',robustness:r.audioRobustness||""}],videoCapabilities:[]};return t.forEach((function(e){i.videoCapabilities.push({contentType:'video/mp4; codecs="'+e+'"',robustness:r.videoRobustness||""})})),[i]};var n,a,o,s=i.prototype;return s.onManifestParsed=function(e){var t=this,r=e.reduce((function(e,t){return e&&(t.drmSchemaId===mr.WIDEVINE||!t.drmSchemaId)}),!0),i="chrome"===d.default.name&&d.default.version.major>=68||d.default.firefox;if(r&&Er&&i){this._licenseServerUrl=e.reduce((function(e,t){return e||t.drmToken||""}),"");var n=pr.WIDEVINE,a=e.map((function(e){return e.videoCodec}));c.Log.i(Tr,"on manifest parsed",n,a),this._attemptKeySystemAccess(pr.WIDEVINE,a)}else setTimeout((function(){return t.emit(k.default.ERROR,{type:I.ErrorTypes.KEY_SYSTEM_ERROR,details:I.ErrorDetails.KEY_SYSTEM_UNSUPPORTED,fatal:!0,reason:"DRM unsupported."})}),0)},s.reset=function(){var e,t=this;return c.Log.i(Tr,"reset"),this._mediaKeysList.map((function(e){if(e.mediaKeysSession)return e.mediaKeysSession.removeEventListener("message",t._onKeySessionMessage),e.mediaKeysSession.close().catch((function(){}))})),this._mediaKeysList=[],this._hasSetMediaKeys=!1,null==(e=this._media.video)?void 0:e.setMediaKeys(null)},s.destory=function(){var e=this,t=this._media.video;if(t){t.removeEventListener("encrypted",this._onMediaEncrypted);var r=this._mediaKeysList;Promise.all(r.map((function(t){if(t.mediaKeysSession)return t.mediaKeysSession.removeEventListener("message",e._onKeySessionMessage),t.mediaKeysSession.close().catch((function(){}))}))).then((function(){if(t)return t.setMediaKeys(null)})).catch((function(){})),this.removeAllListeners()}},s._attemptSetMediaKeys=function(e){if(!this._media.video)throw new Error("Attempted to set mediaKeys without first attaching a media element");if(!this._hasSetMediaKeys){var t=this._mediaKeysList[0];if(!t||!t.mediaKeys)return c.Log.e(Tr,"Fatal: Media is encrypted but no CDM access or no keys have been obtained yet"),void this.emit(k.default.ERROR,{type:I.ErrorTypes.KEY_SYSTEM_ERROR,details:I.ErrorDetails.KEY_SYSTEM_NO_KEYS,fatal:!0,reason:"media is encrypted but no CDM access or no keys have been obtained yet"});c.Log.i(Tr,"Setting keys for encrypted media"),this._media.video.setMediaKeys(t.mediaKeys),this._hasSetMediaKeys=!0}},s._generateRequestWithPreferredKeySession=function(e,t){var r=this,i=this._mediaKeysList[0];if(!i)return c.Log.e(Tr,"Fatal: Media is encrypted but not any key-system access has been obtained yet"),void this.emit(k.default.ERROR,{type:I.ErrorTypes.KEY_SYSTEM_ERROR,details:I.ErrorDetails.KEY_SYSTEM_NO_ACCESS,fatal:!0,reason:"media is encrypted but not any key-system access has been obtained yet"});if(i.mediaKeysSessionInitialized)c.Log.i(Tr,"Key-Session already initialized but requested again");else{var n=i.mediaKeysSession;if(!n)return c.Log.e(Tr,"Fatal: Media is encrypted but no key-session existing"),void this.emit(k.default.ERROR,{type:I.ErrorTypes.KEY_SYSTEM_ERROR,details:I.ErrorDetails.KEY_SYSTEM_NO_SESSION,fatal:!0,reason:"media is encrypted but no key-session existing"});if(!t)return c.Log.i(Tr,"Fatal: initData required for generating a key session is null"),void this.emit(k.default.ERROR,{type:I.ErrorTypes.KEY_SYSTEM_ERROR,details:I.ErrorDetails.KEY_SYSTEM_NO_INIT_DATA,fatal:!0,reason:"initData required for generating a key session is null"});c.Log.i(Tr,'Generating key-session request for "'+e+'" init data type'),i.mediaKeysSessionInitialized=!0,n.generateRequest(e,t).then((function(){c.Log.d(Tr,"Key-session generation succeeded")})).catch((function(e){c.Log.e(Tr,"Error generating key-session request:",e),r.emit(k.default.ERROR,{type:I.ErrorTypes.KEY_SYSTEM_ERROR,details:I.ErrorDetails.KEY_SYSTEM_NO_SESSION,fatal:!1,reason:"error generating key-session request:"+e})}))}},s._attemptKeySystemAccess=function(e,t){var r=this,n=i.getSupportedMediaKeySystemConfigurations(e,t,this._drmSystemOptions);if(c.Log.i(Tr,"Requesting encrypted media key-system access"),Er){var a=Er(e,n);this._mediaKeysPromise=a.then((function(t){var i={mediaKeysSessionInitialized:!1,mediaKeySystemAccess:t,mediaKeySystemDomain:e};r._mediaKeysList.push(i);var n=Promise.resolve().then((function(){return t.createMediaKeys()})).then((function(e){return i.mediaKeys=e,r._mediaKeysList.forEach((function(e){e.mediaKeysSession||(e.mediaKeysSession=e.mediaKeys.createSession()).addEventListener("message",r._onKeySessionMessage,!1)})),e}));return n.catch((function(e){c.Log.e(Tr,"Failed to create media-keys:",e)})),n})),a.catch((function(t){c.Log.e(Tr,'Failed to obtain key-system "'+e+'" access:',t)}))}else c.Log.i(Tr,"no requestMediaKeySystemAccess")},s._getLicenseServerUrl=function(e){switch(e){case pr.WIDEVINE:if(!this._config.widevineLicenseUrl)break;return this._config.widevineLicenseUrl;case pr.PLAYREADY:if(!this._config.playreadyLicenseUrl)break;return this._config.playreadyLicenseUrl;case pr.FAIRPLAY:if(!this._config.fairplayLicenseUrl)break;return this._config.fairplayLicenseUrl}throw new Error('no license server URL configured for key-system "'+e+'"')},s._requestLicense=function(e,t){var r=this,i=this._mediaKeysList[0];if(!i)return c.Log.e(Tr,"Fatal error: Media is encrypted but no key-system access has been obtained yet"),void this.emit(k.default.ERROR,{type:I.ErrorTypes.KEY_SYSTEM_ERROR,details:I.ErrorDetails.KEY_SYSTEM_NO_ACCESS,fatal:!0,reason:"media is encrypted but no key-system access has been obtained yet"});this._disposeLoader();var n={onError:this._onLoaderError,onEnd:function(e,i){r._disposeLoader(),i instanceof ArrayBuffer&&t.update(i)}},a=this._loader=new rt,o={requestMethod:"POST",requestBody:e,url:this._licenseServerUrl||this._getLicenseServerUrl(i.mediaKeySystemDomain),responseType:"arraybuffer"};a.load(o,n,this._loaderConfig)},s._disposeLoader=function(){this._loader&&this._loader.destroy()},n=i,(a=[{key:"isActive",get:function(){return!(!this._media.video||!this._media.video.mediaKeys)}}])&&Sr(n.prototype,a),o&&Sr(n,o),i}(a.EventEmitter);function Lr(e,t){for(var r=0;r<t.length;r++){var i=t[r];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}var Ar="mse",Rr=function(e){var t,r;function i(t){var r;return(r=e.call(this)||this)._config=void 0,r.video=void 0,r._sourceBuffer=void 0,r._mediaSource=null,r._mimeCodec=void 0,r._cleanUpTask=void 0,r._appendQueue=void 0,r._hasVideo=void 0,r._hasAudio=void 0,r._endOfData=!1,r._appendEnabled=void 0,r._duration=null,r._appendError=0,r._appendBufferError=!1,r._mseDuration=null,r._sbHandler={},r._souceBufferLocked=!1,r._sbAppendStarted=void 0,r._startBufSec=0,r._startBufTimer=void 0,r._onSourceOpen=function(){c.Log.i(Ar,"MediaSource onSourceOpen"),r._mediaSource&&(r._mediaSource.removeEventListener("sourceopen",r._onSourceOpen),r._checkSourceBuffer(),r.refresh(),r.emit(k.default.MSE_OPEN))},r._onSourceEnded=function(){c.Log.i(Ar,"MediaSource onSourceEnded")},r._onSourceClose=function(){c.Log.i(Ar,"MediaSource onSourceClose"),r._mediaSource&&(r._mediaSource.removeEventListener("sourceopen",r._onSourceOpen),r._mediaSource.removeEventListener("sourceended",r._onSourceEnded),r._mediaSource.removeEventListener("sourceclose",r._onSourceClose))},r._onSourceBufferUpdateEnd=function(e){r._update(e),r._endOfData&&r._endOfStream(),r._updateDuration(),r.emit(k.default.MSE_UPDATE)},r._onSourceBufferError=function(e){c.Log.e(Ar,"SourceBuffer Error: ",e),r.emit(k.default.ERROR,{type:I.ErrorTypes.MSE_ERROR,details:I.ErrorDetails.SOURCEBUFFER_ERROR,fatal:!0,reason:"source buffer error"})},r._startBufEnded=function(){c.Log.i(Ar,"startPlayBufEnd"),r._removeStartBufTimer(),r._startBufSec=0,r.refresh()},r._config=t,r._hasVideo=!1,r._hasAudio=!1,r._appendQueue={video:[],audio:[]},r._sourceBuffer={},r._cleanUpTask={video:[],audio:[]},r._mimeCodec={},r._sbAppendStarted={},r._appendEnabled=!0,r}r=e,(t=i).prototype=Object.create(r.prototype),t.prototype.constructor=t,t.__proto__=r;var n,a,o,s=i.prototype;return s.attach=function(e){var t=this;this.video=e;var r=Pe();if(r){var i=this._mediaSource=new r;this.video.src=URL.createObjectURL(i),this.video.load(),i.addEventListener("sourceopen",this._onSourceOpen),i.addEventListener("sourceended",this._onSourceEnded),i.addEventListener("sourceclose",this._onSourceClose),this._souceBufferLocked=!1}else setTimeout((function(){t.emit(k.default.ERROR,{type:I.ErrorTypes.MSE_ERROR,details:I.ErrorDetails.MEDIASOURCE_ERROR,fatal:!0,reason:"MediaSource is not support"})}),0)},s.trackInfo=function(e){e.hasAudio&&e.audioCodec&&(this._mimeCodec.audio='audio/mp4; codecs="'+e.audioCodec+'"'),e.hasVideo&&e.videoCodec&&(this._mimeCodec.video='video/mp4; codecs="'+e.videoCodec+'"'),this._hasAudio=this._hasAudio||e.hasAudio,this._hasVideo=this._hasVideo||e.hasVideo,this._checkSourceBuffer(),e.segments.length&&this.mediaSegment(e.segments)},s.updateDuration=function(e){this._duration=e,this._updateDuration()},s.setStartBufSec=function(e){c.Log.i(Ar,"startPlayBufSec: "+e),this._removeStartBufTimer(),this._startBufSec=e,this._startBufTimer=setTimeout(this._startBufEnded,1e3*e)},s._updateDuration=function(){if(null!==this._duration&&this.video&&this._mediaSource&&this._sourceBuffer&&0!==this.video.readyState&&"open"===this._mediaSource.readyState){for(var e in this._sourceBuffer)if(this._sourceBuffer[e]&&this._sourceBuffer[e].updating)return;var t=this.video.duration;if(null===this._mseDuration&&(this._mseDuration=this._mediaSource.duration),this._config.isLive)this._mseDuration=this._mediaSource.duration=1/0;else if(this._duration!==this._mseDuration&&this._duration!==t||!j(t)){var r=!0;for(var i in this._sourceBuffer)r=r&&this.bufferedEndByType(i)<this._duration;r&&(this._mseDuration=this._mediaSource.duration=this._duration),this._duration=null}}},s._checkSourceBuffer=function(){var e=(this._hasAudio?1:0)+(this._hasVideo?1:0),t=(this._mimeCodec.audio?1:0)+(this._mimeCodec.video?1:0);if(c.Log.v(Ar,"checkSourceBuffer",e,t,this._mimeCodec),this._mediaSource&&"open"===this._mediaSource.readyState&&e>0&&t>=e)for(var r in this._mimeCodec)this._mimeCodec[r]&&this._addSourceBuffer(r)},s._addSourceBuffer=function(e){var t=this;if(!this._sourceBuffer[e]&&!this._souceBufferLocked){try{this._mediaSource&&(this._sourceBuffer[e]=this._mediaSource.addSourceBuffer(this._mimeCodec[e]),this._sbAppendStarted[e]=!1)}catch(i){return c.Log.e(Ar,i),void this.emit(k.default.ERROR,{type:I.ErrorTypes.MSE_ERROR,details:I.ErrorDetails.ADDSOURCEBUFFER_ERROR,fatal:!0,reason:i.message})}var r=this._sourceBuffer[e];this._sbHandler[e]={updateend:function(){t._onSourceBufferUpdateEnd(e)},error:function(e){t._onSourceBufferError(e)}},r.addEventListener("error",this._sbHandler[e].error),r.addEventListener("updateend",this._sbHandler[e].updateend),this._duration&&this._mediaSource&&(this._mediaSource.duration=this._duration)}},s._hasPendingData=function(){return!(!this._appendQueue||!(this._appendQueue.video&&this._appendQueue.video.length||this._appendQueue.audio&&this._appendQueue.audio.length))},s.refresh=function(){for(var e in this._sourceBuffer)this._update(e)},s._doAppend=function(e){if(this._appendQueue[e]&&this._appendQueue[e].length>0){if(!this._appendEnabled)return void(this._getBufferQueueSize()>209715200&&!this._appendBufferError&&(this._appendBufferError=!0,this.emit(k.default.ERROR,{type:I.ErrorTypes.MSE_ERROR,details:I.ErrorDetails.APPENDBUFFER_ERROR,fatal:!0,reason:"bufferfull"})));if(this._sourceBuffer[e]&&!this._sourceBuffer[e].updating&&!this._appendBufferError){var t=this._appendQueue[e].shift();this._appendBuffer(t)}}},s.mediaSegment=function(e){var t=this;e.forEach((function(e){var r=e.type;t._appendQueue[r].push(e),t._sourceBuffer[r]&&(t._souceBufferLocked=!0,t._update(r))}))},s.bufferedByType=function(e){var t=this._sourceBuffer[e];return t&&t.buffered.length>0?{start:t.buffered.start(0),end:t.buffered.end(t.buffered.length-1)}:{start:0,end:0}},s.bufferedEndByType=function(e){var t=this._sourceBuffer[e];return t&&t.buffered.length>0?t.buffered.end(t.buffered.length-1):0},s.bufferSliceNumByType=function(e){var t=this._sourceBuffer[e];return t?t.buffered.length:0},s.pendingSecByType=function(e){var t=this._appendQueue[e];return t?t.reduce((function(e,t){return e+t.endDTS-t.startDTS}),0):0},s.pendingNum=function(){var e=0;for(var t in this._appendQueue)e+=this._appendQueue[t].length;return e},s._calculateRemoveRange=function(e){var t=this.video;if(t&&!t.seeking){var r=t.currentTime;if(this._sourceBuffer[e]){var i=this._cleanUpTask[e],n=this._sourceBuffer[e].buffered;if(n.length>=1&&r-n.start(0)>=10){var a=r-5;if(i.length&&0===i[i.length-1].start&&i[i.length-1].end===a)return;i.push({start:0,end:a})}}}},s._cleanUpRange=function(e,t){try{for(var r=0;r<e.buffered.length;r++){var i=e.buffered.start(r),n=e.buffered.end(r),a=Math.max(i,t.start),o=Math.min(n,t.end);if(o>a)return e.remove(a,o),this.emit(k.default.MSE_REMOVE),!(t.end>n&&r<e.buffered.length-1&&(t.start=Math.max(t.start,o),1));if(!(t.end>o))break;t.start=Math.max(t.start,o)}return!0}catch(s){return!(e&&e.updating)}},s._appendBuffer=function(e){if(e&&this._sourceBuffer[e.type]&&this.video&&!this.video.error)try{this._sourceBuffer[e.type].appendBuffer(e.payload.buffer),this._sbAppendStarted[e.type]=!0}catch(a){if(c.Log.w(Ar,a.code,a),22!==a.code)this._appendError?this._appendError++:this._appendError=1,this._appendError>this._config.appendErrorMaxRetry?(this._appendBufferError=!0,this.emit(k.default.ERROR,{type:I.ErrorTypes.MSE_ERROR,details:I.ErrorDetails.APPENDBUFFER_ERROR,fatal:!0,reason:a.message})):this._appendQueue[e.type].unshift(e);else{var t=this.video,r=this._config;this._appendEnabled=!1,this._appendQueue[e.type].unshift(e);var i=t.buffered.end(t.buffered.length-1)-t.currentTime;if(r.lazyLoadMaxDuration>30&&r.lazyLoad)r.lazyLoadMaxDuration=Math.max(r.lazyLoadMaxDuration/2,30),r.lazyLoadRecoverDuration=20;else{var n=t.currentTime-t.buffered.start(0);i<30?(this._calculateRemoveRange(e.type),this.hasCleanUpTask(e.type)&&this._cleanUp(e.type)):n<10&&this.emit(k.default.ERROR,{type:I.ErrorTypes.MSE_ERROR,details:I.ErrorDetails.APPENDBUFFER_ERROR,fatal:!0,reason:"bufferfull-appendError"})}c.Log.i(Ar,"mse bufferfull"),this.emit(k.default.MSE_BUFFER_FULL)}}},s.flush=function(e,t,r){var i=0,n=Number.POSITIVE_INFINITY;for(var a in this._sbAppendStarted={},this._endOfData=!1,this._sourceBuffer)if(this._sbAppendStarted[a]=!1,(!r||r===a)&&this._sourceBuffer[a]){if(e){i=Math.max(i,e);for(var o=this._appendQueue[a].length-1;o>=0&&(!this._appendQueue[a][o].startPTS||this._appendQueue[a][o].startPTS>=e);o--)this._appendQueue[a].pop()}else this._appendQueue[a]=[];t&&(n=Math.min(n,t)),this._cleanUpTask[a].push({start:i,end:n}),this._cleanUp(a)}this._appendEnabled=!0},s.setAppendEnabled=function(e){!this._appendEnabled&&e?(this._appendEnabled=e,this.refresh()):this._appendEnabled=e},s.getAppendEnabled=function(){return this._appendEnabled},s.endOfData=function(){c.Log.i(Ar,"data end"),this._endOfData=!0,!this._hasPendingData()&&(this._config.isLive||!this._config.isLive&&this._duration)&&this.video&&this.video.buffered.length&&this._endOfStream()},s.ended=function(){return this._endOfData},s._endOfStream=function(){var e=this._mediaSource;if(e&&"open"===e.readyState){for(var t in this._sourceBuffer){var r=this._sourceBuffer[t];if(r&&r.updating)return}try{c.Log.i(Ar,"end of stream"),e.endOfStream()}catch(i){c.Log.e(Ar,i),this.emit(k.default.ERROR,{type:I.ErrorTypes.MSE_ERROR,details:I.ErrorDetails.ENDOFSTREAM_ERROR,fatal:!0,reason:i.message})}}},s.destroy=function(){if(this._mediaSource){var e=this._mediaSource;if(this._endOfStream(),"closed"!==e.readyState)for(var t in this._sourceBuffer)this._sourceBuffer[t]&&this._sbHandler[t]&&(this._sourceBuffer[t].removeEventListener("error",this._sbHandler[t].error),this._sourceBuffer[t].removeEventListener("updateend",this._sbHandler[t].updateend),e.removeSourceBuffer(this._sourceBuffer[t]));e.removeEventListener("sourceopen",this._onSourceOpen),e.removeEventListener("sourceended",this._onSourceEnded),e.removeEventListener("sourceclose",this._onSourceClose),this._mediaSource=null}this._removeStartBufTimer(),this.removeAllListeners(),this._appendQueue={},this._mimeCodec={},this._sbAppendStarted={},this._cleanUpTask={},this._sourceBuffer={},this._sbHandler={}},s.hasCleanUpTask=function(e){var t=0;if(void 0===e)for(var r in this._cleanUpTask)t+=this._cleanUpTask[r].length;else this._cleanUpTask[e]&&(t=this._cleanUpTask[e].length);return t>0},s.hasSourceBuffer=function(){return!!Object.keys(this._sourceBuffer).length},s.hasTrackInfo=function(){return!!Object.keys(this._mimeCodec).length},s.hasSourceBufferAppendStarted=function(){if(Object.keys(this._sbAppendStarted).length){var e=!0;for(var t in this._sbAppendStarted)e=e&&this._sbAppendStarted[t];return e}return!1},s._getBufferQueueSize=function(){var e=0;for(var t in this._appendQueue)e+=this._appendQueue[t].reduce((function(e,t){return t.payload&&t.payload.byteLength?e+t.payload.byteLength:e}),0);return e},s.getBufferQueueSec=function(e){var t=this;return this._appendQueue?(e?[e]:Object.keys(this._appendQueue)).reduce((function(e,r){return t._appendQueue[r]&&t._appendQueue[r].length>0&&(0===Object.keys(t._sourceBuffer).length||t._sourceBuffer[r])?Math.max(e,t._appendQueue[r].reduce((function(e,t){var r=t.endDTS-t.startDTS;return r?e+r:e}),0)):e}),0):0},s._update=function(e){if(this.hasCleanUpTask(e)&&this._cleanUp(e),this._startBufSec>0){if(!this.hasTrackInfo())return;for(var t in this._sourceBuffer)if(this.pendingSecByType(t)<this._startBufSec)return;this._startBufEnded()}this._doAppend(e)},s._cleanUp=function(e){for(var t=this._cleanUpTask[e];t&&t.length;){var r=t[0],i=this._sourceBuffer[e];if(i){if(i.updating||!this._cleanUpRange(i,r))return;t.shift()}else t.shift()}this.refresh()},s._removeStartBufTimer=function(){this._startBufTimer&&(clearTimeout(this._startBufTimer),this._startBufTimer=void 0)},n=i,(a=[{key:"readyState",get:function(){return this._mediaSource?this._mediaSource.readyState:"closed"}}])&&Lr(n.prototype,a),o&&Lr(n,o),i}(a.EventEmitter),Ir=r("./src/demux/video/color-space.ts"),kr=function(){if("undefined"!=typeof self&&self.VTTCue)return self.VTTCue;var e=["","lr","rl"],t=["start","middle","end","left","right"];function r(e,t){if("string"!=typeof t)return!1;if(!Array.isArray(e))return!1;var r=t.toLowerCase();return!!~e.indexOf(r)&&r}function i(e){return r(t,e)}function n(e){for(var t=arguments.length,r=new Array(t>1?t-1:0),i=1;i<t;i++)r[i-1]=arguments[i];for(var n=1;n<arguments.length;n++){var a=arguments[n];for(var o in a)e[o]=a[o]}return e}function a(t,a,o){var s=this,u={enumerable:!0};s.hasBeenReset=!1;var d="",c=!1,l=t,f=a,_=o,h=null,p="",v=!0,m="auto",g="start",y=50,E="middle",S=50,T="middle";Object.defineProperty(s,"id",n({},u,{get:function(){return d},set:function(e){d=""+e}})),Object.defineProperty(s,"pauseOnExit",n({},u,{get:function(){return c},set:function(e){c=!!e}})),Object.defineProperty(s,"startTime",n({},u,{get:function(){return l},set:function(e){if("number"!=typeof e)throw new TypeError("Start time must be set to a number.");l=e,this.hasBeenReset=!0}})),Object.defineProperty(s,"endTime",n({},u,{get:function(){return f},set:function(e){if("number"!=typeof e)throw new TypeError("End time must be set to a number.");f=e,this.hasBeenReset=!0}})),Object.defineProperty(s,"text",n({},u,{get:function(){return _},set:function(e){_=""+e,this.hasBeenReset=!0}})),Object.defineProperty(s,"region",n({},u,{get:function(){return h},set:function(e){h=e,this.hasBeenReset=!0}})),Object.defineProperty(s,"vertical",n({},u,{get:function(){return p},set:function(t){var i=function(t){return r(e,t)}(t);if(!1===i)throw new SyntaxError("An invalid or illegal string was specified.");p=i,this.hasBeenReset=!0}})),Object.defineProperty(s,"snapToLines",n({},u,{get:function(){return v},set:function(e){v=!!e,this.hasBeenReset=!0}})),Object.defineProperty(s,"line",n({},u,{get:function(){return m},set:function(e){if("number"!=typeof e&&"auto"!==e)throw new SyntaxError("An invalid number or illegal string was specified.");m=e,this.hasBeenReset=!0}})),Object.defineProperty(s,"lineAlign",n({},u,{get:function(){return g},set:function(e){var t=i(e);if(!t)throw new SyntaxError("An invalid or illegal string was specified.");g=t,this.hasBeenReset=!0}})),Object.defineProperty(s,"position",n({},u,{get:function(){return y},set:function(e){if(e<0||e>100)throw new Error("Position must be between 0 and 100.");y=e,this.hasBeenReset=!0}})),Object.defineProperty(s,"positionAlign",n({},u,{get:function(){return E},set:function(e){var t=i(e);if(!t)throw new SyntaxError("An invalid or illegal string was specified.");E=t,this.hasBeenReset=!0}})),Object.defineProperty(s,"size",n({},u,{get:function(){return S},set:function(e){if(e<0||e>100)throw new Error("Size must be between 0 and 100.");S=e,this.hasBeenReset=!0}})),Object.defineProperty(s,"align",n({},u,{get:function(){return T},set:function(e){var t=i(e);if(!t)throw new SyntaxError("An invalid or illegal string was specified.");T=t,this.hasBeenReset=!0}})),s.displayState=void 0}return a.prototype.getCueAsHTML=function(){return self.WebVTT.convertCueToDOMTree(self,this.text)},a}(),Cr=function(){function e(){}return e.prototype.decode=function(e,t){if(!e)return"";if("string"!=typeof e)throw new Error("Error - expected string data.");return decodeURIComponent(encodeURIComponent(e))},e}(),xr=function(){function e(){this.values=Object.create(null)}var t=e.prototype;return t.set=function(e,t){this.get(e)||""===t||(this.values[e]=t)},t.get=function(e,t,r){return r?this.has(e)?this.values[e]:t[r]:this.has(e)?this.values[e]:t},t.has=function(e){return e in this.values},t.alt=function(e,t,r){for(var i=0;i<r.length;++i)if(t===r[i]){this.set(e,t);break}},t.integer=function(e,t){/^-?\d+$/.test(t)&&this.set(e,parseInt(t,10))},t.percent=function(e,t){if(/^([\d]{1,3})(\.[\d]*)?%$/.test(t)){var r=parseFloat(t);if(r>=0&&r<=100)return this.set(e,r),!0}return!1},e}();function Dr(e,t,r,i){var n=i?e.split(i):[e];for(var a in n)if("string"==typeof n[a]){var o=n[a].split(r);2===o.length&&t(o[0],o[1])}}var wr=new kr(0,0,""),Or="middle"===wr.align?"middle":"center";function Pr(e,t,r){var i=e;function n(){var t=function(e){function t(e,t,r,i){return 3600*(0|e)+60*(0|t)+(0|r)+parseFloat(i||0)}var r=e.match(/^(?:(\d+):)?(\d{2}):(\d{2})(\.\d+)?/);return r?parseFloat(r[2])>59?t(r[2],r[3],0,r[4]):t(r[1],r[2],r[3],r[4]):null}(e);if(null===t)throw new Error("Malformed timestamp: "+i);return e=e.replace(/^[^\sa-zA-Z-]+/,""),t}function a(){e=e.replace(/^\s+/,"")}if(a(),t.startTime=n(),a(),"--\x3e"!==e.substr(0,3))throw new Error("Malformed time stamp (time stamps must be separated by '--\x3e'): "+i);e=e.substr(3),a(),t.endTime=n(),a(),function(e,t){var i=new xr;Dr(e,(function(e,t){var n;switch(e){case"region":for(var a=r.length-1;a>=0;a--)if(r[a].id===t){i.set(e,r[a].region);break}break;case"vertical":i.alt(e,t,["rl","lr"]);break;case"line":n=t.split(","),i.integer(e,n[0]),i.percent(e,n[0])&&i.set("snapToLines",!1),i.alt(e,n[0],["auto"]),2===n.length&&i.alt("lineAlign",n[1],["start",Or,"end"]);break;case"position":n=t.split(","),i.percent(e,n[0]),2===n.length&&i.alt("positionAlign",n[1],["start",Or,"end","line-left","line-right","auto"]);break;case"size":i.percent(e,t);break;case"align":i.alt(e,t,["start",Or,"end","left","right"])}}),/:/,/\s/),t.region=i.get("region",null),t.vertical=i.get("vertical","");var n=i.get("line","auto");"auto"===n&&-1===wr.line&&(n=-1),t.line=n,t.lineAlign=i.get("lineAlign","start"),t.snapToLines=i.get("snapToLines",!0),t.size=i.get("size",100),t.align=i.get("align",Or);var a=i.get("position","auto");"auto"===a&&50===wr.position&&(a="start"===t.align||"left"===t.align?0:"end"===t.align||"right"===t.align?100:50),t.position=a}(e,t)}var Nr=function(){function e(){this.state="INITIAL",this.buffer="",this.decoder=new Cr,this.regionList=[],this.cue=null,this.style="",this.oncue=void 0,this.onstyle=void 0,this.onparsingerror=void 0,this.onflush=void 0}var t=e.prototype;return t.parse=function(e){var t=this;function r(){var e=t.buffer,r=0;for(e=e.replace(/<br(?: \/)?>/gi,"\n");r<e.length&&"\r"!==e[r]&&"\n"!==e[r];)++r;var i=e.substr(0,r);return"\r"===e[r]&&++r,"\n"===e[r]&&++r,t.buffer=e.substr(r),i}e&&(t.buffer+=t.decoder.decode(e,{stream:!0}));try{var i="";if("INITIAL"===t.state){if(!/\r\n|\n/.test(t.buffer))return this;var n=(i=r()).match(/^(ï»¿)?WEBVTT([ \t].*)?$/);if(!n||!n[0])throw new Error("Malformed WebVTT signature.");t.state="HEADER"}for(var a=!1;t.buffer;){if(!/\r\n|\n/.test(t.buffer))return this;switch(a?a=!1:i=r(),t.state){case"HEADER":/:/.test(i)?Dr(i,(function(e,t){}),/:/):i||(t.state="ID");continue;case"NOTE":i||(t.state="ID");continue;case"STYLE":i?t.style+=i:(t.style&&(t.onstyle&&t.onstyle(t.style),t.style=""),t.state="ID");continue;case"ID":if(/^NOTE($|[ \t])/.test(i)){t.state="NOTE";break}if(/^STYLE($|[ \t])/.test(i)){t.state="STYLE";break}if(!i)continue;if(t.cue=new kr(0,0,""),t.state="CUE",-1===i.indexOf("--\x3e")){t.cue.id=i;continue}case"CUE":if(!t.cue){t.state="BADCUE";continue}try{Pr(i,t.cue,t.regionList)}catch(s){t.cue=null,t.state="BADCUE";continue}t.state="CUETEXT";continue;case"CUETEXT":var o=-1!==i.indexOf("--\x3e");if(!i||o&&(a=!0)){t.oncue&&t.cue&&t.oncue(t.cue),t.cue=null,t.state="ID";continue}if(null===t.cue)continue;t.cue.text&&(t.cue.text+="\n"),t.cue.text+=i;continue;case"BADCUE":i||(t.state="ID")}}}catch(s){"CUETEXT"===t.state&&t.cue&&t.oncue&&t.oncue(t.cue),t.cue=null,t.state="INITIAL"===t.state?"BADWEBVTT":"BADCUE"}return this},t.flush=function(){var e=this;try{if((e.cue||"HEADER"===e.state)&&(e.buffer+="\n\n",e.parse()),"INITIAL"===e.state||"BADWEBVTT"===e.state)throw new Error("Malformed WebVTT signature.")}catch(t){e.onparsingerror&&e.onparsingerror(t)}return e.onflush&&e.onflush(),this},e}(),Mr=r("./src/utils/decode-utf8.ts");function Ur(e,t){return void 0===t&&(t=1),function(e,t,r,i){void 0===r&&(r=1),void 0===i&&(i=!1);var n=e*t*r;return i?Math.round(n):n}(e,9e4,1/t)}var Br=r("./src/remux/mp4-remuxer.ts"),Fr=/\r\n|\n\r|\n|\r/g,Vr=function(e,t,r){return void 0===r&&(r=0),e.substr(r,t.length)===t},Hr=function(e){for(var t=5381,r=e.length;r;)t=33*t^e.charCodeAt(--r);return(t>>>0).toString()};function jr(e,t,r,i,n,a,o,s){var u,d=new Nr,c=Object(Mr.decodeUTF8)(new Uint8Array(e)).trim().replace(Fr,"\n").split("\n"),l=[],f=Ur(t,r),_="",h="00:00.000",p=0,v=0,m=!0,g=!1;d.onstyle=function(e){_+=e},d.oncue=function(e){var t=i[n],r=i.ccOffset,o=(p-f)/9e4;if(null!=t&&t.new&&(void 0!==v?r=i.ccOffset=t.start:function(e,t,r){var i=e[t],n=e[i.prevCC];if(!n||!n.new&&i.new)return e.ccOffset=e.presentationOffset=i.start,void(i.new=!1);for(;null!=(a=n)&&a.new;){var a;e.ccOffset+=i.start-n.start,i.new=!1,n=e[(i=n).prevCC]}e.presentationOffset=r}(i,n,o)),o&&(r=o-i.presentationOffset),g){var s=e.endTime-e.startTime,u=Object(Br.PTSNormalize)(9e4*(e.startTime+r-v),9e4*a)/9e4;e.startTime=u,e.endTime=u+s}var d=e.text.trim();e.text=decodeURIComponent(encodeURIComponent(d)),e.id||(e.id=function(e,t,r){return Hr(e.toString())+Hr(t.toString())+Hr(r)}(e.startTime,e.endTime,d)),e.endTime>0&&l.push(e)},d.onparsingerror=function(e){u=e},d.onflush=function(){u?s(u):o(l,_)},c.forEach((function(e){if(m){if(Vr(e,"X-TIMESTAMP-MAP=")){m=!1,g=!0,e.substr(16).split(",").forEach((function(e){Vr(e,"LOCAL:")?h=e.substr(6):Vr(e,"MPEGTS:")&&(p=parseInt(e.substr(7)))}));try{v=function(e){var t=parseInt(e.substr(-3)),r=parseInt(e.substr(-6,2)),i=parseInt(e.substr(-9,2)),n=e.length>9?parseInt(e.substr(0,e.indexOf(":"))):0;if(!(j(t)&&j(r)&&j(i)&&j(n)))throw Error("Malformed X-TIMESTAMP-MAP: Local:"+e);return t+=1e3*r,(t+=6e4*i)+36e5*n}(h)/1e3}catch(t){g=!1,u=t}return}""===e&&(m=!1)}d.parse(e+"\n")})),d.flush()}var Gr="subtitle",Kr=function(e){var t,r;function i(t){var r;return(r=e.call(this)||this)._media=void 0,r._current=-1,r._list=[],r._listPos=0,r._vttCCs=void 0,r._styleNode=void 0,r._onTextTrackChange=function(){var e=r._list.reduce((function(e,t,r){return"showing"===t.track.mode?r:e}),-1);e!==r._current&&(r._current=e,c.Log.i(Gr,"subtitle switching"),r.emit(k.default.SUBTITLE_TRACK_SWITCHED,{level:e}))},r._media=t,r._vttCCs={ccOffset:0,presentationOffset:0,0:{start:0,prevCC:-1,new:!1}},r._media.video&&r._media.video.textTracks.addEventListener("change",r._onTextTrackChange),r}r=e,(t=i).prototype=Object.create(r.prototype),t.prototype.constructor=t,t.__proto__=r;var n=i.prototype;return n.addTracks=function(e){var t=this;e.forEach((function(e,r){var i=t._getTextTrack();i&&t._media.video&&(e.default?(t._current=r,i.mode="showing"):i.mode="hidden")}))},n.select=function(e){if(this._removeStyle(),e!==this._current){var t=this._list[e],r=this._list[this._current];r&&(r.track.mode="hidden"),t?(this._applyStyle(t.style),t.track.mode="showing",this._current=e):this._current=-1,this.emit(k.default.SUBTITLE_TRACK_SWITCHED,{level:this._current})}},n.reset=function(){c.Log.i(Gr,"reset"),this._list.forEach((function(e){!function(e){var t=e.mode;if("disabled"===t&&(e.mode="hidden"),e.cues){for(var r=e.cues.length;r--;)e.removeCue(e.cues[r]);"disabled"===t&&(e.mode=t)}}(e.track),e.track.mode="hidden"})),this._listPos=0,this._current=-1,this._vttCCs={ccOffset:0,presentationOffset:0,0:{start:0,prevCC:-1,new:!1}},this._removeStyle()},n.parseVTTs=function(e,t,r){var i=this,n=this._list[this._current];n&&jr(e,r,t,this._vttCCs,r,t,(function(e,t){e.forEach((function(e){!function(e,t){var r=e.mode;if("disabled"===r&&(e.mode="hidden"),e.cues&&!e.cues.getCueById(t.id))try{if(e.addCue(t),!e.cues.getCueById(t.id))throw new Error("addCue is failed for: "+t)}catch(n){c.Log.d("[texttrack-utils]: "+n);var i=new self.TextTrackCue(t.startTime,t.endTime,t.text);i.id=t.id,e.addCue(i)}"disabled"===r&&(e.mode=r)}(n.track,e)})),t&&(n.style+=t,i._applyStyle(n.style))}),(function(e){}))},n.destroy=function(){this._media.video&&this._media.video.textTracks.removeEventListener("change",this._onTextTrackChange),this.reset(),this._list=[],this.removeAllListeners()},n._getTextTrack=function(){var e;if(this._listPos<this._list.length)e=this._list[this._listPos].track,this._listPos++;else{var t=this._media.video;t&&(e=t.addTextTrack("subtitles"),this._list.push({track:e,style:""}),this._listPos++)}return e},n._applyStyle=function(e){e&&(this._styleNode||(this._styleNode=document.createElement("style"),document.head.appendChild(this._styleNode)),this._styleNode.innerHTML=e)},n._removeStyle=function(){this._styleNode&&(this._styleNode.innerHTML="",document.head.removeChild(this._styleNode),this._styleNode=void 0)},i}(a.EventEmitter);function Wr(e,t){return e.reduce((function(r,i,n){return(e[r].bitrate+i.bitrate)/2>=t?r:n}),0)}var qr=function(){function e(e){this._media=void 0,this._lastPlayTime=void 0,this._lastCheckTime=0,this._waiting=!1,this._start=!1,this._media=e}var t=e.prototype;return t.check=function(){var e=this._media,t=performance.now();if(!e.paused&&!e.seeking&&!e.ended&&t-this._lastCheckTime>=100){if(this._lastCheckTime=t,!this._start)return"number"==typeof this._lastPlayTime&&Math.abs(e.currentTime-this._lastPlayTime)>.017&&(this._start=!0),void(this._lastPlayTime=e.currentTime);e.currentTime===this._lastPlayTime?this._waiting||(this._waiting=!0,this._customEvent(e,"waiting")):this._waiting&&(this._waiting=!1,this._customEvent(e,"playing")),this._lastPlayTime=e.currentTime}},t.reset=function(){this._lastPlayTime=void 0,this._start=!1,this._waiting=!1},t._customEvent=function(e,t){if(e&&e.dispatchEvent){var r=document.createEvent("CustomEvent");r.initCustomEvent(t,!0,!0,{}),e.dispatchEvent(r)}},e}();function zr(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,i)}return r}function Yr(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?zr(Object(r),!0).forEach((function(t){Xr(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):zr(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}function Xr(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function Qr(){return(Qr=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var i in r)Object.prototype.hasOwnProperty.call(r,i)&&(e[i]=r[i])}return e}).apply(this,arguments)}var Jr="kernel-base-mse",$r=function(e){var t,r;function i(t,r,i){var n;return(n=e.call(this,t.video,r)||this)._mse=void 0,n._trans=void 0,n._media=void 0,n._config=void 0,n._seekOnCanplay=!1,n._internalSeekFlag=!1,n._waitingHelper=void 0,n._audioCodecSwap=!1,n._audioCodec="",n._mainTimer=void 0,n._skipSeekEvent=!1,n._subtitle=void 0,n._nextLevelMinBuffer=1,n._loadStopped=!1,n._seekRollbackTime=0,n._recoverMediaErrorTime=0,n._eme=void 0,n._config=i,n._media=t,n._eme=new br(n._media,n._config),n._eme.on(k.default.ERROR,(function(e){n._onError(e)})),t instanceof HTMLVideoElement&&d.default.x5&&d.default.android&&(n._waitingHelper=new qr(n._video),n._monitor.waitTrigger=u.WaitingTrigger.CUSTOM),n._config.initMseOnDemand||n._initMSE(),n}r=e,(t=i).prototype=Object.create(r.prototype),t.prototype.constructor=t,t.__proto__=r;var n=i.prototype;return n.load=function(e,t){void 0===e&&(e=void 0),e&&(this._config.src=e),this._startHeartbeat(),t&&"number"==typeof t.bitrateStart&&(this._config.bitrateStart=t.bitrateStart)},n.stopLoad=function(){c.Log.i(Jr,"call kernel stopLoad"),this._trans&&(this._onLoadEnd(!0),this._destroyTrans(),this._stopHeartbeat(),this._loadStopped=!0,this.emit(k.default.STOP_LOAD))},n.destroy=function(){this._stopMainTimer(),this._stopVideo(),this._subtitle&&this._subtitle.destroy(),this._eme.destory(),e.prototype.destroy.call(this)},n.resume=function(){c.Log.i(Jr,"call resume"),this._loadStopped&&(this._loadStopped=!1,this._load(!0)),this._video.paused&&this._video.play()},n.refresh=function(){(this._config.autoRecoverMedia||this._error!==I.ErrorDetails.VIDEO_ERROR||!this._recoverSwapRemuxType()&&!this._recoverSwapAudioCodec())&&this._reload(),this._error=void 0},n.isTimeinBuffered=function(e){return this._media.isTimeinBuffered(e)},n.setAvailableAbrLevels=function(e){this._trans&&e&&e.length&&this._trans.setAvailableAbrLevels(e)},n.getLevels=function(){return this._trans?this._trans.levels:[]},n.getStartLevel=function(){return void 0===this._startLevel?this._config.adaptive?-1:0:this._startLevel},n.setStartLevel=function(e){this._startLevel=e},n.getCurrentLevel=function(){return this._trans?this._trans.currentLevel:0},n.setCurrentLevel=function(e){c.Log.i(Jr,"set currentLevel",e),!this._verifyLevel(e)||e===this.getCurrentLevel()&&!this.getAutoLevelEnabled()||this._error?this.emit(k.default.LEVEL_SWITCH_FAILED):e<0?this.setNextLevel(-1):(this._stat!==dr.INIT&&this._stat!==dr.LOADING&&(this._monitor.selectBitrate(),this._stat=dr.SELECT_BITRATE,this._seekOnCanplay=!0),this._mse&&(this._mse.flush(),this._checkStreamingMux()),this._trans&&(this._trans.currentLevel=e))},n.getNextLevel=function(){return this._trans?this._trans.nextLevel:0},n.setNextLevel=function(e){c.Log.i(Jr,"set nextLevel",e),this._verifyLevel(e)&&!this._error?this._media.bufferedSec()<this._nextLevelMinBuffer&&e>=0?this.setCurrentLevel(e):this._trans&&(this._trans.nextLevel=e):this.emit(k.default.LEVEL_SWITCH_FAILED)},n.getAutoLevelEnabled=function(){return this._trans?this._trans.autoLevelEnabled:this._config.adaptive},n.getAudioTracks=function(){return this._trans?this._trans.audioTracks:[]},n.setAudioTrack=function(e){this._trans&&e!==this._trans.audioTrack&&this._trans.audioTracks.length>1&&(this._trans.audioTrack=e,this._stat!==dr.INIT&&this._stat!==dr.LOADING&&(this._stat=dr.SELECT_BITRATE,this._seekOnCanplay=!0),this._mse&&(this._mse.flush(),this._checkStreamingMux()))},n.getAudioTrack=function(){var e;return(null==(e=this._trans)?void 0:e.audioTrack)||0},n.getSubtitleTracks=function(){return this._trans?this._trans.subtitleTracks:[]},n.setSubtitleTrack=function(e){this._trans&&e!==this._trans.subtitleTrack&&this._trans.subtitleTracks.length>=1&&this._subtitle&&this._subtitle.select(e)},n.getSubtitleTrack=function(){var e;return(null==(e=this._trans)?void 0:e.subtitleTrack)||0},n._onVideoPlay=function(){this._error||this._trans||this.load(),e.prototype._onVideoPlay.call(this)},n._onVideoEnded=function(){this._seekRollbackTime=0,this._internalSeekFlag=!1,this._skipSeekEvent=!1,e.prototype._onVideoEnded.call(this)},n._checkStreamingMux=function(e){void 0===e&&(e=0),this._config.streamingMux&&this._trans&&(e>11?this._trans.streamingMux(!1):this._trans.streamingMux(!0))},n._initMSE=function(){var e=this;(this._mse&&(this._mse.hasTrackInfo()||this._video.error)||this._eme.isActive)&&(c.Log.i(Jr,"rebuild mse"),URL.revokeObjectURL(this._video.src),this._destroyMSE(),this._eme.isActive&&(this._video.src="",this._eme.reset())),this._mse?this._mse.flush():(this._mse=new Rr(this._config),this._mse.attach(this._video),this._media.attachMSE(this._mse)),this._mse.on(k.default.ERROR,(function(t){e._onError(t)})),this._mse.on(k.default.MSE_BUFFER_FULL,this._onMSEBufferFull.bind(this)),this._mse.on(k.default.MSE_UPDATE,(function(){e.emit(k.default.MSE_UPDATE),e._stat!==dr.NONE&&e._media.isTimeinBuffered(e._video.currentTime)&&e._video.readyState>=3?(e._onVideoCanplay(),c.Log.v(Jr,"canplay polyfill")):e._seekOnCanplay&&e._detectSeekOnCanplay()})),this._mse.on(k.default.MSE_REMOVE,(function(){e.emit(k.default.MSE_REMOVE)})),this._mse.on(k.default.MSE_OPEN,(function(){e.emit(k.default.MSE_OPEN)}))},n._verifyLevel=function(e){return!(!(this._trans&&this._trans.levels.length>0&&e<this._trans.levels.length&&this._mse&&this._video)||this._video.ended)},n._onMSEBufferFull=function(){this.emit(k.default.MSE_BUFFER_FULL)},n._detectSeekOnCanplay=function(){if(this._seekOnCanplay&&this._mse&&!this._mse.hasCleanUpTask()){var e=.001;this._media.isTimeinBuffered(this._video.currentTime+e)&&(c.Log.i(Jr,"seek on canplay "+this._video.currentTime+" + "+e),this._seekOnCanplay=!1,this._internalSeek(this._video.currentTime+e))}},n._internalSeek=function(e){this._internalSeekFlag=!0;try{this._video.currentTime=e}catch(t){}},n._initTrans=function(){this._config.webWorker&&H.prepareWorker(),this._trans=new or(this._config,this._media),this._trans&&(this._transmuxerEvent(this._trans),this._trans.init()),this._waitingHelper&&this._waitingHelper.reset()},n._transmuxerEvent=function(e){var t=this,r=this._mse;e.on(k.default.PARSING_DATA,this._onParsingData.bind(this)),e.on(k.default.PARSING_INIT_SEGMENT,(function(e){if(t._nextLevel.length){var i=t._nextLevel[t._nextLevel.length-1];i.init=!0,t.emit(k.default.LEVEL_SWITCHED,{bitrate:i.bitrate,level:i.level,smooth:i.smooth,auto:i.auto,id:i.id})}if(t._nextAudio){var n=t._nextAudio;t.emit(k.default.AUDIO_TRACK_SWITCHED,{level:n.level,smooth:n.smooth,auto:n.auto,id:n.id})}var a=e.tracks.video,o=e.tracks.audio,s={segments:[],hasVideo:!!a,hasAudio:!!o};for(var u in e.tracks){var d=e.tracks[u];if(Qr(s,d.metadata),d.initSegment){var c={payload:d.initSegment,startPTS:0,endPTS:0,startDTS:0,endDTS:0,type:u,streamDTS:0,framesInfo:[]};s.segments.push(c)}}s.videoCodec=a?a.codec:null,s.audioCodec=o?o.codec:null,t._audioCodec=e.manifestAudioCodec||s.audioCodec;var l=Qr({},s);l.colorSpace=Object(Ir.getColorStr)(l.colorInfo),delete l.segments,delete l.colorInfo,t.emit(k.default.PARSING_INIT_SEGMENT,l),t._mediaInfo=l,r&&r.trackInfo(s),t._startMainTimer()})),e.on(k.default.ERROR,(function(e){t._onError(e)})),e.on(k.default.LOAD_END,this._onLoadEnd.bind(this)),e.on(k.default.SUBTITLE_LOADED,(function(e){t._subtitle&&t._subtitle.parseVTTs(e.data,e.start,e.cc)})),e.on(k.default.LEVEL_SWITCH_FAILED,(function(e){e&&e.smooth?t.setCurrentLevel(e.level):t.emit(k.default.LEVEL_SWITCH_FAILED)})),e.on(k.default.LEVEL_SWITCHING,(function(r){if(r.type!==u.LevelType.SUBTITLE){if(r.id=t._levelSwitchId,t._levelSwitchId++,r.auto=e.autoLevelEnabled,!r.smooth&&t._mse&&(t._mse.flush(),t._checkStreamingMux()),r.type===u.LevelType.AUDIO)return t.emit(k.default.AUDIO_TRACK_SWITCHING,{track:r.level,smooth:r.smooth,auto:r.auto,id:r.id}),void(t._nextAudio=r);r.bitrate=r.level<0?-1:e.levels[r.level].bitrate,t.emit(k.default.LEVEL_SWITCHING,{bitrate:r.bitrate,level:r.level,smooth:r.smooth,auto:r.auto,id:r.id}),-1===r.level?t.emit(k.default.LEVEL_SWITCHED,{bitrate:r.bitrate,level:r.level,smooth:r.smooth,auto:r.auto,id:r.id}):(r.smooth?t._nextLevel=t._nextLevel.sort((function(e,t){return e.startSec-t.startSec})).filter((function(e){return e.startSec<r.startSec-.5})):t._nextLevel=[],t._nextLevel.push(r))}})),e.on(k.default.BUFFER_FLUSHING,(function(e){t._mse&&t._mse.flush(e.startSec,t._video.duration)})),e.on(k.default.METADATA,(function(r){"number"==typeof r.duration&&t._mse&&(delete r.keyframes,e.isMultipart||t._mse.updateDuration(r.duration)),t.emit(k.default.METADATA,r)})),e.on(k.default.MANIFEST_PARSED,(function(r){if(c.Log.i(Jr,"manifest parsed"),"number"!=typeof t._playingLevel){var i,n=void 0,a=t._config.bitrateStart;"number"==typeof a&&a>=0&&(i=Wr(e.levels,a),n=a>=0?i:-1),"number"==typeof t._startLevel&&(n=t._startLevel),"number"==typeof n&&(-1===n&&e.autoLevelEnabled||(e.currentLevel=n)),t._playingLevel=e.currentLevel,e.subtitleTracks.length&&t._initSubtitle(),t._config.emeEnabled&&r.drm&&t._eme.onManifestParsed(t.getLevels()),c.Log.i(Jr,k.default.MANIFEST_PARSED,r),t.emit(k.default.MANIFEST_PARSED,Yr(Yr({},r),{},{currentLevel:e.currentLevel,protocol:e.protocol,auto:e.autoLevelEnabled}))}else e.currentLevel=t._playingLevel})),e.on(k.default.LEVEL_UPDATED,(function(e){!t._config.isLive&&e.duration&&t._mse&&t._mse.updateDuration(e.duration),c.Log.i(Jr,k.default.LEVEL_UPDATED,e),e.type===u.LevelType.AUDIO?t.emit(k.default.AUDIO_TRACK_UPDATED,e):e.type===u.LevelType.MAIN&&t.emit(k.default.LEVEL_UPDATED,e)})),e.on(k.default.SEEK_KEYFRAME,(function(e){t._skipSeekEvent=!0;try{t._internalSeek(e.keyFrameSec)}catch(r){}})),e.on(k.default.PRIV_NAL,(function(e){t.emit(k.default.PRIV_NAL,e)})),e.on(k.default.LOADER_CHUNK_ARRIVAL,(function(e){t.emit(k.default.LOADER_CHUNK_ARRIVAL,e)})),e.on(k.default.MEDIA_DEMUX,(function(e){t.emit(k.default.MEDIA_DEMUX,e)})),e.on(k.default.KEY_FRAME,(function(e){t.emit(k.default.KEY_FRAME,e)})),e.on(k.default.MUX_INFO,(function(e){t.emit(k.default.MUX_INFO,e)})),e.on(k.default.LOST_FRAMES,(function(e){t.emit(k.default.LOST_FRAMES,e)})),e.on(k.default.USE_BACKUP,(function(e){t.emit(k.default.USE_BACKUP,e)})),e.on(k.default.ABR_INFO,(function(e){t.emit(k.default.ABR_INFO,e)})),e.on(k.default.NEW_SOURCE,(function(e){t.emit(k.default.NEW_SOURCE,e)})),e.on(k.default.DISCONTINUITY,(function(e){t.emit(k.default.DISCONTINUITY,e)})),e.on(k.default.DOWNLOAD,(function(e){t.emit(k.default.DOWNLOAD,e)}))},n._destroyTrans=function(){this._trans&&(this._trans.destroy(),this._trans.removeAllListeners(),this._trans=void 0)},n._destroyMSE=function(){this._mse&&(this._mse.removeAllListeners(),this._mse.destroy(),this._mse=void 0)},n._reload=function(){c.Log.i(Jr,"reload"),this._config.startFromSec=this._video.currentTime,this._trans&&(this._startLevel=this._trans.currentLevel),this._nextLevel=[],this._internalSeekFlag=!1,this._stopVideo(),this._initMSE(),this._destroyTrans(),this._initTrans(),this._trans&&this._trans.loadSource(),this._startHeartbeat(),this._video.play()},n._startMainTimer=function(){this._mainTimer||(this._mainTimer=setInterval(this._mainLoop.bind(this),200))},n._stopMainTimer=function(){this._mainTimer&&(clearInterval(this._mainTimer),this._mainTimer=void 0)},n._stopVideo=function(){this._video&&(URL.revokeObjectURL(this._video.src),this._video.hasOwnProperty("src")&&(this._video.src=""),this._video.removeAttribute("src"),this._destroyTrans(),this._destroyMSE())},n._mainLoop=function(){var e=this._video;if(this._waitingHelper&&this._monitor.firstFrameLoaded&&this._waitingHelper.check(),(this._stat===dr.WAITING&&!e.seeking||this._stat===dr.LOADING||this._stat===dr.INIT||this._stat===dr.SEEK||this._stat===dr.SELECT_BITRATE)&&this._mse&&!this._mse.hasCleanUpTask()&&!e.ended&&this._mse.hasSourceBufferAppendStarted()){var t=e.currentTime,r=this._media.currentBuffer(t),i=void 0;if(!r||r.end-t<1){var n=this._media.nextBuffer(t);n&&(c.Log.i(Jr,"try fix block-A"),i=n.start)}else this._video.buffered.length>1&&r.end-t>1&&(c.Log.i(Jr,"try fix block-B"),i=r.start);i&&(i+=d.default.safari?.3:.001,this._internalSeek(i),c.Log.i(Jr,"jump to "+i))}this._nextLevel.length&&this._checkLevelChange()},n._checkLevelChange=function(){var e=this._nextLevel[0];e&&this._video.currentTime>=e.startSec&&this._media.isTimeinBuffered(this._video.currentTime)&&(e.init||this.emit(k.default.LEVEL_SWITCHED,{bitrate:e.bitrate,level:e.level,smooth:e.smooth,auto:e.auto,id:e.id}),this.emit(k.default.LEVEL_SWITCH_PLAYING,{bitrate:e.bitrate,level:e.level,smooth:e.smooth,auto:e.auto,id:e.id}),this._playingLevel=e.level,this._nextLevel.shift())},n._load=function(e){void 0===e&&(e=!1),c.Log.i(Jr,"_load start sec:",this._config.startFromSec),this._mediaInfo=void 0,this._loadStopped=!1,this._error=void 0,this._internalSeekFlag=!1,this._stat=dr.LOADING,this._nextLevel=[],this._stopMainTimer(),this.emit(k.default.LOAD,this._config.src,e),this._subtitle&&this._subtitle.reset(),this._trans&&this._destroyTrans(),this._initMSE(),this._config.startPlayBufferSec&&!e&&this._mse&&this._mse.setStartBufSec(this._config.startPlayBufferSec),this._startHeartbeat(),this._initTrans(),this._trans&&this._trans.loadSource()},n._onParsingData=function(e){this._media.mse&&this._media.mse.mediaSegment(e.segments),this.emit(k.default.PARSING_DATA,e)},n._onLoadEnd=function(e){void 0===e&&(e=!1),this._mse&&this._mse.endOfData(),this.emit(k.default.LOAD_END,{internal:e})},n._onVideoCanplay=function(){e.prototype._onVideoCanplay.call(this),this._stat!==dr.NONE&&(this._stat=dr.NONE,this._trans&&this._trans.emit("mainNotify",{type:"canplay"}),this._detectSeekOnCanplay(),this._checkLevelChange(),this._video.paused||this._onVideoPlaying(),this._config.webWorker&&H.prepareWorker())},n._onVideoSeeked=function(){this._mediaInfo&&e.prototype._onVideoSeeked.call(this)},n._onVideoTimeupdate=function(){this._video.seeking||(this._seekRollbackTime=this._video.currentTime),e.prototype._onVideoTimeupdate.call(this)},n._onVideoWaiting=function(){this._stat=this._stat||dr.WAITING;var e=this._media.bufferedSec(),t=!this._video.seeking&&this._stat===dr.WAITING;t&&this._trans&&this._trans.emit("mainNotify",{type:"waiting"}),this.emit(k.default.WAITING,t,e)},n._onVideoError=function(e){if(c.Log.e(Jr,"video error",e),!this._error&&this._mediaInfo){if(this._config.autoRecoverMedia){var t=performance.now();if((!this._recoverMediaErrorTime||t-this._recoverMediaErrorTime>3e3)&&this._recoverSwapRemuxType())return void(this._recoverMediaErrorTime=t);if(this._recoverSwapAudioCodec())return}var r="video error";this._video&&this._video.error&&(r+=" code:"+this._video.error.code+" message:"+this._video.error.message),this._onError({type:I.ErrorTypes.MEDIA_ERROR,details:I.ErrorDetails.VIDEO_ERROR,fatal:!0,reason:r})}},n._onVideoRatechange=function(){this._trans&&this._trans.emit("mainNotify",{type:"ratechange",playbackRate:this._video.playbackRate}),e.prototype._onVideoRatechange.call(this)},n._heartbeat=function(){e.prototype._heartbeat.call(this),this._trans&&this._trans.heartbeat()},n._onError=function(t){t.fatal&&((t.details===I.ErrorDetails.VIDEO_ERROR||this._video.error)&&this._destroyMSE(),this._stopMainTimer()),e.prototype._onError.call(this,t)},n._recoverSwapRemuxType=function(){var e,t=this._config.gopRemux,r=this._config.streamingMux;return this._config.box===u.MediaBox.flv&&this._config.isLive?this._config.gopRemux=!0:this._config.streamingMux=!1,(t!==this._config.gopRemux||r!==this._config.streamingMux)&&(c.Log.i(Jr,"recover swap remux type"),this.emit(k.default.RETRY,{type:u.RetryType.CODEC,message:"change remux type. video error: "+(null==(e=this._video.error)?void 0:e.code)}),this._reload(),!0)},n._recoverSwapAudioCodec=function(){var e;return!(this._audioCodecSwap||!this._audioCodec||(-1!==this._audioCodec.indexOf("mp4a.40.5")?this._audioCodec="mp4a.40.2":this._audioCodec="mp4a.40.5",this._config.audioCodec=this._audioCodec,this._audioCodecSwap=!0,this.emit(k.default.RETRY,{type:u.RetryType.CODEC,message:"change audio codec: "+this._audioCodec+". video error: "+(null==(e=this._video.error)?void 0:e.code)}),c.Log.i(Jr,"recover swap audio codec"),this._reload(),0))},n._initSubtitle=function(){var e=this;this._trans&&(this._subtitle||(this._subtitle=new Kr(this._media),this._subtitle.on(k.default.SUBTITLE_TRACK_SWITCHED,(function(t){e._trans&&(e._trans.subtitleTrack=t.level,e.emit(k.default.SUBTITLE_TRACK_SWITCHED,t))}))),this._subtitle.addTracks(this._trans.subtitleTracks))},i}(yr),Zr="kernel-mse-live",ei=function(e){var t,r;function i(t,r,i){var n;return(n=e.call(this,t,r,i)||this)._flvLiveRetry=0,n._flvLiveRetryTimer=void 0,n._liveEnd=!1,n._playbackRateManager=void 0,n._catchUpLive=!0,n._preloader=void 0,n._config.autoPlaybackRateConf&&(n._playbackRateManager=new fr(n._media,n._config.autoPlaybackRateConf)),n._catchUpLive=!!n._config.catchUpPausedLive,n}r=e,(t=i).prototype=Object.create(r.prototype),t.prototype.constructor=t,t.__proto__=r;var n=i.prototype;return n.load=function(t,r){void 0===t&&(t=void 0),e.prototype.load.call(this,t,r),c.Log.i(Zr,"load");var i=!!this._trans;this._stat!==dr.INIT&&this._monitor.reset(i),this._playingLevel=void 0,this._checkPreload(t)||(c.Log.i(Zr,"preload miss"),this._load()),this._preloader&&this._preloader.destroy()},n.refresh=function(){this._liveEnd||(e.prototype.refresh.call(this),this._flvLiveRetry=0)},n.liveEnd=function(){c.Log.i(Zr,"liveEnd",this._config.isLive),this._config.isLive&&(this._liveEnd=!0,this._stopFlvLiveRetryTimer())},n.preload=function(e,t){var r;this._config.box===u.MediaBox.flv&&this._config.isLive&&(c.Log.i(Zr,"preload",t),this._preloader||(this._preloader=new lr),this._preloader.start(e,this._media,this._config,"number"==typeof t?t:null==(r=this._trans)?void 0:r.currentLevel),this._monitor.onPreload())},n.destroy=function(){this._stopFlvLiveRetryTimer(),this._preloader&&this._preloader.destroy(),e.prototype.destroy.call(this)},n.resume=function(){this._liveEnd||e.prototype.resume.call(this)},n.stopLoad=function(){e.prototype.stopLoad.call(this),this._stopFlvLiveRetryTimer(),this._preloader&&this._preloader.destroy(),this._playbackRateManager&&this._playbackRateManager.stop()},n._mainLoop=function(){this._playbackRateManager&&this._playbackRateManager.tick(),e.prototype._mainLoop.call(this)},n._onVideoPause=function(){e.prototype._onVideoPause.call(this),this._config.catchUpPausedLive&&(this._catchUpLive=!0)},n._onVideoPlaying=function(){!this._error&&this._config.isLive&&this._media.bufferedSec()>-this._config.defaultSpts/1e3+1&&this._catchUpLive&&(this._seekToLivePos(),this._catchUpLive=!1),e.prototype._onVideoPlaying.call(this)},n._onMSEBufferFull=function(){e.prototype._onMSEBufferFull.call(this),this._config.isLive&&this._video.paused&&(this.stopLoad(),this._initMSE())},n._seekToLivePos=function(){if(this._config.defaultSpts<0){var e=this._media.bufferedEnd()+this._config.defaultSpts/1e3;if(this._media.isTimeinBuffered(e))return this._internalSeek(e),!0}return!1},n._load=function(t){void 0===t&&(t=!1),e.prototype._load.call(this,t),this._liveEnd=!1,this._config.autoPlaybackRate&&this._playbackRateManager&&this._playbackRateManager.start()},n._onLoadEnd=function(t){void 0===t&&(t=!1),this._config.flvLoadEndError&&!this._liveEnd&&this._config.isLive&&this._config.box===u.MediaBox.flv&&!t?this._onError({type:I.ErrorTypes.NETWORK_ERROR,details:I.ErrorDetails.LIVE_DISCONNECTED_ERROR,fatal:!0,reason:"live disconnected"}):e.prototype._onLoadEnd.call(this,t)},n._onVideoWaiting=function(){this._liveEnd&&this._config.box===u.MediaBox.flv&&this._config.isLive?this.stopLoad():e.prototype._onVideoWaiting.call(this)},n._onError=function(t){t.type===I.ErrorTypes.NETWORK_ERROR&&this._config.isLive&&this._config.box===u.MediaBox.flv&&this._flvLiveRetry<this._config.maxRetry?this._startFlvLiveRetryTimer(Math.max(this._config.retryDelay,1e3*this._media.bufferedSec()),t):e.prototype._onError.call(this,t)},n._initTrans=function(){this._stopFlvLiveRetryTimer(),e.prototype._initTrans.call(this)},n._startFlvLiveRetryTimer=function(e,t){var r=this;this._flvLiveRetryTimer||(this._flvLiveRetryTimer=setTimeout((function(e){c.Log.i(Zr,"live retry:"+r._flvLiveRetry),r._flvLiveRetry++,r.emit(k.default.RETRY,{type:u.RetryType.LIVE,message:"reason: "+(null==e?void 0:e.reason)+". retry: "+r._flvLiveRetry}),r._reload()}),e,t))},n._stopFlvLiveRetryTimer=function(){this._flvLiveRetryTimer&&(clearTimeout(this._flvLiveRetryTimer),this._flvLiveRetryTimer=void 0)},n._checkPreload=function(e){if(this._preloader&&this._preloader.check(e)&&this._preloader.trans){var t=this.getAutoLevelEnabled();return this._mediaInfo=void 0,this._loadStopped=!1,this._error=void 0,this._internalSeekFlag=!1,this._nextLevel=[],this._stopMainTimer(),this._stat=dr.LOADING,this._destroyTrans(),this._initMSE(),this._trans=this._preloader.trans,this.emit(k.default.PRELOAD_HIT,this._trans.getCurrentUrl()),this._trans.removeAllListeners(),this._transmuxerEvent(this._trans),this._preloader.use(),this._trans.usePreload(t),this._startHeartbeat(),c.Log.i(Zr,"preload hit"),!0}return!1},i}($r);function ti(e,t){for(var r=0;r<t.length;r++){var i=t[r];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}var ri=function(e){var t,r;function i(t){var r;return(r=e.call(this)||this)._data=void 0,r._trans=void 0,r._eQueue=[],r._events=void 0,r._backupConf={retryWithBackup:!0},r._onEvents=function(e){return function(t){r._eQueue.push({type:e,data:t})}},r._onError=function(){r.destroy(),r.emit(k.default.PRELOAD_COMPLETE,!1),r.removeAllListeners()},r._data=t,r._events=[k.default.PARSING_DATA,k.default.PARSING_INIT_SEGMENT,k.default.LOAD_END,k.default.LEVEL_SWITCH_FAILED,k.default.LEVEL_SWITCHING,k.default.BUFFER_FLUSHING,k.default.METADATA,k.default.FLV_HEAD,k.default.MP4_NOT_FASTSTART,k.default.MANIFEST_PARSED,k.default.LEVEL_UPDATED,k.default.SEEK_KEYFRAME,k.default.PRIV_NAL,k.default.LOADER_CHUNK_ARRIVAL,k.default.MEDIA_DEMUX,k.default.KEY_FRAME,k.default.MUX_INFO,k.default.LOST_FRAMES,k.default.USE_BACKUP,k.default.ABR_INFO,k.default.NEW_SOURCE,k.default.DISCONTINUITY],r}r=e,(t=i).prototype=Object.create(r.prototype),t.prototype.constructor=t,t.__proto__=r;var n,a,o,s=i.prototype;return s.start=function(e,t){if(!this._trans){var r=this._data.config;this._data.auto=e,this._data.level=t,this._backupConf.retryWithBackup=r.retryWithBackup,r.retryWithBackup=!1,this._trans=new or(r,new x,!0),this._trans&&(this._trans.init(),this._trans.streamingMux(!1),this._bind(this._trans),this._trans.loadSource())}},s.destroy=function(){this._trans&&(this._trans.removeAllListeners(),this._trans.destroy(),this._trans=void 0),this._eQueue=[],this.removeAllListeners()},s.use=function(){var e=this;this._eQueue.forEach((function(t){e._trans&&e._trans.emit(t.type,t.data)})),this._trans=void 0},s._bind=function(e){var t=this;this._events.forEach((function(r){e.on(r,t._onEvents(r))})),e.on(k.default.PRELOAD_COMPLETE,(function(){t._data.config.retryWithBackup=t._backupConf.retryWithBackup,e.removeAllListeners(),t.emit(k.default.PRELOAD_COMPLETE,!0),t.removeAllListeners()})),e.on(k.default.DOWNLOAD,(function(e){t.emit(k.default.DOWNLOAD,e)})),e.on(k.default.ERROR,this._onError)},n=i,(a=[{key:"trans",get:function(){return this._trans}}])&&ti(n.prototype,a),o&&ti(n,o),i}(a.EventEmitter);function ii(e){var t=new Ct.a(e,!1);return""+t.origin+t.pathname}function ni(e){if(e){if(Ye.verify(e))return ii(e.adaptationSet.representation[0].url);if(Ze.verify(e))return ii(e.adaptationSet[0].representation[0].url);if("string"==typeof e)return ii(e)}return""}function ai(){return(ai=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var i in r)Object.prototype.hasOwnProperty.call(r,i)&&(e[i]=r[i])}return e}).apply(this,arguments)}var oi="preload-m",si=function(e){var t,r;function i(t){var r;return(r=e.call(this)||this)._waiting=[],r._running=void 0,r._cache=[],r._active=!1,r._updateTimer=void 0,r._timeout=void 0,r._statCallback=void 0,r._onPreloadComplete=function(e){r._stopTimeout(),r._running&&(e?(c.Log.i(oi,"preload task done",r._waiting.length),r._cache.push(r._running),r._cache.length>50&&r._cache.shift(),r.emit(k.default.PRELOAD_COMPLETE)):r._running.app&&r._running.app.destroy()),r._running=void 0,r._delayUpdate()},r._onPreloadDownload=function(e){r.emit(k.default.DOWNLOAD,e)},r._statCallback=t,r}r=e,(t=i).prototype=Object.create(r.prototype),t.prototype.constructor=t,t.__proto__=r;var n=i.prototype;return n.check=function(e){var t=this._statCallback();if(t)for(var r=ni(e),i=0;i<this._cache.length;i++)if(this._cache[i].data.id===r){if(!(performance.now()-this._cache[i].ts<72e5))return void this._cache.splice(i,1);var n=this._cache.splice(i,1)[0];if(n.data.auto&&t.abr||!n.data.auto&&!t.abr&&n.data.level===t.level)return n}},n.add=function(e,t){if(c.Log.i(oi,"add preload task"),e=ai({},e),v.setSrc(e,t),e.src){var r=ni(e.src);if(!r)return;if(this._running&&this._running.data.id===r)return;for(var i=0;i<this._cache.length;i++)if(this._cache[i].data.id===r)return void this._cache.push(this._cache.splice(i,1)[0]);var n={data:{id:r,config:e},ts:performance.now()};this._waiting.push(n),this._delayUpdate()}},n.active=function(e){void 0===e&&(e=!1),this._active!==e&&(e?(this._active=e,this._delayUpdate()):(this._active=e,this._stopUpdateTimer()))},n.clean=function(){this._waiting=[],this._running&&(this._running.app&&this._running.app.destroy(),this._running=void 0),this._active=!1},n.destroy=function(){this.clean(),this._cache.forEach((function(e){e.app&&e.app.destroy()})),this._cache=[],this._stopUpdateTimer(),this.removeAllListeners()},n.hasCache=function(){return this._cache.length>0},n._delayUpdate=function(){var e=this;this._active&&!this._updateTimer&&(this._stopUpdateTimer(),this._updateTimer=setTimeout((function(){e._updateTimer=void 0,e._update()}),1e3))},n._stopUpdateTimer=function(){this._updateTimer&&(clearTimeout(this._updateTimer),this._updateTimer=void 0)},n._update=function(){if(!this._running&&this._waiting.length&&this._active){var e=this._statCallback(),t=this._running=this._waiting.shift();t&&e&&(this._startTimeout(),t.app=new ri(t.data),t.app.on(k.default.PRELOAD_COMPLETE,this._onPreloadComplete),t.app.on(k.default.DOWNLOAD,this._onPreloadDownload),t.app.start(e.abr,e.level),c.Log.i(oi,"preload task start"))}},n._startTimeout=function(){var e=this;this._timeout=setTimeout((function(){e._running&&e._running.app&&e._running.app.destroy(),e._running=void 0,e._delayUpdate(),e._stopTimeout()}),5e3)},n._stopTimeout=function(){this._timeout&&(clearTimeout(this._timeout),this._timeout=void 0)},i}(a.EventEmitter),ui="kernel-mse-vod",di=function(e){var t,r;function i(t,r,i){var n;return(n=e.call(this,t,r,i)||this)._preloader=void 0,n._seekWithLoad=function(){if(c.Log.i(ui,"seek with load"),!n._config.isLive&&n._trans&&n._mse){var e=n._video.currentTime;if(!n._trans.isSeekable()&&e>=u.UNSEEKABLE_START_TIME_THRESHOLD)return c.Log.w(ui,"seek disabled, rollback: "+n._seekRollbackTime),void n._internalSeek(n._seekRollbackTime);n._preloader&&n._preloader.active(!1),n.emit(k.default.SEEK_WITH_LOAD,e),n._stat=dr.SEEK,n._nextLevel.length&&(n._nextLevel=n._nextLevel.slice(n._nextLevel.length-1),n._nextLevel[0].startSec=e),n._mse.flush(),n._seekOnCanplay=!0,n._trans.seek(e,d.default.msie||n._config.alwaysSeekKeyframe,!1)}},n._levelStat=function(){if(n._trans)return{abr:n._trans.autoLevelEnabled,level:n._trans.currentLevel}},!n._config.isLive&&(n._config.startFromSec>0||n._config.startFrom&&n._config.startFrom>0)&&(n._config.startFromSec=n._config.startFromSec||(n._config.startFrom||0)/1e3,n._internalSeek(n._config.startFromSec),n._skipSeekEvent=!0),n._nextLevelMinBuffer=3,n}r=e,(t=i).prototype=Object.create(r.prototype),t.prototype.constructor=t,t.__proto__=r;var n=i.prototype;return n.load=function(t,r){void 0===t&&(t=void 0),e.prototype.load.call(this,t,r),c.Log.i(ui,"load",r);var i=!!this._trans;this._stat!==dr.INIT&&this._monitor.reset(i),this._playingLevel=void 0,this._preloader&&this._preloader.active(!1),r?"number"==typeof r.startFromSec&&(this._config.startFromSec=r.startFromSec):i&&(this._config.startFromSec=0),this._checkPreload()||(c.Log.i(ui,"preload miss"),this._load()),this._preloader&&this._preloader.clean()},n.preload=function(e){var t=this;this._config.box!==u.MediaBox.hls||this._config.isLive||(!this._preloader&&si&&(this._preloader=new si(this._levelStat),this._preloader.on(k.default.PRELOAD_COMPLETE,(function(){return t.emit(k.default.PRELOAD_COMPLETE)})),this._preloader.on(k.default.DOWNLOAD,(function(e){return t.emit(k.default.DOWNLOAD,e)}))),this._preloader&&this._preloader.add(this._config,e))},n.destroy=function(){performance.onresourcetimingbufferfull=null,this._preloader&&this._preloader.destroy(),e.prototype.destroy.call(this)},n.getCurrentLevel=function(){return e.prototype.getCurrentLevel.call(this)},n.setCurrentLevel=function(t){e.prototype.setCurrentLevel.call(this,t),this._preloader&&this._preloader.active(!1)},n._onMSEBufferFull=function(){e.prototype._onMSEBufferFull.call(this),this._config.lazyLoad&&this._trans&&this._trans.setDownloadEnabled(!1)},n._heartbeat=function(){e.prototype._heartbeat.call(this),this._updateBufferControl(),this._trans&&this._preloader&&this._preloader.active(!this._trans.isNetworkInUse&&"closed"!==this._media.mseReadyState)},n._checkPreload=function(){if(!this._preloader||!this._preloader.hasCache()||!this._trans||this._config.startFromSec)return!1;var e=this._preloader.check(this._config.src);return!!(e&&e.app&&e.app.trans)&&(this._config=e.data.config,this._stat=dr.LOADING,this._destroyTrans(),this._config.webWorker&&H.prepareWorker(),this._initMSE(),this._trans=e.app.trans,this.emit(k.default.PRELOAD_HIT,this._trans.getCurrentUrl()),this._transmuxerEvent(this._trans),e.app.use(),this._trans.usePreload(),this._startHeartbeat(),c.Log.i(ui,"preload hit"),!0)},n._updateBufferControl=function(){if(this._trans&&this._mse){var e=this._media.bufferedSec(),t=this._mse.getBufferQueueSec(),r=!0;if(this._checkStreamingMux(e),(e<this._config.lazyLoadRecoverDuration||!this._config.lazyLoad&&!this._mse.getAppendEnabled())&&this._mse.setAppendEnabled(!0),e+t>=("closed"===this._media.mseReadyState?1:this._config.lazyLoadMaxDuration))r=!1;else{if(!(e+t<this._config.lazyLoadRecoverDuration))return;r=!0}this._config.lazyLoad&&this._trans&&(c.Log.v(ui,"download: "+r+" buffered:"+e+" mse:"+t),this._trans.setDownloadEnabled(r)),this._media.pendingNum()&&this._mse.refresh()}},n._onVideoSeeking=function(){if(c.Log.i(ui,"seek to "+this._video.currentTime+" internal:"+this._internalSeekFlag),this._mediaInfo&&!(this._video&&this._video.currentTime>=this._video.duration&&this._mse&&this._mse.ended())){this._checkStreamingMux();var e=this._internalSeekFlag;if(this._internalSeekFlag=!1,this._skipSeekEvent)this._skipSeekEvent=!1;else{this.emit(k.default.SEEKING,e);var t=this._video.currentTime;this._media.isTimeinBuffered(t)?e||(d.default.msedge||d.default.msie?(this._seekOnCanplay=!0,this._seekWithLoad()):this._trans&&"hls"===this._config.box&&this._trans.seek(t,!1,!0)):0===t&&this._video.buffered.length>0&&this._video.buffered.start(0)<1?e||this._internalSeek(this._video.buffered.start(0)):this._seekWithLoad()}}},n._onParsingData=function(t){e.prototype._onParsingData.call(this,t),this._updateBufferControl()},i}($r),ci=function(){function e(){var e=this;this._timer=void 0,this._xhr=void 0,this._callbackFunc=void 0,this._onEnd=function(){e._detectEnd()},this._onReadystatechange=function(){e._xhr&&e._xhr.readyState>=2&&e._detectEnd()},this._detectEnd=function(){e._xhr&&e._callbackFunc&&e._callbackFunc(e._xhr.status),e.stop()}}var t=e.prototype;return t.start=function(e,t){this._callbackFunc=t,this._xhr&&this.stop();var r=this._xhr=new XMLHttpRequest;r.open("GET",e,!0),r.onreadystatechange=this._onReadystatechange,r.onerror=this._onEnd,r.onload=this._onEnd,r.send(),this._timer=setTimeout(this._detectEnd,1e3)},t.stop=function(){this._timer&&(clearTimeout(this._timer),this._timer=void 0),this._xhr&&(this._xhr.onreadystatechange=null,this._xhr.onload=null,this._xhr.onerror=null,this._xhr.abort(),this._xhr=void 0),this._callbackFunc=void 0},e}(),li="kernel-native",fi=function(e){var t,r;function i(t,r,i){var n;return(n=e.call(this,t.video,r)||this)._media=void 0,n._config=void 0,n._src=void 0,n._manifest=void 0,n._levels=[],n._index=0,n._protocol=u.Protocol.NATIVE,n._firstLoad=!0,n._startSec=0,n._httpStatusDetector=void 0,n._media=t,n._config=i,n._src=n._config.src,n}r=e,(t=i).prototype=Object.create(r.prototype),t.prototype.constructor=t,t.__proto__=r;var n=i.prototype;return n.load=function(e,t){c.Log.i(li,"load",e,t),this._src=e||this._src,this._levels=[],this._stat!==dr.INIT&&this._monitor.reset(!this._firstLoad),this._firstLoad?(this._config.startFromSec=(null==t?void 0:t.startFromSec)||this._config.startFromSec||0,this._firstLoad=!1):this._config.startFromSec=(null==t?void 0:t.startFromSec)||0,this._load()},n.setAvailableAbrLevels=function(e){},n.isTimeinBuffered=function(e){return this._media.isTimeinBuffered(e)},n.resume=function(){},n.refresh=function(){this._startLoadLevel(this.getCurrentLevel(),this._video.currentTime),this._video.play()},n.stopLoad=function(){this.emit(k.default.STOP_LOAD),this._stopHeartbeat()},n.setCurrentLevel=function(e){if(this._levels.length){if(e>=0&&e<this._levels.length&&this._index!==e){this._index=e;var t=this._levels[this.getCurrentLevel()];if(t){this._stat=dr.SELECT_BITRATE;var r=t.currentUrl,i=this._video.currentTime;return this._levelSwitchId++,this.emit(k.default.LEVEL_SWITCHING,{url:r,bitrate:t.bitrate,level:e,smooth:!1,auto:!1,id:this._levelSwitchId}),this._startLoadLevel(this.getCurrentLevel(),i),void this.emit(k.default.LEVEL_SWITCHED,{bitrate:t.bitrate,level:e,smooth:!1,auto:!1,id:this._levelSwitchId})}}this.emit(k.default.LEVEL_SWITCH_FAILED)}else this._index=e},n.getCurrentLevel=function(){return this._index},n.setNextLevel=function(e){this.setCurrentLevel(e)},n.getNextLevel=function(){return this._index},n.getLevels=function(){return this._levels},n.preload=function(e){},n.destroy=function(){this._httpStatusDetector&&(this._httpStatusDetector.stop(),this._httpStatusDetector=void 0),e.prototype.destroy.call(this),this._video.hasOwnProperty("src")&&(this._video.src=""),this._video.removeAttribute("src")},n._onVideoCanplay=function(){var t=this._levels[this._index];t&&this._stat===dr.SELECT_BITRATE&&this.emit(k.default.LEVEL_SWITCH_PLAYING,{bitrate:t.bitrate,level:this._index,smooth:!1,auto:!1,id:this._levelSwitchId}),this._stat!==dr.NONE&&(this._stat=dr.NONE),e.prototype._onVideoCanplay.call(this)},n._onVideoWaiting=function(){this._stat=this._stat||dr.WAITING;var e=this._media.bufferedSec(),t=!this._video.seeking&&this._stat===dr.WAITING;this.emit(k.default.WAITING,t,e)},n._onVideoLoadedmetadata=function(){this._mediaInfo={width:this._video.videoWidth,height:this._video.videoHeight};var e=this._levels[this.getCurrentLevel()];if(e&&e.codec){var t=Xe(e.codec);this._mediaInfo.audioCodec=t.audio,this._mediaInfo.videoCodec=t.video}this._startSec&&this._video.currentTime.toFixed(4)!==this._startSec.toFixed(4)&&(this._video.currentTime=this._startSec,this._startSec=0),this.emit(k.default.PARSING_INIT_SEGMENT,this._mediaInfo)},n._onVideoSeeking=function(){var e=this._video.currentTime;this.emit(k.default.SEEKING),this.isTimeinBuffered(e)||this.emit(k.default.SEEK_WITH_LOAD,e)},n._onVideoError=function(e){var t,r=this,i="video error";this._video&&this._video.error&&(i+=" code:"+this._video.error.code+" message:"+this._video.error.message);var n={type:I.ErrorTypes.MEDIA_ERROR,details:I.ErrorDetails.VIDEO_ERROR,fatal:!0,url:this._video.src,reason:i},a=null==(t=this._video.error)?void 0:t.code;2===a||4===a?(this._httpStatusDetector||(this._httpStatusDetector=new ci),this._httpStatusDetector.start(this._video.src,(function(e){c.Log.i(li,"video error check http status code:",e),(2===a||4===a&&e>0)&&(e<200||e>299)?r._onError({type:I.ErrorTypes.NETWORK_ERROR,details:I.ErrorDetails.LOAD_ERROR,fatal:!0,url:r._video.src,statusCode:e,reason:i}):r._onError(n)}))):this._onError(n)},n._load=function(e){var t;void 0===e&&(e=!1),c.Log.i(li,"_load"),this._mediaInfo=void 0,this._error=void 0,this._stat=dr.LOADING,this._protocol="object"==typeof this._src?u.Protocol.KWAI_MP4:u.Protocol.NATIVE,this.emit(k.default.LOAD,this._config.src,e),this._manifest=new jt(this._src),(t=this._manifest.levels).length?("number"==typeof this._startLevel&&this._startLevel>=0&&this._startLevel<t.length&&(this._index=this._startLevel),this._levels=t,this._protocol===u.Protocol.KWAI_MP4&&this.emit(k.default.MANIFEST_PARSED,{currentLevel:this._index,protocol:this._protocol,auto:!1}),this._startLoadLevel(this._index,this._config.startFromSec),this._startHeartbeat()):this._onError({type:I.ErrorTypes.MUX_ERROR,details:I.ErrorDetails.MANIFEST_PARSING_ERROR,fatal:!0,reason:"manifest parsing error"})},n._startLoadLevel=function(e,t){void 0===t&&(t=0);var r=this._levels[e];if(r){c.Log.i(li,"level",e,t);var i=r.currentUrl;this.emit(k.default.NEW_SOURCE,{sync:t,index:e}),this._video.src=i,this._startSec=t}},i}(yr);function _i(e,t){for(var r=0;r<t.length;r++){var i=t[r];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}var hi=function(){function e(){this._prevVideoTimestamp=0,this._prevAudioTimestamp=0,this._prevVideoReceived=0,this._prevAudioReceived=0,this._result=void 0,this._result=this._newInfo()}var t,r,i,n=e.prototype;return n.reset=function(){this._result=this._newInfo(),this._prevVideoTimestamp=0,this._prevAudioTimestamp=0,this._prevVideoReceived=0,this._prevAudioReceived=0},n.parse=function(e){var t=this,r=this._result,i=0,n=0,a="",o="",s="",u="";r.totalReceive=0,e.forEach((function(e){if("inbound-rtp"===e.type){if("video"===e.mediaType){var d=e.timestamp-t._prevVideoTimestamp;t._prevVideoTimestamp&&(i=(e.bytesReceived-t._prevVideoReceived)/d),t._prevVideoReceived=e.bytesReceived,t._prevVideoTimestamp=e.timestamp,r.key=e.keyFramesDecoded,r.videoPacketsLost=e.packetsLost,o=e.codecId,u=e.trackId}else if("audio"===e.mediaType){var c=e.timestamp-t._prevAudioTimestamp;t._prevAudioReceived&&(n=(e.bytesReceived-t._prevAudioReceived)/c),t._prevAudioReceived=e.bytesReceived,r.audioPacketsLost=e.packetsLost,a=e.codecId,s=e.trackId}r.totalReceive+=e.bytesReceived,t._prevAudioTimestamp=e.timestamp}})),r.audioDataRate=Math.round(7.8125*n),r.videoDataRate=Math.round(7.8125*i),r.speed=1e3*(i+n),e.forEach((function(e){"codec"===e.type?e.id===o?r.videoCodec=e.mimeType:e.id===a&&(r.audioCodec=e.mimeType,r.audioChannelCount=e.channels,r.audioSampleRate=e.clockRate):"track"===e.type&&(e.id===u?(r.width=e.frameWidth,r.height=e.frameHeight,r.videoAvgJitterBufferDelay=e.jitterBufferDelay/e.jitterBufferEmittedCount):e.id===s&&(r.audioAvgJitterBufferDelay=e.jitterBufferDelay/e.jitterBufferEmittedCount))}));var d=null,c=null;return e.forEach((function(t){"transport"===t.type&&(d=e.get(t.selectedCandidatePairId))})),d||e.forEach((function(e){"candidate-pair"===e.type&&e.selected&&(d=e)})),d&&d.remoteCandidateId&&(c=e.get(d.remoteCandidateId)),c&&(r.rtcRemoteAddress=c.address||c.ip||c.ipAddress,r.rtcRemotePort=c.port||c.portNumber),this._result=r,r},n._newInfo=function(){return{totalReceive:0,speed:0,rtcRemoteAddress:"",rtcRemotePort:0,width:0,height:0,audioCodec:"",videoCodec:"",audioChannelCount:0,audioSampleRate:0,videoDataRate:0,audioDataRate:0,key:0,audioPacketsLost:0,videoPacketsLost:0,audioAvgJitterBufferDelay:0,videoAvgJitterBufferDelay:0}},t=e,(r=[{key:"result",get:function(){return this._result}}])&&_i(t.prototype,r),i&&_i(t,i),e}();function pi(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,i)}return r}function vi(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?pi(Object(r),!0).forEach((function(t){mi(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):pi(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}function mi(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function gi(){return(gi=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var i in r)Object.prototype.hasOwnProperty.call(r,i)&&(e[i]=r[i])}return e}).apply(this,arguments)}var yi,Ei="kernel-rtc",Si=function(e){var t,r;function i(t,r,i){var n;return(n=e.call(this,t.video,r)||this)._media=void 0,n._pc=void 0,n._config=void 0,n._loaderConfig=void 0,n._stream=void 0,n._src=void 0,n._rtcStatParser=void 0,n._retrying=!1,n._retryTimer=null,n._retryCount=0,n.transmissionTimeoutTimer=null,n.transmissionTimeout=void 0,n.peerConnectionTimeout=void 0,n.peerConnectionMaxRetry=void 0,n.peerConnectionRetryDelay=void 0,n._manifest=void 0,n._levels=[],n._index=0,n._parseStats=function(e){n._pc&&n._pc.getStats(null).then((function(t){var r=n._rtcStatParser.parse(t);e(r)}),(function(e){return console.log(e)}))},n._media=t,n._config=i,n._loaderConfig={useFetch:!0,connectionTimeout:n._config.sdpConnectionTimeout||1e4,maxRetry:0,retryDelay:n._config.retryDelay||1e3},n.transmissionTimeout=n._config.transmissionTimeout||1e4,n.peerConnectionTimeout=i.peerConnectionTimeout||1e5,n.peerConnectionMaxRetry=i.peerConnectionMaxRetry||5,n.peerConnectionRetryDelay=i.peerConnectionRetryDelay||3e3,n._src=n._config.src,n._rtcStatParser=new hi,n}r=e,(t=i).prototype=Object.create(r.prototype),t.prototype.constructor=t,t.__proto__=r;var n=i.prototype;return n.load=function(e,t){c.Log.i(Ei,"load"),this._stat!==dr.INIT&&this._monitor.reset(),this._src=e||this._src,this._manifest=new jt(this._src),this._levels=this._manifest.levels,this._levels.length?this._load():this._onError({type:I.ErrorTypes.MUX_ERROR,details:I.ErrorDetails.MANIFEST_PARSING_ERROR,fatal:!0,reason:"manifest parsing error"})},n.setAvailableAbrLevels=function(e){},n.isTimeinBuffered=function(e){return!1},n.resume=function(){},n.destroy=function(){e.prototype.destroy.call(this),this._video&&(this._video.srcObject=null),this._disconnect(),this._stream=void 0,this._stopVideo()},n.refresh=function(e){this._disconnect(),this._load()},n.stopLoad=function(){this.emit(k.default.STOP_LOAD),this._pc&&(this._pc.close(),this._pc=null),this._stopRetry(),this._stopHeartbeat()},n.setCurrentLevel=function(e){},n.getCurrentLevel=function(){return this._index},n.setNextLevel=function(e){},n.getNextLevel=function(){return this._index},n.getLevels=function(){return this._levels},n.liveEnd=function(){},n._onVideoLoadedmetadata=function(){var e=this;this._parseStats((function(t){e._mediaInfo.width=t.width,e._mediaInfo.height=t.height,e._mediaInfo.audioCodec=t.audioCodec,e._mediaInfo.audioSampleRate=t.audioSampleRate,e._mediaInfo.channelCount=t.audioChannelCount,e._mediaInfo.videoCodec=t.videoCodec,e._mediaInfo.hasVideo=!!t.videoCodec,e._mediaInfo.hasAudio=!!t.audioCodec,e._mediaInfo.streamHost=t.rtcRemoteAddress,e._mediaInfo.streamPort=t.rtcRemotePort;var r=gi({},e._mediaInfo);e.emit(k.default.PARSING_INIT_SEGMENT,r)}))},n._heartbeat=function(){var e=this;this._parseStats((function(t){var r;t.speed||e.transmissionTimeoutTimer||"connected"!==(null==(r=e._pc)?void 0:r.connectionState)?t.speed&&(e.transmissionTimeoutTimer&&clearTimeout(e.transmissionTimeoutTimer),e.transmissionTimeoutTimer=null):e.transmissionTimeoutTimer=+setTimeout((function(){var t={type:I.ErrorTypes.NETWORK_ERROR,details:I.ErrorDetails.WEBRTC_TRANSMISSION_DATA_NULL,reason:"transmission timeout "+e.transmissionTimeout,fatal:!1,url:e._src};e._onError(t),e._retry(t.reason)}),e.transmissionTimeout),e.emit(k.default.HEARTBEAT,t)}))},n._onVideoCanplay=function(){this._stat!==dr.NONE&&(this._stat=dr.NONE),e.prototype._onVideoCanplay.call(this)},n._load=function(){var e=this;this._rtcStatParser.reset(),this._stat=dr.LOADING,this.emit(k.default.LOAD,this._src),this.emit(k.default.NEW_SOURCE,{sync:0,index:0},this._levels[this._index]),this._pc&&this._pc.close(),this._createPeerConnection(),this._connect().catch((function(t){e._retry(null==t?void 0:t.reason)}))},n._stopVideo=function(){this._video&&(this._video.srcObject=null)},n._retry=function(e){var t=this;this._retrying=!0,this._pc&&this._pc.close(),this._stopRetry(),this._retryCount<this.peerConnectionMaxRetry&&(this.transmissionTimeoutTimer&&clearTimeout(this.transmissionTimeoutTimer),this._retryTimer&&clearTimeout(this._retryTimer),this._retryTimer=+setTimeout((function(){t._retryCount++,c.Log.i(Ei,"retry",t._retryCount,e,t._src),t.emit(k.default.RETRY,{type:u.RetryType.RTC,message:"reason: "+e+". retry: "+t._retryCount}),t._retryTimer=null,t._createPeerConnection(),t._connect().then((function(){t._retryCount=0,t._retrying=!1}),(function(r){t._retryCount<t.peerConnectionMaxRetry?t._retry(e):t._onError(vi(vi({},r),{},{fatal:!0,url:t._src}))}))}),this.peerConnectionRetryDelay))},n._stopRetry=function(){this._retryTimer&&(clearTimeout(this._retryTimer),this._retryTimer=null)},n.fetchAnwserSdp=function(e){var t=this,r=new rt,i={url:this._src,responseType:"text",requestBody:e,requestMethod:"POST",headers:[{header:"Content-type",value:"application/json"}]};return new Promise((function(e,n){r.load(i,{onEnd:function(i,n){if("string"==typeof n){var a=JSON.parse(n);t.emit(k.default.LEVEL_UPDATED),e(a.sdp)}r.destroy()},onError:function(e,i){c.Log.e(Ei,"loadSdp",i);var a={type:I.ErrorTypes.NETWORK_ERROR,details:I.ErrorDetails.LOAD_ERROR,reason:i.text,fatal:!1,url:t._src};i.retry===t._loaderConfig.maxRetry&&(r.destroy(),n(a)),t._onError(a)},onAbort:function(){r.destroy(),n()}},t._loaderConfig)})).catch((function(e){return Promise.reject(e)}))},n._createPeerConnection=function(){var e=this,t=this._pc=new RTCPeerConnection;return t.addEventListener("track",(function(t){return e._onPCTrack(t)})),t.addEventListener("connectionstatechange",(function(t){return e._onPCConnectionStateChange(t)})),t.addEventListener("icecandidateerror",(function(t){return e._onPCIceCandidateError(t)})),t.addEventListener("signalingstatechange",(function(t){return e._onPCSignalingStateChange(t)})),t.addEventListener("iceconnectionstatechange",(function(t){return e._onPCIceConnecttionStateChange(t)})),t.addEventListener("icegatheringstatechange",(function(t){return e._onIceGatheringStateChange(t)})),t.addTransceiver("audio",{direction:"recvonly"}),t.addTransceiver("video",{direction:"recvonly"}),t},n._disconnect=function(){this._pc&&this._pc.close(),this._pc=null},n._connect=function(){var e=this,t=this._pc;return t||Promise.reject("PeerConnection isn't exist"),this._createOffer().then((function(t){return e.fetchAnwserSdp(JSON.stringify({sdp:t.sdp}))})).then((function(t){return e._setAnwser(t)})).then((function(){return t?new Promise((function(r,i){var n=setTimeout((function(){var t={type:I.ErrorTypes.NETWORK_ERROR,details:I.ErrorDetails.WEBRTC_CONNECT_TIMEOUT,fatal:!1,reason:"webrtc connect timeout",url:e._src};e._onError(t),i(t)}),e.peerConnectionTimeout);t.addEventListener("connectionstatechange",(function e(){switch(t.connectionState){case"connected":r(void 0),clearTimeout(n),t.removeEventListener("connectionstatechange",e);break;case"closed":case"disconnected":case"failed":clearTimeout(n),t.removeEventListener("connectionstatechange",e),i({type:I.ErrorTypes.NETWORK_ERROR,details:I.ErrorDetails.WEBRTC_CONNECT_FAILED,fatal:!1,reason:t.onconnectionstatechange})}}))})):Promise.reject("PeerConnection isn't exist")})).catch((function(e){return c.Log.e(Ei,e),Promise.reject(e)}))},n._createOffer=function(){var e=this,t=this._pc;return t?t.createOffer().then((function(e){return c.Log.i(Ei,"offer",e),t.setLocalDescription(e).then((function(){return e}))}),(function(t){c.Log.e(Ei,"offer",t);var r={type:I.ErrorTypes.NETWORK_ERROR,details:I.ErrorDetails.WEBRTC_OFFER_ERROR,fatal:!1,url:e._src,reason:"webrtc createoffer error"+t};return e._onError(r),Promise.reject(r)})):Promise.reject()},n._setAnwser=function(e){var t=this,r=this._pc;if(!r||"closed"===r.signalingState)return Promise.reject();var i=new RTCSessionDescription({type:"answer",sdp:e});return r.setRemoteDescription(i).then((function(e){c.Log.i(Ei,"answer",i)}),(function(e){c.Log.e(Ei,"answer",e);var r={type:I.ErrorTypes.NETWORK_ERROR,details:I.ErrorDetails.WEBRTC_ANSWER_ERROR,fatal:!1,url:t._src,reason:"webrtc answer error"};return t._onError(r),Promise.reject(r)}))},n._onPCTrack=function(e){var t=this;if(this._media.video&&e.streams&&this._stream!==e.streams[0]){var r=this._stream=e.streams[0];this._media.video.srcObject=r,this._mediaInfo={},e.streams[0].getTracks().forEach((function(e){var r=e.getSettings();t._mediaInfo.width=r.width||t._mediaInfo.width,t._mediaInfo.height=r.height||t._mediaInfo.height,t._mediaInfo.fps=r.frameRate||t._mediaInfo.fps}))}},n._onPCConnectionStateChange=function(e){var t=this._pc;if(t)switch(c.Log.i(Ei,"pcConnectionStateChange",t.connectionState),t.connectionState){case"connecting":case"connected":break;case"disconnected":case"failed":case"closed":this._onError({type:I.ErrorTypes.NETWORK_ERROR,details:I.ErrorDetails.WEBRTC_DISCONNECTED_ERROR,reason:t.connectionState,fatal:!1,url:this._src}),!this._retrying&&this._retry("PeerConnection state is "+t.connectionState)}},n._onPCIceCandidateError=function(e){var t;c.Log.i(Ei,"iceCandidateError",e),this._onError({type:I.ErrorTypes.NETWORK_ERROR,details:I.ErrorDetails.WEBRTC_ICE_CANDIDATE_ERROR,fatal:!1,reason:(null==(t=this._pc)?void 0:t.iceConnectionState)||""}),!this._retrying&&this._retry("iceCandidateError")},n._onPCSignalingStateChange=function(e){var t;c.Log.i(Ei,"signalingStateChange",null==(t=this._pc)?void 0:t.signalingState)},n._onPCIceConnecttionStateChange=function(e){var t;c.Log.i(Ei,"iceConnecttionStateChange",null==(t=this._pc)?void 0:t.iceConnectionState)},n._onIceGatheringStateChange=function(e){var t;c.Log.i(Ei,"iceGatheringStateChange",null==(t=this._pc)?void 0:t.iceGatheringState)},n._onIcecandidate=function(e){var t;c.Log.i(Ei,"icecandidate",e.candidate),e.candidate&&(null==(t=this._pc)||t.addIceCandidate(new RTCIceCandidate({sdpMLineIndex:0,sdpMid:"0",candidate:e.candidate})).then((function(){return c.Log.i(Ei,"addIceCandidate success")}),(function(e){return c.Log.e(Ei,"addIceCandidate failed",e)})))},i}(yr),Ti=new Uint8Array(16);function bi(){if(!yi&&!(yi="undefined"!=typeof crypto&&crypto.getRandomValues&&crypto.getRandomValues.bind(crypto)||"undefined"!=typeof msCrypto&&"function"==typeof msCrypto.getRandomValues&&msCrypto.getRandomValues.bind(msCrypto)))throw new Error("crypto.getRandomValues() not supported. See https://github.com/uuidjs/uuid#getrandomvalues-not-supported");return yi(Ti)}for(var Li=/^(?:[0-9a-f]{8}-[0-9a-f]{4}-[1-5][0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12}|00000000-0000-0000-0000-000000000000)$/i,Ai=function(e){return"string"==typeof e&&Li.test(e)},Ri=[],Ii=0;Ii<256;++Ii)Ri.push((Ii+256).toString(16).substr(1));var ki=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,r=(Ri[e[t+0]]+Ri[e[t+1]]+Ri[e[t+2]]+Ri[e[t+3]]+"-"+Ri[e[t+4]]+Ri[e[t+5]]+"-"+Ri[e[t+6]]+Ri[e[t+7]]+"-"+Ri[e[t+8]]+Ri[e[t+9]]+"-"+Ri[e[t+10]]+Ri[e[t+11]]+Ri[e[t+12]]+Ri[e[t+13]]+Ri[e[t+14]]+Ri[e[t+15]]).toLowerCase();if(!Ai(r))throw TypeError("Stringified UUID is invalid");return r},Ci=function(e){if(!Ai(e))throw TypeError("Invalid UUID");var t,r=new Uint8Array(16);return r[0]=(t=parseInt(e.slice(0,8),16))>>>24,r[1]=t>>>16&255,r[2]=t>>>8&255,r[3]=255&t,r[4]=(t=parseInt(e.slice(9,13),16))>>>8,r[5]=255&t,r[6]=(t=parseInt(e.slice(14,18),16))>>>8,r[7]=255&t,r[8]=(t=parseInt(e.slice(19,23),16))>>>8,r[9]=255&t,r[10]=(t=parseInt(e.slice(24,36),16))/1099511627776&255,r[11]=t/4294967296&255,r[12]=t>>>24&255,r[13]=t>>>16&255,r[14]=t>>>8&255,r[15]=255&t,r},xi=function(e,t,r){function i(e,i,n,a){if("string"==typeof e&&(e=function(e){e=unescape(encodeURIComponent(e));for(var t=[],r=0;r<e.length;++r)t.push(e.charCodeAt(r));return t}(e)),"string"==typeof i&&(i=Ci(i)),16!==i.length)throw TypeError("Namespace must be array-like (16 iterable integer values, 0-255)");var o=new Uint8Array(16+e.length);if(o.set(i),o.set(e,i.length),(o=r(o))[6]=15&o[6]|t,o[8]=63&o[8]|128,n){a=a||0;for(var s=0;s<16;++s)n[a+s]=o[s];return n}return ki(o)}try{i.name=e}catch(n){}return i.DNS="6ba7b810-9dad-11d1-80b4-00c04fd430c8",i.URL="6ba7b811-9dad-11d1-80b4-00c04fd430c8",i};function Di(e){return 14+(e+64>>>9<<4)+1}function wi(e,t){var r=(65535&e)+(65535&t);return(e>>16)+(t>>16)+(r>>16)<<16|65535&r}function Oi(e,t,r,i,n,a){return wi((o=wi(wi(t,e),wi(i,a)))<<(s=n)|o>>>32-s,r);var o,s}function Pi(e,t,r,i,n,a,o){return Oi(t&r|~t&i,e,t,n,a,o)}function Ni(e,t,r,i,n,a,o){return Oi(t&i|r&~i,e,t,n,a,o)}function Mi(e,t,r,i,n,a,o){return Oi(t^r^i,e,t,n,a,o)}function Ui(e,t,r,i,n,a,o){return Oi(r^(t|~i),e,t,n,a,o)}xi("v3",48,(function(e){if("string"==typeof e){var t=unescape(encodeURIComponent(e));e=new Uint8Array(t.length);for(var r=0;r<t.length;++r)e[r]=t.charCodeAt(r)}return function(e){for(var t=[],r=32*e.length,i="0123456789abcdef",n=0;n<r;n+=8){var a=e[n>>5]>>>n%32&255,o=parseInt(i.charAt(a>>>4&15)+i.charAt(15&a),16);t.push(o)}return t}(function(e,t){e[t>>5]|=128<<t%32,e[Di(t)-1]=t;for(var r=1732584193,i=-271733879,n=-1732584194,a=271733878,o=0;o<e.length;o+=16){var s=r,u=i,d=n,c=a;r=Pi(r,i,n,a,e[o],7,-680876936),a=Pi(a,r,i,n,e[o+1],12,-389564586),n=Pi(n,a,r,i,e[o+2],17,606105819),i=Pi(i,n,a,r,e[o+3],22,-1044525330),r=Pi(r,i,n,a,e[o+4],7,-176418897),a=Pi(a,r,i,n,e[o+5],12,1200080426),n=Pi(n,a,r,i,e[o+6],17,-1473231341),i=Pi(i,n,a,r,e[o+7],22,-45705983),r=Pi(r,i,n,a,e[o+8],7,1770035416),a=Pi(a,r,i,n,e[o+9],12,-1958414417),n=Pi(n,a,r,i,e[o+10],17,-42063),i=Pi(i,n,a,r,e[o+11],22,-1990404162),r=Pi(r,i,n,a,e[o+12],7,1804603682),a=Pi(a,r,i,n,e[o+13],12,-40341101),n=Pi(n,a,r,i,e[o+14],17,-1502002290),r=Ni(r,i=Pi(i,n,a,r,e[o+15],22,1236535329),n,a,e[o+1],5,-165796510),a=Ni(a,r,i,n,e[o+6],9,-1069501632),n=Ni(n,a,r,i,e[o+11],14,643717713),i=Ni(i,n,a,r,e[o],20,-373897302),r=Ni(r,i,n,a,e[o+5],5,-701558691),a=Ni(a,r,i,n,e[o+10],9,38016083),n=Ni(n,a,r,i,e[o+15],14,-660478335),i=Ni(i,n,a,r,e[o+4],20,-405537848),r=Ni(r,i,n,a,e[o+9],5,568446438),a=Ni(a,r,i,n,e[o+14],9,-1019803690),n=Ni(n,a,r,i,e[o+3],14,-187363961),i=Ni(i,n,a,r,e[o+8],20,1163531501),r=Ni(r,i,n,a,e[o+13],5,-1444681467),a=Ni(a,r,i,n,e[o+2],9,-51403784),n=Ni(n,a,r,i,e[o+7],14,1735328473),r=Mi(r,i=Ni(i,n,a,r,e[o+12],20,-1926607734),n,a,e[o+5],4,-378558),a=Mi(a,r,i,n,e[o+8],11,-2022574463),n=Mi(n,a,r,i,e[o+11],16,1839030562),i=Mi(i,n,a,r,e[o+14],23,-35309556),r=Mi(r,i,n,a,e[o+1],4,-1530992060),a=Mi(a,r,i,n,e[o+4],11,1272893353),n=Mi(n,a,r,i,e[o+7],16,-155497632),i=Mi(i,n,a,r,e[o+10],23,-1094730640),r=Mi(r,i,n,a,e[o+13],4,681279174),a=Mi(a,r,i,n,e[o],11,-358537222),n=Mi(n,a,r,i,e[o+3],16,-722521979),i=Mi(i,n,a,r,e[o+6],23,76029189),r=Mi(r,i,n,a,e[o+9],4,-640364487),a=Mi(a,r,i,n,e[o+12],11,-421815835),n=Mi(n,a,r,i,e[o+15],16,530742520),r=Ui(r,i=Mi(i,n,a,r,e[o+2],23,-995338651),n,a,e[o],6,-198630844),a=Ui(a,r,i,n,e[o+7],10,1126891415),n=Ui(n,a,r,i,e[o+14],15,-1416354905),i=Ui(i,n,a,r,e[o+5],21,-57434055),r=Ui(r,i,n,a,e[o+12],6,1700485571),a=Ui(a,r,i,n,e[o+3],10,-1894986606),n=Ui(n,a,r,i,e[o+10],15,-1051523),i=Ui(i,n,a,r,e[o+1],21,-2054922799),r=Ui(r,i,n,a,e[o+8],6,1873313359),a=Ui(a,r,i,n,e[o+15],10,-30611744),n=Ui(n,a,r,i,e[o+6],15,-1560198380),i=Ui(i,n,a,r,e[o+13],21,1309151649),r=Ui(r,i,n,a,e[o+4],6,-145523070),a=Ui(a,r,i,n,e[o+11],10,-1120210379),n=Ui(n,a,r,i,e[o+2],15,718787259),i=Ui(i,n,a,r,e[o+9],21,-343485551),r=wi(r,s),i=wi(i,u),n=wi(n,d),a=wi(a,c)}return[r,i,n,a]}(function(e){if(0===e.length)return[];for(var t=8*e.length,r=new Uint32Array(Di(t)),i=0;i<t;i+=8)r[i>>5]|=(255&e[i/8])<<i%32;return r}(e),8*e.length))}));var Bi,Fi,Vi,Hi,ji,Gi,Ki=function(e,t,r){var i=(e=e||{}).random||(e.rng||bi)();if(i[6]=15&i[6]|64,i[8]=63&i[8]|128,t){r=r||0;for(var n=0;n<16;++n)t[r+n]=i[n];return t}return ki(i)};function Wi(e,t,r,i){switch(e){case 0:return t&r^~t&i;case 1:return t^r^i;case 2:return t&r^t&i^r&i;case 3:return t^r^i}}function qi(e,t){return e<<t|e>>>32-t}function zi(e){var t=performance.now();return{play:Math.round(e.playDuration+(e.playStartMS?t-e.playStartMS:0)),actualPlay:Math.round(e.actualPlayDuration+(e.actualPlayStartMS?t-e.actualPlayStartMS:0)),pause:Math.round(e.pauseDuration+(e.pauseStartMS?t-e.pauseStartMS:0)),buffer:Math.round(e.bufferTime+(e.bufferingStartMS?t-e.bufferingStartMS:0))}}function Yi(){for(var e=document,t=0,r=["hidden","webkitHidden","mozHidden"];t<r.length;t++){var i=r[t];if(i in e)return e[i]}return null}function Xi(e,t){for(var r=0;r<t.length;r++){var i=t[r];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}xi("v5",80,(function(e){var t=[1518500249,1859775393,2400959708,3395469782],r=[1732584193,4023233417,2562383102,271733878,3285377520];if("string"==typeof e){var i=unescape(encodeURIComponent(e));e=[];for(var n=0;n<i.length;++n)e.push(i.charCodeAt(n))}else Array.isArray(e)||(e=Array.prototype.slice.call(e));e.push(128);for(var a=e.length/4+2,o=Math.ceil(a/16),s=new Array(o),u=0;u<o;++u){for(var d=new Uint32Array(16),c=0;c<16;++c)d[c]=e[64*u+4*c]<<24|e[64*u+4*c+1]<<16|e[64*u+4*c+2]<<8|e[64*u+4*c+3];s[u]=d}s[o-1][14]=8*(e.length-1)/Math.pow(2,32),s[o-1][14]=Math.floor(s[o-1][14]),s[o-1][15]=8*(e.length-1)&4294967295;for(var l=0;l<o;++l){for(var f=new Uint32Array(80),_=0;_<16;++_)f[_]=s[l][_];for(var h=16;h<80;++h)f[h]=qi(f[h-3]^f[h-8]^f[h-14]^f[h-16],1);for(var p=r[0],v=r[1],m=r[2],g=r[3],y=r[4],E=0;E<80;++E){var S=Math.floor(E/20),T=qi(p,5)+Wi(S,v,m,g)+y+t[S]+f[E]>>>0;y=g,g=m,m=qi(v,30)>>>0,v=p,p=T}r[0]=r[0]+p>>>0,r[1]=r[1]+v>>>0,r[2]=r[2]+m>>>0,r[3]=r[3]+g>>>0,r[4]=r[4]+y>>>0}return[r[0]>>24&255,r[0]>>16&255,r[0]>>8&255,255&r[0],r[1]>>24&255,r[1]>>16&255,r[1]>>8&255,255&r[1],r[2]>>24&255,r[2]>>16&255,r[2]>>8&255,255&r[2],r[3]>>24&255,r[3]>>16&255,r[3]>>8&255,255&r[3],r[4]>>24&255,r[4]>>16&255,r[4]>>8&255,255&r[4]]})),(Fi=Bi||(Bi={})).PLAY="PLAY",Fi.END="END",Fi.PAUSE="PAUSE",Fi.LOAD="LOAD",Fi.BLOCK_START="BLOCK_START",Fi.BLOCK_END="BLOCK_END",Fi.SEEK_START="SEEK_START",Fi.SEEK_END="SEEK_END",Fi.LIVE_STOP="LIVE_STOP",Fi.STOP="STOP",Fi.ERROR="ERROR",Fi.DESTORY="DESTORY",Fi.QUALITY_CHANGE="QUALITY_CHANGE",Fi.QUALITY_CHANGE_DATA="QUALITY_CHANGE_DATA",Fi.QUALITY_CHANGE_RENDER="QUALITY_CHANGE_RENDER",Fi.SPEED_CHANGE="SPEED_CHANGE",Fi.RETRY="RETRY",Fi.AUDIO_OUTPUT_DEVICE_CHANGE="AUDIO_OUTPUT_DEVICE_CHANGE",Fi.NETWORK_CHANGE="NETWORK_CHANGE",Fi.VIDEO_DOM_EVENT="VIDEO_DOM_EVENT",Fi.FIRST_SCREEN_RENDER="FIRST_SCREEN_RENDER",Fi.PREPARED="PREPARED",Fi.METADATA_LOAD="METADATA_LOAD",(Hi=Vi||(Vi={})).FIRST_FRAME="normal",Hi.FIRST_FRAME_SEEK="seek",Hi.FIRST_FRAME_SELECT_BITRATE="select_bitrate",(Gi=ji||(ji={})).START="start",Gi.MANIFEST="manifest",Gi.LEVEL="level",Gi.DATA="data",Gi.DEMUX="demux",Gi.SEGMENT="segment",Gi.CANPLAY="canplay",Gi.LOADEDDATA="loadeddata",Gi.SEEKED="seeked";var Qi=[{event:ji.START,emitEvent:"first_loader_open_timestamp",detailName:"first-loader-open"},{event:ji.MANIFEST,detailName:"manifest-duration"},{event:ji.LEVEL,detailName:"level-duration"},{event:ji.DATA,emitEvent:"receive-first-package-duration",detailName:"first-package-duration"},{event:ji.DEMUX,emitEvent:"first-flv-package-duration",detailName:"first-remux-duration"},{event:ji.SEGMENT,emitEvent:"first-flv-to-mp4",detailName:"first-segment-duration"},{event:[ji.LOADEDDATA,ji.CANPLAY,ji.SEEKED],emitEvent:"first_video_frame_duration",detailName:"first-frame-duration"}],Ji=function(){function e(e,t){this._complete=0,this._duration=0,this._events=void 0,this._start=0,this._lastEventTime=0,this._details={},this._eventEmitter=void 0,this._media=void 0,this._type=Vi.FIRST_FRAME,this._events=Qi.slice(0),this._eventEmitter=e,this._media=t}var t,r,i,n=e.prototype;return n.start=function(e){this._complete=0,this._start=performance.now(),this._duration=0,this._events=Qi.slice(0),this._lastEventTime=0,this._type=e,this._details={type:e,error_cnt:0},this.process(ji.START,this._start)},n.process=function(e,t){if(void 0===t&&(t=0),this._complete)return!1;var r=this._events,i=-1;t=t||performance.now();for(var n=0;n<r.length;n++){var a=r[n];if(Array.isArray(a.event)){if(-1!==a.event.indexOf(e)){i=n;break}}else if(a.event===e){i=n;break}}if(-1===i)return!1;var o=r.splice(0,i+1).pop(),s="closed"===this._media.mseReadyState;if((0===r.length||s&&e===ji.SEGMENT)&&(this._duration=t-this._start,this._complete=Date.now()),o){var u=Math.round(t-this._lastEventTime);0===this._lastEventTime&&(u=Date.now()),this._lastEventTime=t,this._details[o.detailName]=u,o.emitEvent&&this._eventEmitter&&this._eventEmitter.emit(k.default.REPORT,{type:P,value:{type:o.emitEvent,value:u}})}return!!this._complete},n.onError=function(){this._details.error_cnt++},t=e,(r=[{key:"type",get:function(){return this._type}},{key:"complete",get:function(){return this._complete}},{key:"duration",get:function(){return this._duration}},{key:"details",get:function(){return this._details}}])&&Xi(t.prototype,r),i&&Xi(t,i),e}(),$i=window.performance,Zi=function(){function e(){var e=this;this.tag="fps",this._lastDroppedFrames=0,this._lastDecodedFrames=0,this._video=null,this._isVideoPlaybackQualityAvailable=!1,this._lastTime=0,this._decoded=0,this._dropped=0,this._seeked=function(){e.checkFPSInterval()}}var t=e.prototype;return t.attachMedia=function(e){var t=this._video=e instanceof window.HTMLVideoElement?e:null;t&&(this._isVideoPlaybackQualityAvailable="function"==typeof t.getVideoPlaybackQuality,t.addEventListener("seeked",this._seeked))},t.destory=function(){this._video&&this._video.removeEventListener("seeked",this._seeked)},t.reset=function(){this._lastTime=$i.now(),this._lastDroppedFrames=this._lastDecodedFrames=this._decoded=this._dropped=0;var e=this._video;if(e)try{if(this._isVideoPlaybackQualityAvailable){var t=e.getVideoPlaybackQuality();this._lastDecodedFrames=t.totalVideoFrames,this._lastDroppedFrames=t.droppedVideoFrames}else this._lastDecodedFrames=e.webkitDecodedFrameCount,this._lastDroppedFrames=e.webkitDroppedFrameCount}catch(r){return}},t.checkFPSInterval=function(){var e=this._video,t=$i.now(),r=null,i=0,n=0;if(e)if(this._isVideoPlaybackQualityAvailable){var a=e.getVideoPlaybackQuality();i=a.totalVideoFrames,n=a.droppedVideoFrames}else i=e.webkitDecodedFrameCount||0,n=e.webkitDroppedFrameCount||0;if(i){i<this._lastDecodedFrames&&(this._lastDecodedFrames=0,this._lastDroppedFrames=0);var o=t-this._lastTime,s=n-this._lastDroppedFrames,u=i-this._lastDecodedFrames,d=0,c=0;this._lastTime&&(d=parseFloat((1e3*s/o).toFixed(2)),c=parseFloat((1e3*u/o).toFixed(2))),this._decoded=this._decoded+=u,this._dropped=this._dropped+=s,this._lastTime=t,this._lastDroppedFrames=n,this._lastDecodedFrames=i,r={decoded:this._decoded,dropped:this._dropped,decodedFPS:c,droppedFPS:d}}return this._lastTime=t,r},e}();function en(){return(en=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var i in r)Object.prototype.hasOwnProperty.call(r,i)&&(e[i]=r[i])}return e}).apply(this,arguments)}function tn(e,t){for(var r=0;r<t.length;r++){var i=t[r];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}function rn(e,t,r){return t&&tn(e.prototype,t),r&&tn(e,r),e}var nn={local:0,server:0},an=function(){function e(){var e=this;this._loader=void 0,this._callback=void 0,this._loaderConfig=void 0,this._onLoaderError=function(){e._disposeLoader()},this._onLoaderEnd=function(t,r){if(e._disposeLoader(),"string"==typeof r){nn.local=performance.now();var i=r.split(",");nn.server=1e3*parseFloat(i[0])+parseInt(i[1],10)/1e3/2}},this._callback={onError:this._onLoaderError,onEnd:this._onLoaderEnd},this._loaderConfig={useFetch:!1,connectionTimeout:5e3}}e.serverMs=function(e){return nn.server?e-nn.local+nn.server:null},rn(e,null,[{key:"serverNowMs",get:function(){return nn.server?performance.now()-nn.local+nn.server:null}}]);var t=e.prototype;return t.update=function(e){e?nn={server:e,local:0}:this.load()},t.load=function(){this._disposeLoader();var e={url:"https://ntp.nc.gifshow.com/",responseType:"text"};(this._loader=new rt).load(e,this._callback,this._loaderConfig)},t.destroy=function(){this._disposeLoader()},t._disposeLoader=function(){this._loader&&this._loader.destroy()},rn(e,[{key:"time",get:function(){return en({},nn)}}]),e}();function on(e,t){for(var r=0;r<t.length;r++){var i=t[r];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}var sn=function(){function e(){this._ntp=void 0,this._media=void 0,this._priv={keyAbstMs:0,keyPtsOrignMs:0,keyDtsOrignMs:0},this._vLastFrameInfo=void 0,this._aLastFrameInfo=void 0}var t,r,i,n=e.prototype;return n.init=function(e){this._ntp=new an,an.serverNowMs||this._ntp.load(),this._media=e},n.onPrivNal=function(e){this._priv.keyAbstMs=e.abst,this._priv.keyPtsOrignMs=e.ptsOrignMs,this._priv.keyDtsOrignMs=e.timestamp},n.onParsing=function(e){var t=this;e.segments.forEach((function(e){var r=e;Array.isArray(r.framesInfo)&&(e.type===u.TrackType.VIDEO?t._vLastFrameInfo=r.framesInfo[r.framesInfo.length-1]:e.type===u.TrackType.AUDIO&&(t._aLastFrameInfo=r.framesInfo[r.framesInfo.length-1]))}))},n.destroy=function(){this._ntp&&(this._ntp.destroy(),this._ntp=void 0)},n._renderDelay=function(e){var t=an.serverNowMs,r=this._priv;if(t&&e&&this._media&&r.keyAbstMs){var i=1e3*this._media.currentTime;return e.ptsMs-i+t-(e.ptsOrignMs-r.keyPtsOrignMs+r.keyAbstMs)}return 0},t=e,i=[{key:"workerTimeOffset",set:function(t){e._workerStartMs=t}}],(r=[{key:"displayDelay",get:function(){return this._renderDelay(this._vLastFrameInfo)}},{key:"audioRenderDelay",get:function(){return this._renderDelay(this._aLastFrameInfo)}},{key:"recDelay",get:function(){var t=this._vLastFrameInfo;if(an.serverNowMs&&t&&this._media){var r=this._priv;return an.serverMs(t.parseMs+e._workerStartMs)-(t.dtsOrignMs-r.keyDtsOrignMs+r.keyAbstMs)}return 0}}])&&on(t.prototype,r),i&&on(t,i),e}();sn._workerStartMs=0;var un=sn;function dn(){return(dn=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var i in r)Object.prototype.hasOwnProperty.call(r,i)&&(e[i]=r[i])}return e}).apply(this,arguments)}var cn=function(){function e(e,t){this._data=void 0,this._config=void 0,this._snapshot=void 0,this._tickIndex=1,this._statTimestampMillis=0,this._statTimestampMillisUTC=0,this._firstScreen=!0,this._firstScreenDetails=void 0,this._firstScreenDuration=null,this._clickToFirstFrame=0,this._customeHttpHeader=void 0,this._errorCode=0,this._errorMessage="",this._data=e,this._config=t,this._tickIndex=1,this._snapshot={play:0,actualPlay:0,pause:0,buffer:0,blockCount:0,pauseCnt:0,renderBlockCount:0,seekCnt:0,seekLoadCnt:0,decodedFrames:0,droppedFrames:0,downloadedBytes:0,cdnDropFrameCnt:0,cdnDropFrameDuration:0,download:0,mseUpdate:0,mseRemove:0,segment:0,preloadCount:0},this._resetForNewInterval()}var t=e.prototype;return t._updateSnapshot=function(e){var t={};for(var r in this._snapshot)"number"==typeof e[r]&&(t[r]=e[r]-this._snapshot[r],this._snapshot[r]=e[r]);return t},t._resetForNewInterval=function(){this._statTimestampMillis=performance.now(),this._statTimestampMillisUTC=Date.now(),this._customeHttpHeader=void 0,this._firstScreenDuration=null,this._firstScreenDetails=void 0,this._errorCode=0,this._errorMessage=""},t.setFirstScreenDuration=function(e,t,r){this._firstScreenDuration=Math.round(e),this._firstScreenDetails=t,this._firstScreen=!0,this._clickToFirstFrame=r},t.setCustomHeader=function(e){void 0===this._customeHttpHeader&&(this._customeHttpHeader=se(e)||null)},t.setError=function(e,t){this._errorCode=e,this._errorMessage=t},t.buildAndStartNewInterval=function(){var e=this._data,t=this._config,r=this._updateSnapshot(e),i=this._updateSnapshot(zi(this._data)),n=performance.now(),a={skip_cnt:r.cdnDropFrameCnt,skip_duration:r.cdnDropFrameDuration,v_rec_delay:e.recDelay||0,v_render_delay:e.displayDelay||0,a_render_delay:e.audioRenderDelay||0},o={load_count:r.download,seek_cnt:r.seekCnt,seek_load_cnt:r.seekLoadCnt,pause_duration:i.pause,pause_cnt:r.pauseCnt,preload_cnt:r.preloadCount},s={tick_index:this._tickIndex,tick_start:this._statTimestampMillisUTC,tick_duration:Math.round(n-this._statTimestampMillis),domain:new Ct.a(e.url).host,error_code:this._errorCode,error_message:this._errorMessage,kernel_version:e.version,session_id:e.sessionId,play_url:e.url,load_start_time:e.loadStartTime||0,play_start_time:e.playStartTime||0,adaptive_multi_rate:e.abrNow?1:0,max_bitrate:e.maxBitrate||0,avg_bitrate:e.avgBitrate||0,protocol:e.protocol,stream_duration:e.streamDuration||0,reuse:e.reuse,kbytes_received:r.downloadedBytes>>10,block_count:r.blockCount||0,render_block_count:r.renderBlockCount||0,decoded_video_frames:r.decodedFrames||0,dropped_video_frames:r.droppedFrames||0,segment_count:r.segment||0,play_duration:i.play||0,buffer_time:i.buffer||0,actual_play_duration:i.actualPlay||0,played_video_duration:i.play||0,a_buf_start:e.aBufStart||0,a_buf_end:e.aBufEnd||0,a_buf_len:e.aBufLen||0,a_buf_slices:e.aBufCount||0,v_buf_start:e.vBufStart||0,v_buf_end:e.vBufEnd||0,v_buf_len:e.vBufLen||0,v_buf_slices:e.vBufCount||0,play_pos:e.playPos||0,v_data_rate:e.vDataRate||0,a_data_rate:e.aDataRate||0,buffer_queue_count:e.bufferQueueCount||0,hidden:Yi()?1:0,v_ready_state:e.videoReadyState};return e.mse&&(s.mse_update_count=r.mseUpdate||0,s.mse_remove_count=r.mseRemove||0),this._firstScreen&&(null===this._firstScreenDuration?s.first_screen_total_duration=0:(s.first_screen_total_duration=this._firstScreenDuration,s.first_screen_details=this._firstScreenDetails,"hls"===t.box&&(s.preload_hit=e.preloadHit,s.preload_cache_hit=e.preloadCacheHit,s.preload_cache_fail=e.preloadCacheFail),this._firstScreenDetails=null,this._firstScreenDuration=null,this._firstScreen=!1)),"number"==typeof this._clickToFirstFrame&&e.playStartTime&&(s.click_to_first_frame=this._clickToFirstFrame,this._clickToFirstFrame>0&&(this._clickToFirstFrame=void 0)),this._customeHttpHeader&&(s.custom_http_header=this._customeHttpHeader),e.qualityType&&(s.quality_type=e.qualityType),e.qualityLabel&&(s.quality_label=e.qualityLabel),e.avgBitrate&&(s.avg_bitrate=e.avgBitrate),"flv"===t.box?dn(s,a):dn(s,o),this._resetForNewInterval(),this._tickIndex++,s},e}();function ln(){return(ln=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var i in r)Object.prototype.hasOwnProperty.call(r,i)&&(e[i]=r[i])}return e}).apply(this,arguments)}function fn(e,t){for(var r=0;r<t.length;r++){var i=t[r];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}var _n,hn,pn=function(){function e(){this._qos=void 0,this._rtcClosedStreamTraffic=0,this.reset()}var t,r,i,n=e.prototype;return n.reset=function(){this._qos={traffic:0,streams:[],download:[]},this._rtcClosedStreamTraffic=0},n.onKeyFrame=function(){this._qos.streams[this._qos.streams.length-1].keyFrame++},n.onStreamOpen=function(e,t,r,i,n){var a=this.loadingInfo;a&&(this._rtcClosedStreamTraffic+=a.traffic),this._qos.streams.length>10&&this._qos.streams.shift(),this._qos.streams.push({protocol:n,index:e,startPos:t,url:r,bitrate:i,traffic:0,loadTimeCost:0,keyFrame:0,videoDataRate:0,audioDataRate:0,speed:0,segments:{}})},n.setRTCStats=function(e){var t=this.loadingInfo;t&&(t.traffic=e.totalReceive,t.audioDataRate=e.audioDataRate,t.videoDataRate=e.videoDataRate,t.speed=e.speed,t.keyFrame=e.key,this._qos.traffic=t.traffic+this._rtcClosedStreamTraffic)},n.onMediaInfo=function(e){var t=this.loadingInfo;t&&(t.mediaInfo=ln({},e))},n.onDataReceive=function(e){this._qos.traffic+=e.byteLength;var t=this._qos.download;t.length>200&&t.pop(),t.unshift(e);var r=this._qos.streams[this._qos.streams.length-1];r.traffic+=e.byteLength,r.loadTimeCost+=e.timeCost},n.onMediaSegment=function(e){var t=this._qos,r=t.streams[t.streams.length-1],i=r.segments[e.type]||[];r.segments[e.type]=i,i.push({duration:1e3*(e.endDTS-e.startDTS),dts:1e3*e.startDTS,len:e.payload.byteLength}),i.length>100&&i.shift();for(var n=0,a=0,o=0;o<i.length;o++)a+=i[o].len,n+=i[o].duration;n>0&&(e.type===u.TrackType.VIDEO?r.videoDataRate=Math.round(8*a/n):e.type===u.TrackType.AUDIO&&(r.audioDataRate=Math.round(8*a/n)))},n.getInfoByTime=function(e){for(var t=this._qos.streams.length-1;t>=0;t--)if(this._qos.streams[t].startPos<e)return this._qos.streams[t];return null},n.updateStartPos=function(e){this._qos.streams.length&&(this._qos.streams[this._qos.streams.length-1].startPos=e)},t=e,(r=[{key:"loadingInfo",get:function(){return this._qos.streams.length?this._qos.streams[this._qos.streams.length-1]:null}},{key:"downloadSpeed",get:function(){var e=this.loadingInfo;if(e){if(e.protocol!==u.Protocol.KWAI_WEBRTC){for(var t=this._qos,r=performance.now(),i=0,n=0,a=0;a<t.download.length&&t.download[a].ts>r-1e3;a++)i+=t.download[a].byteLength,n+=t.download[a].timeCost;e.speed=Math.round(i/n*1e3)||0}return e.speed}return 0}},{key:"mediaInfo",get:function(){return this._qos.streams.length?this._qos.streams[this._qos.streams.length-1].mediaInfo:null}},{key:"videoDataRate",get:function(){return this._qos.streams.length?this._qos.streams[this._qos.streams.length-1].videoDataRate:0}},{key:"audioDataRate",get:function(){return this._qos.streams.length?this._qos.streams[this._qos.streams.length-1].audioDataRate:0}},{key:"bitrate",get:function(){return this._qos.streams.length?this._qos.streams[this._qos.streams.length-1].bitrate:0}},{key:"traffic",get:function(){return this._qos.traffic}},{key:"data",get:function(){return this._qos}}])&&fn(t.prototype,r),i&&fn(t,i),e}();function vn(){return(vn=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var i in r)Object.prototype.hasOwnProperty.call(r,i)&&(e[i]=r[i])}return e}).apply(this,arguments)}function mn(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,i)}return r}function gn(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?mn(Object(r),!0).forEach((function(t){yn(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):mn(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}function yn(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function En(e,t){for(var r=0;r<t.length;r++){var i=t[r];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}(hn=_n||(_n={})).NORMEL="normal",hn.SEEK="seek",hn.END="end",hn.LEVEL_SWITCH="levelSwitch";var Sn=function(e){var t,r;function i(t,r,i){var n;return(n=e.call(this)||this)._version=void 0,n._config=void 0,n._beaconTimer=void 0,n._runningStartTime=void 0,n._media=void 0,n._fps=void 0,n._firstFrame=void 0,n._data=void 0,n._realtimeBeacon=void 0,n._firstLoadTime=0,n._hiddenStart=!1,n._playing=!1,n._seeking=!1,n._sm=void 0,n._seekLoadFlag=!1,n._liveDelay=void 0,n._waitingTrigger=u.WaitingTrigger.NATIVE,n._seekingThrottle=null,n._seekedDebounce=null,n._onOnlineChange=function(){n.triggerEventReport(Bi.NETWORK_CHANGE,{online:void 0!==navigator.onLine?navigator.onLine?1:0:null})},n._sendRealtimeBeacon=function(e){void 0===e&&(e=_n.NORMEL);var t=n._getRealtimeBeacon();t&&(t.type=e,n._config.isLive||(t.seek_record=n._data.seekRecord.slice(0),n._data.seekRecord=[]),n.emit(k.default.REPORT,{type:M,value:t}))},n._version=t,n._config=i,n._beaconTimer=null,n._runningStartTime=performance.now(),n._firstFrame=new Ji(function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(n),r),n._sm=new pn,n._media=r,r.video&&(n._fps=new Zi,n._fps.attachMedia(r.video)),i.isLive&&i.box===u.MediaBox.flv&&i.ntp&&(n._liveDelay=new un,n._liveDelay.init(r)),n.reset(),window.addEventListener("online",n._onOnlineChange),window.addEventListener("offline",n._onOnlineChange),n}r=e,(t=i).prototype=Object.create(r.prototype),t.prototype.constructor=t,t.__proto__=r;var n,a,o,s=i.prototype;return s.reset=function(e){void 0===e&&(e=!1),this._playing=!1,this._seeking=!1,this._seekLoadFlag=!1,this._seekedDebounce&&clearTimeout(this._seekedDebounce),this._seekingThrottle&&clearTimeout(this._seekingThrottle),this._data={version:this._version,decodedFPS:0,droppedFPS:0,decodedFrames:0,droppedFrames:0,sessionId:Ki(),startTime:performance.now(),loadStartTime:0,playStartTime:0,playDuration:0,actualPlayDuration:0,pauseDuration:0,pauseCnt:0,bufferTime:0,blockCount:0,renderBlockCount:0,streamDuration:0,seekCnt:0,seekDuration:0,seekLoadCnt:0,seekLoadDuration:0,seekStartTime:0,recoverMedia:0,retry:0,urlId:0,url:"",unknownTSPacketCount:0,audioNonMonotonous:0,startBitrate:0,smoothBitrate:-1,useBackup:0,abrLowProfile:0,abr:!1,mseBufferFull:0,aacOverhead:0,protocol:u.Protocol.UNKNOWN,errorCode:0,errorMessage:"",maxBitrate:0,downloadedBytes:0,cdnDropFrameCnt:0,cdnDropFrameDuration:0,download:0,mseUpdate:0,segment:0,mseRemove:0,preloadHit:0,preloadCount:0,preloadCacheHit:0,preloadCacheFail:0,reuse:0,videoReadyState:0,playPos:0,seekRecord:[],codecs:"",mse:!1,aBufStart:0,aBufEnd:0,aBufLen:0,aBufCount:0,vBufStart:0,vBufEnd:0,vBufLen:0,vBufCount:0,aDataRate:0,vDataRate:0,bufferQueueCount:0,firstScreenTotalDuration:0,clickToFirstFrame:0},c.Log.i("monitor","reset",this._data.sessionId),this._data.reuse=e?1:0,this._sm.reset(),this._fps&&this._fps.reset(),this._refreshFPS()},s.onLoaderChunkArrival=function(e){e.ts=e.ts||performance.now(),this._data.downloadedBytes+=e.byteLength,this._sm.onDataReceive(e),this._realtimeBeacon&&this._realtimeBeacon.setCustomHeader(e.header),this._processFirstFrame(ji.DATA,e.ts)},s.onMediaDemux=function(e){this._data.demuxer=e.type,this._processFirstFrame(ji.DEMUX,performance.now())},s.onKeyFrame=function(){this._sm.onKeyFrame()},s.onMuxInfo=function(e){var t=this._data;t.unknownTSPacketCount=t.unknownTSPacketCount||e.unknownTSPacketCount||0,t.audioNonMonotonous=t.audioNonMonotonous||e.audioNonMonotonous||0,t.aacOverhead=t.aacOverhead||e.aacOverhead||0},s.onLostFrame=function(e){this._data.cdnDropFrameCnt++,this._data.cdnDropFrameDuration+=Math.round(e.drop)},s.onUseBackup=function(){this._data.useBackup=1},s.onAbrInfo=function(e){this._data.abrLowProfile=e.lowProfile},s.onNewSource=function(e,t){if(t){var r=this._data;r.urlId=t.urlId,r.url=t.url[t.urlId],this._sm.onStreamOpen(e.index||0,e.sync,r.url,t.bitrate,r.protocol),r.level=e.index,r.maxBitrate=t.maxBitrate,r.avgBitrate=t.avgBitrate,r.qualityType=t.qualityType,r.qualityLabel=t.qualityLabel,r.protocol===u.Protocol.UNKNOWN&&(this._config.box===u.MediaBox.native?r.protocol=u.Protocol.NATIVE:this._config.box===u.MediaBox.hls?r.protocol=u.Protocol.HLS:this._config.box===u.MediaBox.flv?r.protocol=u.Protocol.FLV:this._config.box===u.MediaBox.mp4&&(r.protocol=u.Protocol.MP4))}},s.onDiscontinuity=function(e){this.emit(k.default.REPORT,{type:U,value:e})},s.onDownload=function(e){var t=this,r=this._data;if(e.cacheHit)e.preload||(r.preloadCacheHit=1);else{r.preloadCacheFail=e.cacheFail?1:0,e.errorCode&&!this._firstFrame.complete&&this._firstFrame.onError(),r.download++;var i=function(e){var t;return"flv"===e.resourceType?t={domain:new Ct.a(e.url).host,downloaded_size:e.byteLength,error_code:e.errorCode,load_status:e.status,network_cost:Math.round(e.spendTime),resource_type:"flv",total_size:e.byteLength,url:e.url}:(t={download_url:e.url,domain:new Ct.a(e.url).host,download_start_time:e.startTime,download_spend_time:Math.round(e.spendTime),download_status:e.status,http_status_code:e.httpStatusCode,retry_index:e.retry,error_code:e.errorCode,error_message:e.errorMessage,loader_id:e.loaderId,download_size:e.byteLength,resource_type:e.resourceType,preload:e.preload?1:0},e.slice&&(t.hls_slice_bytes=e.byteLength,t.hls_slice_play_start_time=e.slicePlayStartTime,t.hls_slice_play_duration=e.slicePlayDuration,t.hls_slice_index=e.sliceIndex,e.sliceLevelIndex&&(t.hls_slice_level_index=e.sliceLevelIndex)),e.qualityType&&(t.quality_type=e.qualityType),"number"==typeof e.rangeStart&&(t.range_start=e.rangeStart),e.rangeEnd&&(t.range_end=e.rangeEnd)),e.httpResponseTime&&(t.http_response_time=e.httpResponseTime),e.customHeader&&(t.custom_http_header=e.customHeader),void 0!==e.redirect&&(t.time_redirect=Math.round(e.redirect)),void 0!==e.dns&&(t.time_dns=Math.round(e.dns)),void 0!==e.tcp&&(t.time_tcp=Math.round(e.tcp)),void 0!==e.request&&(t.time_request=Math.round(e.request)),void 0!==e.firstResponse&&(t.time_first_response=Math.round(e.firstResponse)),void 0!==e.response&&(t.time_response=Math.round(e.response)),e.duration&&(t.duration=Math.round(e.duration)),t}(e);i.session_id=r.sessionId,i.kernel_version=this._version,i.load_start_time=r.loadStartTime||0,i.protocol=r.protocol,i.use_backup=r.useBackup,i.first_screen=r.firstScreenTotalDuration?1:0,1009===e.errorCode?setTimeout((function(){t.emit(k.default.REPORT,{type:N,value:i})}),0):this.emit(k.default.REPORT,{type:N,value:i})}},s.heartbeat=function(e){var t=this._data;this._refreshFPS();var r={},i=this._sm;e&&i.setRTCStats(e),r=t.mse||t.protocol===u.Protocol.KWAI_WEBRTC?{totalReceive:i.traffic,speed:i.downloadSpeed,videoDataRate:i.videoDataRate,audioDataRate:i.audioDataRate,videoBuffered:Math.round(1e3*this._media.bufferedSecByType(u.TrackType.VIDEO)),audioBuffered:Math.round(1e3*this._media.bufferedSecByType(u.TrackType.AUDIO))}:{videoBuffered:Math.round(1e3*this._media.bufferedSec()),audioBuffered:Math.round(1e3*this._media.bufferedSec())},this._refreshDelay(),r.decodedFPS=t.decodedFPS,r.droppedFPS=t.droppedFPS,r.decodedFrames=t.decodedFrames,r.droppedFrames=t.droppedFrames,e&&(r.audioAvgJitterBufferDelay=e.audioAvgJitterBufferDelay,r.videoAvgJitterBufferDelay=e.videoAvgJitterBufferDelay,r.audioPacketsLost=e.audioPacketsLost,r.videoPacketsLost=e.videoPacketsLost),t.displayDelay&&(r.displayDelay=t.displayDelay,r.recDelay=t.recDelay),this.emit(k.default.REPORT,{type:O,value:r})},s._refreshFPS=function(){var e;this._fps&&(e=this._fps.checkFPSInterval());var t=this._data;e?(t.decodedFPS=e.decodedFPS,t.droppedFPS=e.droppedFPS,t.droppedFrames=e.dropped,t.decodedFrames=e.decoded):t.decodedFPS=t.droppedFPS=t.droppedFrames=t.decodedFrames=0},s.destroy=function(){this.triggerEventReport(Bi.DESTORY),this._sendRealtimeBeacon(_n.END),this._stopBeaconTimer(),this._fps&&(this._fps.destory(),this._fps=void 0),window.removeEventListener("online",this._onOnlineChange),window.removeEventListener("offline",this._onOnlineChange),this._seekedDebounce&&clearTimeout(this._seekedDebounce),this._seekingThrottle&&clearTimeout(this._seekingThrottle),this._liveDelay&&this._liveDelay.destroy()},s.onPreloadHit=function(e){this._data.preloadHit=1,this._onLoad(e,1)},s.onPreload=function(){this._data.preloadCount++},s.onLoad=function(e,t){void 0===t&&(t=!1);var r="string"==typeof e?e:"";t?(this._firstFrame.complete||this._firstFrame.start(Vi.FIRST_FRAME),this._data.errorCode=0,this._data.errorMessage=""):this._onLoad(r)},s.onStopLoad=function(){this._sendRealtimeBeacon(_n.END),this._stopBeaconTimer(),this._waitingEnd(),this._config.isLive&&this.triggerEventReport(Bi.LIVE_STOP)},s.onManifest=function(e,t){t&&(this._data.url=t.url[t.urlId],this._data.protocol=e.protocol,this._data.drm=e.drm,this._data.startBitrate||(this._data.startBitrate=t.bitrate),this._data.abrNow=this._data.abr=this._data.abr||e.auto),this._processFirstFrame(ji.MANIFEST)},s.onLevel=function(e){void 0===e&&(e=0),this._processFirstFrame(ji.LEVEL,e)},s.onAudioTrack=function(){},s.onSegmentInit=function(e){var t=[];e.videoCodec&&t.push(e.videoCodec),e.audioCodec&&t.push(e.audioCodec),this._data.codecs=t.join(","),e.sid=this._data.sessionId,e.streamHost||(e.streamHost=new Ct.a(this._data.url).host),this._sm.onMediaInfo(e),this.emit(k.default.REPORT,{type:w,value:e})},s.onSegment=function(e){var t=this;this._liveDelay&&this._liveDelay.onParsing(e),e.segments.forEach((function(e){t._sm.onMediaSegment(e)})),this._processFirstFrame(ji.SEGMENT),this._data.segment++},s.onPrivNal=function(e){this._liveDelay&&this._liveDelay.onPrivNal(e)},s.onPlay=function(){this._data.playStartTime||(this._data.playStartTime=Date.now()),this._startBeaconTimer()},s.onLoadeddata=function(){this._processFirstFrame(ji.LOADEDDATA),this._waitingEnd()},s.onCanplay=function(){this._processFirstFrame(ji.CANPLAY),d.default.safari&&!this._data.mse||this._waitingEnd()},s.onPlaying=function(){this._playing||(this._playing=!0,this.triggerEventReport(Bi.PLAY)),this._playStart(),this._pauseEnd(),this._waitingEnd()},s.onPause=function(){var e;null!=(e=this._media.video)&&e.seeking||!this._playing||(this._playEnd(),this._pauseStart(),this.triggerEventReport(Bi.PAUSE),this._playing=!1)},s.onEnd=function(){this._playing=!1,this._playEnd(),this._pauseEnd(),this._waitingEnd(),this._sendRealtimeBeacon(_n.END),this._stopBeaconTimer(),this.triggerEventReport(Bi.END)},s.onWaiting=function(e,t){this._data.playPos=Math.round(1e3*this._media.currentTime),this._playing&&this._firstFrame.complete&&e&&(this._waitingStart(t),this.triggerEventReport(Bi.BLOCK_START))},s.mseOpen=function(){this._data.mse=!0,this._media&&this._media.video&&!this._media.video.paused&&this.onPlay()},s.mseUpdate=function(){this._data.mseUpdate++},s.mseRemove=function(){this._data.mseRemove++},s.onSeek=function(e){var t,r,i=this;void 0===e&&(e=!1),this._data.seekRecord.push({from:this._data.playPos,to:Math.round(1e3*this._media.currentTime),time:Date.now()}),this._data.seekRecord.length>50&&this._data.seekRecord.shift(),this._config.isLive||e||(this._data.seekStartTime=performance.now(),this._seeking?!this._seekingThrottle&&this._seeking&&(this._seekingThrottle=+setTimeout((function(e){var t,r;i.triggerEventReport(Bi.SEEK_START,{paused:null==(t=i._media.video)?void 0:t.paused,seeking:null==(r=i._media.video)?void 0:r.seeking,position:e}),i._seekingThrottle=null}),500,this._data.playPos/1e3)):(this.triggerEventReport(Bi.SEEK_START,{paused:null==(t=this._media.video)?void 0:t.paused,seeking:null==(r=this._media.video)?void 0:r.seeking,position:this._data.playPos/1e3}),this._seeking=!0))},s.onSeekWithLoad=function(e){this._sendRealtimeBeacon(_n.SEEK),this._resetBeaconTimer(),this._firstFrame.start(Vi.FIRST_FRAME_SEEK),this._sm.updateStartPos(e),this._seekLoadFlag=!0},s.onSeeked=function(){var e=this;if(this._data.seekStartTime){var t;this._data.seekCnt++;var r=Math.round(performance.now()-this._data.seekStartTime);this._data.seekDuration+=r,this._data.seekStartTime=0,this._seekLoadFlag&&(this._data.seekLoadCnt++,this._data.seekLoadDuration+=r),this._seekedDebounce&&clearTimeout(this._seekedDebounce),this._seekedDebounce=+setTimeout((function(t){var r,i,n;null!=(r=e._media.video)&&r.seeking||(e._seeking=!1,e.triggerEventReport(Bi.SEEK_END,{paused:null==(i=e._media.video)?void 0:i.paused,seeking:null==(n=e._media.video)?void 0:n.seeking,position:t}))}),500,null==(t=this._media.video)?void 0:t.currentTime)}this._seekLoadFlag=!1,this._firstFrame.complete||this._data.mse||!d.default.safari&&!d.default.msie||this._firstFrame.process(ji.SEEKED)},s.onMSEBufferFull=function(){this._data.mseBufferFull++},s.onTimeupdate=function(){var e=Math.round(1e3*this._media.currentTime);d.default.msie&&!this._data.mse&&this._data.bufferingStartMS&&this._data.playPos!==e&&this.onPlaying(),this._data.playPos=e},s.onProgress=function(){var e;d.default.safari&&!this._data.mse&&this._data.bufferingStartMS&&4===(null==(e=this._media.video)?void 0:e.readyState)&&this._waitingEnd()},s.mediaCapabilities=function(e){this._data.smoothBitrate=e},s.levelSwitching=function(e,t){t&&(this._data.url=t.url[t.urlId],this._data.abrNow=e.auto,this._data.abr=this._data.abr||e.auto,this.triggerEventReport(Bi.QUALITY_CHANGE,{quality_type:t.qualityType,trigger_mode:e.auto?"abr":"user",play_url:this._data.url,is_smooth:e.isSmooth?1:0}))},s.levelSwitched=function(){this.triggerEventReport(Bi.QUALITY_CHANGE_DATA)},s.levelSwitchPlaying=function(){this.triggerEventReport(Bi.QUALITY_CHANGE_RENDER)},s.onAudioSwitching=function(){},s.onAudioSwitched=function(){},s.onRetry=function(e){this._data.retry++,e.type===u.RetryType.CODEC&&this._data.recoverMedia++,this.triggerEventReport(Bi.RETRY,{retry_type:e.type,retry_message:e.message})},s.selectBitrate=function(){this._sendRealtimeBeacon(_n.LEVEL_SWITCH),this._resetBeaconTimer(),this._firstFrame.start(Vi.FIRST_FRAME_SELECT_BITRATE)},s.onMetaData=function(e){this.emit(k.default.REPORT,{type:D,value:e}),this.triggerEventReport(Bi.METADATA_LOAD,gn({},e))},s.triggerEventReport=function(e,t){this.emit("report",{type:"event",value:gn({type:e,position:this._media.currentTime,session_id:this.sid},t)})},s.onDurationChange=function(e){this._data.streamDuration=Math.round(1e3*e)},s.onRateChange=function(e){var t;null!=(t=this._media.video)&&t.seeking||this.triggerEventReport(Bi.SPEED_CHANGE,{speed:e})},s.onError=function(e,t){this.triggerEventReport(Bi.ERROR,{error_message:t,error_type:e}),this._data.errorCode=e,this._data.errorMessage=t,this._realtimeBeacon&&this._realtimeBeacon.setError(e,t),this._playEnd(),this._pauseEnd(),this._waitingEnd()},s._getRealtimeBeacon=function(){return this._realtimeBeacon?(this._refreshRealtime(),this._refreshDelay(),this._refreshFPS(),this._realtimeBeacon.buildAndStartNewInterval()):null},s._processFirstFrame=function(e,t){void 0===t&&(t=0),!this._firstFrame.complete&&this._firstFrame.process(e,t)&&this._onFirstFrame()},s._playStart=function(){this._data.playStartMS=this._data.playStartMS||performance.now(),this._data.actualPlayStartMS=this._data.actualPlayStartMS||performance.now()},s._playEnd=function(){this._data.playStartMS&&(this._data.playDuration+=performance.now()-this._data.playStartMS),this._data.actualPlayStartMS&&(this._data.actualPlayDuration+=performance.now()-this._data.actualPlayStartMS),this._data.playStartMS=void 0,this._data.actualPlayStartMS=void 0},s._pauseStart=function(){this._data.pauseCnt++,this._data.pauseStartMS=this._data.pauseStartMS||performance.now()},s._pauseEnd=function(){this._data.pauseStartMS&&(this._data.pauseDuration+=performance.now()-this._data.pauseStartMS),this._data.pauseStartMS=void 0},s._waitingStart=function(e){this._data.bufferingStartMS||(this._data.blockCount++,this._data.bufferingStartMS=performance.now(),e>.6&&this._data.renderBlockCount++),this._data.actualPlayStartMS&&(this._data.actualPlayDuration+=performance.now()-this._data.actualPlayStartMS),this._data.actualPlayStartMS=void 0},s._waitingEnd=function(){this._data.bufferingStartMS&&(this._data.bufferTime+=performance.now()-this._data.bufferingStartMS,this._data.bufferingStartMS=void 0,this.triggerEventReport(Bi.BLOCK_END))},s._onFirstFrame=function(){var e,t,r,i,n,a,o,s,u,d,c=this._data;c.firstScreenTotalDuration=c.firstScreenTotalDuration||Math.round(this._firstFrame.duration),c.firstScreenDetails=c.firstScreenDetails||this._firstFrame.details,this.triggerEventReport(Bi.FIRST_SCREEN_RENDER,{initial_rate:Math.round(this._sm.videoDataRate),inital_quality_type:this._data.qualityType,fps:null==(e=this.loadingInfo)||null==(t=e.mediaInfo)?void 0:t.fps,a_codec:null==(r=this.loadingInfo)||null==(i=r.mediaInfo)?void 0:i.audioCodec,v_codec:null==(n=this.loadingInfo)||null==(a=n.mediaInfo)?void 0:a.videoCodec,channels:null==(o=this.loadingInfo)||null==(s=o.mediaInfo)?void 0:s.channelCount,sample_rate:null==(u=this.loadingInfo)||null==(d=u.mediaInfo)?void 0:d.audioSampleRate}),c.playStartTime&&this._firstFrame.complete?c.clickToFirstFrame=c.clickToFirstFrame||Math.max(1,this._firstFrame.complete-c.playStartTime):c.clickToFirstFrame=1,this._realtimeBeacon&&this._realtimeBeacon.setFirstScreenDuration(this._firstFrame.duration,this._firstFrame.details,c.clickToFirstFrame),this._media.video&&!this._media.video.paused&&this._firstFrame.type===Vi.FIRST_FRAME&&this._playStart()},s._startBeaconTimer=function(){null===this._beaconTimer&&(this._beaconTimer=setInterval(this._sendRealtimeBeacon,1e4))},s._stopBeaconTimer=function(){this._beaconTimer&&(clearTimeout(this._beaconTimer),this._beaconTimer=null)},s._resetBeaconTimer=function(){this._stopBeaconTimer(),this._startBeaconTimer()},s._refreshDelay=function(){var e=this._liveDelay,t=this._data;e&&(t.displayDelay=Math.round(e.displayDelay),t.recDelay=Math.round(e.recDelay),t.audioRenderDelay=Math.round(e.audioRenderDelay))},s._refreshRealtime=function(){var e,t,r=this._sm,i=this._media,n=i.currentTime;i.mse?(e=i.mseBufferedSecByType(u.TrackType.VIDEO),t=i.mseBufferedSecByType(u.TrackType.AUDIO)):e=t=i.mediaBufferedSec();var a=this._data;a.aBufStart=Math.round(1e3*t.start),a.aBufEnd=Math.round(1e3*t.end),a.aBufLen=Math.round(1e3*Math.max(0,t.end-n)),a.aBufCount=i.mse?i.bufferSliceNumByType(u.TrackType.AUDIO):i.bufferSliceNum(),a.vBufStart=Math.round(1e3*e.start),a.vBufEnd=Math.round(1e3*e.end),a.vBufLen=Math.round(1e3*Math.max(0,e.end-n)),a.vBufCount=i.mse?i.bufferSliceNumByType(u.TrackType.VIDEO):i.bufferSliceNum(),a.aDataRate=Math.round(r.audioDataRate),a.vDataRate=Math.round(r.videoDataRate),a.bufferQueueCount=i.pendingNum(),a.videoReadyState=i.videoReadyState},s._onLoad=function(e,t){void 0===t&&(t=0),this.triggerEventReport(Bi.LOAD,{url:e,protocol:this._config.box,initial_speed:String(this._media.video&&this._media.video.playbackRate),hit_preload:t}),this._data.loadStartTime=Date.now(),this._firstFrame.start(Vi.FIRST_FRAME),this._firstLoadTime||(this._firstLoadTime=performance.now(),this._hiddenStart=Yi()),this._data.url=e,this._stopBeaconTimer(),this._realtimeBeacon=new cn(this._data,this._config)},n=i,(a=[{key:"runningStartTime",get:function(){return this._runningStartTime}},{key:"firstFrameLoaded",get:function(){return!!this._firstFrame.complete}},{key:"sid",get:function(){return this._data.sessionId}},{key:"playingInfo",get:function(){return this._sm.getInfoByTime(this._media.currentTime)}},{key:"loadingInfo",get:function(){return this._sm.loadingInfo}},{key:"snapshot",get:function(){var e=this._sm;return vn({downloadSpeed:e.downloadSpeed,videoDataRate:e.videoDataRate,audioDataRate:e.audioDataRate},this._data,e.data)}},{key:"data",get:function(){return this._data}},{key:"audienceStat",get:function(){var e=this._data,t=this._sm,r=zi(e),i={session_id:e.sessionId,kernel_version:this._version,load_start_time:e.loadStartTime,play_start_time:e.playStartTime,play_duration:r.play,actual_play_duration:r.actualPlay,traffic:t.traffic>>10,buffer_time:r.buffer,block_cnt:e.blockCount,render_block_cnt:e.renderBlockCount,stream_duration:e.streamDuration,play_url:e.url,stream_host:new Ct.a(e.url).host,click_to_first_frame:e.playStartTime&&e.clickToFirstFrame||0,first_screen_total_duration:Math.round(e.firstScreenTotalDuration)||0,first_screen_details:e.firstScreenDetails||this._firstFrame.details||null,error_code:e.errorCode||0,error_message:e.errorMessage||"",remux_process_type:(this._config.streamingMux?1:0)+(this._config.gopRemux?1:0),hidden_start:this._hiddenStart?1:0,adaptive_multi_rate:this._config.adaptive?1:0,current_running_time:Math.round(performance.now()-e.startTime),running_time:Math.round(performance.now()-this._runningStartTime),codec:e.codecs,recover_media:e.recoverMedia,protocol:e.protocol,smooth_bitrate:e.smoothBitrate,start_bitrate:e.startBitrate||0,use_backup:e.useBackup,abr:e.abr?1:0,abr_low_profile:e.abrLowProfile,max_bitrate:e.maxBitrate,reuse:e.reuse,play_pos:Math.round(1e3*this._media.currentTime),pause_cnt:e.pauseCnt,waiting_trigger:this._waitingTrigger,support_h265_mse:dt(u.CodecType.h265),support_av1_mse:dt(u.CodecType.av1),preload_hit:e.preloadHit,preload_cnt:e.preloadCount,drm:e.drm?1:0,demuxer:e.demuxer||Zt.DemuxerType.UNKNOWN};return e.mse&&(i.mse_buffer_full=e.mseBufferFull,i.mse_remove=e.mseRemove),this._config.isLive?(i.skip_cnt=e.cdnDropFrameCnt,i.skip_duration=e.cdnDropFrameDuration,i.retry=e.retry):(i.pause_duration=r.pause,i.seek_cnt=e.seekCnt,i.seek_duration=e.seekDuration,i.seek_load_cnt=e.seekLoadCnt,i.seek_load_duration=e.seekLoadDuration,i.start_sec=Math.round(this._config.startFromSec)),this._config.box===u.MediaBox.hls&&(i.url_id=e.urlId,i.unknown_ts_packet_count=e.unknownTSPacketCount,i.audio_non_monotonous=e.audioNonMonotonous,i.aac_overhead=e.aacOverhead,i.preload_cache_hit=e.preloadCacheHit,i.preload_cache_fail=e.preloadCacheFail,i.db_quota_exceeded=0),e.qualityType&&(i.quality_type=e.qualityType),e.qualityLabel&&(i.quality_label=e.qualityLabel),e.avgBitrate&&(i.avg_bitrate=e.avgBitrate),i}},{key:"waitTrigger",set:function(e){this._waitingTrigger=e}}])&&En(n.prototype,a),o&&En(n,o),i}(a.EventEmitter);function Tn(e,t){for(var r=0;r<t.length;r++){var i=t[r];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}function bn(e,t,r){return t&&Tn(e.prototype,t),r&&Tn(e,r),e}var Ln="kernel",An=function(e){var t,r;function i(t,r){var n,a;return(n=e.call(this)||this)._config=void 0,n._video=void 0,n._media=void 0,n._monitor=void 0,n._error=void 0,n._kernel=void 0,n._video=t,n.off||(n.off=n.removeListener),n._config=v.processConfig(r),n._config?i.isSupport(n._config)||setTimeout((function(){n._onError({type:I.ErrorTypes.OTHER_ERROR,details:I.ErrorDetails.UNSUPPORTED,fatal:!0,reason:"unsupported"})}),0):setTimeout((function(){n._onError({type:I.ErrorTypes.OTHER_ERROR,details:I.ErrorDetails.CONFIG_ERROR,fatal:!0,reason:"config data error"})}),0),r.webWorker&&H.prepareWorker(),n._parseUrlConfig(),n._media=new x(n._video),n._monitor=n._initLogger(),n._kernel=n._initKernel(),n._config.box===u.MediaBox.hls&&n._config.resourceBuffer&&(a=n._config.resourceBufferSize,performance&&("function"==typeof performance.setResourceTimingBufferSize?performance.setResourceTimingBufferSize(a):"function"==typeof performance.webkitSetResourceTimingBufferSize&&performance.webkitSetResourceTimingBufferSize(a)),performance.onresourcetimingbufferfull=ue),c.Log.i(Ln,i.version,r,n._config),n}r=e,(t=i).prototype=Object.create(r.prototype),t.prototype.constructor=t,t.__proto__=r,i.isSupport=function(e){if(u.MediaBox.webrtc===(null==e?void 0:e.box))return"RTCPeerConnection"in window;var t=function(e){void 0===e&&(e=u.CodecType.h264);var t=window.SourceBuffer||window.WebKitSourceBuffer,r=dt(e),i=!t||t.prototype&&"function"==typeof t.prototype.appendBuffer&&"function"==typeof t.prototype.remove;return r&&i}(),r=!0;e&&(r=e.isLive&&e.box===u.MediaBox.flv);var i=v.isStreamingSupport(e);return t&&!(r&&!i)},bn(i,null,[{key:"version",get:function(){return"3.0.7"}},{key:"MediaBox",get:function(){return u.MediaBox}},{key:"Events",get:function(){return{REPORT:k.default.REPORT,ERROR:k.default.ERROR,LEVEL_SWITCHING:k.default.LEVEL_SWITCHING,LEVEL_SWITCHED:k.default.LEVEL_SWITCHED,LEVEL_SWITCH_PLAYING:k.default.LEVEL_SWITCH_PLAYING,LEVEL_SWITCH_FAILED:k.default.LEVEL_SWITCH_FAILED,AUDIO_TRACK_SWITCHING:k.default.AUDIO_TRACK_SWITCHING,AUDIO_TRACK_SWITCHED:k.default.AUDIO_TRACK_SWITCHED,AUDIO_TRACK_UPDATED:k.default.AUDIO_TRACK_UPDATED,SUBTITLE_TRACK_SWITCHED:k.default.SUBTITLE_TRACK_SWITCHED,MANIFEST_PARSED:k.default.MANIFEST_PARSED,LEVEL_UPDATED:k.default.LEVEL_UPDATED,PRELOAD_HIT:k.default.PRELOAD_HIT,LOAD_END:k.default.LOAD_END}}},{key:"Reports",get:function(){return{METADATA:D,MEDIA_INFO:w,HEARTBEAT:O,PERFORMANCE:P,DOWNLOAD:N,REALTIME_BEACON:M,DISCONTINUITY:U}}}]);var n=i.prototype;return n.load=function(e,t){void 0===e&&(e=void 0),c.Log.i(Ln,"call kernel load"),e&&v.setSrc(this._config,e),this._config.src?this._kernel.load(this._config.src,t):this._onError({type:I.ErrorTypes.OTHER_ERROR,details:I.ErrorDetails.CONFIG_ERROR,fatal:!0,reason:"url empty"})},n.getTimeNow=function(){return an.serverNowMs},n.setAvailableAbrLevels=function(e){this._kernel.setAvailableAbrLevels(e)},n.preload=function(e,t){"preload"in this._kernel&&this._kernel.preload(e,t)},n.isTimeinBuffered=function(e){return this._kernel.isTimeinBuffered(e)},n.resume=function(){c.Log.i(Ln,"call resume"),this._kernel.resume(),this._video.paused&&this._video.play()},n.destroy=function(){c.Log.i(Ln,"call kernel destroy"),H.clear(),this._kernel.destroy(),this._kernel.removeAllListeners(),this._monitor&&(this._monitor.destroy(),this._monitor.removeAllListeners()),this.removeAllListeners()},n.refresh=function(){c.Log.i(Ln,"call kernel refresh"),this._kernel.refresh()},n.stopLoad=function(){c.Log.i(Ln,"call kernel stopLoad"),this._kernel.stopLoad()},n.getStreamTime=function(e){return this._media.hasStreamTime?this._media.getStreamTime(e)||0:NaN},n.getAudienceStat=function(){return this._monitor.audienceStat},n.getMediaInfo=function(){return this._kernel.getMediaInfo()},n.experiment=function(e){e&&null!=typeof e.startBitrateLimit&&(this._config.hlsAdaptiveConfig?this._config.hlsAdaptiveConfig.startBitrateLimit=e.startBitrateLimit:this._config.hlsAdaptiveConfig={startBitrateLimit:e.startBitrateLimit})},n.liveEnd=function(){"liveEnd"in this._kernel&&this._kernel.liveEnd()},n.selectBitrate=function(e,t){void 0===t&&(t=!1);var r=this._kernel.getLevels();if(r&&r.length){var i=-1;e>=0&&(i=Wr(r,e)),t?this.nextLevel=i:this.currentLevel=i}},n.getBitrates=function(){var e=this._kernel.getLevels(),t=[];return e.forEach((function(e){t.push(e.bitrate)})),t},n.getLevels=function(){return this._kernel.getLevels().map((function(e){return e.getKLevel()}))},n.getCurrentLevelIndex=function(){return this._kernel.getCurrentLevel()},n.getCurrentLevel=function(){var e;return(null==(e=this._kernel.getLevels()[this._kernel.getCurrentLevel()])?void 0:e.getKLevel())||null},n.setAvailableAbrBitrates=function(e){var t=this._kernel.getLevels();if(t&&t.length){var r=[];e.forEach((function(e){r.push(Wr(t,e))})),this.setAvailableAbrLevels(r)}},n.seek=function(e){c.Log.i(Ln,"call kernel seek"),this._config.isLive||(this._video.currentTime=e)},n.play=function(){return c.Log.i(Ln,"call kernel play"),this._video.play()},n.pause=function(){return c.Log.i(Ln,"call kernel pause"),this._video.pause()},n.getCurrentBitrate=function(){var e=this._kernel.getLevels()[this._kernel.getCurrentLevel()];return e?e.bitrate:0},n._initKernel=function(){var e=this,t=new(this._config.box===u.MediaBox.webrtc?Si:this._config.box===u.MediaBox.native?fi:this._config.isLive?ei:di)(this._media,this._monitor,this._config);return t.on(k.default.ERROR,(function(t){e._onError(t)})),t.on(k.default.MANIFEST_PARSED,(function(r){r.bitrates=e.getBitrates(),r.bitrate=e.getCurrentBitrate(),r.levels=e.getLevels();var i=e._kernel.getAudioTracks();i&&i.length&&(r.audioTrack=t.getAudioTrack(),r.audioTracks=i.map((function(e){return{lang:e.lang,qualityLabel:e.qualityLabel,qualityType:e.qualityType,bitrate:e.bitrate,groupId:e.groupId}})));var n=e._kernel.getSubtitleTracks();n&&n.length&&(r.subtitleTrack=t.getSubtitleTrack(),r.subtitleTracks=n.map((function(e){return{lang:e.lang,name:e.name,groupId:e.groupId}}))),e._monitor.onManifest(r,e._kernel.getLevels()[r.currentLevel]),e.emit(k.default.MANIFEST_PARSED,r)})),t.on(k.default.LEVEL_SWITCHING,(function(t){e._monitor.levelSwitching(t,e._kernel.getLevels()[t.level]),e.emit(k.default.LEVEL_SWITCHING,t)})),t.on(k.default.LEVEL_SWITCHED,(function(t){e._monitor.levelSwitched(),e.emit(k.default.LEVEL_SWITCHED,t)})),t.on(k.default.LEVEL_SWITCH_PLAYING,(function(t){e._monitor.levelSwitchPlaying(),e.emit(k.default.LEVEL_SWITCH_PLAYING,t)})),t.on(k.default.AUDIO_TRACK_SWITCHING,(function(t){e._monitor.onAudioSwitching(),e.emit(k.default.AUDIO_TRACK_SWITCHING,t)})),t.on(k.default.AUDIO_TRACK_SWITCHED,(function(t){e._monitor.onAudioSwitched(),e.emit(k.default.AUDIO_TRACK_SWITCHED,t)})),t.on(k.default.LEVEL_SWITCH_FAILED,(function(t){return e.emit(k.default.LEVEL_SWITCH_FAILED,t)})),t.on(k.default.STOP_LOAD,(function(t){e._monitor.onStopLoad(),e.emit(k.default.STOP_LOAD,t)})),t.on(k.default.LOAD_END,(function(t){return e.emit(k.default.LOAD_END,t)})),t.on(k.default.LEVEL_UPDATED,(function(t){e._monitor.onLevel(),e.emit(k.default.LEVEL_UPDATED,t)})),t.on(k.default.AUDIO_TRACK_UPDATED,(function(t){e._monitor.onAudioTrack(),e.emit(k.default.AUDIO_TRACK_UPDATED,t)})),t.on(k.default.SUBTITLE_TRACK_SWITCHED,(function(t){e.emit(k.default.SUBTITLE_TRACK_SWITCHED,t)})),t.on(k.default.PRELOAD_HIT,(function(t){e._monitor.onPreloadHit(t),e.emit(k.default.PRELOAD_HIT,t)})),t.on(k.default.PRELOAD_COMPLETE,(function(t){e._monitor.onPreload()})),t.on(k.default.PRIV_NAL,(function(t){return e._monitor.onPrivNal(t)})),t.on(k.default.LOAD,(function(t,r){return e._monitor.onLoad(t,r)})),t.on(k.default.PARSING_DATA,(function(t){return e._monitor.onSegment(t)})),t.on(k.default.WAITING,(function(t,r){return e._monitor.onWaiting(t,r)})),t.on(k.default.LOADEDDATA,(function(){return e._monitor.onLoadeddata()})),t.on(k.default.CANPLAY,(function(){return e._monitor.onCanplay()})),t.on(k.default.SEEKING,(function(t){return e._monitor.onSeek(t)})),t.on(k.default.SEEKED,(function(){return e._monitor.onSeeked()})),t.on(k.default.SEEK_WITH_LOAD,(function(t){return e._monitor.onSeekWithLoad(t)})),t.on(k.default.PLAYING,(function(){return e._monitor.onPlaying()})),t.on(k.default.PAUSE,(function(){return e._monitor.onPause()})),t.on(k.default.PLAY,(function(){return e._monitor.onPlay()})),t.on(k.default.ENDED,(function(){return e._monitor.onEnd()})),t.on(k.default.RATE_CHANGE,(function(t){return e._monitor.onRateChange(t)})),t.on(k.default.DURATION_CHANGE,(function(t){return e._monitor.onDurationChange(t)})),t.on(k.default.PARSING_INIT_SEGMENT,(function(t){return e._monitor.onSegmentInit(t)})),t.on(k.default.TIMEUPDATE,(function(){return e._monitor.onTimeupdate()})),t.on(k.default.PROGRESS,(function(){return e._monitor.onProgress()})),t.on(k.default.HEARTBEAT,(function(t){return e._monitor.heartbeat(t)})),t.on(k.default.MSE_BUFFER_FULL,(function(){return e._monitor.onMSEBufferFull()})),t.on(k.default.MSE_UPDATE,(function(){return e._monitor.mseUpdate()})),t.on(k.default.MSE_REMOVE,(function(){return e._monitor.mseRemove()})),t.on(k.default.MSE_OPEN,(function(){return e._monitor.mseOpen()})),t.on(k.default.LOADER_CHUNK_ARRIVAL,(function(t){return e._monitor.onLoaderChunkArrival(t)})),t.on(k.default.MEDIA_DEMUX,(function(t){return e._monitor.onMediaDemux(t)})),t.on(k.default.KEY_FRAME,(function(){return e._monitor.onKeyFrame()})),t.on(k.default.MUX_INFO,(function(t){return e._monitor.onMuxInfo(t)})),t.on(k.default.LOST_FRAMES,(function(t){return e._monitor.onLostFrame(t)})),t.on(k.default.USE_BACKUP,(function(){return e._monitor.onUseBackup()})),t.on(k.default.ABR_INFO,(function(t){return e._monitor.onAbrInfo(t)})),t.on(k.default.NEW_SOURCE,(function(t){e._monitor.onNewSource(t,e._kernel.getLevels()[t.index])})),t.on(k.default.DISCONTINUITY,(function(t){return e._monitor.onDiscontinuity(t)})),t.on(k.default.METADATA,(function(t){return e._monitor.onMetaData(t)})),t.on(k.default.DOWNLOAD,(function(t){return e._monitor.onDownload(t)})),t.on(k.default.RETRY,(function(t){return e._monitor.onRetry(t)})),t},n._initLogger=function(){var e=this,t=new Sn(i.version,this._media,this._config);return t.on(k.default.REPORT,(function(t){e.emit(k.default.REPORT,t)})),t},n._onError=function(e){c.Log.i(Ln,"on error",e);var t={errno:m,errmsg:e.reason||"unknow",fatal:e.fatal};switch(e.type){case I.ErrorTypes.NETWORK_ERROR:t.errno=g,t.statusCode=e.statusCode,t.url=e.url;break;case I.ErrorTypes.MSE_ERROR:switch(e.details){case I.ErrorDetails.APPENDBUFFER_ERROR:t.errno=L;break;case I.ErrorDetails.ENDOFSTREAM_ERROR:t.errno=S;break;case I.ErrorDetails.MEDIASOURCE_ERROR:t.errno=T;break;default:t.errno=b}break;case I.ErrorTypes.MEDIA_ERROR:t.errno=A,e.details===I.ErrorDetails.CANNOT_SEEK?t.errno=E:t.errno=y;break;case I.ErrorTypes.MUX_ERROR:t.errno=A;break;case I.ErrorTypes.OTHER_ERROR:e.details===I.ErrorDetails.CONFIG_ERROR?t.errno=R:t.errno=A}var r=re(e.details,e.reason,e.statusCode||0);this._monitor.onError(r,e.reason),e.fatal&&(this.stopLoad(),t.code=r,t.type=e.type,t.reason=e.reason),e.fatal&&!this._error&&(this._error=e.details,this.emit(k.default.ERROR,t))},n._parseUrlConfig=function(){if(location.href){var e=location.href.match(/kwaiKernelLog=([a-z]{1})/);if(e&&e.length>1)return this._config.kwaiKernelLog=e[1],void c.Log.level(this._config.kwaiKernelLog)}var t=(new _e).read("kwai-kernel-log");t&&(this._config.kwaiKernelLog=t),c.Log.level(this._config.kwaiKernelLog)},bn(i,[{key:"audioTrack",get:function(){return this._kernel.getAudioTrack()||0},set:function(e){this._kernel.setAudioTrack(e)}},{key:"subtitleTrack",get:function(){return this._kernel.getSubtitleTrack()||0},set:function(e){this._kernel.setSubtitleTrack(e)}},{key:"currentLevel",get:function(){return this._kernel.getCurrentLevel()},set:function(e){this._kernel.setCurrentLevel(e)}},{key:"nextLevel",get:function(){return this._kernel.getNextLevel()},set:function(e){this._kernel.setNextLevel(e)}},{key:"startLevel",get:function(){return this._kernel.getStartLevel()},set:function(e){this._kernel.setStartLevel(e)}},{key:"autoLevelEnabled",get:function(){return this._kernel.getAutoLevelEnabled()}},{key:"monitorData",get:function(){return this._monitor?this._monitor.snapshot:null}}]),i}(a.EventEmitter)},"./src/io/data-cache.ts":function(e,t,r){function i(e,t){for(var r=0;r<t.length;r++){var i=t[r];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}r.r(t);var n=function(){function e(){this._size=0,this._cache=[],this._index=0,this._offset=0}var t,r,n,a=e.prototype;return a.put=function(t){if(this.unreadLen+t.byteLength>=e.MAX_CACHE_SIZE)throw new Error("max cache size");this._cache.push(t),this._size+=t.byteLength},a.get=function(e){if(!(e>this.unreadLen)){var t,r=this._cache[this._index];if(0===this._offset&&e===r.byteLength)e===r.buffer.byteLength?t=r:(t=new Uint8Array(e)).set(r),this._index++,this._offset=0;else{t=new Uint8Array(e);for(var i=0,n=0,a=0;i<e;)a=this._offset,n=Math.min(r.byteLength,e-i+a),0===a&&n===r.byteLength?t.set(r,i):t.set(r.subarray(a,n),i),i+=n-a,n>=r.byteLength?(this._index++,r=this._cache[this._index],this._offset=0):this._offset=n}return this._collateCache(),t}},a.read=function(e){if(!(e>this.unreadLen)){for(var t=new Uint8Array(e),r=this._index,i=0,n=0,a=this._offset;i<e;){var o=this._cache[r];r>0&&(a=0),n=Math.min(o.byteLength,e-i+a),t.set(o.subarray(a,n),i),i+=n-a,r++}return t}},a.skip=function(e){var t=this._offset+e;if(!(t>this._size)){if(t===this._size)this.clear();else for(;t>0;){var r=this._cache[this._index].byteLength;t<r?(this._offset=t,t=0):t===r?(this._offset=0,t=0,this._index++):(this._offset=0,t-=r,this._index++)}this._collateCache()}},a.clear=function(){this._size=0,this._cache=[],this._index=0,this._offset=0},a._collateCache=function(){for(;this._index;){var e=this._cache.shift();e&&(this._size-=e.byteLength),this._index--}},t=e,(r=[{key:"unreadLen",get:function(){return this._size-this._offset}}])&&i(t.prototype,r),n&&i(t,n),e}();n.MAX_CACHE_SIZE=104857600,t.default=n},"./src/remux/mp4-remuxer.ts":function(e,t,r){r.r(t),r.d(t,"PTSNormalize",(function(){return K}));var i=r("./src/core/kernel-errors.ts"),n=r("./src/core/kernel-events.ts"),a=function(){function e(){}return e.getSilentFrame=function(e,t){switch(e){case"mp4a.40.2":if(1===t)return new Uint8Array([0,200,0,128,35,128]);if(2===t)return new Uint8Array([33,0,73,144,2,25,0,35,128]);if(3===t)return new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,142]);if(4===t)return new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,128,44,128,8,2,56]);if(5===t)return new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,130,48,4,153,0,33,144,2,56]);if(6===t)return new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,130,48,4,153,0,33,144,2,0,178,0,32,8,224]);break;default:if(1===t)return new Uint8Array([1,64,34,128,163,78,230,128,186,8,0,0,0,28,6,241,193,10,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,94]);if(2===t)return new Uint8Array([1,64,34,128,163,94,230,128,186,8,0,0,0,0,149,0,6,241,161,10,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,94]);if(3===t)return new Uint8Array([1,64,34,128,163,94,230,128,186,8,0,0,0,0,149,0,6,241,161,10,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,94])}return null},e}(),o=r("./src/utils/log.ts"),s=r("./src/demux/audio/adts.ts"),u={chanelConfig:2,objectType:2,sampleingIndex:7},d="audio-helper",c=function(){function e(){}return e.initAudioForFillSilent=function(e,t){void 0===t&&(t=""),e.codec||s.initTrackConfigByInfo(e,u,t||(/firefox/.test(navigator.userAgent.toLowerCase())?"mp4a.40.2":"mp4a.40.5"))},e.fillAACFrameByCount=function(t,r,i,n,o){void 0===n&&(n=0),void 0===o&&(o=""),e.initAudioForFillSilent(t,o);var u=a.getSilentFrame(t.manifestCodec||t.codec,t.channelCount);if(u&&i>0){for(var d=s.getFrameDuration(t.samplerate),c=0;c<i;c++)t.samples.push({unit:u,pts:r||1,dts:r||1,streamDTS:n+d/90});return r+d}return r},e.ensureAudioFrame=function(t,r,i,n){if(void 0===i&&(i=""),r.samples.length){if(0===t.samples.length){var a=r.samples[0].pts;o.Log.w(d,"fill audio before remux frame @"+a+" has audio data:"+t.samples.length),e.fillAACFrameByCount(t,a,1,r.samples[0].streamDTS,i)}var s=r.samples[r.samples.length-1],u=s.dts-(t.samples.length?t.samples[t.samples.length-1].dts:r.samples[0].dts);(u>1*r.inputTimescale||u/r.inputTimescale>.2&&n)&&(o.Log.w(d,"fill audio @end"),e.fillAACFrameByCount(t,s.dts,1,s.streamDTS,i))}},e}(),l=r("./src/types/core.ts"),f=r("./src/utils/browser.ts"),_=r("./src/demux/create-track.ts"),h=Object(_.createVideoTrack)(0);h.bitDepth=8,h.chromaFormat="4:2:0",h.codec="avc1.64000a",h.colorInfo={colorRange:1,colourPrimaries:2,transferCharacteristics:0,matrixCoefficients:0},h.fps=15,h.height=48,h.id=1,h.inputTimescale=9e4,h.level="1.0",h.pixelRatio=[1,1],h.profile="High",h.sampleDuration=6e3,h.width=64,h.sps=[new Uint8Array([103,100,0,10,172,114,4,68,122,16,0,0,3,0,16,0,0,3,3,32,241,34,88,70])],h.pps=[new Uint8Array([104,232,67,143,44,139])];var p=[{type:5,data:new Uint8Array([101,136,129,0,5,127,254,246,115,124,10,107,109,176,149,46,5,118,246,150,55,45,60,239,89,160,124,49,129])}],v=function(){function e(){}return e.getFillTrack=function(e,t,r,i){if(!(t-2<e))return h.samples=[{cts:0,dts:e,key:!0,pts:e,streamDTS:r,units:p},{cts:0,dts:t-1,key:!0,pts:t-1,streamDTS:i-1,units:p}],h},e.getFillTrackBySamples=function(e){if(e.length)return h.samples=[],e.length>0&&h.samples.push({cts:0,dts:e[0].dts,key:!0,pts:e[0].dts,streamDTS:e[0].streamDTS,units:p}),e.length>1&&h.samples.push({cts:0,dts:e[e.length-1].dts,key:!0,pts:e[e.length-1].dts,streamDTS:e[e.length-1].streamDTS,units:p}),h},e}(),m=Math.pow(2,32)-1,g={video:new Uint8Array([0,0,0,45,104,100,108,114,0,0,0,0,0,0,0,0,118,105,100,101,0,0,0,0,0,0,0,0,0,0,0,0,86,105,100,101,111,72,97,110,100,108,101,114,0]),audio:new Uint8Array([0,0,0,45,104,100,108,114,0,0,0,0,0,0,0,0,115,111,117,110,0,0,0,0,0,0,0,0,0,0,0,0,83,111,117,110,100,72,97,110,100,108,101,114,0])},y=new Uint8Array([0,0,0,24,102,116,121,112,105,115,111,109,0,0,0,1,105,115,111,109,97,118,99,49]),E=new Uint8Array([0,0,0,24,102,116,121,112,105,115,111,109,0,0,0,1,105,115,111,109,104,101,118,49]),S=new Uint8Array([0,0,0,16,115,116,116,115,0,0,0,0,0,0,0,0]),T=new Uint8Array([0,0,0,16,115,116,115,99,0,0,0,0,0,0,0,0]),b=new Uint8Array([0,0,0,16,115,116,99,111,0,0,0,0,0,0,0,0]),L=new Uint8Array([0,0,0,20,115,116,115,122,0,0,0,0,0,0,0,0,0,0,0,0]),A=new Uint8Array([0,0,0,36,100,105,110,102,0,0,0,28,100,114,101,102,0,0,0,0,0,0,0,1,0,0,0,12,117,114,108,32,0,0,0,1]),R=new Uint8Array([0,0,0,20,118,109,104,100,0,0,0,1,0,0,0,0,0,0,0,0]),I=new Uint8Array([0,0,0,16,115,109,104,100,0,0,0,0,0,0,0,0]),k=new Uint8Array([0,0,0,20,98,116,114,116,0,28,156,128,0,45,198,192,0,45,198,192]),C=new Uint8Array([0,0,0,120,109,118,104,100,1,0,0,0,0,0,0,0,0,0,0,2,0,0,0,0,0,0,0,3,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,64,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,255,255,255,255]),x=new Uint8Array([0,0,0,104,116,107,104,100,1,0,0,7,0,0,0,0,0,0,0,2,0,0,0,0,0,0,0,3,0,0,0,2,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,64,0,0,0,0,0,0,0,0,0,0,0]),D=new Uint8Array([0,0,0,32,116,114,101,120,0,0,0,0,0,0,0,2,0,0,0,1,0,0,0,0,0,0,0,0,0,1,0,1]),w=new Uint8Array([0,0,0,44,109,100,104,100,1,0,0,0,0,0,0,0,0,0,0,2,0,0,0,0,0,0,0,3,0,0,172,68,0,0,0,0,0,0,0,0,85,196,0,0]),O=new Uint8Array([0,0,0,93,115,116,115,100,0,0,0,0,0,0,0,1,0,0,0,77,109,112,52,97,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,2,0,16,0,0,0,0,172,68,0,0,0,0,0,41,101,115,100,115,0,0,0,0,3,27,0,1,0,4,19,64,21,0,0,0,0,0,0,0,0,0,0,0,5]),P=new Uint8Array([0,0,0,185,115,116,115,100,0,0,0,0,0,0,0,1,0,0,0,169,97,118,99,49,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,5,0,2,208,0,72,0,0,0,72,0,0,0,0,0,0,0,1,18,100,97,105,108,121,109,111,116,105,111,110,47,104,108,115,46,106,115,0,0,0,0,0,0,0,0,0,0,0,0,0,0,24,17,17]),N=new Uint8Array([0,0,0,246,115,116,115,100,0,0,0,0,0,0,0,1,0,0,0,230,104,101,118,49,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,5,0,2,208,0,72,0,0,0,72,0,0,0,0,0,0,0,1,10,120,113,113,47,102,108,118,46,106,115,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,24,255,255]),M=new Uint8Array([0,0,0,16,112,97,115,112,0,0,0,1,0,0,0,1]),U=function(){function e(){}return e.moov=function(t){for(var r=y,i=t.length;i--;)t[i].type===l.TrackType.VIDEO&&0===t[i].codec.indexOf("hev1")&&(r=E);var n=r.byteLength+e._getMoovLen(t),a={data:new Uint8Array(n),offset:0};return a.data.set(r,0),a.offset+=r.byteLength,e._writeMoov(a,t),a.data},e.videoMediaSegment=function(t,r,i,n){var a=8+i.mp4Samples.reduce((function(e,t){return e+t.units.reduce((function(e,t){return e+t.data.byteLength+4}),0)}),0),o=e._getMediaSegmentData(i,a,n);return e._mediaSegmentHead(o,t,r,i,a,n),i.samples.forEach((function(e){e.units.forEach((function(e){var t=e.data.byteLength;o.data[o.offset]=t>>24&255,o.data[o.offset+1]=t>>16&255,o.data[o.offset+2]=t>>8&255,o.data[o.offset+3]=255&t,o.data.set(e.data,o.offset+4),o.offset+=4+t}))})),o.data},e.audioMediaSegment=function(t,r,i,n){var a=8+i.mp4Samples.reduce((function(e,t){return e+t.unit.byteLength}),0),o=e._getMediaSegmentData(i,a,n);return e._mediaSegmentHead(o,t,r,i,a,n),i.mp4Samples.forEach((function(e){o.data.set(e.unit,o.offset),o.offset+=e.unit.byteLength})),o.data},e._getMoovLen=function(t){var r=t.reduce((function(t,r){return t+e._getTrakLen(r)}),0);return 8+C.byteLength+r+e._getMvexLen(t)},e._writeMoov=function(t,r){var i=e._getMoovLen(r);e._writeBoxHead(t,e.types.moov,i),e._writeMvhd(t,r[0].timescale,r[0].duration),r.forEach((function(r){e._writeTrak(t,r)})),e._writeMvex(t,r)},e._getMoofLen=function(e){return 100+17*e},e._mediaSegmentHead=function(t,r,i,n,a,o){o&&(t.data.set(o),t.offset=o.byteLength),e._writeMoof(t,r,i,n),e._writeBoxHead(t,e.types.mdat,a)},e._getMediaSegmentData=function(t,r,i){var n=e._getMoofLen(t.mp4Samples.length);return{data:new Uint8Array(n+r+(i?i.byteLength:0)),offset:0}},e._writeMvhd=function(e,t,r){r*=t;var i=Math.floor(r/(m+1)),n=Math.floor(r%(m+1)),a=C;a[28]=t>>24&255,a[29]=t>>16&255,a[30]=t>>8&255,a[31]=255&t,a[32]=i>>24,a[33]=i>>16&255,a[34]=i>>8&255,a[35]=255&i,a[36]=n>>24,a[37]=n>>16&255,a[38]=n>>8&255,a[39]=255&n,e.data.set(a,e.offset),e.offset+=C.byteLength},e._writeTkhd=function(e,t){var r=t.id,i=t.duration*t.timescale,n=Math.floor(i/(m+1)),a=Math.floor(i%(m+1)),o=0,s=0;t.hasOwnProperty("width")&&(o=t.width),t.hasOwnProperty("height")&&(s=t.height);var u=x;u[28]=r>>24&255,u[29]=r>>16&255,u[30]=r>>8&255,u[31]=255&r,u[36]=n>>24,u[37]=n>>16&255,u[38]=n>>8&255,u[39]=255&n,u[40]=a>>24,u[41]=a>>16&255,u[42]=a>>8&255,u[43]=255&a,u[96]=o>>8&255,u[97]=255&o,u[100]=s>>8&255,u[101]=255&s,e.data.set(u,e.offset),e.offset+=x.byteLength},e._getTrakLen=function(t){return 8+x.byteLength+e._getMdiaLen(t)},e._writeTrak=function(t,r){var i=e._getTrakLen(r);this._writeBoxHead(t,e.types.trak,i),this._writeTkhd(t,r),this._writeMdia(t,r)},e._getMdiaLen=function(t){return 8+w.byteLength+g[t.type].byteLength+e._getMinfLen(t)},e._writeMdia=function(t,r){var i=e._getMdiaLen(r);this._writeBoxHead(t,e.types.mdia,i),this._writeMdhd(t,r.timescale,r.duration),t.data.set(g[r.type],t.offset),t.offset+=g[r.type].byteLength,this._writeMinf(t,r)},e._writeMdhd=function(e,t,r){r*=t;var i=Math.floor(r/(m+1)),n=Math.floor(r%(m+1)),a=w;a[28]=t>>24&255,a[29]=t>>16&255,a[30]=t>>8&255,a[31]=255&t,a[32]=i>>24,a[33]=i>>16&255,a[34]=i>>8&255,a[35]=255&i,a[36]=n>>24,a[37]=n>>16&255,a[38]=n>>8&255,a[39]=255&n,e.data.set(a,e.offset),e.offset+=a.byteLength},e._getMinfLen=function(t){return t.type===l.TrackType.AUDIO?8+I.byteLength+A.byteLength+e._getStblLen(t):8+R.byteLength+A.byteLength+e._getStblLen(t)},e._writeMinf=function(t,r){if(this._writeBoxHead(t,e.types.minf,e._getMinfLen(r)),r.type===l.TrackType.AUDIO)return t.data.set(I,t.offset),t.offset+=I.byteLength,t.data.set(A,t.offset),t.offset+=A.byteLength,void this._writeStbl(t,r);t.data.set(R,t.offset),t.offset+=R.byteLength,t.data.set(A,t.offset),t.offset+=A.byteLength,this._writeStbl(t,r)},e._getStblLen=function(e){return 8+this._getStsdLen(e)+S.byteLength+T.byteLength+L.byteLength+b.byteLength},e._writeStbl=function(t,r){var i=this._getStblLen(r);this._writeBoxHead(t,e.types.stbl,i),this._writeStsd(t,r),t.data.set(S,t.offset),t.offset+=S.byteLength,t.data.set(T,t.offset),t.offset+=T.byteLength,t.data.set(L,t.offset),t.offset+=L.byteLength,t.data.set(b,t.offset),t.offset+=b.byteLength},e._getStsdLen=function(t){return t.type===l.TrackType.AUDIO?e._getMp4aStsdLen(t):0===t.codec.indexOf("hev1")?e._getHev1StsdLen(t):e._getAvc1StsdLen(t)},e._writeStsd=function(e,t){t.type!==l.TrackType.AUDIO?0!==t.codec.indexOf("hev1")?this._writeAvc1Stsd(e,t):this._writeHev1Stsd(e,t):this._writeMp4aStsd(e,t)},e._getAvcCLen=function(e){return 15+e.sps.reduce((function(e,t){return e+t.byteLength+2}),0)+e.pps.reduce((function(e,t){return e+t.byteLength+2}),0)},e._getHvcCLen=function(e){return 8+e.hvcc.byteLength},e._getAvc1Len=function(t){return 86+e._getAvcCLen(t)+20+16},e._getAvc1StsdLen=function(e){return 16+this._getAvc1Len(e)},e._getHev1StsdLen=function(t){return N.byteLength+e._getHvcCLen(t)},e._writeAvc1Stsd=function(t,r){var i,n,a,o=[],s=[];for(i=0;i<r.sps.length;i++)a=(n=r.sps[i]).byteLength,o.push(a>>>8&255),o.push(255&a),o=o.concat(Array.prototype.slice.call(n));for(i=0;i<r.pps.length;i++)a=(n=r.pps[i]).byteLength,s.push(a>>>8&255),s.push(255&a),s=s.concat(Array.prototype.slice.call(n));var u=this._getAvcCLen(r),d=this._getAvc1Len(r),c=this._getAvc1StsdLen(r),l=P,f=r.width,_=r.height,h=r.pixelRatio[0],p=r.pixelRatio[1];l[0]=c>>24&255,l[1]=c>>16&255,l[2]=c>>8&255,l[3]=255&c,l[16]=d>>24&255,l[17]=d>>16&255,l[18]=d>>8&255,l[19]=255&d,l[48]=f>>8&255,l[49]=255&f,l[50]=_>>8&255,l[51]=255&_,t.data.set(l,t.offset),t.offset+=l.byteLength,this._writeBoxHead(t,e.types.avcC,u);var v=[1,o[3],o[4],o[5],255,224|r.sps.length].concat(o).concat([r.pps.length]).concat(s);t.data.set(v,t.offset),t.offset+=v.length,t.data.set(k,t.offset),t.offset+=k.byteLength;var m=M;m[8]=h>>24,m[9]=h>>16&255,m[10]=h>>8&255,m[11]=255&h,m[12]=p>>24,m[13]=p>>16&255,m[14]=p>>8&255,m[15]=255&p,t.data.set(m,t.offset),t.offset+=m.byteLength},e._writeHev1Stsd=function(t,r){var i=this._getHvcCLen(r),n=this._getHev1StsdLen(r),a=N;t.offset,a[0]=n>>24&255,a[1]=n>>16&255,a[2]=n>>8&255,a[3]=255&n;var o=r.codecWidth,s=r.codecHeight;a[16]=n-16>>24&255,a[17]=n-16>>16&255,a[18]=n-16>>8&255,a[19]=n-16&255,a[48]=o>>8&255,a[49]=255&o,a[50]=s>>8&255,a[51]=255&s,t.data.set(a,t.offset),t.offset+=a.byteLength,this._writeBoxHead(t,e.types.hvcC,i),t.data.set(r.hvcc,t.offset),t.offset+=r.hvcc.byteLength},e._getMp4aEsdsLen=function(e){return 33+e.config.length+4},e._getMp4aStsdLen=function(t){return 52+e._getMp4aEsdsLen(t)},e._writeMp4aStsd=function(t,r){var i=r.config.length,n=e._getMp4aEsdsLen(r),a=e._getMp4aStsdLen(r),o=a-16,s=O;s[0]=a>>24&255,s[1]=a>>16&255,s[2]=a>>8&255,s[3]=255&a,s[16]=o>>24&255,s[17]=o>>16&255,s[18]=o>>8&255,s[19]=255&o,s[41]=r.channelCount,s[48]=r.samplerate>>8&255,s[49]=255&r.samplerate,s[52]=n>>24&255,s[53]=n>>16&255,s[54]=n>>8&255,s[55]=255&n,s[65]=23+i,s[70]=15+i,t.data.set(s,t.offset),t.offset+=s.byteLength;var u=[i].concat(r.config).concat([6,1,2]);t.data.set(u,t.offset),t.offset+=u.length},e._getMvexLen=function(e){return 8+e.length*D.byteLength},e._writeMvex=function(t,r){var i=e._getMvexLen(r);this._writeBoxHead(t,e.types.mvex,i),r.forEach((function(r){e._writeTrex(t,r)}))},e._writeTrex=function(e,t){var r=t.id,i=D;i[12]=r>>24,i[13]=r>>16&255,i[14]=r>>8&255,i[15]=255&r,e.data.set(i,e.offset),e.offset+=i.byteLength},e._writeMoof=function(t,r,i,n){var a=n.mp4Samples.length,o=e._getMoofLen(a),s=o-24,u=12+a,d=20+16*a,c=o+8,l=n.id,f=n.mp4Samples||[],_=Math.floor(i/(m+1)),h=Math.floor(i%(m+1));e._writeBoxHead(t,e.types.moof,o),e._writeBoxHead(t,e.types.mfhd,16),t.data[t.offset+4]=r>>24,t.data[t.offset+5]=r>>16&255,t.data[t.offset+6]=r>>8&255,t.data[t.offset+7]=255&r,t.offset+=8,e._writeBoxHead(t,e.types.traf,s),e._writeBoxHead(t,e.types.tfhd,16),t.data[t.offset+4]=l>>24,t.data[t.offset+5]=l>>16&255,t.data[t.offset+6]=l>>8&255,t.data[t.offset+7]=255&l,t.offset+=8,e._writeBoxHead(t,e.types.tfdt,20),t.data[t.offset]=1,t.data[t.offset+4]=_>>24,t.data[t.offset+5]=_>>16&255,t.data[t.offset+6]=_>>8&255,t.data[t.offset+7]=255&_,t.data[t.offset+8]=h>>24,t.data[t.offset+9]=h>>16&255,t.data[t.offset+10]=h>>8&255,t.data[t.offset+11]=255&h,t.offset+=12,e._writeBoxHead(t,e.types.sdtp,u),t.offset+=4,f.forEach((function(e,r){var i=e.flags;t.data[t.offset+r]=i.dependsOn<<4|i.isDependedOn<<2|i.hasRedundancy})),t.offset+=a,e._writeBoxHead(t,e.types.trun,d),t.data[t.offset+2]=15,t.data[t.offset+3]=1,t.data[t.offset+4]=a>>>24&255,t.data[t.offset+5]=a>>>16&255,t.data[t.offset+6]=a>>>8&255,t.data[t.offset+7]=255&a,t.data[t.offset+8]=c>>>24&255,t.data[t.offset+9]=c>>>16&255,t.data[t.offset+10]=c>>>8&255,t.data[t.offset+11]=255&c,t.offset+=12,f.forEach((function(e,r){t.data.set([e.duration>>>24&255,e.duration>>>16&255,e.duration>>>8&255,255&e.duration,e.len>>>24&255,e.len>>>16&255,e.len>>>8&255,255&e.len,e.flags.isLeading<<2|e.flags.dependsOn,e.flags.isDependedOn<<6|e.flags.hasRedundancy<<4|e.flags.isNonSync,61440&e.flags.degradPrio,15&e.flags.degradPrio,e.cts>>>24&255,e.cts>>>16&255,e.cts>>>8&255,255&e.cts],t.offset+16*r)})),t.offset+=16*a},e._writeBoxHead=function(e,t,r){e.data[e.offset]=r>>24&255,e.data[e.offset+1]=r>>16&255,e.data[e.offset+2]=r>>8&255,e.data[e.offset+3]=255&r,e.data.set(t,e.offset+4),e.offset+=8},e}();U.types={avc1:[97,118,99,49],avcC:[97,118,99,67],btrt:[98,116,114,116],dinf:[100,105,110,102],dref:[100,114,101,102],esds:[101,115,100,115],ftyp:[102,116,121,112],hdlr:[104,100,108,114],mdat:[109,100,97,116],mdhd:[109,100,104,100],mdia:[109,100,105,97],mfhd:[109,102,104,100],minf:[109,105,110,102],moof:[109,111,111,102],moov:[109,111,111,118],mp4a:[109,112,52,97],mvex:[109,118,101,120],mvhd:[109,118,104,100],pasp:[112,97,115,112],sdtp:[115,100,116,112],stbl:[115,116,98,108],stco:[115,116,99,111],stsc:[115,116,115,99],stsd:[115,116,115,100],stsz:[115,116,115,122],stts:[115,116,116,115],tfdt:[116,102,100,116],tfhd:[116,102,104,100],traf:[116,114,97,102],trak:[116,114,97,107],trun:[116,114,117,110],trex:[116,114,101,120],tkhd:[116,107,104,100],vmhd:[118,109,104,100],smhd:[115,109,104,100],hvcC:[104,118,99,67]};var B=U;function F(){return(F=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var i in r)Object.prototype.hasOwnProperty.call(r,i)&&(e[i]=r[i])}return e}).apply(this,arguments)}function V(e,t){for(var r=0;r<t.length;r++){var i=t[r];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}var H=1e5,j="remuxer",G=function(){function e(e,t,r,i){void 0===i&&(i=""),this._eventEmitter=void 0,this._config=void 0,this._typeSupported=void 0,this._isSafari=void 0,this._forceFirstIDR=void 0,this._videoTimeReference=void 0,this._videoTimeReferenceInfo=void 0,this._ISGenerated=!1,this._videoTime=void 0,this._transmuxData=void 0,this._nextAudioPts=void 0,this._nextAvcDts=void 0,this._initPTS=void 0,this._initDTS=void 0,this._initSegment={},this._eventEmitter=e,this._config=t,this._typeSupported=r;var n=navigator.userAgent;this._isSafari=!(!(i&&i.indexOf("Apple")>-1&&n)||n.match("CriOS")),this._ISGenerated=!1,this._videoTimeReference=t.streamingMux&&!t.gopRemux,this._resetVideoTime(),this._videoTimeReferenceInfo={},this._forceFirstIDR=!(!f.default.chrome||!(f.default.version.major<50||50===f.default.version.major&&f.default.version.build<2661))}var t,r,s,u=e.prototype;return u.destroy=function(){},u.resetTimeStamp=function(e){this._initPTS=this._initDTS=e,this._resetVideoTime()},u.resetInitSegment=function(e){this._ISGenerated=!1,this._initSegment={},this._transmuxData=e,this._clearVideoTimeReference()},u.getLastPTS=function(){return{video:this._videoTime.vLastPTS,audio:this._videoTime.aLastPTS}},u.flush=function(e,t){var r;void 0===e&&(e=0),void 0===t&&(t=!0);var i=this._videoTimeReferenceInfo;if(this._videoTimeReference&&i.sample&&(i.track.samples=[i.sample],delete i.sample,i.sequenceNumber+=1,r=this._remuxVideo(i.track,i.timeOffset,!0,e,i.accurateTimeOffset)),this._clearVideoTimeReference(),r&&t){var a=[r];this._eventEmitter.emit(n.default.PARSING_DATA,{segments:a,extra:this._transmuxData})}return r},u._clearVideoTimeReference=function(){this._videoTimeReferenceInfo={}},u.remux=function(e,t,r,i,a,s){if(void 0===s&&(s=!1),this._config.ensureAudio&&e.active&&c.ensureAudioFrame(e,t,this._config.audioCodec,s),s&&t.active&&0===t.samples.length&&e.samples.length&&e.samplerate){if(this._ISGenerated&&(e.samples[e.samples.length-1].pts-e.samples[0].pts)/e.inputTimescale<1)return;var u=v.getFillTrackBySamples(e.samples);u&&(o.Log.i(j,"fill black video frame"),u.sequenceNumber=t.sequenceNumber,u.active=t.active,t=u,this._transmuxData&&this.resetInitSegment(this._transmuxData))}if(this._ISGenerated||this._generateIS(e,t,r),!i&&t.samples.length&&(t.samples[0].pts=t.samples[0].dts),this._ISGenerated){var d,l,f=r,_=r;if(e.samples.length&&t.samples.length)if(!i&&a){if(e.samples[0].pts-t.samples[0].pts<0){var h=F({},t.samples[0]);h.dts=h.pts=e.samples[0].pts,t.samples.unshift(h)}}else{var p=(e.samples[0].pts-t.samples[0].pts)/t.inputTimescale;f+=Math.max(0,p),_+=Math.max(0,-p)}var m=0;(d=this._remuxAudio(e,f,i,a))&&(m=d.endPTS-d.startPTS),!(l=this._remuxVideo(t,_,i,m,a,s))&&s&&this._videoTimeReferenceInfo.sample&&(l=this.flush(m,!1)),l&&!d&&e.codec&&(d=this._remuxEmptyAudio(e,f,i,l));var g=[];d&&g.push(d),l&&g.push(l),g.length&&this._eventEmitter.emit(n.default.PARSING_DATA,{segments:g,extra:this._transmuxData})}},u._generateIS=function(e,t,r){var a,s,u=this._eventEmitter,d=e.samples,c=t.samples,l=this._typeSupported,f={},_={tracks:f},h=void 0===this._initPTS,p="audio/mp4";if(h&&(a=s=1/0),e.config&&d.length&&(e.timescale=e.samplerate,o.Log.v(j,"audio sampling rate : "+e.samplerate),e.isAAC||(l.mpeg?(p="audio/mpeg",e.codec=""):l.mp3&&(e.codec="mp3")),this._initSegment.audio=!e.isAAC&&l.mpeg?new Uint8Array:B.moov([e]),f.audio={container:p,codec:e.codec,metadata:{channelCount:e.channelCount,audioSampleRate:e.samplerate}},h&&(a=s=d[0].pts-e.inputTimescale*r)),t.sps&&t.pps&&c.length){var v=t.inputTimescale;t.timescale=v,t.duration<=0&&(o.Log.i(j,"videoTrack.duration === 0"),t.duration=1),this._initSegment.video=B.moov([t]),f.video={container:"video/mp4",codec:t.codec,metadata:{width:t.width,height:t.height,fps:t.fps,profile:t.profile,level:t.level,chromaFormat:t.chromaFormat,bitDepth:t.bitDepth,colorInfo:t.colorInfo}},h&&(a=Math.min(a||1/0,c[0].pts-v*r),s=Math.min(s||1/0,c[0].dts-v*r),u.emit(n.default.INIT_PTS_FOUND,{initPTS:a,timescale:v}))}Object.keys(f).length?(u.emit(n.default.PARSING_INIT_SEGMENT,_),this._ISGenerated=!0,h&&(this._initPTS=a,this._initDTS=s,o.Log.i(j,"init pts:"+a+" dts:"+s))):u.emit(n.default.ERROR,{type:i.ErrorTypes.MUX_ERROR,details:i.ErrorDetails.PARSING_ERROR,fatal:!1,reason:"no audio/video samples found"})},u._remuxVideo=function(e,t,r,i,n,a){if(void 0===n&&(n=!1),void 0===a&&(a=!1),e.samples.length){var s,u,d=e.timescale,c=e.samples,f=[],_=this._initPTS,h=this._videoTime,p=[],v=0,m=0,g=0,y=c.length;if(void 0!==_){var E=this._nextAvcDts,S=this._isSafari;if(0!==y&&0!==e.timescale&&(S&&(r=r||!!(c.length&&E&&(n&&Math.abs(t-E/d)<.1||Math.abs(c[0].pts-E-_)<d/5))),r||(E=t*d,this._resetVideoTime()),void 0!==E)){c.forEach((function(e){e.pts=K(e.pts-_,E),e.dts=K(e.dts-_,E)})),c.sort((function(e,t){var r=e.dts-t.dts,i=e.pts-t.pts;return r||i}));var T=c.reduce((function(e,t){return Math.max(Math.min(e,t.pts-t.dts),-18e3)}),0);if(T<0){o.Log.w(j,"PTS < DTS detected in video samples, shifting DTS by "+Math.round(T/90)+" ms to overcome this issue");for(var b=0;b<c.length;b++)c[b].dts+=T}this._videoTimeReference&&(this._videoTimeReferenceInfo.timeOffset=t,this._videoTimeReferenceInfo.accurateTimeOffset=n,this._videoTimeReferenceInfo.track=e,this._videoTimeReferenceInfo.sample&&(y++,c.unshift(this._videoTimeReferenceInfo.sample),this._videoTimeReferenceInfo.sample=void 0),c.length>1&&!a&&(this._videoTimeReferenceInfo.sample=c.pop(),y--));var L=c[0];g=Math.max(L.dts,0),m=Math.max(L.pts,0);var A=Math.round((g-E)/90);r&&A&&(A>1?o.Log.v(j,"AVC:"+A+" ms hole between fragments detected,filling it"):A<-1&&o.Log.v(j,"AVC:"+-A+" ms overlapping between fragments detected"),m=Math.max(m-(g-E),E),g=E,c[0].dts=g,c[0].pts=m,o.Log.v(j,"Video/PTS/DTS adjusted: "+Math.round(m/90)+"/"+Math.round(g/90)+",delta:"+A+" ms")),L=c[c.length-1],u=Math.max(L.dts,0),s=Math.max(L.pts,0,u),S&&(v=Math.round((u-g)/(c.length-1)));for(var R=0;R<y;R++){var I=c[R];I.dts=S?g+R*v:Math.max(I.dts,g),I.pts=Math.max(I.pts,I.dts)}for(var k=0;k<y;k++){var C=c[k];C.units;var x,D=void 0;if(S)D=Math.max(0,v*Math.round((C.pts-C.dts)/v));else{if(k<y-1)v=c[k+1].dts-C.dts;else{var w=this._config,O=0;if(O=this._videoTimeReferenceInfo.sample?this._videoTimeReferenceInfo.sample.dts-C.dts:e.sampleDuration||h.sampleDuration||C.dts-c[k>0?k-1:k].dts,O=90*Math.floor(O/90),w.stretchShortVideoTrack&&this._nextAudioPts){var P=w.maxBufferHole,N=Math.floor(P*d),M=(i?m+i*d:this._nextAudioPts)-C.pts;M>N?((v=M-O)<0&&(v=O),o.Log.v(j,"It is approximately "+M/90+" ms to the next segment; using duration "+v/90+" ms for the last video frame.")):v=O}else v=O}D=Math.round(C.pts-C.dts)}if(v<0||isNaN(v)){var U=0;r&&c.length<2&&(U=90*A),v=Math.max((e.sampleDuration||h.sampleDuration)-U,90)}x=C.units.reduce((function(e,t){return t.data.byteLength+4+e}),0),f.push({len:x,units:C.units,duration:v,cts:D,streamDTS:C.streamDTS,flags:{isLeading:0,isDependedOn:0,hasRedundancy:0,degradPrio:0,dependsOn:C.key?2:1,isNonSync:C.key?0:1}}),C.extraInfo&&(C.extraInfo.ptsMs=L.pts/d*1e3,p.push(C.extraInfo))}if(this._nextAvcDts=u+v,f.length&&this._forceFirstIDR){var F=f[0].flags;F.dependsOn=2,F.isNonSync=0}e.mp4Samples=f;var V={payload:B.videoMediaSegment(e.sequenceNumber++,g,e,this._getMoovByType(l.TrackType.VIDEO)),startPTS:m/d,endPTS:(s+v)/d,startDTS:g/d,endDTS:this._nextAvcDts/d,type:l.TrackType.VIDEO,streamDTS:f[0].streamDTS,framesInfo:p};return this._videoTime.vLastPTS=V.endPTS,0===h.nbSamples&&(h.firstDTS=g),h.nbSamples+=y,h.sampleDuration=Math.round((this._nextAvcDts-h.firstDTS)/h.nbSamples),e.samples=[],e.mp4Samples=[],V}}}},u._remuxAudio=function(e,t,r,i){if(void 0===i&&(i=!1),e.samples.length){var n,s,u,d=e.inputTimescale,c=e.timescale,f=d/c,_=e.isAAC?1024:1152,h=_*f,p=this._initPTS,v=[],m=[],g=0,y=e.samples,E=this._nextAudioPts,S=!1;if(void 0!==p&&(r=r||!!(y.length&&E&&(i&&Math.abs(t-E/d)<.1||Math.abs(y[0].pts-E-p)<20*h)),y.forEach((function(e){e.pts=e.dts=K(e.pts-p,t*d)})),0!==(y=y.filter((function(e){return e.pts>=0}))).length&&(r&&void 0!==E||(E=i?t*d:y[0].pts,S=!0),void 0!==E))){if(e.isAAC)for(var T=this._config.maxAudioFramesDrift,b=0,L=E;b<y.length;){var A=y[b],R=A.pts-L,I=Math.abs(1e3*R/d);if(R<=-T*h)y.splice(b,1);else if(R>=T*h&&I<H&&L){var k=Math.round(R/h);o.Log.w(j,"Injecting "+k+" audio frame @ "+(L/d).toFixed(3)+"s due to "+Math.round(1e3*R/d)+" ms gap.");for(var C=0;C<k;C++){var x=Math.max(L,0);(s=a.getSilentFrame(e.manifestCodec||e.codec,e.channelCount))||(o.Log.v(j,"Unable to get silent frame for given audio codec; duplicating last frame instead."),s=A.unit.subarray()),y.splice(b,0,{unit:s,pts:x,dts:x,streamDTS:A.streamDTS-(k-C)*h/90}),L+=h,b++}A.pts=A.dts=L,L+=h,b++}else A.pts=A.dts=L,L+=h,b++}for(var D=y.length,w=0,O=y.length;w<O;w++){var P=y[w],N=P.unit,M=P.pts;if(void 0!==u&&n)n.duration=Math.round((M-u)/f);else{var U=Math.round(1e3*(M-E)/d),F=0;if(r&&e.isAAC&&U){if(U>0&&U<H)F=Math.round((M-E)/h),o.Log.v(j,U+" ms hole between AAC samples detected,filling it"),F>0&&((s=a.getSilentFrame(e.manifestCodec||e.codec,e.channelCount))||(s=N.subarray()));else if(U<-12){o.Log.v(j,"drop overlapping AAC sample, expected/parsed/delta:"+(E/d).toFixed(3)+"s/"+(M/d).toFixed(3)+"s/"+-U+"ms");continue}M=E}g=M;for(var V=0;V<F;V++)(s=a.getSilentFrame(e.manifestCodec||e.codec,e.channelCount))||(o.Log.v(j,"Unable to get silent frame for given audio codec; duplicating this frame instead."),s=N.subarray()),n={len:s.byteLength,cts:0,duration:1024,unit:s,streamDTS:Math.round(P.streamDTS-(F-V)*h/90),flags:{isLeading:0,isDependedOn:0,hasRedundancy:0,degradPrio:0,dependsOn:1,isNonSync:0}},v.push(n)}n={len:N.byteLength,cts:0,duration:1024,unit:N,streamDTS:P.streamDTS,flags:{isLeading:0,isDependedOn:0,hasRedundancy:0,degradPrio:0,dependsOn:1,isNonSync:0}},v.push(n),P.extraInfo&&(P.extraInfo.ptsMs=M/d*1e3,m.push(P.extraInfo)),u=M}var G=0;if(D=v.length,n){if(D>=2&&(G=v[D-2].duration,n.duration=G),D&&"number"==typeof u){n&&0===n.duration&&(n.duration=e.isAAC?1024:1152),this._nextAudioPts=E=u+f*(G||_),e.mp4Samples=v;var W=B.audioMediaSegment(e.sequenceNumber++,g/f,e,this._getMoovByType(l.TrackType.AUDIO));e.samples=[],e.mp4Samples=[];var q=g/d,z=E/d,Y={payload:W,startPTS:q,endPTS:z,startDTS:q,endDTS:z,type:l.TrackType.AUDIO,streamDTS:v[0].streamDTS/1e3,framesInfo:m};return this._videoTime.aLastPTS=Y.endPTS,Y}S&&delete this._nextAudioPts,e.samples=[],e.mp4Samples=[]}}}},u._remuxEmptyAudio=function(e,t,r,i){if(void 0!==this._initDTS){var n=e.inputTimescale,s=n/(e.samplerate?e.samplerate:n),u=this._nextAudioPts,d=(void 0!==u?u:i.startDTS*n)+this._initDTS,c=i.endDTS*n+this._initDTS,l=1024*s,f=Math.ceil((c-d)/l),_=a.getSilentFrame(e.manifestCodec||e.codec,e.channelCount);if(o.Log.w(j,"remux empty Audio"),_){for(var h=[],p=0;p<f;p++){var v=d+p*l;h.push({unit:_,pts:v,dts:v,streamDTS:(i.streamDTS*n+p*l)/90})}return e.samples=h,this._remuxAudio(e,t,r)}o.Log.d(j,"Unable to remuxEmptyAudio since we were unable to get a silent frame for given audio codec!")}},u._resetVideoTime=function(){this._videoTime={nbSamples:0,firstDTS:0,sampleDuration:3e3,vLastPTS:0,aLastPTS:0}},u._getMoovByType=function(e){var t;return this._initSegment&&this._initSegment[e]&&(t=this._initSegment[e],delete this._initSegment[e]),t},t=e,(r=[{key:"ISGenerated",get:function(){return this._ISGenerated}}])&&V(t.prototype,r),s&&V(t,s),e}();function K(e,t){var r;if(void 0===t)return e;for(r=t<e?-8589934592:8589934592;Math.abs(e-t)>4294967296;)e+=r;return e}t.default=G},"./src/types/core.ts":function(e,t,r){var i,n,a,o,s,u,d,c,l,f,_,h,p,v;r.r(t),r.d(t,"CodecType",(function(){return i})),r.d(t,"Protocol",(function(){return a})),r.d(t,"MediaBox",(function(){return s})),r.d(t,"RetryType",(function(){return d})),r.d(t,"WaitingTrigger",(function(){return l})),r.d(t,"LevelType",(function(){return _})),r.d(t,"TrackType",(function(){return p})),r.d(t,"UNSEEKABLE_START_TIME_THRESHOLD",(function(){return m})),(n=i||(i={}))[n.h264=0]="h264",n[n.h265=1]="h265",n[n.av1=2]="av1",(o=a||(a={})).UNKNOWN="unknown",o.FLV="flv",o.HLS="hls",o.MP4="mp4",o.NATIVE="native",o.ABR_FLV="abrFlv",o.KWAI_HLS="kwaiHls",o.KWAI_MP4="kwaiMp4",o.KWAI_FLV="kwaiFlv",o.KWAI_WEBRTC="kwaiWebRtc",(u=s||(s={})).flv="flv",u.hls="hls",u.webrtc="webrtc",u.mp4="mp4",u.native="native",(c=d||(d={})).LIVE="live_retry",c.RTC="rtc_retry",c.CODEC="codec",(f=l||(l={}))[f.NATIVE=0]="NATIVE",f[f.CUSTOM=1]="CUSTOM",(h=_||(_={})).MAIN="main",h.AUDIO="audio",h.SUBTITLE="subtitle",(v=p||(p={})).VIDEO="video",v.AUDIO="audio";var m=.1},"./src/types/remux.ts":function(e,t,r){var i,n,a,o,s,u;r.r(t),r.d(t,"RemuxerTrackIdConfig",(function(){return i})),r.d(t,"AudioConfigType",(function(){return a})),r.d(t,"DemuxerType",(function(){return s})),(n=i||(i={}))[n.video=1]="video",n[n.audio=2]="audio",(o=a||(a={}))[o.ADTS=0]="ADTS",o[o.ASC=1]="ASC",(u=s||(s={})).UNKNOWN="unknown",u.FLV="flv",u.FMP4="fmp4",u.TS="ts",u.MP4="mp4"},"./src/utils/browser.ts":function(e,t,r){r.r(t);var i={};!function(){var e=self.navigator.userAgent.toLowerCase(),t=/(edge)\/([\w.]+)/.exec(e)||/(opr)[\/]([\w.]+)/.exec(e)||/(chrome)[ \/]([\w.]+)/.exec(e)||/(iemobile)[\/]([\w.]+)/.exec(e)||/(version)(applewebkit)[ \/]([\w.]+).*(safari)[ \/]([\w.]+)/.exec(e)||/(webkit)[ \/]([\w.]+).*(version)[ \/]([\w.]+).*(safari)[ \/]([\w.]+)/.exec(e)||/(webkit)[ \/]([\w.]+)/.exec(e)||/(opera)(?:.*version|)[ \/]([\w.]+)/.exec(e)||/(msie) ([\w.]+)/.exec(e)||e.indexOf("trident")>=0&&/(rv)(?::| )([\w.]+)/.exec(e)||e.indexOf("compatible")<0&&/(firefox)[ \/]([\w.]+)/.exec(e)||[],r=/(ipad)/.exec(e)||/(ipod)/.exec(e)||/(windows phone)/.exec(e)||/(iphone)/.exec(e)||/(kindle)/.exec(e)||/(android)/.exec(e)||/(windows)/.exec(e)||/(mac)/.exec(e)||/(linux)/.exec(e)||/(cros)/.exec(e)||[],n={browser:t[5]||t[3]||t[1]||"",version:t[2]||t[4]||"0",majorVersion:t[4]||t[2]||"0",platform:r[0]||""},a={x5:/ tbs\//.test(e)};if(n.browser){a[n.browser]=!0;var o=n.majorVersion.split(".");a.version={major:parseInt(n.majorVersion,10),string:n.version},o.length>1&&(a.version.minor=parseInt(o[1],10)),o.length>2&&(a.version.build=parseInt(o[2],10))}if(n.platform&&(a[n.platform]=!0),(a.chrome||a.opr||a.safari)&&(a.webkit=!0),a.rv||a.iemobile){a.rv&&delete a.rv;var s="msie";n.browser=s,a.msie=!0}if(a.edge){delete a.edge;var u="msedge";n.browser=u,a.msedge=!0}if(a.opr){var d="opera";n.browser=d,a.opera=!0}if(a.safari&&a.android){var c="android";n.browser=c,a.android=!0}for(var l in a.name=n.browser,a.platform=n.platform,i)i.hasOwnProperty(l)&&delete i[l];i=a}(),t.default=i},"./src/utils/decode-utf8.ts":function(e,t,r){function i(e){for(var t=[],r=0,i=e.byteLength;r<i;){if(e[r]<128)t.push(e[r]);else if(e[r]<192);else if(e[r]<224){if(r<i-1&&e[r+1]>>6==2){t.push((31&e[r])<<6|63&e[r+1]),r+=2;continue}}else if(e[r]<240){if(r<i-2&&e[r+1]>>6==2&&e[r+2]>>6==2){t.push((15&e[r])<<12|(63&e[r+1])<<6|63&e[r+2]),r+=3;continue}}else if(e[r]<248&&r<i-3&&e[r+1]>>6==2&&e[r+2]>>6==2&&e[r+3]>>6==2){t.push((7&e[r])<<18|(63&e[r+1])<<12|(63&e[r+2])<<6|63&e[r+3]),r+=4;continue}r++}return(String.fromCodePoint||n).apply(null,t)}function n(){for(var e=[],t=0,r="",i=0,n=arguments.length;i!==n;++i){var a=+arguments[i];if(!(a<1114111&&a>>>0===a))throw RangeError("Invalid code point: "+a);a<=65535?t=e.push(a):(a-=65536,t=e.push(55296+(a>>10),a%1024+56320)),t>=16383&&(r+=String.fromCharCode.apply(null,e),e.length=0)}return r+String.fromCharCode.apply(null,e)}r.r(t),r.d(t,"decodeUTF8",(function(){return i}))},"./src/utils/keyframes-utils.ts":function(e,t,r){r.r(t);var i=function(){function e(){}return e.getPosByTime=function(e,t){if(e){if(e[0]&&t<=e[0].time)return e[0];if(e[e.length-1]&&t>=e[e.length-1].time)return e[e.length-1];for(var r=0,i=e.length-1,n=0,a=0;r<=i;)if(t>(a=e[1+(n=(r+i)/2|0)]?e[n+1].time:Number.MAX_SAFE_INTEGER))r=n+1;else{if(!(t<e[n].time))return t===a?e[n+1]:e[n];i=n-1}return e[0]}},e}();t.default=i},"./src/utils/log.ts":function(e,t,r){var i,n;function a(e,t){return t&&0!==t.length||(t=[e],e=""),e="kwai-k"+(e?"::"+e:""),t.unshift("["+e+"] > "),t}r.r(t),r.d(t,"Log",(function(){return o})),r.d(t,"LOG_LEVEL",(function(){return i})),(n=i||(i={})).LEVEL_ERROR="e",n.LEVEL_WARN="w",n.LEVEL_INFO="i",n.LEVEL_DEBUG="d",n.LEVEL_VERBOSE="v";var o=function(){function e(){}return e.level=function(t){switch(e.ENABLE_ERROR=e.ENABLE_WARN=e.ENABLE_INFO=e.ENABLE_DEBUG=e.ENABLE_VERBOSE=!1,t){case i.LEVEL_ERROR:e.ENABLE_ERROR=!0;break;case i.LEVEL_WARN:e.ENABLE_ERROR=e.ENABLE_WARN=!0;break;case i.LEVEL_INFO:e.ENABLE_ERROR=e.ENABLE_WARN=e.ENABLE_INFO=!0;break;case i.LEVEL_DEBUG:e.ENABLE_ERROR=e.ENABLE_WARN=e.ENABLE_INFO=e.ENABLE_DEBUG=!0;break;case i.LEVEL_VERBOSE:e.ENABLE_ERROR=e.ENABLE_WARN=e.ENABLE_INFO=e.ENABLE_DEBUG=e.ENABLE_VERBOSE=!0}},e.e=function(t){if(e.ENABLE_ERROR){for(var r=arguments.length,i=new Array(r>1?r-1:0),n=1;n<r;n++)i[n-1]=arguments[n];var o=a(t,i);(console.error||console.warn||console.log).apply(console,o)}},e.w=function(t){if(e.ENABLE_WARN){for(var r=arguments.length,i=new Array(r>1?r-1:0),n=1;n<r;n++)i[n-1]=arguments[n];var o=a(t,i);(console.warn||console.log).apply(console,o)}},e.i=function(t){if(e.ENABLE_INFO){for(var r=arguments.length,i=new Array(r>1?r-1:0),n=1;n<r;n++)i[n-1]=arguments[n];var o=a(t,i);(console.info||console.log).apply(console,o)}},e.d=function(t){if(e.ENABLE_DEBUG){for(var r=arguments.length,i=new Array(r>1?r-1:0),n=1;n<r;n++)i[n-1]=arguments[n];var o=a(t,i);(console.debug||console.log).apply(console,o)}},e.v=function(t){if(e.ENABLE_VERBOSE){for(var r=arguments.length,i=new Array(r>1?r-1:0),n=1;n<r;n++)i[n-1]=arguments[n];var o=a(t,i);console.log.apply(console,o)}},e}();o.ENABLE_ERROR=!0,o.ENABLE_WARN=!1,o.ENABLE_INFO=!1,o.ENABLE_DEBUG=!1,o.ENABLE_VERBOSE=!1},"./src/utils/uint8-array-tools.ts":function(e,t,r){function i(e,t,r){var i=r?t+r:e.byteLength-1;return String.fromCharCode.apply(null,e.subarray(t,i))}function n(e,t,r){void 0===t&&(t=0),void 0===r&&(r=!1);var i=0;return(i=r?e[t+1]<<8|e[t]:e[t]<<8|e[t+1])<0?65536+i:i}function a(e,t,r){void 0===t&&(t=0),void 0===r&&(r=!1);var i=0;return(i=r?e[t+2]<<16|e[t+1]<<8|e[t]:e[t]<<24|e[t+1]<<16|e[t+2]<<8)<0?16777215+i:i}function o(e,t,r){void 0===t&&(t=0),void 0===r&&(r=!1);var i=0;return(i=r?e[t+3]<<24|e[t+2]<<16|e[t+1]<<8|e[t]:e[t]<<24|e[t+1]<<16|e[t+2]<<8|e[t+3])<0?4294967296+i:i}function s(e,t,r){void 0===r&&(r=!1);var i=0;return 2147483648&(i=r?e[t+3]<<24|e[t+2]<<16|e[t+1]<<8|e[t]:e[t]<<24|e[t+1]<<16|e[t+2]<<8|e[t+3])&&(i=i+1-4294967295),i}function u(e,t,r){return void 0===t&&(t=0),void 0===r&&(r=!1),r?e[t+7]<<56|e[t+6]<<48|e[t+5]<<40|e[t+4]<<32|e[t+3]<<24|e[t+2]<<16|e[t+1]<<8|e[t]:e[t]<<56|e[t+1]<<48|e[t+2]<<40|e[t+3]<<32|e[t+4]<<24|e[t+5]<<16|e[t+6]<<8|e[t+7]}r.r(t),r.d(t,"bin2str",(function(){return i})),r.d(t,"readUint16",(function(){return n})),r.d(t,"readUint24",(function(){return a})),r.d(t,"readUint32",(function(){return o})),r.d(t,"readInt32",(function(){return s})),r.d(t,"readUint64",(function(){return u}))}}).default);var Gi=Hi(ji.exports);export{Gi as K,Nt as P,e as S,Ui as c,r as f,t as m,i as p,Fi as s,n as w};
    </script>
    <link rel="modulepreload" href="/assets/vendor.cb11ce5d.js">
    <link rel="stylesheet" href="/assets/index.4bf7ee11.css">
  </head>
  <body>
    <div id="app"></div>
    
  </body>
</html>
